<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Create a Public Holidays API using Microsoft Azure | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/2022/08/09/create-a-public-holidays-api-using-microsoft-azure/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Create a Public Holidays API using Microsoft Azure | luke.geek.nz"><meta data-rh="true" name="description" content="Using a previous blog post I did on using a third-party API (Application Programming Interface) to start a Virtual Machine when it wasn&#x27;t a Public Holiday, I had a thought on what could be an option if I wanted an API only accessible on an internal network or if I wanted to include custom Holidays such as Star Wars day or company holidays? Could I create and query my API using Microsoft Azure services? You can!"><meta data-rh="true" property="og:description" content="Using a previous blog post I did on using a third-party API (Application Programming Interface) to start a Virtual Machine when it wasn&#x27;t a Public Holiday, I had a thought on what could be an option if I wanted an API only accessible on an internal network or if I wanted to include custom Holidays such as Star Wars day or company holidays? Could I create and query my API using Microsoft Azure services? You can!"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-08-09T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/2022/08/09/create-a-public-holidays-api-using-microsoft-azure/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/2022/08/09/create-a-public-holidays-api-using-microsoft-azure/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/2022/08/09/create-a-public-holidays-api-using-microsoft-azure/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.94a74a36.css">
<script src="/assets/js/runtime~main.60b6c6e5.js" defer="defer"></script>
<script src="/assets/js/main.29f5ca25.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azure-container-apps-overview/">Azure Container Apps - Overview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/book-review-cloud-solution-architects-career-master-plan/">Book Review Cloud Solution Architects Career Master Plan</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/microsoft-azure-sandbox-design-considerations/">Microsoft Azure - Sandbox Design Considerations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/tag-azure-resources-owner-azure-automation-runbook/">Tag Azure Resources with Owner using Azure Automation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/enterprise-policy-code-azure-devops/">Enterprise Policy as Code with Azure DevOps</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Using a previous blog post I did on using a third-party API (Application Programming Interface) to start a Virtual Machine when it wasn&#x27;t a Public Holiday, I had a thought on what could be an option if I wanted an API only accessible on an internal network or if I wanted to include custom Holidays such as Star Wars day or company holidays? Could I create and query my API using Microsoft Azure services? You can!"><header><h1 class="title_f1Hy" itemprop="headline">Create a Public Holidays API using Microsoft Azure</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-08-09T00:00:00.000Z" itemprop="datePublished">August 9, 2022</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Luke Murray</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Using a previous <a href="https://luke.geek.nz/azure/turn-on-a-azure-virtual-machine-using-azure-automation/" target="_blank" rel="noopener noreferrer" title="Turn on a Azure Virtual Machine using Azure Automation">blog post</a> I did on using a third-party API <em>(Application Programming Interface)</em> to start a Virtual Machine when it wasn&#x27;t a Public Holiday, I had a thought on what could be an option if I wanted an API only accessible on an internal network or if I wanted to include custom Holidays such as Star Wars day or company holidays? Could I create and query my API using Microsoft Azure services? You can!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<blockquote>
<p>Today we will create a base Public Holidays API using several Microsoft Azure serverless services, such as Azure Function, Azure Storage Account and API Management.</p>
</blockquote>
<p><em>Note: As this is a demonstration, I will be using a</em> <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-scale?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Functions hosting options"><em>Consumption-based Azure Function</em></a> <em>and Azure storage account, and although it is a good place to start - depending on your requirements, you may be better off with Azure Function Premium Plan to avoid cold-start times, and if you need a high amount of requests and writes (GET and POSTs) and resiliency, then replace the Storage account table with a</em> <a href="https://learn.microsoft.com/en-us/azure/cosmos-db/introduction?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Cosmos DB"><em>Cosmos DB</em></a><em>.</em></p>
<p>The solution will be made up of the following:</p>















































<table><thead><tr><th>Azure Service</th><th>Name</th><th>Plan</th><th>Note</th></tr></thead><tbody><tr><td>Application Insights</td><td>ai-nzPublicHolidays-prd-ae</td><td></td><td></td></tr><tr><td>Azure API Management</td><td>apims-publicholidays-prd-ae</td><td>Developer (No SLA)</td><td></td></tr><tr><td>Azure Function</td><td>func-nzpublicHolidays-prd-ae</td><td>Function App - Consumption</td><td></td></tr><tr><td>Azure Storage Account</td><td>funcnzpublicholidaystgac</td><td>StorageV2 (general purpose v2) - Locally-redundant storage (LRS)</td><td>Contains &#x27;PublicHolidays&#x27; table</td></tr><tr><td>Azure Storage Account</td><td>rgnzpublicholidayspb4ed</td><td>Storage (general purpose v1)  - Locally-redundant storage (LRS)</td><td>Contains Azure Functions App Files</td></tr><tr><td>Resource Group</td><td>rg-publicholidays-prd-ae</td><td></td><td>Resource Group - containing above resources.</td></tr></tbody></table>
<p><img loading="lazy" alt="Azure Resource Group - Diagram" src="/assets/images/api_resourcegroupazviz-6b750e49b76e6fbbc15caf8db97c3dac.png" title="Azure Resource Group - Diagram" width="2805" height="300" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites">Pre-requisites<a href="#pre-requisites" class="hash-link" aria-label="Direct link to Pre-requisites" title="Direct link to Pre-requisites">​</a></h4>
<ul>
<li>An Azure subscription <em>(with at least Contributor rights to a Resource Group)</em>.</li>
<li>Azure PowerShell modules <em>(</em><a href="https://learn.microsoft.com/en-us/powershell/module/az.accounts/?view=azps-8.2.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Az.Accounts"><em>Az.Accounts</em></a><em>,</em> <a href="https://learn.microsoft.com/en-us/powershell/module/az.storage/?view=azps-8.2.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Az.Storage"><em>Az.Storage</em></a> <em>&amp;</em> <a href="https://www.powershellgallery.com/packages/AzTable/" target="_blank" rel="noopener noreferrer" title="AzTable"><em>AzTables</em></a><em>)</em></li>
</ul>
<p><em>Note: AzTables is not part of the standard Az PowerShell module set and is a separate module you will need to install (Install-Module AzTables).</em></p>
<p>We will use a mix of the Azure Portal and PowerShell to deploy this solution from start to finish; you can find the source data and code directly in the GitHub repository here: <a href="https://github.com/lukemurraynz/PublicHoliday-API" target="_blank" rel="noopener noreferrer" title="PublicHoliday-API">lukemurraynz/PublicHoliday-API</a> for reference <em>(feel free to fork, raise pull requests etc.).</em> In this guide, I will try not to assume preexisting knowledge <em>(other than general Azure and PowerShell knowledge)</em>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h3>
<p>The deployment steps will be separated into different sections to help simplify implementation.</p>
<blockquote>
<p>First, make sure you adjust the names of your resources and locations to suit your naming conventions and regional locations <em>(such as Australia East or West Europe)</em>. Your deployments may fail if a name is already in use. See &quot;<a href="https://luke.geek.nz/azure/microsoft-azure-naming-conventions/" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Naming Conventions ">Microsoft Azure Naming Conventions</a>&quot; for more about Naming conventions.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-resource-group">Create Resource Group<a href="#create-resource-group" class="hash-link" aria-label="Direct link to Create Resource Group" title="Direct link to Create Resource Group">​</a></h4>
<p>The Resource Group will contain all resources related to the API that we will deploy today.</p>
<p><em>However, I recommend you consider what resources might be shared outside of this API - such as API Management, and put them in a separate Shared or Common Resource Group, to keep the li.e.ecycle of your resources together (ie API resources all in one place, so if it gets decommissioned, it is as easy a deleting the Resource Group).</em></p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click <strong>Click on the burger and click</strong> <a href="https://portal.azure.com/#view/HubsExtension/BrowseResourceGroups" target="_blank" rel="noopener noreferrer" title="Resource Groups"><strong>Resource groups</strong></a></li>
<li>Click <strong>+ Create</strong></li>
<li>Select your <strong>Subscription</strong></li>
<li>Type in a name for your <strong>Resource Group</strong> <em>(like &#x27;rg-publicholidays-prd-ae&#x27;)</em></li>
<li>Select your <strong>Region</strong> and click <strong>Next: Tags</strong></li>
<li>Enter in applicable <strong>tags</strong> <em>(i.e. Application: Public Holidays API)</em></li>
<li>Click <strong>Next: Review + create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><img loading="lazy" alt="Create a resource group" src="/assets/images/azureportal_creatergapi-e4b9ec363fbcf561a94e95c818b36b5e.png" title="Create a resource group" width="736" height="374" class="img_ev3q"></p>
<p>If you prefer PowerShell, you can deploy a new Resource Group with the below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzResourceGroup -Name &#x27;rg-publicholidays-prd-ae&#x27; -Location &#x27;Australia East&#x27; -Tag @{Application=&quot;Public Holidays API&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-storage-account">Create Storage Account<a href="#create-storage-account" class="hash-link" aria-label="Direct link to Create Storage Account" title="Direct link to Create Storage Account">​</a></h4>
<p>Now that the Resource Group has been created, it&#x27;s time to import our Storage Account - which will hold our Table of data around Public Holidays.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click <strong>Click on the burger and click</strong> <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Storage%2FStorageAccounts" target="_blank" rel="noopener noreferrer" title="Storage accounts"><strong>Storage Accounts</strong></a></li>
<li>Click <strong>+ Create</strong></li>
<li>Select the <strong>Subscription</strong> and <strong>Resource Group</strong> you created earlier</li>
<li>Enter in a <strong>Name</strong> for your <strong>Storage Account</strong> (<em>like &#x27;funcnzpublicholidaystgac&#x27;)</em></li>
<li>Select your <strong>Region</strong> <em>(i.e. Australia East)</em></li>
<li>For <strong>Performance</strong>, I am going to select: <strong>Standard</strong></li>
<li>For <strong>Redundancy</strong>, as this is a demo, I will select <strong>Locally-redundant storage (LRS). However, if</strong> you plan on running this in production, you may consider ZRS for zone redundancy.</li>
<li>If you plan on locking down the Storage Account to your Virtual Network or specific IP addresses, continue to the Networking Tab; we can accept the defaults and click: <strong>Review</strong>.</li>
<li>Click <strong>Create</strong></li>
</ol>
<p>If you prefer PowerShell, you can deploy a new Storage account with the below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzStorageAccount -ResourceGroupName &#x27;rg-publicholidays-prd-ae&#x27; -Name &#x27;funcnzpublicholidaystgac&#x27; -Location &#x27;Australia East&#x27; -SkuName &#x27;Standard_LRS&#x27; -Kind StorageV2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="import-public-holiday-data">Import Public Holiday data<a href="#import-public-holiday-data" class="hash-link" aria-label="Direct link to Import Public Holiday data" title="Direct link to Import Public Holiday data">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-storage-account-table">Create Azure Storage Account Table<a href="#create-azure-storage-account-table" class="hash-link" aria-label="Direct link to Create Azure Storage Account Table" title="Direct link to Create Azure Storage Account Table">​</a></h5>
<p>Now that we have the Storage account that will hold our Public Holiday time to import the data.</p>
<p>Most of this task will be done with PowerShell, but first, we need to create the Table that will hold our Public Holidays.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click <strong>Click on the burger and click</strong> <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Storage%2FStorageAccounts" target="_blank" rel="noopener noreferrer" title="Storage accounts"><strong>Storage Accounts</strong></a></li>
<li><strong>Navigate</strong> to your created <strong>Storage</strong> account</li>
<li>In the Navigation blade, click <strong>Tables</strong></li>
<li>Click <strong>+ Table</strong></li>
<li>For a Table Name, I will go with <strong>PublicHolidays</strong></li>
<li>Click <strong>Ok</strong></li>
</ol>
<p><img loading="lazy" alt="Create Azure Storage Account Table" src="/assets/images/azureportal_createpublicholidaystable-17900c7b03aa308022d2d7418c793f5a.png" title="Create Azure Storage Account Table" width="753" height="521" class="img_ev3q"></p>
<p>You can use PowerShell to create the Table below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageAccount = Get-AzStorageAccount -ResourceGroupName &#x27;rg-publicholidays-prd-ae&#x27; -Name &#x27;funcnzpublicholidaystgac&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageContext = $storageAccount.Context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzStorageTable -Name &#x27;PublicHolidays&#x27; -Context $storageContext</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="import-public-holiday-data-into-table">Import Public Holiday Data into Table<a href="#import-public-holiday-data-into-table" class="hash-link" aria-label="Direct link to Import Public Holiday Data into Table" title="Direct link to Import Public Holiday Data into Table">​</a></h5>
<p>Now that we have the Azure storage account and PublicHolidays table, it&#x27;s time to import the data.</p>
<p>If you want to do this manually, the Azure Table will have the following columns:</p>
<p>| Date | Country | Type | Name | Day | Year | Comments |</p>
<p>We could enter the data manually, but I will leverage the Nager API to download and parse a CSV file for a few countries. You can find the source data and code directly in the GitHub repository here: <a href="https://github.com/lukemurraynz/PublicHoliday-API" target="_blank" rel="noopener noreferrer" title="PublicHoliday-API">lukemurraynz/PublicHoliday-API</a> for reference.</p>
<p>To do this, we will need PowerShell, so assuming you have logged into PowerShell and set the context to your Azure subscription, let us continue.</p>
<p>I have created a CSV <em>(Comma-separated values)</em> file with a list of countries <em>(i.e. US, NZ, AU)</em> called &#x27;SourceTimeDate.CSV&#x27;, but you can adjust this to suit your requirements and place it in a folder on my C:\ drive called: Temp\API.</p>
<p>Open <strong>PowerShell</strong> and <strong>run</strong> the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Folder = &#x27;C:\Temp\API\&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Csv = Import-csv &quot;$Folder\DateTimeSource\SourceTimeDate.csv&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$CurrentYear = (Get-Date).Year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ForEach ($Country in $Csv)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$CountryCode = $Country.Country</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Invoke-WebRequest -Uri &quot;https://date.nager.at/PublicHoliday/Country/$CountryCode/$CurrentYear/CSV&quot; -OutFile &quot;$FolderAPI\DateTimeSource\Country$CountryCode$CurrentYear.csv&quot; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These cmdlets will download a bunch of CSV files into the API folder, with the Public Holidays for each Country for this year, and then you can adjust the $CurrentYear variable for future years <em>(i.e. 2025)</em>.</p>
<p>Once you have all the CSV files for your Public Holidays and before we import the data into the Azure storage table, now is the time to create a new Custom Holidays CSV; you can easily use an existing one to create a new CSV containing your company&#x27;s public holidays or other days that may be missing from the standard list, make sure it matches the correct format and save it into the same folder.</p>
<p><img loading="lazy" alt="Custom Public Holidays API" src="/assets/images/customholidays_api-e3feccfea6b230e5b5caea2b070d43e5.png" title="Custom Public Holidays API" width="723" height="159" class="img_ev3q"></p>
<p>Now that you have all your CSV files containing the Public Holidays in your Country or countries, it&#x27;s time to import them into the Azure Table. First, we import the data using a PowerShell session logged into Azure.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Imports Public Holiday into Azure Storage table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Requires AzTable Module (not part of the normal Az cmdlets)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Import-Module AzTable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Imports data from CSV files into $GLobalHolidays variable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Folder = &#x27;C:\Temp\API\&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$GlobalHolidays = Get-ChildItem &quot;$Folder\DateTimeSource\*.csv&quot; | Foreach-Object {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $basename = $_.BaseName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  import-csv $_ </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Connect-AzAccount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Connects to Azure Storage Account</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageAccountName = &#x27;funcnzpublicholidaystgac&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$resourceGroupName = &#x27;rg-publicHolidays-prd-ae&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$tableName = &#x27;PublicHolidays&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageAccount = Get-AzStorageAccount -ResourceGroupName $resourceGroupName -Name $storageAccountName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageContext = $storageAccount.Context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$cloudTable = (Get-AzStorageTable -Name $tableName -Context $storageContext).CloudTable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Imports CSV data into Azure Table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$counter = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ForEach ($Holiday in $GlobalHolidays)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $Date = [DateTime]($Holiday.Date)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $Dayofweek = $Date.DayOfWeek | Out-String</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $Year = $Date.Year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $HolidayDate = Get-Date $Date -format &quot;dd-MM-yyyy&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Add-AzTableRow `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -table $cloudTable `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -partitionKey &#x27;1&#x27; `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -rowKey ((++$counter)) -property @{&quot;Date&quot;=$HolidayDate;&quot;Country&quot;=$Holiday.CountryCode;&quot;Type&quot;=$Holiday.Type;&quot;Name&quot;=$Holiday.LocalName;&quot;Day&quot;=$Dayofweek;&quot;Year&quot;=$Year;&quot;Comments&quot;=$Holiday.Counties}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Validate the data in the Storage table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-AzTableRow -table $cloudTable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="Import CSV to Azure Storage Account" src="/assets/images/import-csvtoazuretables-8d10f55cd0b8a8e8297b959aa7ae3cd5.gif" title="Import CSV to Azure Storage Account" width="1203" height="361" class="img_ev3q"></p>
<p><img loading="lazy" alt="Validate Azure Storage Account Table" src="/assets/images/import-csvtoazuretablesvalidate-0615d15e07b7cab4343607aa29e118e6.gif" title="Validate Azure Storage Account Table" width="1203" height="361" class="img_ev3q"></p>
<p>Now the Public Holidays are imported into the Azure storage account table with additional information, such as the Day it falls, and the Date format has been changed to suit the NZ format <em>(DD-MM-YYYY)</em>.</p>
<p>If we log in to the Azure Portal, navigate to the Storage account and under Storage Browser, we can now see our Table is full of Public Holidays.</p>
<p><img loading="lazy" src="/assets/images/azureportal_storagebrowser_api_table-4ed54d2629d3d74f3d5221901f6bd6d9.png" width="2109" height="965" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-api">Create API<a href="#create-api" class="hash-link" aria-label="Direct link to Create API" title="Direct link to Create API">​</a></h4>
<p>That we have our Table with Public Holiday data, it&#x27;s time to create our Azure Function to act as the API that will talk to the azure storage account!</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-function">Create Azure Function<a href="#create-azure-function" class="hash-link" aria-label="Direct link to Create Azure Function" title="Direct link to Create Azure Function">​</a></h5>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click <strong>Click on the burger and click</strong> <a href="https://portal.azure.com/#view/HubsExtension/BrowseResourceGroups" target="_blank" rel="noopener noreferrer" title="Resource groups"><strong>Resource groups</strong></a></li>
<li>Navigate to your <strong>resource group</strong> and click <strong>+ Create</strong></li>
<li>Search for: <strong>Function</strong></li>
<li>Select <strong>Function App</strong>, and click <strong>Create</strong></li>
<li>Enter your <strong>Function App Name</strong> <em>(i.e. &#x27;func-nzpublicHolidays-prd-ae&#x27;)</em></li>
<li>For Runtime Stack, select <strong>PowerShell Core</strong></li>
<li>Select the latest version (at this time, it&#x27;s <strong>7.2</strong>)</li>
<li>Select your <strong>Region</strong></li>
<li>Select <strong>Windows</strong></li>
<li>Set your <strong>Plan</strong> <em>(in my example, its Consumption (Serverless))</em></li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><img loading="lazy" alt="Azure Function - Create" src="/assets/images/azureportal_createazfunctionapiwin-ef7a4566a3c9cf027bafa17f95362cdb.png" title="Azure Function - Create" width="738" height="782" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-environment-variables">Configure Environment Variables<a href="#configure-environment-variables" class="hash-link" aria-label="Direct link to Configure Environment Variables" title="Direct link to Configure Environment Variables">​</a></h5>
<p>Now that the Function App has been created before creating the GetPublicHoliday function, we need to add a few environment variables that the Function will use; these variables will contain the ResourceGroup and Storage account name.</p>
<ol>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>Click <strong>Configuration</strong></li>
<li>Click <strong>+ New application setting</strong></li>
<li>Under the name, add: <strong>PublicHolidayRESOURCEGROUPNAME</strong></li>
<li>For value, type in the name of your resource group.</li>
<li>Add a second application setting named: <strong>PublicHolidaySTORAGEACCNAME</strong></li>
<li>For value, type in the name of your storage account that contains the Public Holiday table.</li>
<li>Click <strong>Save</strong> <em>(to save the variables)</em>.</li>
</ol>
<p><img loading="lazy" alt="Azure Function - Variables" src="/assets/images/azureportal_funcapp_api_variables-1cd7cf230579d1c83511b45531fa3f14.png" title="Azure Function - Variables" width="1318" height="672" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-managed-identity">Configure Managed Identity<a href="#configure-managed-identity" class="hash-link" aria-label="Direct link to Configure Managed Identity" title="Direct link to Configure Managed Identity">​</a></h5>
<p>Next, we need to give the Function App the ability to read the Azure storage account. To do this, we need to configure a System assigned managed identity.</p>
<ol>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>Click <strong>Identity</strong></li>
<li>Under the System assigned heading, toggle the status to <strong>On</strong></li>
<li>Click <strong>Save</strong></li>
<li>Select <strong>Yes</strong>, to enable the System assigned managed identity</li>
<li>Under Permissions, click <strong>Azure role assignments</strong></li>
<li>Click <strong>+ Add role assignment</strong></li>
<li>For Scope, select <strong>Storage</strong></li>
<li>Select your Subscription and storage account containing your Public Holiday data</li>
<li>For role, select <strong>Contributor</strong> <em>(Storage Table Data Reader is not enough).</em></li>
<li>Click <strong>Save</strong></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-requirements">Configure Requirements<a href="#configure-requirements" class="hash-link" aria-label="Direct link to Configure Requirements" title="Direct link to Configure Requirements">​</a></h5>
<p>The Azure function app will rely on a few PowerShell Modules; for the FunctionApp to load them, we need to add them to the requirements.psd1 file.</p>
<ol>
<li>
<p><strong>Navigate</strong> to your <strong>Azure Function</strong></p>
</li>
<li>
<p>Click <strong>App files</strong></p>
</li>
<li>
<p>Change the dropdown to <strong>requirements.psd1</strong></p>
</li>
<li>
<p>In the hash array, comment out the #Az module line <em>(as this will load the entire Az Module set, which will cause an increased delay in the startup as those extra modules aren&#x27;t needed)</em>, and add the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># This file enables modules to be automatically managed by the Functions service.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># See https://aka.ms/functionsmanageddependency for additional information.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # For latest supported version, go to &#x27;https://www.powershellgallery.com/packages/Az&#x27;. </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # To use the Az module in your function app, please uncomment the line below.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    #&#x27;Az&#x27; = &#x27;8.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;Az.Accounts&#x27;  = &#x27;2.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;Az.Storage&#x27;   = &#x27;4.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;Az.Resources&#x27; = &#x27;2.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;AzTable&#x27;      = &#x27;2.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-function-publicholidays">Create Function PublicHolidays<a href="#create-function-publicholidays" class="hash-link" aria-label="Direct link to Create Function PublicHolidays" title="Direct link to Create Function PublicHolidays">​</a></h5>
<p>Now that the Function App has been configured, it is time to create our Function.</p>
<ol>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>Click <strong>Functions</strong></li>
<li>Click <strong>+ Create</strong></li>
<li>Change Development environment to <strong>Develop in Portal</strong></li>
<li>Select Template, an <strong>HTTP trigger</strong></li>
<li>For the New Function name, I will go with <strong>GetPublicHoliday</strong></li>
<li>Change Authorization level to <strong>Anonymous</strong> <em>(if you aren&#x27;t going to implement API Management, select Function and look at whitelisting your IP only, we will be locking it down to API Management later)</em>.</li>
<li>Click <strong>Create</strong></li>
</ol>
<p><img loading="lazy" alt="Create Azure Function App" src="/assets/images/azureportal_createfunctionpublicholidays-2673e41f9b6d67f4d37da55b13f9de6c.png" title="Create Azure Function App" width="840" height="829" class="img_ev3q"></p>
<ol>
<li>
<p>Click <strong>Code + Test</strong></p>
</li>
<li>
<p>Copy the following Code into the run.ps1 file, this code is core to the Function that will read the HTTP request and bring back a PowerShell object with the Public Holiday information as part of a GET request:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;# The code above does the following, explained in English:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. Read the query parameters from the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. Read the body of the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. Write to the Azure Functions log stream.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. Interact with query parameters or the body of the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5. Associate values to output bindings by calling &#x27;Push-OutputBinding&#x27;. </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://luke.geek.nz/ #&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using namespace System.Net</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Input bindings are passed in via param block.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">param([Parameter(Mandatory = $true)]$Request, [Parameter(Mandatory = $true)]$TriggerMetadata)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Write to the Azure Functions log stream.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write-Host &#x27;GetPublicHoliday function processed a request.&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Interact with query parameters or the body of the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$date = $Request.Query.Date</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$country = $Request.Query.CountryCode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$resourceGroupName = $env:PublicHolidayRESOURCEGROUPNAME</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageAccountName = $env:PublicHolidaySTORAGEACCNAME</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$tableName = &#x27;PublicHolidays&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ClientIP = $Request.Headers.&quot;x-forwarded-for&quot;.Split(&quot;:&quot;)[0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">try {   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $storageAccount = Get-AzStorageAccount -ResourceGroupName $resourceGroupName -Name $storageAccountName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $storageContext = $storageAccount.Context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $cloudTable = (Get-AzStorageTable -Name $tableName -Context $storageContext).CloudTable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Import-Module AzTable   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $Tables = Get-AzTableRow -table $cloudTable </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ForEach ($table in $Tables)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [string]$Filter1 = [Microsoft.Azure.Cosmos.Table.TableQuery]::GenerateFilterCondition(&quot;Country&quot;, [Microsoft.Azure.Cosmos.Table.QueryComparisons]::Equal, $country)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [string]$Filter2 = [Microsoft.Azure.Cosmos.Table.TableQuery]::GenerateFilterCondition(&quot;Date&quot;, [Microsoft.Azure.Cosmos.Table.QueryComparisons]::Equal, $date)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [string]$finalFilter = [Microsoft.Azure.Cosmos.Table.TableQuery]::CombineFilters($Filter1, &quot;and&quot;, $Filter2)     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $object = Get-AzTableRow -table $cloudTable -CustomFilter $finalFilter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $body = @()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $System = New-Object -TypeName PSObject</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name CountryCode -Value   $object.Country</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name HolidayDate -Value   $object.Date</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name HolidayYear -Value   $object.Year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name HolidayName -Value   $object.Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name HolidayType -Value   $object.Type</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name Comments -Value      $object.Comments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name RequestedIP -Value   $ClientIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $body += $System</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $System = New-Object -TypeName PSObject</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $status = [Net.HttpStatusCode]::OK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">catch {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $body = &quot;Failure connecting to table for state data, $_&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $status = [Net.HttpStatusCode]::BadRequest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#$body =  $TriggerMetadata</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Associate values to output bindings by calling Push-OutputBinding&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Push-OutputBinding -Name Response -Value ([HttpResponseContext]@{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    StatusCode = $status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Body       = $body</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="test-function---publicholidays">Test Function - PublicHolidays<a href="#test-function---publicholidays" class="hash-link" aria-label="Direct link to Test Function - PublicHolidays" title="Direct link to Test Function - PublicHolidays">​</a></h5>
<p>Before proceeding with the next step, it&#x27;s time to test the function.</p>
<ol>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>Click <strong>Functions</strong></li>
<li>Click <strong>GetPublicHoliday</strong></li>
<li>Click <strong>Code + Test</strong></li>
<li>Click <strong>Test/Run</strong></li>
<li>Change HTTP method to <strong>Get</strong></li>
<li>Under Query, add Country value and Date value.</li>
</ol>
<p>Note: Make sure the date and country formats match what is in the Azure storage account.</p>
<p>You can also Invoke the function app directly with PowerShell, with the Date and Country as Parameters at the end:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Invoke-RestMethod -URI &quot;https://func-nzpublicholidays-prd-ae.azurewebsites.net/api/GetPublicHoliday?Date=25-12-2023&amp;CountryCode=NZ&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="Test Public Holiday API" src="/assets/images/testpublicholidayapi-3b124ddd861072dc80c53f1fee4ffb52.gif" title="Test Public Holiday API" width="1203" height="361" class="img_ev3q"></p>
<p>Congratulations! You have now created a Public Holiday API that you can call for automation! You can lock down the Function App to only certain IPs or proceed to configure Azure API Management.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-azure-api-management">Configure Azure API Management<a href="#configure-azure-api-management" class="hash-link" aria-label="Direct link to Configure Azure API Management" title="Direct link to Configure Azure API Management">​</a></h5>
<p>Now that the Function App responds to requests, we can expose the HTTP endpoint through <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Expose serverless APIs from HTTP endpoints using Azure API Management">Azure API Management</a>. Azure API Management will give greater flexibility and security over API endpoints, particularly when dealing with more than one API. Azure API Management also offers inbuilt shared cache functionality and integration into <a href="https://azure.microsoft.com/en-us/services/cache/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" Azure Cache for Redis®2">Azure Cache for Redis</a>.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>On the Navigation blade, select <strong>API Management</strong></li>
<li>Click <strong>Create New</strong></li>
<li>Select your subscription, <strong>Region</strong>, and organisation <strong>name</strong>.</li>
<li>Select a <a href="https://azure.microsoft.com/en-us/pricing/details/api-management/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" API Management pricing"><strong>Pricing Tier</strong></a></li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><img loading="lazy" alt="Create Azure API Management" src="/assets/images/azureportal_createapimanagement-7cd983b8676b0d28c16984ab9db47cdc.png" width="802" height="790" class="img_ev3q"></p>
<ol>
<li>
<p>Wait for 10 minutes to half an hour for provisioning to take place, and Azure API Management will be in an activating state.</p>
</li>
<li>
<p>Once API Management has been provisioned, you can <strong>copy</strong> the <strong>Virtual IP (VIP)</strong> addresses of API Management and <strong>restrict</strong> your <strong>function</strong> app to <strong>only</strong> allow <strong>inbound</strong> access from that <strong>IP</strong>.</p>
</li>
<li>
<p>Once you have done that, add the GetPublicHoliday function app into Azure API Management, add the paths to add a version, and then, using the subscription key, you run the following command to pull data.</p>
<p>Invoke-RestMethod -uri &quot;<a href="https://apims-nzpublicholidays-prd-ae.azure-api.net/v1/GetPublicHoliday?Date=4/05/2022&amp;CountryCode=NZ&amp;Ocp-Apim-Subscription-Key=$KEY" target="_blank" rel="noopener noreferrer">https://apims-nzpublicholidays-prd-ae.azure-api.net/v1/GetPublicHoliday?Date=4/05/2022&amp;CountryCode=NZ&amp;Ocp-Apim-Subscription-Key=$KEY</a>&quot;</p>
</li>
</ol></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/2022/08/17/connect-to-azure-sql-database-in-a-jupyter-notebook-using-python/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Connect to Azure SQL Database in a Jupyter Notebook using Python</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/microsoft-azure-zonalallocationfailed/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Microsoft Azure - ZonalAllocationFailed</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#pre-requisites" class="table-of-contents__link toc-highlight">Pre-requisites</a></li></ul></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a><ul><li><a href="#create-resource-group" class="table-of-contents__link toc-highlight">Create Resource Group</a></li><li><a href="#create-storage-account" class="table-of-contents__link toc-highlight">Create Storage Account</a></li><li><a href="#import-public-holiday-data" class="table-of-contents__link toc-highlight">Import Public Holiday data</a><ul><li><a href="#create-azure-storage-account-table" class="table-of-contents__link toc-highlight">Create Azure Storage Account Table</a></li><li><a href="#import-public-holiday-data-into-table" class="table-of-contents__link toc-highlight">Import Public Holiday Data into Table</a></li></ul></li><li><a href="#create-api" class="table-of-contents__link toc-highlight">Create API</a><ul><li><a href="#create-azure-function" class="table-of-contents__link toc-highlight">Create Azure Function</a></li><li><a href="#configure-environment-variables" class="table-of-contents__link toc-highlight">Configure Environment Variables</a></li><li><a href="#configure-managed-identity" class="table-of-contents__link toc-highlight">Configure Managed Identity</a></li><li><a href="#configure-requirements" class="table-of-contents__link toc-highlight">Configure Requirements</a></li><li><a href="#create-function-publicholidays" class="table-of-contents__link toc-highlight">Create Function PublicHolidays</a></li><li><a href="#test-function---publicholidays" class="table-of-contents__link toc-highlight">Test Function - PublicHolidays</a></li><li><a href="#configure-azure-api-management" class="table-of-contents__link toc-highlight">Configure Azure API Management</a></li></ul></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
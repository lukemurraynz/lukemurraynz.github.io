<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">145 posts tagged with &quot;Azure&quot; | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/tags/azure/page/20/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="145 posts tagged with &quot;Azure&quot; | luke.geek.nz"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/tags/azure/page/20/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/20/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/20/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.28b9be22.css">
<script src="/assets/js/runtime~main.7d194455.js" defer="defer"></script>
<script src="/assets/js/main.63c37273.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/hackathon-vending-project/">Azure Hackathon Vending with Terraform</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/automate-container-patching-with-trivy-copacetic-azure-devops/">Container Patching with Azure DevOps, Trivy and Copacetic</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/push-docker-images-to-acr-using-github-codespaces/">Push Docker Images to Azure Container Registry with GitHub Codespaces</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/devcenter-project-deletion-issues/">Unable to delete DevCenter Project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/containerapps-env-missing-subnet/">Azure Container Apps Environment deployment - Missing Subnet</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>145 posts tagged with &quot;Azure&quot;</h1><a href="/tags/">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2022/03/16/azure-optimisation-engine/">Azure Optimization Engine</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-03-16T00:00:00.000Z">March 16, 2022</time> · <!-- -->21 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>This post is a part of <a href="https://www.azurespringclean.com/" target="_blank" rel="noopener noreferrer">Azure Spring Clean</a>, which is a community event focused on Azure management topics from March 14-18, 2022.</p>
<p>Thanks to <a href="https://twitter.com/wedoazure" target="_blank" rel="noopener noreferrer">Joe Carlyle</a> and <a href="https://twitter.com/tamstar1234" target="_blank" rel="noopener noreferrer">Thomas Thornton</a> for putting in the time and organising this event.</p>
<p>This article, along with others of its kind <em>(Articles, Videos etc.),</em> cover Azure Management topics such as Azure Monitor, Azure Cost Management, Azure Policy, Azure Security Principles or Azure Foundations!</p>
<p>Today I will be covering the <a href="https://github.com/helderpinto/AzureOptimizationEngine" target="_blank" rel="noopener noreferrer" title="Azure Optimization Engine">Azure Optimization Engine</a>.</p>
<p><img decoding="async" loading="lazy" alt="#AzureSpringClean - Azure Optimization Engine" src="/assets/images/azurespringclean_2022_aoe-28392a18f272b222d14eafb305ae40f5.png" title="#AzureSpringClean - Azure Optimization Engine" width="2545" height="1429" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<blockquote>
<p>The Azure Optimization Engine <em>(AOE)</em> is an extensible solution designed to generate optimization recommendations for your Azure environment, like a fully customizable Azure Advisor.</p>
<p>The first custom recommendations use-case covered by this tool was augmenting Azure Advisor Cost recommendations, particularly Virtual Machine right-sizing, with a fit score based on VM <em>(Virtual Machine)</em> metrics and properties.</p>
</blockquote>
<p>The Azure Optimization Engine can…</p>
<ul>
<li>Enable new custom recommendation types</li>
<li>Augment Azure Advisor recommendations with richer details that better drive action</li>
<li>Add fit score to recommendations.</li>
<li>Add historical perspective to recommendations <em>(the older the recommendation, the higher the chances to remediate it)</em></li>
<li>Drive continuous automated optimisation</li>
</ul>
<p>Azure Optimisation Engine combines multiple data sources to give you better data-driven decisions and recommendations, outside of that usually deployed by the inbuilt Azure Advisor, example use-cases and data sources can be seen below:</p>
<ul>
<li>Azure Resource Graph <em>(Virtual Machine and Managed Disks properties)</em></li>
<li>Azure Monitor Logs <em>(Virtual Machine performance metrics)</em></li>
<li>Azure Consumption <em>(consumption/billing usage details events)</em></li>
<li>Extracts data periodically to build a recommendations history</li>
<li>Joins and queries data in an analytics-optimised repository <em>(Log Analytics)</em></li>
<li>Virtual Machine performance metrics collected with Log Analytics agent</li>
<li>Can leverage existing customer setup</li>
<li>Requires only a few metrics collected with a frequency &gt;= 60 seconds</li>
</ul>
<blockquote>
<p>Besides collecting <strong>all Azure Advisor recommendations</strong>, AOE includes other custom recommendations that you can tailor to your needs:</p>
<ul>
<li>Cost
<ul>
<li>Augmented Advisor Cost VM right-size recommendations, with fit score based on Virtual Machine guest OS metrics <em>(collected by Log Analytics agents)</em> and Azure properties</li>
<li>Underutilized VM Scale Sets</li>
<li>Unattached disks</li>
<li>Standard Load Balancers without backend pool</li>
<li>Application Gateways without backend pool</li>
<li>VMs deallocated since a long time ago (<em>forgotten VMs)</em></li>
<li>Orphaned Public IPs</li>
</ul>
</li>
<li>High Availability
<ul>
<li>Virtual Machine high availability <em>(availability zones count, availability set, managed disks, storage account distribution when using unmanaged disks)</em></li>
<li>VM Scale Set high availability <em>(availability zones count, managed disks)</em></li>
<li>Availability Sets structure <em>(fault/update domains count)</em></li>
</ul>
</li>
<li>Performance
<ul>
<li>VM Scale Sets constrained by lack of compute resources</li>
</ul>
</li>
<li>Security
<ul>
<li>Service Principal credentials/certificates without expiration date</li>
<li>NSG rules referring to empty or non-existing subnets</li>
<li>NSG rules referring to orphan or removed NICs</li>
<li>NSG rules referring to orphan or removed Public IPs</li>
</ul>
</li>
<li>Operational Excellence
<ul>
<li>Load Balancers without backend pool</li>
<li>Service Principal credentials/certificates expired or about to expire</li>
<li>Subscriptions close to the maximum limit of RBAC <em>(Role Based Access Control)</em> assignments</li>
<li>Management Groups close to the maximum limit of RBAC assignments</li>
<li>Subscriptions close to the maximum limit of resource groups</li>
<li>Subnets with low free IP space</li>
<li>Subnets with too much IP space wasted</li>
<li>Empty subnets</li>
<li>Orphaned NICs</li>
</ul>
</li>
</ul>
</blockquote>
<p>Feel free to skip to the Workbook and PowerBI sections to look at some of the outs of box data and recommendations.</p>
<p>The Azure Optimisation Engine is battle-tested</p>
<ul>
<li>Providing custom recommendations since Nov 2019</li>
<li>Serving Azure customers worldwide</li>
<li>From smaller 50-500 VMs customers to larger ones with more than 5K VMs</li>
<li>Several customer-specific developments (custom collectors and recommendation algorithms)</li>
<li>Flexibility options include <em>(multi-subscription and multi-tenant capability)</em></li>
<li>Based on cheap services <em>(Azure Automation, Storage, small SQL Database</em>)</li>
</ul>
<p>A few hours after setting up the engine, you will get access to a Power BI dashboard and Log Analytic Workbooks with all Azure optimisation opportunities, coming from both Azure Advisor and tailored recommendations included in the engine.</p>
<p>These recommendations are then updated every seven days.</p>
<blockquote>
<p>It is worth noting that Azure Optimisation Engine is <strong>NOT</strong> an official <strong>Microsoft Product,</strong> and as such is under no offical support, it was created and maintened by: Hélder Pinto, a Senior Customer Engineer for Microsoft and would like to take the opportunity to thank Hélder the amazing work he is doing with this product on a continous basis, and giving me his blessing to write this article, on which he has already done an amazing job documenting on Github.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture">​</a></h4>
<p><img decoding="async" loading="lazy" alt="Azure Optimization Engine Architecture" src="/assets/images/architecture-a9d4dd501d8f97d571f6dc0d927227c1.jpg" title="Azure Optimization Engine Architecture" width="786" height="360" class="img_ev3q"></p>
<p>Azure Optimization Engine runs on top of Azure Automation <em>(Runbooks for each data source)</em> and Log Analytics. It is supplemented by a storage account to store JSON and Azure SQL database to help control ingestion <em>(last processed blob and lines processed)</em>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install">Install<a href="#install" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h4>
<p>Taken directly from the Git repository readme, the prerequisite for Azure Optimization Engine are:</p>
<ul>
<li>A supported Azure subscription <em>(see the</em> <a href="https://github.com/helderpinto/AzureOptimizationEngine#faq" target="_blank" rel="noopener noreferrer"><em>FAQs</em></a><em>on Github)</em></li>
<li><a href="hhttps://learn.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-7.5.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Install the Azure Az PowerShell module">Azure Powershell 6.6.0+</a><em>(Azure Bicep support is not currently available but is being worked on)</em>.</li>
<li><a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation?view=graph-powershell-beta&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" Microsoft.Graph.Authentication ">Microsoft.Graph.Authentication</a> and <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation?view=graph-powershell-beta&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Microsoft.Graph.Identity.DirectoryManagement">Microsoft.Graph.Identity.DirectoryManagement</a> PowerShell modules</li>
<li>A user account with Owner permissions over the chosen subscription, so that the Automation Managed Identity is granted the required privileges over the subscription (Reader) and deployment resource group <em>(Contributor)</em></li>
<li><em>(Optional)</em> A user account with at least Privileged Role Administrator permissions over the Azure AD tenant, so that the Managed Identity is granted the required privileges over Azure AD <em>(Global Reader)</em></li>
</ul>
<p>During deployment, you&#x27;ll be asked several questions. It would be best if you planned for the following:</p>
<ul>
<li>Whether you&#x27;re going to reuse an existing Log Analytics Workspace or create a new one. <strong>IMPORTANT</strong>: you should ideally reuse a workspace where you have VMs onboarded and already sending performance metrics <em>(<code>Perf</code> table)</em>; otherwise, you will not fully leverage the augmented right-size recommendations capability. If this is not possible/desired for some reason, you can still manage to use multiple workspaces <em>(see</em> <a href="https://github.com/helderpinto/AzureOptimizationEngine/blob/master/docs/configuring-workspaces.md" target="_blank" rel="noopener noreferrer"><em>Configuring Log Analytics workspaces</em></a><em>)</em>.</li>
<li>An Azure subscription to deploy the solution <em>(if you&#x27;re reusing a Log Analytics workspace, you must deploy into the same subscription the workspace is in).</em></li>
<li>A unique name prefix for the Azure resources being created (if you have specific naming requirements, you can also choose resource names during deployment)</li>
<li>Azure region</li>
</ul>
<p>If the deployment fails for some reason, you can repeat it, as it is idempotent <em>(i.e. they can be applied multiple times without changing the result)</em>. The exact process is used to upgrade a previous deployment with the latest version. You have to keep the same deployment options, so make sure you document them.</p>
<p>We will now go through and install the prerequisites from scratch; as in this article, I will be deploying the Azure Optimization Engine from our local workstation.</p>
<p>You can also install from the <a href="https://luke.geek.nz/azure/setup-azure-cloud-shell/" target="_blank" rel="noopener noreferrer" title="Azure Cloud Shell">Azure Cloud Shell,</a></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="install-azure-powershell--microsoft-graph-modules">Install Azure PowerShell &amp; Microsoft Graph modules<a href="#install-azure-powershell--microsoft-graph-modules" class="hash-link" aria-label="Direct link to Install Azure PowerShell &amp; Microsoft Graph modules" title="Direct link to Install Azure PowerShell &amp; Microsoft Graph modules">​</a></h5>
<ol>
<li>
<p>Open Windows PowerShell</p>
</li>
<li>
<p>Type in:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Install-Module -Name Az,Microsoft.Graph.Authentication,Microsoft.Graph.Identity.DirectoryManagement -Scope CurrentUser -Repository PSGallery -Force</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="install-1">Install<a href="#install-1" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install">​</a></h4>
<p>Now that we have the prerequisites installed! Let&#x27;s set up Azure Optimization Engine!</p>
<ol>
<li>
<p>In your favourite web browser, <strong>navigate</strong> to the <a href="https://github.com/helderpinto/AzureOptimizationEngine" target="_blank" rel="noopener noreferrer" title="https://github.com/helderpinto/AzureOptimizationEngine"><strong>AzureOptimizationEngine</strong></a> GitHub repository.</p>
</li>
<li>
<p>Select <strong>Code</strong>, <strong>Download Zip</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Optimization Engine - GitHub" src="/assets/images/2022-03-12-09_23_49-helderpinto_azureoptimizationengine_-the-azure-optimization-engine-is-an-extensi-bcef43692efcf0dfe56e6918137b48ee.png" title="Azure Optimization Engine - GitHub" width="425" height="359" class="img_ev3q"></p>
</li>
<li>
<p><strong>Download</strong> and <strong>extract</strong> the ZIP file to a location you can easily navigate to in PowerShell (<em>I have extracted it to C:\temp\AzureOptimizationEngine-master\AzureOptimizationEngine-master)</em></p>
</li>
<li>
<p>Open PowerShell <em>(or Windows Terminal)</em></p>
</li>
<li>
<p>Because the scripts were downloaded from the internet, we will need to <strong>Unblock</strong> these so that we can run them, open PowerShell and run the <strong>script</strong> below <em>(changing your path to the path that the files were extracted)</em></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-ChildItem -r &#x27;C:\temp\AzureOptimizationEngine-master\AzureOptimizationEngine-master&#x27; | Unblock-File</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Now that the script and associated files have been unblocked <strong>change</strong> the <strong>directory</strong> to the <strong>location</strong> of the Deploy-AzureOptimizationEngine.ps1 <strong>file</strong>.</p>
</li>
<li>
<p>Run: <strong>.\Deploy-AzureOptimizationEngine.ps1</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Windows Terminal -\Deploy-AzureOptimizationEngine.ps1" src="/assets/images/2022-03-12-09_48_40-plex-fc05e1149c5c344be34d84613efbc787.png" title="Windows Terminal -\Deploy-AzureOptimizationEngine.ps1" width="952" height="469" class="img_ev3q"></p>
</li>
<li>
<p>A browser window will then popup, <strong>authenticate to Azure</strong> <em>(connect to the Azure tenant that has access to the Azure subscription you wish to set up Azure Optimization Engine on)</em>.</p>
</li>
<li>
<p>Once authentication, you will need to <strong>confirm</strong> the Azure <strong>subscription</strong> to which you want to deploy Azure Optimization Engine.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Optimization Engine - Select Subscription" src="/assets/images/aoe-selectazsubscription-9594c8d11829e4fbed4434555ef65053.png" title="Azure Optimization Engine - Select Subscription" width="1005" height="185" class="img_ev3q"></p>
</li>
<li>
<p>Once your subscription is selected, it&#x27;s time to <strong>choose</strong> a <strong>naming prefix</strong> for your resources <em>(if you choose Enter, you can manually name each resource); in</em> my case, my prefix will be: <em>aoegeek.</em> Because Azure Optimization Engine will be creating resources that are globally available, make sure you select a prefix that suits your organisation/use-case as you may run into issues with the name already being used.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Optimization Engine - Select Region" src="/assets/images/aoe-selectazprefix-bd0db3795e9e239f0fa734b3e08ff0b5.png" title="Azure Optimization Engine - Select Region" width="1251" height="96" class="img_ev3q"></p>
</li>
<li>
<p>If you have an <strong>existing Log Analytics</strong> workspace that your Virtual Machines and resources are connected to, you can specify &#x27;Y&#x27; here to select your existing resource; I am creating this from fresh so that I will choose <strong>&#x27;N.</strong>&#x27;</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Log Analytics" src="/assets/images/aoe-selectazloganalyticworkspace-a9d2a4573f2c9e6a3869399d73fd3393.png" title="Azure Log Analytics" width="637" height="29" class="img_ev3q"></p>
</li>
<li>
<p>The Azure Optimization <strong>Engine will now check that the names and resources are available</strong> to be deployed to your subscriptions and resources <em>(nothing is deployed during this stage - if there is an error, you can fix the issue and go back)</em>.</p>
</li>
<li>
<p>Once validation has passed, <strong>select</strong> the <strong>region</strong> that Azure Optimization will be deployed to; I will deploy to australiaeast, so I choose 1.</p>
</li>
<li>
<p>Azure Optimization Engine now <strong>requires</strong> the <strong>SQL Admin</strong> username; for the SQL server and database it will create, I will go with: sqladmin</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Optimization Engine - Region" src="/assets/images/aoe-selectlocationsql-2f77a2a5c24d2d6226866145ed16b899.png" title="Azure Optimization Engine - Region" width="680" height="495" class="img_ev3q"></p>
</li>
<li>
<p>Now enter the <strong>password</strong> for the <strong>sqladmin</strong> account and press Enter</p>
</li>
<li>
<p>Verify that everything is correct, then press <strong>Y</strong> to deploy Azure Optimization Engine!</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Windows Terminal - Deploy Azure Optimization Engine" src="/assets/images/deploy-azureoptimizationengine-4f5a53915f65769f48c41d735cff59df.gif" title="Windows Terminal - Deploy Azure Optimization Engine" width="1115" height="566" class="img_ev3q"></p>
</li>
<li>
<p>Deployment could take 10-25 minutes... <em>(mine took 22 minutes and 51 seconds)</em></p>
</li>
<li>
<p>While leaving the PowerShell window open, log into the Azure Portal; you should now have a new Resource Group, and your resources will start getting created... you can click on Deployments <em>(under Settings navigation bar)</em> in the Resource Group to review the deployment status.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Portal - Deployments" src="/assets/images/deploycheck-azureoptimizationengine-599e59e9d3c464022a4c1cff95ed2d10.gif" title="Azure Portal - Deployments" width="1411" height="566" class="img_ev3q"></p>
</li>
<li>
<p>If you notice a failure, in the Deployment tab for: &#x27;PolicyDeployment&#x27; you can ignore this, as it may have failed if the SQL Server hasn&#x27;t been provisioned yet; once it has been provisioned, you can navigate back to this failed deployment and click &#x27;Redeploy&#x27;, to deploy a SQL Security Alert policy.</p>
</li>
</ol>
<p><em>Note: The Azure SQL database will have the Public IP from the location the script was deployed from, allowed on the Azure SQL database; you may need to adjust this depending on your requirements.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure">Configure<a href="#configure" class="hash-link" aria-label="Direct link to Configure" title="Direct link to Configure">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="onboard-azure-vms-to-log-analytics-using-azure-policy-and-powershell">Onboard Azure VMs to Log Analytics using Azure Policy and PowerShell<a href="#onboard-azure-vms-to-log-analytics-using-azure-policy-and-powershell" class="hash-link" aria-label="Direct link to Onboard Azure VMs to Log Analytics using Azure Policy and PowerShell" title="Direct link to Onboard Azure VMs to Log Analytics using Azure Policy and PowerShell">​</a></h5>
<p>Now that Azure Optimization has been installed, let&#x27;s onboard our current and future Azure Virtual Machines to Azure Optimization Engine, using Azure Policy. This is required if you want to get Azure Advisor Virtual Machine right-size recommendations augmented with guest OS metrics. If you don&#x27;t collect metrics from the Virtual Machines, you will still have a fully functional Optimisation Engine, with many recommendations, but the Advisor Virtual Machine right-size ones will be served as is.</p>
<ol>
<li>
<p>Open <strong>PowerShell</strong> and <strong>login</strong> to <strong>Azure</strong> using: Connect-AzAccount</p>
</li>
<li>
<p><strong>Connect to</strong> your Azure <strong>subscription</strong> that contains the Virtual Machines you want to onboard to Log Analytics</p>
</li>
<li>
<p>Type:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Register the resource provider if it&#x27;s not already registered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Register-AzResourceProvider -ProviderNamespace &#x27;Microsoft.PolicyInsights&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>The PowerShell script below will:</p>
<ul>
<li>Copies the built-in Azure Policy definition of <a href="https://www.azadvertizer.net/azpolicyadvertizer/0868462e-646c-4fe3-9ced-a733534b6a2c.html?desc=compareJson&amp;left=https%3A%2F%2Fwww.azadvertizer.net%2Fazpolicyadvertizerjson%2F0868462e-646c-4fe3-9ced-a733534b6a2c_2.0.0.json&amp;right=https%3A%2F%2Fwww.azadvertizer.net%2Fazpolicyadvertizerjson%2F0868462e-646c-4fe3-9ced-a733534b6a2c_2.0.1.json" target="_blank" rel="noopener noreferrer" title=" Azure Policy definition Deploy - Configure Log Analytics extension to be enabled on Windows virtual machines ">Deploy - Configure Log Analytics extension to be enabled on Windows virtual machines</a></li>
<li>Create a User-Managed Identity</li>
<li>Assign: Log Analytics contributor rights to a subscription scope</li>
<li>Create a policy assignment, and assign it to the subscription</li>
</ul>
</li>
<li>
<p>Just update the variables to match your setup</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#requires -Version 1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Enter your subscription name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$subscriptionName = &#x27;luke.geek.nz&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Enter the name of yuour </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$policyDisplayName = &#x27;Deploy - Log Analytics&#x27; #Cant Exceed 24 characters</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$location = &#x27;australiaeast&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$resourceGroup = &#x27;aoegeek-rg&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$UsrIdentityName = &#x27;AOE_ManagedIdentityUsr&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$param = @{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  logAnalytics = &#x27;aoegeek-la&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Get a reference to the subscription that will be the scope of the assignment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$sub = Get-AzSubscription -SubscriptionName $subscriptionName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$subid = $sub.Id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Creates User Managed identity </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$AzManagedIdentity = New-AzUserAssignedIdentity -ResourceGroupName $resourceGroup -Name $UsrIdentityName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Adds Contributor rights to User Managed identity to Subscription</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Waits 10 seconds to allow for Azure AD to replicate and recognise Managed identity has been created.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Start-Sleep -Seconds &#x27;10&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Assigns role assignement to managed identity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> New-AzRoleAssignment -Objectid $AzManagedIdentity.PrincipalId -scope (&#x27;/subscriptions/&#x27; + $subid ) -RoleDefinitionName &#x27;Log Analytics Contributor&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Get a reference to the built-in policy definition that will be assigned</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$definition = Get-AzPolicyDefinition | Where-Object -FilterScript {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $_.Properties.DisplayName -eq &#x27;Deploy - Configure Log Analytics extension to be enabled on Windows virtual machines&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create the policy assignment with the built-in definition against your subscription</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzPolicyAssignment -Name $policyDisplayName -DisplayName $policyDisplayName -Scope (&#x27;/subscriptions/&#x27; + $subid ) -PolicyDefinition $definition -IdentityType &#x27;UserAssigned&#x27;  -IdentityId $AzManagedIdentity.id -location $location -PolicyParameterObject $param</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Creates R3mediation task, to deploy the extension to the VM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$policyAssignmentID = Get-AzPolicyAssignment -Name $policyDisplayName | Select-Object -Property PolicyAssignmentId </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Start-AzPolicyRemediation -Name &#x27;Deploy - LA Agent&#x27; -PolicyAssignmentId $policyAssignmentID.PolicyAssignmentId -ResourceDiscoveryMode ReEvaluateCompliance</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p><em>Note: The default &#x27;Deploy - Configure Log Analytics extension to be enabled on Windows virtual machines&#x27; policy doesn&#x27;t currently support Gen 2 or Windows Server 2022 Virtual Machines; if you have these, then you can copy the Azure Policy definition and then make your own with the new imageSKUs, although this policy may be replaced by the: Configure Windows virtual machines to run Azure Monitor Agent policy. Although I haven&#x27;t tested it yet, the same script above can be modified to suit.</em></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="onboard-azure-vms-to-log-analytics-using-the-azure-portal">Onboard Azure VMs to Log Analytics using the Azure Portal<a href="#onboard-azure-vms-to-log-analytics-using-the-azure-portal" class="hash-link" aria-label="Direct link to Onboard Azure VMs to Log Analytics using the Azure Portal" title="Direct link to Onboard Azure VMs to Log Analytics using the Azure Portal">​</a></h5>
<p>If you do not want to onboard VMs with Policy, you can do it manually via the Azure Portal.</p>
<ol>
<li>Open <strong>Azure Portal</strong></li>
<li>Navigate to <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.OperationalInsights%2Fworkspaces" target="_blank" rel="noopener noreferrer" title="Log Analytic Workspaces"><strong>Log Analytic Workspaces</strong></a></li>
<li><strong>Click on</strong> the Log Analytic <strong>workspace</strong> that was provisioned for Azure Optimization Engine</li>
<li>Navigate to <strong>Virtual Machines</strong> <em>(under Workspace Data Sources)</em></li>
<li>Click on the Virtual Machine you want to link up to the Log Analytics workspace, and click <strong>Connect -</strong> this will trigger the Log Analytic extension and agent o be installed. Repeat for any further Virtual Machines.</li>
<li><img decoding="async" loading="lazy" alt="Log Analytics - Connect VM" src="/assets/images/aoe-2019vmgen1_connectla-0756cd76382986357e3e66c456d28055.png" title="Log Analytics - Connect VM" width="371" height="424" class="img_ev3q"></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="setup-log-analytic-performance-counters">Setup Log Analytic Performance Counters<a href="#setup-log-analytic-performance-counters" class="hash-link" aria-label="Direct link to Setup Log Analytic Performance Counters" title="Direct link to Setup Log Analytic Performance Counters">​</a></h5>
<p>Now that we have Virtual Machines reporting to our Log Analytic instance, it&#x27;s time to make sure we are collecting as much data as we need to give suitable recommendations, luckily a script has already been included in the Azure Optimisation repository called &#x27;<em>Setup-LogAnalyticsWorkspaces.ps1</em>&#x27; to configure the performance counters.</p>
<ol>
<li>
<p>Open <strong>PowerShell</strong> <em>(or Windows Terminal)</em></p>
</li>
<li>
<p><strong>Change</strong> the <strong>directory</strong> to the <strong>location</strong> of the Setup-LogAnalyticsWorkspaces.ps1, in the root folder of the repository extracted earlier</p>
</li>
<li>
<p>Run the following PowerShell commands to download the required PowerShell Modules:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Install-Module -Name Az.ResourceGraph</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Install-Module -Name Az.OperationalInsights</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Then run: .<strong>\Setup-LogAnalyticsWorkspaces.ps1</strong></p>
</li>
<li>
<p>The script will then go through all Log Analytic workspaces that you have access to and check for performance counters.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Windows PowerShell - \Setup-LogAnalyticsWorkspaces.ps1" src="/assets/images/deploycheck-loganalytics-9e21d4aee2426844a4576b72fda1d56e.gif" title="Windows PowerShell - \Setup-LogAnalyticsWorkspaces.ps1" width="1122" height="562" class="img_ev3q"></p>
</li>
<li>
<p>If they are missing from the Log Analytics workspace, then you can run:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">./Setup-LogAnalyticsWorkspaces.ps1 -AutoFix</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>or</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> #Fix specific workspaces configuration, using a custom counter collection frequency</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./Setup-LogAnalyticsWorkspaces.ps1 -AutoFix -WorkspaceIds &quot;d69e840a-2890-4451-b63c-bcfc5580b90f&quot;,&quot;961550b2-2c4a-481a-9559-ddf53de4b455&quot; -IntervalSeconds 30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-ad-based-recommendations-by-granting-permissions-to-managed-identity">Setup Azure AD-based recommendations by granting permissions to Managed Identity.<a href="#setup-azure-ad-based-recommendations-by-granting-permissions-to-managed-identity" class="hash-link" aria-label="Direct link to Setup Azure AD-based recommendations by granting permissions to Managed Identity." title="Direct link to Setup Azure AD-based recommendations by granting permissions to Managed Identity.">​</a></h5>
<p>Azure Optimization Engine, has the ability to do recommendations based on Microsoft Entra ID roles and permissions, but in order to do that, the System Assigned Identity of the Azure Optimization Engine account needs to be given &#x27;Global Reader&#x27; rights. As part of the deployment, you may have gotten the following error:</p>
<p><em>Cannot bind argument to parameter &#x27;DirectoryRoleId&#x27; because it is an empty string.</em></p>
<p><em>Could not grant role. If you want Azure AD-based recommendations, please grant the Global Reader role manually to the aoegeek-auto managed identity or, for previous versions of AOE, to the Run As Account principal.</em></p>
<p>We are going to grant the Azure Automation account &#x27;Global Reader&#x27; rights manually in the Azure Portal.</p>
<ol>
<li>Open <strong>Azure Portal</strong></li>
<li>Navigate to <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts" target="_blank" rel="noopener noreferrer" title="Automation Accounts"><strong>Automation Accounts</strong></a></li>
<li><strong>Open</strong> your Azure Optimisation Engine <strong>automation account</strong></li>
<li>Navigate down the navigation bar to the <strong>Account Settings</strong> section and select: <strong>Identity</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Automation - Identity" src="/assets/images/aoe-managedidentityazautomate-1b4014ef61ac4c7e7cd46b3ffdbc4e3c.png" title="Azure Automation - Identity" width="1328" height="525" class="img_ev3q"></li>
<li><strong>Copy</strong> the <strong>object ID</strong></li>
<li>Now navigate to <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer" title="Microsoft Entra ID"><strong>Microsoft Entra ID</strong></a></li>
<li>Click on <strong>Roles and Administrators</strong></li>
<li>Search for: <strong>Global Reader</strong></li>
<li>Select Global Reader and select <strong>+ Add assignments</strong></li>
<li>Paste in the object ID earlier, and click <strong>Ok</strong> to grant Global Reader rights to the Azure Automation identity.</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="azure-automation---runbooks--automation">Azure Automation - Runbooks &amp; Automation<a href="#azure-automation---runbooks--automation" class="hash-link" aria-label="Direct link to Azure Automation - Runbooks &amp; Automation" title="Direct link to Azure Automation - Runbooks &amp; Automation">​</a></h5>
<p>The wind that gives Azure Optimization Engine its lift is Azure Automation and Runbooks, at the time I deployed this - I had x1 Azure Automation account and 33 runbooks!</p>
<p>Looking at the runbooks deployed, you can get a sense of what Azure Optimization Engine is doing...</p>

















































































































































<table><thead><tr><th>NAME</th><th>TYPE</th></tr></thead><tbody><tr><td>aoegeek-auto</td><td>Automation Account</td></tr><tr><td>Export-AADObjectsToBlobStorage (aoegeek-auto/Export-AADObjectsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-AdvisorRecommendationsToBlobStorage (aoegeek-auto/Export-AdvisorRecommendationsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGAppGatewayPropertiesToBlobStorage (aoegeek-auto/Export-ARGAppGatewayPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGAvailabilitySetPropertiesToBlobStorage (aoegeek-auto/Export-ARGAvailabilitySetPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGLoadBalancerPropertiesToBlobStorage (aoegeek-auto/Export-ARGLoadBalancerPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGManagedDisksPropertiesToBlobStorage (aoegeek-auto/Export-ARGManagedDisksPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGNICPropertiesToBlobStorage (aoegeek-auto/Export-ARGNICPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGNSGPropertiesToBlobStorage (aoegeek-auto/Export-ARGNSGPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGPublicIpPropertiesToBlobStorage (aoegeek-auto/Export-ARGPublicIpPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGResourceContainersPropertiesToBlobStorage (aoegeek-auto/Export-ARGResourceContainersPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGUnmanagedDisksPropertiesToBlobStorage (aoegeek-auto/Export-ARGUnmanagedDisksPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGVirtualMachinesPropertiesToBlobStorage (aoegeek-auto/Export-ARGVirtualMachinesPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGVMSSPropertiesToBlobStorage (aoegeek-auto/Export-ARGVMSSPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ARGVNetPropertiesToBlobStorage (aoegeek-auto/Export-ARGVNetPropertiesToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-AzMonitorMetricsToBlobStorage (aoegeek-auto/Export-AzMonitorMetricsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-ConsumptionToBlobStorage (aoegeek-auto/Export-ConsumptionToBlobStorage)</td><td>Runbook</td></tr><tr><td>Export-RBACAssignmentsToBlobStorage (aoegeek-auto/Export-RBACAssignmentsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Ingest-OptimizationCSVExportsToLogAnalytics (aoegeek-auto/Ingest-OptimizationCSVExportsToLogAnalytics)</td><td>Runbook</td></tr><tr><td>Ingest-RecommendationsToSQLServer (aoegeek-auto/Ingest-RecommendationsToSQLServer)</td><td>Runbook</td></tr><tr><td>Recommend-AADExpiringCredentialsToBlobStorage (aoegeek-auto/Recommend-AADExpiringCredentialsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-AdvisorAsIsToBlobStorage (aoegeek-auto/Recommend-AdvisorAsIsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-AdvisorCostAugmentedToBlobStorage (aoegeek-auto/Recommend-AdvisorCostAugmentedToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-ARMOptimizationsToBlobStorage (aoegeek-auto/Recommend-ARMOptimizationsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-LongDeallocatedVmsToBlobStorage (aoegeek-auto/Recommend-LongDeallocatedVmsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-UnattachedDisksToBlobStorage (aoegeek-auto/Recommend-UnattachedDisksToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-UnusedAppGWsToBlobStorage (aoegeek-auto/Recommend-UnusedAppGWsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-UnusedLoadBalancersToBlobStorage (aoegeek-auto/Recommend-UnusedLoadBalancersToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-VMsHighAvailabilityToBlobStorage (aoegeek-auto/Recommend-VMsHighAvailabilityToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-VMSSOptimizationsToBlobStorage (aoegeek-auto/Recommend-VMSSOptimizationsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Recommend-VNetOptimizationsToBlobStorage (aoegeek-auto/Recommend-VNetOptimizationsToBlobStorage)</td><td>Runbook</td></tr><tr><td>Remediate-AdvisorRightSizeFiltered (aoegeek-auto/Remediate-AdvisorRightSizeFiltered)</td><td>Runbook</td></tr><tr><td>Remediate-LongDeallocatedVMsFiltered (aoegeek-auto/Remediate-LongDeallocatedVMsFiltered)</td><td>Runbook</td></tr><tr><td>Remediate-UnattachedDisksFiltered (aoegeek-auto/Remediate-UnattachedDisksFiltered)</td><td>Runbook</td></tr></tbody></table>
<p>A lot of the runbooks, such as the Log Analytics workspace ID, link up to Azure Automation variables, such as this period in Days to look back for Advisor recommendations, by default, this is &#x27;7&#x27; but you can change this variable to suit your organisation&#x27;s needs.</p>
<p><img decoding="async" loading="lazy" alt="Azure Automation - Runbooks &amp;amp; Automation" src="/assets/images/aoe-variables-6d7cf08f142e3c5d21c5ea56f3a5af51.png" title="Azure Automation - Runbooks &amp;amp; Automation" width="1319" height="949" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="azure-automation---schedules">Azure Automation - Schedules<a href="#azure-automation---schedules" class="hash-link" aria-label="Direct link to Azure Automation - Schedules" title="Direct link to Azure Automation - Schedules">​</a></h5>
<p>Along with containing the variables and configurations used by the Runbooks, it also contains the schedules for the ingest of data into the storage account and SQL databases, most of these are Daily, but schedules such as ingesting from the Azure Advisor are weekly, by default these times are in UTC.</p>
<p><img decoding="async" loading="lazy" alt="Azure Automation - Schedules" src="/assets/images/aoe-schedules-6fb5f8721167e4866f605cdd63180043.png" title="Azure Automation - Schedules" width="1333" height="970" class="img_ev3q"></p>
<p>When making changes to these schedules <em>(or moving the Runbooks to be run from a Hybrid worker)</em>, it is recommended to use the Reset-AutomationSchedules.ps1 script. These times need to be in UTC.</p>
<p><img decoding="async" loading="lazy" alt="Terminal - Reset-AutomationSchedules.ps1" src="/assets/images/update-automationschedules-97b92517562b267c0ec3d9b27e2b19e2.gif" title="Terminal - Reset-AutomationSchedules.ps1" width="1122" height="647" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="azure-automation---credentials">Azure Automation - Credentials<a href="#azure-automation---credentials" class="hash-link" aria-label="Direct link to Azure Automation - Credentials" title="Direct link to Azure Automation - Credentials">​</a></h5>
<p>When we set up the Azure SQL database earlier, as part of the Azure Optimisation setup, we configured the SQL Admin account and password, these credentials are stored and used by the Runbooks in the Azure Automation credential pane.</p>
<p><img decoding="async" loading="lazy" alt="Azure Automation - Credentials" src="/assets/images/aoe-credentials-a6723fb26c307eb1ba48d0776eeab30a.png" title="Azure Automation - Credentials" width="1324" height="588" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-recommendations">View Recommendations<a href="#view-recommendations" class="hash-link" aria-label="Direct link to View Recommendations" title="Direct link to View Recommendations">​</a></h3>
<p>It&#x27;s worth noting, that because Azure Optimization Engine stores its data into Log Analytics and SQL, you can use languages such as KQL directly on the Log Analytics workspace to pull out any information you might need and develop integration into other toolsets.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="workbooks">Workbooks<a href="#workbooks" class="hash-link" aria-label="Direct link to Workbooks" title="Direct link to Workbooks">​</a></h5>
<p>There are x3 Azure Log Analytics workbooks included in the Azure Optimization Engine, these are as follows:</p>





















<table><thead><tr><th>NAME</th><th>TYPE</th></tr></thead><tbody><tr><td>Resources Inventory</td><td>Azure Workbook</td></tr><tr><td>Identities and Roles</td><td>Azure Workbook</td></tr><tr><td>Costs Growing</td><td>Azure Workbook</td></tr></tbody></table>
<p>They can be easily accessed in the Azure Portal.</p>
<ol>
<li>Log in to the <strong>Azure Portal</strong></li>
<li>Navigate to <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.OperationalInsights%2Fworkspaces" target="_blank" rel="noopener noreferrer" title="Log Analytics Workspace"><strong>Log Analytics Workspace</strong></a></li>
<li>Click on the Log Analytics workspace you set up for Azure Optimization Engine earlier and click on <strong>Workbooks</strong> <em>(under General)</em>.</li>
<li>Click on: <strong>Workbooks</strong> filter at the top to display the 3 Azure Optimization Engine</li>
<li><img decoding="async" loading="lazy" alt="Log Analtics - Workbooks" src="/assets/images/aoe-displayworkbooks-b0ecb34c41aaebdd1e02e10b3f42e8d3.png" title="Log Analtics - Workbooks" width="954" height="569" class="img_ev3q"></li>
<li>After a few days of collecting data, you should now be able to see data like below.</li>
</ol>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="resource-inventory---general">Resource Inventory - General<a href="#resource-inventory---general" class="hash-link" aria-label="Direct link to Resource Inventory - General" title="Direct link to Resource Inventory - General">​</a></h6>
<p><img decoding="async" loading="lazy" alt="Resource Inventory - General" src="/assets/images/aoe-workbookresourceinventory-ad40a7d0fcd64ab6192513f16524c648.png" title="Resource Inventory - General" width="1047" height="823" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="resource-inventory---virtual-machines">Resource Inventory - Virtual Machines<a href="#resource-inventory---virtual-machines" class="hash-link" aria-label="Direct link to Resource Inventory - Virtual Machines" title="Direct link to Resource Inventory - Virtual Machines">​</a></h6>
<p><img decoding="async" loading="lazy" alt="Resource Inventory - Virtual Machines" src="/assets/images/aoe-workbookresourceinventory_virtualmachines-583da597c732a19e9c8277516c57ddca.png" title="Resource Inventory - Virtual Machines" width="1028" height="2264" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="resource-inventory---virtual-machine-scalesets">Resource Inventory - Virtual Machine ScaleSets<a href="#resource-inventory---virtual-machine-scalesets" class="hash-link" aria-label="Direct link to Resource Inventory - Virtual Machine ScaleSets" title="Direct link to Resource Inventory - Virtual Machine ScaleSets">​</a></h6>
<p><img decoding="async" loading="lazy" alt="Resource Inventory - Virtual Machine ScaleSets" src="/assets/images/aoe-workbookresourceinventory_virtualmachinescaletset-13581dbfe3d4fb718cf56cb69c2af14c.png" title="Resource Inventory - Virtual Machine ScaleSets" width="1016" height="2178" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="resource-inventory---virtual-machine-scalesets-disks">Resource Inventory - Virtual Machine ScaleSets Disks<a href="#resource-inventory---virtual-machine-scalesets-disks" class="hash-link" aria-label="Direct link to Resource Inventory - Virtual Machine ScaleSets Disks" title="Direct link to Resource Inventory - Virtual Machine ScaleSets Disks">​</a></h6>
<p><img decoding="async" loading="lazy" alt="Resource Inventory - Virtual Machine ScaleSets Disks" src="/assets/images/aoe-workbookresourceinventory_virtualmachinescaletsetdisks-d4ec1fc4885585343ae1d9cfe9a80b97.png" title="Resource Inventory - Virtual Machine ScaleSets Disks" width="1033" height="890" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="resource-inventory---virtual-networks">Resource Inventory - Virtual Networks<a href="#resource-inventory---virtual-networks" class="hash-link" aria-label="Direct link to Resource Inventory - Virtual Networks" title="Direct link to Resource Inventory - Virtual Networks">​</a></h6>
<p><img decoding="async" loading="lazy" alt="Resource Inventory - Virtual Networks" src="/assets/images/aoe-workbookresourceinventory_virtualnetworks-ba3f4ca93d3956bc377d2301211f3d14.png" title="Resource Inventory - Virtual Networks" width="1018" height="1491" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="identities-and-roles---overview">Identities and Roles - Overview<a href="#identities-and-roles---overview" class="hash-link" aria-label="Direct link to Identities and Roles - Overview" title="Direct link to Identities and Roles - Overview">​</a></h6>
<p><img decoding="async" loading="lazy" alt="Identities and Roles - Overview" src="/assets/images/aoe-workbookaad_overview-fee5d40d84bf6457c7220691e9a4ff68.png" title="Identities and Roles - Overview" width="2587" height="934" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="power-bi">Power BI<a href="#power-bi" class="hash-link" aria-label="Direct link to Power BI" title="Direct link to Power BI">​</a></h5>
<p>The true power of the Azure Optimisation engine, is the data stored in the SQL database, using PowerBI you can pull the data into dashboards and make it more meaningful, and the recommendations given from PowerBI and SQL.</p>
<p>The Optimisation Engine already has a starter PowerBI file, which pulls data from the database.</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="install-powerbi-desktop">Install PowerBI Desktop<a href="#install-powerbi-desktop" class="hash-link" aria-label="Direct link to Install PowerBI Desktop" title="Direct link to Install PowerBI Desktop">​</a></h6>
<ol>
<li>Open Microsoft Store and search for: <a href="https://aka.ms/pbidesktopstore" target="_blank" rel="noopener noreferrer" title=" Microsoft Power BI Desktop"><strong>Power BI Desktop</strong></a></li>
<li>Click <strong>Get</strong></li>
<li><img decoding="async" loading="lazy" alt="Power BI Desktop" src="/assets/images/microsoft-store-powerbidesktop-cc7ad117e2985fa7b8d179ff0972556c.png" title="Power BI Desktop" width="403" height="368" class="img_ev3q"></li>
<li>Once Downloaded, click <strong>Open</strong></li>
</ol>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="obtain-azure-sql-information">Obtain Azure SQL Information<a href="#obtain-azure-sql-information" class="hash-link" aria-label="Direct link to Obtain Azure SQL Information" title="Direct link to Obtain Azure SQL Information">​</a></h6>
<p>In order to connect PowerBI to the Azure SQL database, we need to know the URL of the database and make sure our IP has been opened on the Azure SQL Firewall.</p>
<ol>
<li>Open <strong>Azure Portal</strong></li>
<li>Navigate to <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Sql%2Fservers" target="_blank" rel="noopener noreferrer" title="Azure Portal - SQL servers"><strong>SQL Servers</strong></a></li>
<li>Click on the SQL server created earlier, under the Security heading click on <strong>Firewall and Virtual Networks</strong></li>
<li>Under: Client IP address, make sure your public IP is added and click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure SQL - Virtual Network" src="/assets/images/aoe-sql-server-firewall-2c994b63f831458b9f5b94e0db50e4f6.png" title="Azure SQL - Virtual Network" width="1328" height="812" class="img_ev3q"></li>
<li>Now that we have verified/added our client IP, we need to get the SQL <strong>database</strong> <em>(not server)</em> URL</li>
<li>Click on <strong>Overview</strong></li>
<li><strong>Click</strong> on the <em>aoeoptimization</em> <strong>database</strong> <em>(under Available resources, down the bottom)</em></li>
<li>Click on <strong>Copy to Clipboard</strong> for the <strong>server Name</strong>/URL</li>
<li><img decoding="async" loading="lazy" alt="Azure SQL - Database URL" src="data:image/png;base64,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" title="Azure SQL - Database URL" width="480" height="145" class="img_ev3q"></li>
</ol>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="open-powerbi-desktop-file">Open PowerBI Desktop File<a href="#open-powerbi-desktop-file" class="hash-link" aria-label="Direct link to Open PowerBI Desktop File" title="Direct link to Open PowerBI Desktop File">​</a></h6>
<p>Now that we have PowerBI Desktop installed, it&#x27;s time to open: AzureOptimizationEngine.pbix. This PowerBI file is located in the Views folder of the Azure Optimization Engine repository.</p>
<ol>
<li><strong>Open</strong>: <strong>AzureOptimizationEngine.pbix</strong> in PowerBI Desktop</li>
<li>On the Home page ribbon, click on <strong>Transform Data</strong></li>
<li>Click <strong>Data source settings</strong></li>
<li>Click <strong>Change Source</strong></li>
<li><strong>Change</strong> the default <strong>SQL server</strong> of aoedevgithub-sql.database.windows.net to your SQL database, copied earlier.</li>
<li>Click <strong>Ok</strong></li>
<li>Click Ok and press <strong>Apply Changes</strong></li>
<li>It will prompt for credentials, click on <strong>Database</strong></li>
<li>Enter in your SQLAdmin details entered as part of the Azure Optimization Engine setup</li>
<li>Click <strong>Connect</strong></li>
</ol>
<p>After PowerBI updates its database and queries, your PowerBI report should now be populated with data like below.</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="powerbi---overview">PowerBI - Overview<a href="#powerbi---overview" class="hash-link" aria-label="Direct link to PowerBI - Overview" title="Direct link to PowerBI - Overview">​</a></h6>
<p><img decoding="async" loading="lazy" alt="PowerBI - Overview" src="/assets/images/aoe-powerbi_overview-8d059e8ed738e8a3690cbb2ee774a0c0.png" title="PowerBI - Overview" width="1614" height="893" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="powerbi---cost">PowerBI - Cost<a href="#powerbi---cost" class="hash-link" aria-label="Direct link to PowerBI - Cost" title="Direct link to PowerBI - Cost">​</a></h6>
<p><img decoding="async" loading="lazy" alt="PowerBI - Cost" src="/assets/images/aoe-powerbi_cost-9dff1afe13c6526978b67786a636cbae.png" title="PowerBI - Cost" width="1558" height="524" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="powerbi---high-availability">PowerBI - High Availability<a href="#powerbi---high-availability" class="hash-link" aria-label="Direct link to PowerBI - High Availability" title="Direct link to PowerBI - High Availability">​</a></h6>
<p><img decoding="async" loading="lazy" alt="PowerBI - High Availability" src="/assets/images/aoe-powerbi_ha-690bbe8afef11ceff2e0339fbff66323.png" title="PowerBI - High Availability" width="1561" height="775" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="powerbi---security">PowerBI - Security<a href="#powerbi---security" class="hash-link" aria-label="Direct link to PowerBI - Security" title="Direct link to PowerBI - Security">​</a></h6>
<p><img decoding="async" loading="lazy" alt="PowerBI - Security" src="/assets/images/aoe-powerbi_security-a08e6c5ea3c79142f23ee9737c74bcee.png" title="PowerBI - Security" width="1609" height="798" class="img_ev3q"></p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="powerbi---operational-excellence">PowerBI - Operational Excellence<a href="#powerbi---operational-excellence" class="hash-link" aria-label="Direct link to PowerBI - Operational Excellence" title="Direct link to PowerBI - Operational Excellence">​</a></h6>
<p><img decoding="async" loading="lazy" alt="PowerBI - Operational Excellence" src="/assets/images/aoe-powerbi_operationalexcellencepng-a2a1ca90266c98bcfd0b8bca4a2f81fc.png" title="PowerBI - Operational Excellence" width="1571" height="782" class="img_ev3q"></p>
<p><strong>Congratulations! You have now successfully stood up and configured Azure Optimization Engine!</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="additional-recommended-reading">Additional Recommended Reading<a href="#additional-recommended-reading" class="hash-link" aria-label="Direct link to Additional Recommended Reading" title="Direct link to Additional Recommended Reading">​</a></h4>
<ul>
<li><em>&quot;Augmenting Azure Advisor Cost Recommendations for Automated Continuous Optimization&quot;</em> blog post series:
<ol>
<li><a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/augmenting-azure-advisor-cost-recommendations-for-automated/ba-p/1339298?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Augmenting Azure Advisor Cost Recommendations for Automated Continuous Optimization – Part 1">Part 1 - Solution Overview</a></li>
<li><a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/augmenting-azure-advisor-cost-recommendations-for-automated/ba-p/1457687?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Augmenting Azure Advisor Cost Recommendations for Automated Continuous Optimization – Part 2">Part 2 - Collecting Data</a></li>
<li><a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/augmenting-azure-advisor-cost-recommendations-for-automated/ba-p/1544796?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Augmenting Azure Advisor Cost Recommendations for Automated Continuous Optimization – Part 3">Part 3 - Generating &amp; Viewing Recommendations</a></li>
<li><a href="https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/automating-continuous-optimization-with-the-azure-optimization/ba-p/1851317?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Automating Continuous Optimization with the Azure Optimization Engine">Part 4 - Automating Continous Optimisation with the Azure Optimization Engine</a></li>
</ol>
</li>
<li><a href="https://github.com/helderpinto/AzureOptimizationEngine#usage-instructions" target="_blank" rel="noopener noreferrer" title="Azure Optimization Engine">Azure Optimization Engine Github - Usage instructions</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/setup-azure-cloud-shell/">Setup Azure Cloud Shell</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-03-07T00:00:00.000Z">March 7, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>The Azure Cloud Shell allows connectivity to Microsoft Azure using an authenticated, browser-based shell experience that’s hosted in the cloud and accessible from virtually anywhere as long as you have access to your favourite browser!</p>
<p>Azure Cloud Shell is assigned per unique user account and automatically authenticated with each session.</p>
<p>Get a modern command-line experience from multiple access points, including the <a href="https://portal.azure.com/" target="_blank" rel="noopener noreferrer">Azure portal</a>, <a href="https://shell.azure.com/" target="_blank" rel="noopener noreferrer">shell.azure.com</a>, <a href="https://azure.microsoft.com/en-us/get-started/azure-portal/mobile-app/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure mobile app</a>, Azure docs_(e.g.<em><a href="https://learn.microsoft.com/en-us/cli/azure/?view=azure-cli-latest&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer"><em>Azure CLI</em></a></em>,_ <a href="https://learn.microsoft.com/en-us/powershell/azure/get-started-azureps?view=azps-7.5.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer"><em>Azure PowerShell</em></a><em>)</em>, and <a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.azure-account" target="_blank" rel="noopener noreferrer">VS Code Azure Account extension</a>.</p>
<p>Both Bash and PowerShell experiences are available.</p>
<blockquote>
<p>Microsoft routinely maintains and updates Cloud Shell, which comes equipped with commonly used CLI tools including Linux shell interpreters, PowerShell modules, Azure tools, text editors, source control, build tools, container tools, database tools, and more. Cloud Shell also includes language support for several popular programming languages such as Node.js, .NET, and Python.</p>
</blockquote>
<p>Along with native tools such as Azure PowerShell, it also contains Terraform, allowing you to implement and test functionality such as Infrastructure as Code, without needing to touch your local machine and is always up-to-date, a full list of tools can be found &#x27;<a href="https://learn.microsoft.com/en-us/azure/cloud-shell/features?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Features &amp; tools for Azure Cloud Shell">here</a>&#x27;.</p>
<p>Just some noticeable things to be aware of regarding the Azure Cloud Shell:</p>
<ul>
<li>Cloud Shell runs on a temporary host provided on a per-session, per-user basis</li>
<li>Cloud Shell times out after 20 minutes without interactive activity</li>
<li>Cloud Shell requires an Azure file share to be mounted</li>
<li>Cloud Shell uses the same Azure file share for both Bash and PowerShell</li>
<li>Cloud Shell is assigned one machine per user account</li>
<li>Cloud Shell persists $HOME using a 5-GB image held in your file share</li>
<li>Permissions are set as a regular Linux user in Bash</li>
</ul>
<p>The Azure Cloud Shell is very easy to set up and get going, but in this article, I will show you the additional configuration options you have available, such as selecting your own storage account, region and resource group to conform to any naming policies and preferences you may have.</p>
<p>By default, CloudShell creates a new Resource Group, Storage account, Fileshare in the Southeast Asia region.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="to-set-up-azure-cloud-shell">To set up Azure Cloud Shell<a href="#to-set-up-azure-cloud-shell" class="hash-link" aria-label="Direct link to To set up Azure Cloud Shell" title="Direct link to To set up Azure Cloud Shell">​</a></h3>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure - Portal"><strong>Azure Portal</strong></a></li>
<li>Click on the little <strong>Terminal/PowerShell icon</strong> in the upper navigation bar</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Cloud Shell" src="data:image/png;base64,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" title="Azure Portal - Cloud Shell" width="1284" height="69" class="img_ev3q"></li>
<li>You should get notified, &quot;You have no storage mounted&quot; click on <strong>Show advanced settings</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Cloud Shell" src="/assets/images/nostgmounted_azureportal-d63a7f92d556cf0d3256d67da456a0d5.png" width="806" height="323" class="img_ev3q"></li>
<li>Here you can easily <strong>create your CloudShell storage account with your own preferences</strong>:</li>
</ol>
<ul>
<li>The subscription</li>
<li>Region</li>
<li>Resource Group <em>(new or existing)</em></li>
<li>Storage account <em>(new or existing)</em></li>
<li>Fileshare <em>(new or existing)</em></li>
</ul>
<ol>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Cloud Shell Storage Account" src="/assets/images/stgconfigured_azureportal-bb2551bdc8f67af3c77be75d9b6a3b19.png" width="770" height="301" class="img_ev3q"></li>
<li>Click on <strong>Create Storage</strong> when you are ready to start the verification <em>(which happens after you click Create storage, don&#x27;t worry as long as you have the window open you can make any additional changes)</em> and deployment.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Cloud Shell" src="/assets/images/cloudshell-92ed03f8e9ca553bfead39c6fec4b478.png" width="1574" height="866" class="img_ev3q"></li>
</ol>
<p>Using this method is handy when you have more than one person administering the subscription, each person can have its own file share, which can then be backed up using Azure Backup and easily removed later when not needed.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2022/02/16/native-rdp-client-azure-bastion/">Native RDP Client &amp; Azure Bastion</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-02-16T00:00:00.000Z">February 16, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>In early February 2022, Azure Bastion Preview support for the <a href="https://learn.microsoft.com/en-us/azure/bastion/connect-native-client-windows?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Connect to a VM using the native client (Preview)">native Windows SSH and RDP</a> client came out, and this meant that we no longer have to rely on the Azure Portal and the limitations of a web browser - the support also includes File transfer through the clipboard by copying and pasted into the RDP session!</p>
<blockquote>
<p>Azure Bastion is a fully managed service that provides more secure and seamless Remote Desktop Protocol (RDP) and Secure Shell Protocol (SSH) access to virtual machines (VMs) without any exposure through public IP addresses. Provision the service directly in your local or peered virtual network to get support for all the VMs within it.</p>
</blockquote>
<p>Let’s test the native RDP client through a secure connection using Azure Bastion!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<ul>
<li>This configuration requires the <a href="https://learn.microsoft.com/en-us/azure/bastion/configuration-settings?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Bastion documentation">Standard</a> tier for Azure Bastion.</li>
<li>A Virtual Machine(s) to connect</li>
<li>Latest <a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure CLI">Azure CLI</a></li>
<li>Reader role on the Virtual Machine</li>
<li>Read role on the Network Interface Card of the Virtual Machine.</li>
<li>Reader role on the Azure Bastion resource</li>
<li>Virtual Machine Administrator <em>(or User)</em> login role <em>using</em> <a href="https://learn.microsoft.com/en-us/azure/active-directory/devices/howto-vm-sign-in-azure-ad-windows?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Login to Windows virtual machine in Azure using Microsoft Entra ID authentication"><em>Microsoft Entra ID</em></a><em>authentication</em>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-bastion">Create Azure Bastion<a href="#create-azure-bastion" class="hash-link" aria-label="Direct link to Create Azure Bastion" title="Direct link to Create Azure Bastion">​</a></h3>
<p>If you have a Virtual Machine but haven&#x27;t set up Azure Bastion, run through the below to set it up:</p>
<ol>
<li>Log in to the <strong>Azure Portal</strong></li>
<li>Click on <strong>Create a resource</strong></li>
<li>Search for: <strong>Bastion</strong> <img decoding="async" loading="lazy" alt="Azure - Bastion" src="/assets/images/bastionmarketplace-3d1024864c5635f8244224dd1e84a911.png" title="Azure - Bastion" width="1016" height="353" class="img_ev3q"></li>
<li>Click <strong>Create</strong></li>
<li>This is a Networking resource to place it in the same Resource Group as my Virtual Network.</li>
<li>Please type in a <strong>Name</strong> for the <strong>Bastion</strong> instance; I will call mine: Bastion</li>
<li><strong>Select</strong> the <strong>Region</strong> that <strong>matches</strong> the Virtual <strong>Network</strong> region</li>
<li>Select <strong>Standard</strong> Tier</li>
<li>Select the <strong>Virtual Network</strong></li>
<li>It now warns you about creating an: AzureBastionSubnet with a prefix of at least /27, so we need to create one; click on <strong>Manage Subnet Configuration</strong>.</li>
<li>Click <strong>+ Subnet</strong></li>
<li>For the Name type in: <strong>AzureBastionSubnet</strong></li>
<li>For the <strong>Subnet</strong> address range: <strong>10.0.1.0/27</strong>, <em>If you get an error that indicates the address is overlapping with another subnet, it may be because the Address space is only a /24; click Cancel and click on Address Space in the Virtual Network and change the /24 to/16 to increase the address range.</em></li>
<li>Click <strong>Save</strong> to create the subnet <img decoding="async" loading="lazy" alt="Azure - Bastion" src="data:image/png;base64,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" title="Azure - Bastion" width="1120" height="112" class="img_ev3q"></li>
<li>Up the Top, click <strong>Create a Bastion</strong>. Your subnet should be selected automatically to go back to the Bastion setup.</li>
<li>You do need a <strong>Public IP</strong> for Bastion, so <strong>confirm</strong> the <strong>name</strong> is appropriate, then click <strong>Next: Tags.</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Bastion" src="/assets/images/2022-02-16-10_44_32-create-a-bastion-microsoft-azure-mozilla-firefox-private-browsing-8c8a7936ac1a513139302228cd17a0e3.png" width="787" height="780" class="img_ev3q"></li>
<li>Add in appropriate tags, then click <strong>Next: Advanced</strong></li>
<li>Check the box next to <strong>Native client support (Preview)</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Bastion" src="data:image/png;base64,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" width="482" height="228" class="img_ev3q"></li>
<li>Click <strong>Next: Review + Create</strong></li>
<li>Click on <strong>Create</strong> to create your Bastion instance!</li>
</ol>
<p><strong>Note: Bastion may take 10-20 minutes to provision.</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-bastion-sku">Check Bastion SKU<a href="#check-bastion-sku" class="hash-link" aria-label="Direct link to Check Bastion SKU" title="Direct link to Check Bastion SKU">​</a></h3>
<p>If you already have an Azure Bastion instance, let&#x27;s check the SKU and, if needed, change it to Standard. Just a note:</p>
<p><em>Downgrading from a Standard SKU to a Basic SKU is not supported. To downgrade, you must delete and recreate Azure Bastion.</em></p>
<ol>
<li>Log in to the <strong>Azure Portal</strong></li>
<li>Navigate to your <strong>Bastion</strong> resource</li>
<li>Click on: <strong>Configuration</strong></li>
<li>Change Tier to <strong>Standard</strong></li>
<li>Check: <strong>Native client support (Preview)</strong></li>
<li>Click <strong>Apply</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Bastion" src="/assets/images/2022-02-16-10_58_47-bastion-microsoft-azure-mozilla-firefox-private-browsing-bbb247a089da3b0dc206bcd7cca3fd6c.png" width="1242" height="440" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="connect-to-vm-using-native-rdp-support">Connect to VM using Native RDP Support<a href="#connect-to-vm-using-native-rdp-support" class="hash-link" aria-label="Direct link to Connect to VM using Native RDP Support" title="Direct link to Connect to VM using Native RDP Support">​</a></h3>
<ol>
<li>
<p>Open command prompt or Terminal</p>
</li>
<li>
<p>Type: <strong>az login</strong></p>
</li>
<li>
<p>Login to your Azure subscription</p>
</li>
<li>
<p>We need the resource ID of the VM we need to connect to, type in: <strong>az VM show --resource-group &#x27;appserver-rg&#x27; --name &#x27;APP-P01&#x27; --show-details</strong></p>
</li>
<li>
<p><em>Change the resource group and VM name above to match your VM</em></p>
</li>
<li>
<p>Copy the id of the Virtual Machine you want to connect to</p>
</li>
<li>
<p>Because I am running the Azure CLI from a PowerShell terminal, I am going to use the following variables:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$BastionName = &#x27;Bastion&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$BastionRG = &#x27;network-rg&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$VMResourceID= &#x27;/subscriptions/000000-0000-0000-0000000/resourceGroups/appserver-rg/providers/Microsoft.Compute/virtualMachines/APP-P01&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">az network bastion rdp --name $BastionName --resource-group $BastionRG --target-resource-id $VMResourceID</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Run the command, your Remote Desktop window should open up, and the tunnel has been established; if you close the Azure CLI window, your RDP session will be dropped!</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Bastion" src="/assets/images/azurebastiontst-58f474c9f5ff6d33ae8cec8518eded12.gif" width="2117" height="1025" class="img_ev3q"></p>
</li>
</ol>
<p>As you could most likely tell, there are no options to enable drive passthrough, etc. You would usually find when connecting to Remote Desktop, but the copying of files/text, etc., does work!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2022/02/11/azurefeeds/">AzureFeeds</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-02-11T00:00:00.000Z">February 11, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Over the past few months, I have been busy working on a new project...</p>
<p>A news aggregator for Azure news and updates, I tested some desire for this using AzureFeeds, on <a href="https://www.linkedin.com/in/azure-feeds-709457212/recent-activity/" target="_blank" rel="noopener noreferrer" title="Azure Feeds - Linkedin">LinkedIn </a> as a platform <em>(which will continue)...</em></p>
<p>I didn&#x27;t want my LinkedIn connections, to be spammed by Azure updates every day, when some connections were connected to me for other non-Azure related services, so I created a separate account that interested people could subscribe to AzureFeeds.</p>
<p>I was lucky enough to acquire both <a href="https://azureupdates.com" target="_blank" rel="noopener noreferrer" title="https://azureupdates.com">https://azureupdates.com</a> and <a href="https://azurefeeds.com/" target="_blank" rel="noopener noreferrer" title="https://azurefeeds.com/">https://azurefeeds.com/</a> and wanted to do something a bit more substantial than just forwarding to the relevant Microsoft pages.</p>
<p>Inspired by <a href="https://www.planetpowershell.com/" target="_blank" rel="noopener noreferrer" title="Planet PowerShell">PlanetPowerShell</a>, I wanted an Azure specific service, so I created the <a href="https://azurefeeds.com/" target="_blank" rel="noopener noreferrer" title="Azure Feeds">AzureFeeds</a> website.</p>
<p>Originally starting using official Microsoft services, due to the massive amount of updates and changes ongoing, I didn&#x27;t want to make the feeds too busy, however with <a href="https://twitter.com/lukemurraynz/status/1491139604879388673" target="_blank" rel="noopener noreferrer" title="Twitter - Community or nah?">feedback</a> from the community through a Twitter poll, I then added an author section and added community-based content to supplement official updates, mimicking the functionality of PlanetPowerShell being content community-driven a lot more.</p>
<p>You can subscribe to a single feed by clicking &#x27;Download Feed&#x27; using your favourite RSS reader (even <a href="https://support.microsoft.com/en-us/office/what-are-rss-feeds-e8aaebc3-a0a7-40cd-9e10-88f9c1e74b97" target="_blank" rel="noopener noreferrer" title=" What are RSS feeds?">Outlook</a>) and get the content delivered straight to you from official and community updates! Allowing you to keep up with Azure Updates and Azure community-driven updates easily, or just browse the webpage and filter by Author or Category for content that you may be after.</p>
<p><strong>Check out..</strong> <a href="https://azurefeeds.com/" target="_blank" rel="noopener noreferrer" title="https://azurefeeds.com/"><strong>https://azurefeeds.com/</strong></a></p>
<p><a href="https://azurefeeds.com/" target="_blank" rel="noopener noreferrer" title="https://azurefeeds.com/"><img decoding="async" loading="lazy" alt="Azure Feeds" src="/assets/images/azure-feeds-keep-up-to-date-with-the-ever-changing-and-evolving-microsoft-azur-e65131969b12c898b5c584f6ff202354.png" title="Azure Feeds" width="1688" height="1018" class="img_ev3q"></a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-vm-application-deployment/">Datto Remote Management Azure VM Application Deployment</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-02-05T00:00:00.000Z">February 5, 2022</time> · <!-- -->14 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>The Azure Compute Gallery <em>(superseded the Shared Image Gallery)</em> offers more than just Azure Image management and replication, and you can deploy Applications to your Virtual Machines.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<blockquote>
<p>An Azure Compute Gallery helps you build structure and organization around your Azure resources, like images and <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/vm-applications?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">applications</a>. An Azure Compute Gallery provides:</p>
<ul>
<li>Global replication.</li>
<li>Versioning and grouping of resources for easier management.</li>
<li>Highly available resources with Zone Redundant Storage <em>(ZRS)</em> accounts in regions that support Availability Zones. ZRS offers better resilience against zonal failures.</li>
<li>Premium storage support <em>(Premium_LRS)</em>.</li>
<li>Sharing across subscriptions, and even between Active Directory <em>(AD)</em> tenants, using Azure RBAC.</li>
<li>Scaling your deployments with resource replicas in each region.</li>
</ul>
</blockquote>
<p>With images, Azure VM applications that support both Linux and Windows operating systems get these benefits.</p>
<blockquote>
<p>While you can create an image of a VM with apps pre-installed, you would need to update your image each time you have application changes. Separating your application installation from your VM images means there’s no need to publish a new image for every line of code change.</p>
<p>Application packages provide benefits over other deployment and packaging methods:</p>
<ul>
<li>Grouping and versioning of your packages</li>
<li>VM applications can be globally replicated to be closer to your infrastructure, so you don’t need to use AzCopy or other storage copy mechanisms to copy the bits across Azure regions.</li>
<li>Sharing with other users through Azure Role Based Access Control (RBAC)</li>
<li>Support for virtual machines, and both flexible and uniform scale sets</li>
<li>If you have Network Security Group (NSG) rules applied on your VM or scale set, downloading the packages from an internet repository might not be possible. And with storage accounts, downloading packages onto locked-down VMs would require setting up private links.</li>
<li>VM applications can be used with the <a href="https://learn.microsoft.com/en-us/azure/governance/policy/concepts/effects?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">DeployIfNotExists</a> policy.</li>
</ul>
</blockquote>
<p>Azure VM Application packages <em>(stored in an Azure Storage account)</em> uses multiple resources, as below:</p>





















<table><thead><tr><th>Resource</th><th>Description</th></tr></thead><tbody><tr><td>Azure compute gallery</td><td>A gallery is a repository for managing and sharing application packages. Users can share the gallery resource and all the child resources will be shared automatically. The gallery name must be unique per subscription. For example, you may have one gallery to store all your OS images and another gallery to store all your VM applications.</td></tr><tr><td>VM application</td><td>This is the definition of your VM application. This is a logical resource that stores the common metadata for all the versions under it. For example, you may have an application definition for Apache Tomcat and have multiple versions within it.</td></tr><tr><td>VM Application version</td><td>This is the deployable resource. You can globally replicate your VM application versions to target regions closer to your VM infrastructure. The VM Application Version must be replicated to a region before it may be deployed on a VM in that region.</td></tr></tbody></table>
<p>There is no extra charge for using VM Application Packages, but you will be charged for the following resources:</p>
<ul>
<li>Storage costs of storing each package and any replicas.</li>
<li>Network egress charges for replication of the first image version from the source region to the replicated regions. Subsequent replicas are handled within the region, so there are no additional charges.</li>
</ul>
<p>Before we deploy our first VM application, there are a few things we need to be aware of:</p>
<ul>
<li>VM Application requires an Azure Compute Gallery</li>
<li>VM Application requires an Azure storage account to store your applications</li>
<li>The VM Application gets downloaded to the VM using the name of the VM application <em>(not the actual name and Extension of your file in the storage account)</em></li>
<li>Currently, in order to retry a failed installation, you need to remove the application from the profile and add it back</li>
<li>No more than five applications per Virtual Machine deployed at a time</li>
<li>The maximum size of the application is 1 GB</li>
<li>You can&#x27;t have multiple versions of the same application installed on a Virtual Machine, and a newer version will supersede an older version either via an upgrade command or complete reinstall.</li>
</ul>
<p>In this article, we are going to deploy the Datto Remote Management &amp; Monitoring Agent to a Windows Server 2022 Virtual Machine; this agent is a simple executable that installs on a virtual machine and allows remote access and management of a virtual machine, without requiring any other form of connectivity <em>(Azure Bastion, RDP via Public IP, Site to Site VPN etc.)</em> for an MSP <em>(Managed Service Provider)</em> using the Datto toolset, the same concept can be applied to any application <em>(theoretically you can also use this to run PowerShell installs or chocolatey installs)</em>.</p>
<blockquote>
<p>It&#x27;s worth noting the VM Applications are currently in Public Preview, there is a good chance there will be changes in the way these operate and are configured when it becomes Generally Available.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-vm-application-deployment">Setup Azure VM Application Deployment<a href="#setup-azure-vm-application-deployment" class="hash-link" aria-label="Direct link to Setup Azure VM Application Deployment" title="Direct link to Setup Azure VM Application Deployment">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h4>
<p>In order to use VM Applications, we need:</p>
<ul>
<li>A storage account</li>
<li>Azure Compute gallery</li>
<li>VM application definition and version <em>(in my example: the Datto RMM agent)</em></li>
</ul>
<p>Following the guide, we will run through the creation of everything from scratch; I am, however, assuming you already have the executable or application package and know the instructions to install/uninstall it - as each application is different. The Microsoft<a href="https://learn.microsoft.com/en-us/azure/virtual-machines/vm-applications?WT.mc_id=AZ-MVP-5004796#exe-installer" target="_blank" rel="noopener noreferrer" title="VM Applications overview">VM Applications docs</a> give a few good examples for getting started with various applications.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-storage-account">Setup Storage Account<a href="#setup-storage-account" class="hash-link" aria-label="Direct link to Setup Storage Account" title="Direct link to Setup Storage Account">​</a></h4>
<p>The Storage account is where your application will be placed; it uses blobs; depending on the importance of your application deployments, you may want to go for geo-replication etc., but in this example, I will be going with a locally redundant, StorageV2 general-purpose account.</p>
<ol>
<li>Open the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click on <strong>+ Create a Resource</strong></li>
<li>Search for: <strong>Storage account</strong>, and <strong>select</strong> it</li>
<li>Click <a href="https://portal.azure.com/#create/Microsoft.StorageAccount-ARM" target="_blank" rel="noopener noreferrer" title="Create a storage account"><strong>Create</strong></a></li>
<li><strong>Select</strong> your <strong>subscription</strong></li>
<li><strong>Select</strong> a <strong>Resource Group</strong> for your storage account, <strong>or create</strong> a new <strong>one</strong></li>
<li><strong>Enter</strong> your storage account <strong>name</strong> <em>(this needs to be globally unique)</em></li>
<li><strong>Select</strong> your <strong>region</strong> that your application will be in; although the application can be replicated to other regions, it&#x27;s better to select your primary region here.</li>
<li><strong>Select</strong> the <strong>performance</strong> and <strong>redundancy</strong> to match your requirements and click <strong>Next: Advanced</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create Storage Account" src="/assets/images/create-a-storage-account-microsoft-azure-6c3cf423d43d18281bf042d6325ffbe7.png" width="910" height="937" class="img_ev3q"></li>
<li>You can <strong>leave</strong> most <strong>settings</strong> here as <strong>default</strong>, the application executable will need to be able to be accessed directly; make sure the <strong>Minimum TLS</strong> is at least <strong>1.2</strong>.</li>
<li>You don&#x27;t need hierarchical namespace etc.; unselect &#x27;<em>Allow cross-tenant replication&#x27;</em> unless this is a feature you use.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create Storage Account" src="/assets/images/create-a-storage-account-advanced-microsoft-azure-619d94a152780cdca4cf6f5c9cd69060.png" width="1035" height="1183" class="img_ev3q"></li>
<li>Click <strong>Review + Create</strong> to skip to the last blade; most defaults are fine, but if you want to adjust the blob retainment and soft delete settings, go to the Data Protection tab, set them, then review your Configuration and select <strong>Create</strong>.</li>
<li>Go back to your storage account and click <strong>Configuration</strong></li>
<li>Make sure: Allow storage account key access is: <strong>Enabled</strong>; if it is not, select Enabled and click <strong>Save</strong>.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-compute-gallery">Setup Azure Compute Gallery<a href="#setup-azure-compute-gallery" class="hash-link" aria-label="Direct link to Setup Azure Compute Gallery" title="Direct link to Setup Azure Compute Gallery">​</a></h4>
<p>Now that we have the Storage account to store your application binaries, we now need an Azure Compute Gallery <em>(previously the Shared Image Gallery)</em> to keep your application definition and version metadata.</p>
<ol>
<li>Open the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click on <strong>+ Create a Resource</strong></li>
<li>Search for: <strong>Azure Compute Gallery</strong> and <strong>select</strong> it</li>
<li>Click <a href="https://portal.azure.com/#create/microsoft.sharedImageGallery" target="_blank" rel="noopener noreferrer" title="Create Azure compute gallery"><strong>Create</strong></a></li>
<li><strong>Select</strong> your <strong>subscription</strong> and <strong>resource group</strong> <em>(in this case, I am going to use the same resource group as the Storage account I created earlier)</em></li>
<li>Type in a <strong>name</strong>, and <strong>select</strong> your <strong>region</strong></li>
<li>Although not mandatory, use the opportunity to fill in a description for the purpose of the Compute Gallery for future reference</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create Storage Account" src="/assets/images/create-azure-compute-gallery-microsoft-azure-f60d33dd4dbe9c6ff1e16d399b8efb54.png" width="796" height="605" class="img_ev3q"></li>
<li>Select <strong>Review + Create</strong></li>
<li>Verify everything is correct and click on: <strong>Create</strong></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-application-definition">Create Application Definition<a href="#create-application-definition" class="hash-link" aria-label="Direct link to Create Application Definition" title="Direct link to Create Application Definition">​</a></h4>
<p>VM application definitions are created within a gallery and carry information about the application and requirements for using it internally. This includes the operating system type for the VM application versions contained within the application definition. The name of your Application definition defines the name of the file that will be downloaded to your virtual machines.</p>
<ol>
<li>Open the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Navigate to &#x27;<strong>All Resources&#x27;</strong></li>
<li><strong>Find and click on</strong> your <strong>Azure Compute Gallery</strong> you created earlier</li>
<li>On the overview pane, select <strong>+ Add</strong></li>
<li>Click on +<strong>VM application definition</strong></li>
<li>Your subscription and resource group should be automatically selected to the location of the Compute Gallery, type in the <strong>name of</strong> your <strong>applicatio.n</strong></li>
<li>Select your <strong>region</strong></li>
<li>Select the <strong>OS type</strong> - in my case, and I select <strong>Windows</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create Application Definition" src="/assets/images/create-a-vm-application-definition-microsoft-azure-65e5e7ef47340d1255b43581f5a68fa4.png" width="773" height="878" class="img_ev3q"></li>
<li>Click <strong>Next: Publishing Options</strong></li>
<li>The following fields are not mandatory, but I recommend filling in areas to help report on and manage your applications.
<ul>
<li>Description</li>
<li>End of life date</li>
<li>Eula link</li>
<li>Privacy URI</li>
<li>Release notes URI</li>
</ul>
</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create Metadata" src="/assets/images/create-a-vm-application-definition-metadata-microsoft-azure-648f195d72135cdf78547179db26f318.png" width="751" height="511" class="img_ev3q"></li>
<li>Click <strong>Review + create</strong></li>
<li>Verify your Configuration and select <strong>Create</strong></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-application-version">Create Application version<a href="#create-application-version" class="hash-link" aria-label="Direct link to Create Application version" title="Direct link to Create Application version">​</a></h4>
<p>Now that we have the application definition setup, it&#x27;s time to set up the version and upload our binary file.+</p>
<ol>
<li>
<p>Open the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></p>
</li>
<li>
<p>Navigate to &#x27;<strong>All Resources&#x27;</strong></p>
</li>
<li>
<p><strong>Find and click on</strong> your <strong>Azure Compute Gallery</strong> you created earlier</p>
</li>
<li>
<p>Click on <strong>Definitions</strong><em>(besides the Get Started link)</em></p>
</li>
<li>
<p><strong>Select</strong> your Application <strong>definition</strong></p>
</li>
<li>
<p>Click on: <strong>+Add</strong></p>
</li>
<li>
<p><strong>Enter</strong> in your <strong>version number</strong>, and this will increment and grow as you adjust and troubleshoot your application; I recommend starting with 0.0.1 then working your way up, with 1.0.0 being potentially your final/production-ready releast.</p>
</li>
<li>
<p>Select your <strong>Region</strong></p>
</li>
<li>
<p>Now we need to select our source application package <em>(you can enter in your blob URL if you know it)</em>; we haven&#x27;t uploaded it to our storage account yet, so we will select <strong>Browse</strong></p>
</li>
<li>
<p><strong>Select</strong> your <strong>Storage account</strong></p>
</li>
<li>
<p>Press <strong>+ Container</strong></p>
</li>
<li>
<p><strong>Enter</strong> in the <strong>name</strong> of your <strong>container</strong> <em>( it has to be in lowercase)</em>, such as the application name <em>(to keep things separate, consider a container per application)</em></p>
</li>
<li>
<p>Press <strong>Upload</strong></p>
</li>
<li>
<p><strong>Browse</strong> to your <strong>file</strong> and select it</p>
</li>
<li>
<p>Expand <strong>Advanced</strong></p>
</li>
<li>
<p>Make sure that Blob type is: <strong>Blob</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Portal - Azure Blob" src="/assets/images/upload-blob-microsoft-azure-ab68e0f8c8521e5d1d61497f6b09f0ec.png" width="1417" height="1072" class="img_ev3q"></p>
</li>
<li>
<p>Click <strong>Upload</strong></p>
</li>
<li>
<p><strong>Select</strong> your newly uploaded file and click <strong>Select</strong></p>
</li>
<li>
<p><em>Note: You can only upload one file as part of your package, you can upload a ZIP file and have your Install script extract it</em></p>
</li>
<li>
<p>The <strong>Install script</strong> is the command to install to your application, by default windows applications are set to install cmd. This already knows the directory your files are in because the file will be uploaded as the application name (i.e. DattoRMM), it needs to be renamed to include .exe and then ran, I will switch to PowerShell for the Install script, so will enter:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">powershell.exe -command &quot;Rename-Item &#x27;.\DattoRMM&#x27; -NewName &#x27;DattoRMM.exe&#x27;; Start-Process &#x27;.\DattoRMM.exe&#x27;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>If you have a script to uninstall the application, enter it <em>(in my case, I am just going to put a &#x27;.&#x27; to skip this, as I don&#x27;t currently have an uninstall script developed)</em></p>
</li>
<li>
<p>The rest of the Configuration isn&#x27;t mandatory; the Update script is used by Azure when a new version of an application is created; by default, the Azure VM extension will treat an upgrade like a completely new install and run the install steps unless an update script is defined.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Portal - Application Version" src="/assets/images/create-a-vm-application-version-microsoft-azure-0df2a1f5e8b68233635efdfb6ac2cf7a.png" width="865" height="1062" class="img_ev3q"></p>
</li>
<li>
<p>Click <strong>Next: Replication</strong></p>
</li>
<li>
<p>Like Azure Compute Images, you can replicate your Azure VM applications across multiple regions <em>(depending on where your workloads are)</em>, such as Australia East to West Europe, and store it then Zone Redundant or Local storage. In my example, I am going to leave mine as one replica in Australia East on locally-redundant storage and click <strong>Review + create</strong></p>
</li>
<li>
<p>Verify everything looks ok and click <strong>Create</strong> to create your application version! This may take a few minutes to create, depending on your configuration and replication.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-azure-vm-application">Deploy Azure VM Application<a href="#deploy-azure-vm-application" class="hash-link" aria-label="Direct link to Deploy Azure VM Application" title="Direct link to Deploy Azure VM Application">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-azure-vm-application-to-virtual-machines-using-the-azure-portal">Deploy Azure VM Application to Virtual Machines using the Azure Portal<a href="#deploy-azure-vm-application-to-virtual-machines-using-the-azure-portal" class="hash-link" aria-label="Direct link to Deploy Azure VM Application to Virtual Machines using the Azure Portal" title="Direct link to Deploy Azure VM Application to Virtual Machines using the Azure Portal">​</a></h4>
<p>Now that your Azure VM Application has been created, it is now time to deploy to a Virtual Machine. I have a Windows Server 2022 Datacenter Azure Gen 2 VM running as a Standard_B2ms as my test machine, and because I am going to use the Datto RMM agent to connect to the machine, I don&#x27;t need any RDP ports open etc.</p>
<ol>
<li>Open the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Navigate to <strong>Virtual Machines</strong></li>
<li>Click on your Virtual Machine</li>
<li>Under Settings, click <strong>Extensions + Applications</strong></li>
<li>Click <strong>VM Applications</strong></li>
<li>Click <strong>+ Add application</strong></li>
<li><strong>Select</strong> your <strong>application</strong> <em>(note you can select a particular version, by default, it is the latest)</em></li>
<li>Click <strong>Ok</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - VM-P01" src="/assets/images/vm-p01-microsoft-azure-be4a29adee4d86ddd404d9ac2a5da96d.png" width="1427" height="675" class="img_ev3q"></li>
<li>You can select your Install Order <em>(i.e. if you had multiple applications, you can select which one installs 1st, 2nd, third and so on)</em>; I will select No Reference and click Save to start the deployment.</li>
<li>If you click Extensions, you should see that a: VMAppExtension has started to be installed; click on Refresh to update the status and click on the Extension to a more detailed status message, hopefully you see &quot;:Operational Install is SUCCESS&quot;</li>
<li>My Virtual Machine has now had the Datto Remote Management agent installed successfully and has appeared in the portal for me to connect to!</li>
<li><img decoding="async" loading="lazy" alt="Azure - Datto RMM" src="/assets/images/vm-p01-datto-rmm-034de4021906de33a95bec0d37a9a146.png" width="601" height="254" class="img_ev3q"></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-azure-vm-application-to-multiple-virtual-machines-using-powershell">Deploy Azure VM Application to Multiple Virtual Machines using PowerShell<a href="#deploy-azure-vm-application-to-multiple-virtual-machines-using-powershell" class="hash-link" aria-label="Direct link to Deploy Azure VM Application to Multiple Virtual Machines using PowerShell" title="Direct link to Deploy Azure VM Application to Multiple Virtual Machines using PowerShell">​</a></h4>
<p>I&#x27;ve created the PowerShell script below to deploy an application to multiple Virtual Machines at once, it can easily be adjusted for a PowerShell Runbook that runs periodically to install software on machines it may be missing. As usual, please make sure you test and run any PowerShell scripts first in a demo environment.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$allvms = Get-AzVM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$applicationname = &#x27;DattoRMM&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$galleryname = &#x27;AzComputeGallery&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$galleryrg = &#x27;vmapps-prod-rg&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$appversion = &#x27;0.0.1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">try</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ForEach ($vm in $allvms)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $AzVM = Get-AzVM -ResourceGroupName $vm.ResourceGroupName -Name $vm.Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $appversion = Get-AzGalleryApplicationVersion `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -GalleryApplicationName $applicationname `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -GalleryName $galleryname `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -Name $appversion `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -ResourceGroupName $galleryrg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $packageid = $appversion.Id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $app = New-AzVmGalleryApplication -PackageReferenceId $packageid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-AzVmGalleryApplication -VM $AzVM -GalleryApplication $app</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Update-AzVM -ResourceGroupName $vm.ResourceGroupName -VM $AzVM -ErrorAction Stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">catch [Microsoft.Azure.Commands.Compute.Common.ComputeCloudException]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  #Most likely failed due to duplicate package ID/identical version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  [Management.Automation.ErrorRecord]$e = $_</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $info = [PSCustomObject]@{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Exception = $e.Exception.Message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Reason    = $e.CategoryInfo.Reason</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Target    = $e.CategoryInfo.TargetName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-vm-application">Troubleshooting VM Application<a href="#troubleshooting-vm-application" class="hash-link" aria-label="Direct link to Troubleshooting VM Application" title="Direct link to Troubleshooting VM Application">​</a></h3>
<p>If you have problems installing a package, just a reminder that the VM Application, uploads your file based on the name of the Application, to the server and needs to be renamed with a valid extension as part of the install script.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="package-location">Package Location<a href="#package-location" class="hash-link" aria-label="Direct link to Package Location" title="Direct link to Package Location">​</a></h4>
<p>The package/extension location is here:</p>
<ul>
<li>C:\Packages\Plugins\Microsoft.CPlat.Core.VMApplicationManagerWindows\{VERSION#}\</li>
</ul>
<p>You will find your Application binary under Downloads.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="logs">Logs<a href="#logs" class="hash-link" aria-label="Direct link to Logs" title="Direct link to Logs">​</a></h4>
<p><strong>For the extension status logs, navigate to:</strong></p>
<ul>
<li>C:\Packages\Plugins\Microsoft.CPlat.Core.VMApplicationManagerWindows\{VERSION#}\Status</li>
</ul>
<p>You should see files such as:</p>
<ul>
<li>0.status</li>
</ul>
<p>You can right-click these and open them in Notepad, and you should have the timestamp and the last status message, this should be identical to what you see in the Azure Portal.</p>
<p><strong>For the application install logs, navigate to:</strong></p>
<ul>
<li>C:\Packages\Plugins\Microsoft.CPlat.Core.VMApplicationManagerWindows\{VERSION#}\Downloads\{APPNAME}\{APPVERSION}\</li>
</ul>
<p>You may see files such as:</p>
<ul>
<li>stderr</li>
<li>stdout</li>
</ul>
<p>You can right-click these and open them in Notepad, any errors will be noted in these.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting-during-preview">Troubleshooting during preview<a href="#troubleshooting-during-preview" class="hash-link" aria-label="Direct link to Troubleshooting during preview" title="Direct link to Troubleshooting during preview">​</a></h4>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-machines/vm-applications?WT.mc_id=AZ-MVP-5004796#troubleshooting-during-preview" target="_blank" rel="noopener noreferrer" title="Troubleshooting during preview">Troubleshooting during preview</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tags/azure/page/19/"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tags/azure/page/21/"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">196 posts tagged with &quot;Azure&quot; | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/tags/azure/page/18/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="196 posts tagged with &quot;Azure&quot; | luke.geek.nz"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/tags/azure/page/18/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/18/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/18/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script>






<script>window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){window.dataLayer.push(arguments)}</script>
<meta property="og:type" content="website">
<meta property="og:site_name" content="luke.geek.nz">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@lukemurraynz">
<meta name="twitter:creator" content="@lukemurraynz">
<meta name="author" content="Luke Murray">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"luke.geek.nz","description":"Microsoft MVP - Microsoft Azure ☁, Technical Consultant, Azure Solutions Architect Expert, Technologist and a drinker of coffee.","url":"https://luke.geek.nz","author":{"@type":"Person","name":"Luke Murray","url":"https://luke.geek.nz/about","sameAs":["https://twitter.com/lukemurraynz","https://www.linkedin.com/in/ljmurray/","https://aus.social/@lukemurray","https://bsky.app/profile/lukemurraynz.bsky.social"]},"publisher":{"@type":"Person","name":"Luke Murray"},"potentialAction":{"@type":"SearchAction","target":"https://luke.geek.nz/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script><link rel="stylesheet" href="/assets/css/styles.991ca2b0.css">
<script src="/assets/js/runtime~main.595ca597.js" defer="defer"></script>
<script src="/assets/js/main.b204cd40.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/tags/">Tags</a><a class="navbar__item navbar__link" href="/archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/luke.geek.nz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/schedule-github-coding-agents/">Schedule GitHub Coding Agents with Copilot CLI and GitHub Actions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azd-github-copilot-coding-agent-azure-mcp-server/">Automate Azure Access for GitHub Copilot with AZD</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/servicebusapimpublish/">Native Service Bus Publishing from API Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/spec-driven-platform-landing-zone-bicep/">Spec-Driven Azure Platform Landing Zone with Bicep</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/learn-mcp-server-semantic-kernel/">Integrating Microsoft Learn MCP Server with Semantic Kernel</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>196 posts tagged with &quot;Azure&quot;</h1><a href="/tags/">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/PrincpalNotFound-bicep-roleassignment/">Azure Bicep - Principal does not exist in directory</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-31T00:00:00.000Z">October 31, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Recently, I was deploying an <a href="https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/how-manage-user-assigned-managed-identities?pivots=identity-mi-methods-azp&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">User Assigned Managed identity</a>, and assigning the managed identity a role assignment with Azure Bicep, and ran into an issue, where the assignment would fail, but then after a rerun would work.</p>
<blockquote>
<p>Principal e892476361114c90be141d9bf20cc94b does not exist in the directory 73160ae1-aa4a-48b5-a424-d5e43d808f53. Check that you have the correct principal ID. If you are creating this principal and then immediately assigning a role, this error might be related to a replication delay. In this case, set the role assignment principalType property to a value, such as ServicePrincipal, User, or Group. See <a href="https://learn.microsoft.com/azure/role-based-access-control/troubleshooting?tabs=bicep&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">https://aka.ms/docs-principaltype</a></p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="PrincpalNotFound" src="/assets/images/PrincipalNotExistinDirectory-30dcbc091e1cb7613fc3c32980a0face.png" width="1044" height="622" class="img_ev3q"></p>
<p>What was happening, was that the User Assigned Identity was created, and immediately after the role assignment was attempted, leaving no time for the role assignment API to be aware that the User Assigned Managed identity existed, even with a hard coded dependson!</p>
<p>The fix was to Set the: <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/scenarios-rbac?WT.mc_id=AZ-MVP-5004796#principal" target="_blank" rel="noopener noreferrer" class="">principalType</a> into the Bicep, as ServicePrincipal, making sure that the Azure platform can wait for the replication to complete, before trying the role assignment.</p>
<blockquote>
<p>The principalType property specifies whether the principal is a user, a group, or a service principal. Managed identities are a form of service principal.</p>
</blockquote>
<div class="language-bicep codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bicep codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> uami </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> azUserAssignedManagedIdentity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">location</span><span class="token operator">:</span><span class="token plain"> location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> uamiassignment </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Authorization/roleAssignments@2022-04-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">guid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">resourceGroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;contributor&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">principalId</span><span class="token operator">:</span><span class="token plain"> uami</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">principalId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">principalType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ServicePrincipal&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">roleDefinitionId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">resourceId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Authorization/roleDefinitions&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;b24988ac-6180-42a0-ab88-20f7382dd24c&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// Contributor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">scope</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">resourceGroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/powershell/azure-management-powershell/">Microsoft Azure Management with PowerShell - Introduction</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-30T00:00:00.000Z">October 30, 2023</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><blockquote>
<p>To see a video of these commands in action, take a look at the following YouTube-hosted video: <a href="https://youtu.be/a4gehHwlwBQ" target="_blank" rel="noopener noreferrer" class="">Microsoft Azure Management with PowerShell - Introduction</a></p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="powershell">PowerShell<a href="#powershell" class="hash-link" aria-label="Direct link to PowerShell" title="Direct link to PowerShell" translate="no">​</a></h2>
<p>PowerShell is a powerful scripting and automation framework developed by Microsoft. It is designed for task automation and configuration management and is particularly useful for managing and automating Microsoft Windows environments. PowerShell uses a command-line interface with a scriptable approach, and it&#x27;s built on the .NET Framework.</p>
<ul>
<li class=""><a href="https://learn.microsoft.com/powershell/scripting/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">What is PowerShell?</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="powershell-and-microsoft-azure">PowerShell and Microsoft Azure<a href="#powershell-and-microsoft-azure" class="hash-link" aria-label="Direct link to PowerShell and Microsoft Azure" title="Direct link to PowerShell and Microsoft Azure" translate="no">​</a></h2>
<p>When it comes to Microsoft Azure, PowerShell provides a robust set of cmdlets (pronounced &quot;command-lets&quot;) that enable you to interact with and manage Azure resources, making it a valuable tool for working with Azure services.</p>
<p>When you run a PowerShell cmdlet to, for example, create a virtual machine or retrieve information about an Azure resource, the cmdlet translates your request into an HTTP request to the relevant Azure REST API endpoint.</p>
<ul>
<li class=""><a href="https://learn.microsoft.com/powershell/azure/?view=azps-10.4.1&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure PowerShell Documentation</a></li>
</ul>
<blockquote>
<p>There is an assumption, that you have access to an Azure environment, and the ability to create resources, within that environment.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Microsoft Azure Management with PowerShell" src="/assets/images/BlogHeading-BlogHeading-Microsoft-Azure-Management-with-PowerShell-788b8586e4737f49ce3303670020bee9.gif" width="1198" height="628" class="img_ev3q"></p>
<p>First up, let&#x27;s verify the version of PowerShell we have, open a Powershell terminal and run:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$PSVersionTable</span><br></span></code></pre></div></div>
<p>A supported version of PowerShell version 7 or higher is the recommended version of PowerShell for use with the Az PowerShell module on all platforms including Windows, Linux, and macOS.</p>
<p>The Az PowerShell module is preinstalled in <a href="https://learn.microsoft.com/azure/cloud-shell/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Cloud Shell</a> and in <a href="https://learn.microsoft.com/powershell/azure/azureps-in-docker?view=azps-10.4.1&amp;tabs=amd64&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Docker</a> images.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-up-your-azure-environment-for-powershell">Setting up your Azure environment for PowerShell<a href="#setting-up-your-azure-environment-for-powershell" class="hash-link" aria-label="Direct link to Setting up your Azure environment for PowerShell" title="Direct link to Setting up your Azure environment for PowerShell" translate="no">​</a></h3>
<p>First thigs first, lets installed the Azure (<a href="https://learn.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-10.4.1&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Az PowerShell module</a>)modules.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Install Azure Modules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># The Set-PSRepository cmdlet is used to set values for a registered repository. </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># The Install-Module cmdlet is used to download one or more modules from an online gallery and installs them on the local computer. In this case, the command is installing the Az module, which provides cmdlets for managing Azure resources.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Set-PSRepository</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;PSGallery&#x27;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">InstallationPolicy Trusted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Install-Module</span><span class="token plain"> Az </span><br></span></code></pre></div></div>
<p>If you don&#x27;t have local administrator rights, you can install it into your user profile like below:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Install Azure Module as Current User (as opposed to System)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># &#x27;-Scope CurrentUser` specifies that the module should be installed only for the current user. If you don&#x27;t specify a scope, the default is `AllUsers`, which requires administrator permissions.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Install-Module</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name Az </span><span class="token operator">-</span><span class="token plain">Repository PSGallery </span><span class="token operator">-</span><span class="token plain">Scope CurrentUser</span><br></span></code></pre></div></div>
<p>You can install a specific version of the Az module by specifying RequiredVersion, like below:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Install specific version of Azure Modules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Install-Module</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name Az </span><span class="token operator">-</span><span class="token plain">RequiredVersion 7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">0</span><br></span></code></pre></div></div>
<p>You will find that the Azure powershell cmdlets will constantly get updated, to resolve bugs, offer new functionality, to update the modules to the ltest you can use:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Update Azure Module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># The command Get-InstalledModule -Name Az* | Update-Module is used to update all installed PowerShell modules that start with &quot;Az&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Set-PSRepository</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;PSGallery&#x27;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">InstallationPolicy Trusted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-InstalledModule</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name Az* </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Update-Module</span><br></span></code></pre></div></div>
<p>Az is a collection of different cmdlets, across multiple Azure resource types, to view a list of avaliable commands you use &#x27;Get-Command&#x27;, like below:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Gets Az Commands</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Note: Will take a while for all the cmdlets to list.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-Command</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Noun Az*</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-started-with-azure-powershell-module">Getting started with Azure PowerShell module<a href="#getting-started-with-azure-powershell-module" class="hash-link" aria-label="Direct link to Getting started with Azure PowerShell module" title="Direct link to Getting started with Azure PowerShell module" translate="no">​</a></h3>
<p>Lets connect to Microsoft Azure</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Connect to Azure - Interactive will prompt for credentials</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Connect-AzAccount</span><br></span></code></pre></div></div>
<p>If your wanting to connect to Azure, from a device that doesn&#x27;t supoport the credential prompt, like Azure Cloudshell you can connect using another device, using a device code:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Connect to Azure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Connect-AzAccount</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">UseDeviceAuthentication</span><br></span></code></pre></div></div>
<p>If you have a Service principal, you can use this to authenticate, commonly used for automation scripts, Azure DevOps agents and GitHub runners.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Connect to Azure using Service Principal authentication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$SecurePassword</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">ConvertTo-SecureString</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">String </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Password123!&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">AsPlainText </span><span class="token operator">-</span><span class="token plain">Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$TenantId</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyy&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ApplicationId</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzz&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Credential</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-Object</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">TypeName System</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Management</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Automation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">PSCredential </span><span class="token operator">-</span><span class="token plain">ArgumentList </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ApplicationId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$SecurePassword</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Connect-AzAccount</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ServicePrincipal </span><span class="token operator">-</span><span class="token plain">TenantId </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$TenantId</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Credential </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Credential</span><br></span></code></pre></div></div>
<p>Once, connected - its time to check what Azure subscriptions you can use.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get Azure Subscriptions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzSubscription</span><br></span></code></pre></div></div>
<p>Once you have selected the right Azure subscription to connect to, you can set your Subscription context (modify/delete resources). Add your subscription ID, from the earlier step in between &#x27;&#x27;.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Select Azure Subscription</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subid</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzContext</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">SubscriptionId </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subid</span><br></span></code></pre></div></div>
<p>Now you have connected to your, Azure subscription, it is time to get your Azure resources and Resource Groups</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get Azure resource groups and resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResourceGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Format-Table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Format-Table</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get Azure resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get Azure resource by ResourceType</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceType </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/virtualNetworks&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Sort Azure resource by Name and Resource Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceType </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Storage/storageAccounts&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Sort-Object</span><span class="token plain"> Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Sort-Object</span><span class="token plain"> ResourceGroupName </span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Working with Variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Working with variables and data types in PowerShell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resourceType</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/virtualNetworks&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceType </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resourceType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Using PowerShell operators for comparisons and calculations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resources</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$count</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Count</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;You have </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$count</span><span class="token string" style="color:rgb(255, 121, 198)"> resources in your Azure subscription.&quot;</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Scripting constructs: loops and conditional statements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resources</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resource</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resources</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceType </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/virtualNetworks&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Found a virtual network: </span><span class="token string function" style="color:rgb(80, 250, 123)">$</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string function variable" style="color:rgb(189, 147, 249);font-style:italic">$resource</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string function" style="color:rgb(80, 250, 123)">Name</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;This virtual network is in </span><span class="token string function" style="color:rgb(80, 250, 123)">$</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string function variable" style="color:rgb(189, 147, 249);font-style:italic">$resource</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string function" style="color:rgb(80, 250, 123)">ResourceGroupName</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ForegroundColor Green</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Scripting constructs: loops and conditional statements</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subscriptions</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzSubscription</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subscription</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subscriptions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resource</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceType </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/virtualNetworks&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$resource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceType </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/virtualNetworks&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Found a virtual network: </span><span class="token string function" style="color:rgb(80, 250, 123)">$</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string function variable" style="color:rgb(189, 147, 249);font-style:italic">$resource</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string function" style="color:rgb(80, 250, 123)">Name</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">BackgroundColor Black </span><span class="token operator">-</span><span class="token plain">ForegroundColor White</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;This virtual network is in </span><span class="token string function" style="color:rgb(80, 250, 123)">$</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string function variable" style="color:rgb(189, 147, 249);font-style:italic">$resource</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string function" style="color:rgb(80, 250, 123)">ResourceGroupName</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ForegroundColor Green</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;This Virtual Network is in </span><span class="token string function" style="color:rgb(80, 250, 123)">$</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string function variable" style="color:rgb(189, 147, 249);font-style:italic">$subscription</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token string function" style="color:rgb(80, 250, 123)">Name</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ForegroundColor Green</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Error handling in PowerShell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;NonexistentResourceGroup&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ErrorAction Stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;An error occurred: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token string" style="color:rgb(255, 121, 198)">. Make sure you have selected the right Resource Group&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ForegroundColor Red</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="resource-creation">Resource Creation<a href="#resource-creation" class="hash-link" aria-label="Direct link to Resource Creation" title="Direct link to Resource Creation" translate="no">​</a></h3>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Import Module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Import-Module</span><span class="token plain"> Az </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#Create Azure Resource Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">New-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;MyResourceGroup&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;West US&quot;</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get Regions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzLocation</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Select-Object</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">First 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzLocation</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Select-Object</span><span class="token plain"> DisplayName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> Location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> PhysicalLocation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> GeographyGroup </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Format-Table</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ate Azure Resource </span><span class="token function" style="color:rgb(80, 250, 123)">Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AustraliaEast&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">New-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;MyResourceGroup</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Create a storage account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uniqueId</span><span class="token plain"> = </span><span class="token namespace">[guid]</span><span class="token plain">::NewGuid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ToString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Substring</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AustraliaEast&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;MyResourceGroup</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">New-AzStorageAccount</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;mystgacc</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$uniqueId</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">SkuName Standard_LRS </span><span class="token operator">-</span><span class="token plain">AllowBlobPublicAccess </span><span class="token boolean">$false</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">verbose</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#Remove Azure Storage account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AustraliaEast&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzStorageAccount</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;mystgacc</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$uniqueId</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Force </span><span class="token operator">-</span><span class="token plain">verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzStorageAccount</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;mystgacc</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$uniqueId</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">verbose</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Create an Azure Virtual Network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AustraliaEast&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;network-prod-rg&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$VNetname</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;vnet-prod&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subnetname</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;infraservers&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subnetAddressPrefix</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;10.0.0.0/24&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Create a resource group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroup</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ErrorAction SilentlyContinue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Creating Resource Group </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token string" style="color:rgb(255, 121, 198)"> in </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ForegroundColor Yellow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroup</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Resource Group </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token string" style="color:rgb(255, 121, 198)"> already exists in </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ForegroundColor Green</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Create a virtual network</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$AzVNET</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzVirtualNetwork</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$VNetname</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">AddressPrefix </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;10.0.0.0/16&#x27;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$region</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Create a subnet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subnetConfig</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Add-AzVirtualNetworkSubnetConfig</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subnetname</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">AddressPrefix </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subnetAddressPrefix</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">VirtualNetwork </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$AzVNET</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get full object output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Alias (This is a pipeline to the Format-List cmdlet (fl is an alias for Format-List). It formats the output as a list of properties for each object. This can make it easier to read the details of the virtual network.)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzVirtualNetwork</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$VNetname</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># | fl</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Alias</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Get-Alias</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Select-Object</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">First 2</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#splat</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$configData</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ResourceGroupName = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;MyResourceGroup&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Location = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;West US&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    StorageAccountName = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;stgacctest100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzStorageAccount</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$configData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$configData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">StorageAccountName </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$configData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Location </span><span class="token operator">-</span><span class="token plain">SkuName Standard_LRS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Error</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Failed to create storage account: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#splat as parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$configData</span><span class="token plain"> = @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ResourceGroupName&quot;</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;MyResourceGroup&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Location&quot;</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;West US&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;StorageAccountName&quot;</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;stgacctest100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;SkuName&quot;</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Standard_LRS&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzStorageAccount</span><span class="token plain"> @configData</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Error</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Failed to create storage account: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Tags</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;TagTestRG&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">New-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AustraliaEast&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> Department = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Finance&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> Project = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Q1&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Get Tag Resource Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;TagTestRG&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Tags</span><br></span></code></pre></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;TagTestRG&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$tags</span><span class="token plain"> = </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Tags</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$tags</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Project&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$tags</span><br></span></code></pre></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/power-shell/">PowerShell</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Monitor-Azure-LandingZones-with-AMBA/">Monitor your Azure Landing Zone with Baseline Alerts</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-21T00:00:00.000Z">October 21, 2023</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><blockquote>
<p>When deploying Azure resources, it is crucial to configure alerts to ensure your resources&#x27; health, performance, and security.</p>
</blockquote>
<p>By setting up alerts, you can proactively monitor your resources and take timely actions to address any issues that may arise.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Monitor your Azure Landing Zone with Baseline Alerts" href="/azure/Monitor-Azure-LandingZones-with-AMBA/"><b>Read more</b></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/private-endpoint-traffic-not-appearing-azure-firewall/">Private Endpoint traffic not appearing in Azure Firewall</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-10-03T00:00:00.000Z">October 3, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>You may have a situation where you have implemented <a href="https://learn.microsoft.com/azure/private-link/private-endpoint-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Private endpoints</a> and the traffic from on-premises to those Private Endpoints, either doesn&#x27;t work, even though on-premises firewalls say otherwise, or is working, but doesn&#x27;t appear in the Azure Firewall.</p>
<p>I had this recently with <a href="https://learn.microsoft.com/azure/azure-arc/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Arc</a>, where the endpoints failed to connect once a site-to-site VPN connection <em>(which was working)</em> was replaced with an expressroute connection, but going through the Azure Firewall logs, was unable to see any 443 traffic for Arc, hitting the Firewall even when the connection was working.</p>
<p><img decoding="async" loading="lazy" alt="Private Endpoint traffic not appearing in Azure Firewall" src="/assets/images/BlobHeading_PrivateEndpointtrafficnotappearing-46abd44f0fd04636f0a349e00b724711.gif" width="1200" height="628" class="img_ev3q"></p>
<blockquote>
<p>Traffic flow: Onpremises -- (ER Circuit) -- ER gateway -- Secured hub Azure Firewall -- (Vnet Connection) -- PE (Private Endpoint)</p>
</blockquote>
<p>The issue was related to how private endpoint traffic is routed differently.</p>
<p>If the traffic has reached the Expressroute gateway from on-premises, with routing intent, normal traffic will be forced to the AzFW first before reaching its destination, as you would think and expect.</p>
<blockquote>
<p>However, for the private endpoint scenario, once a Private Endpoint is deployed to any VNET, there will be an automatic system route with the PE IP and prefix /32 installed on all of the linked NICs.
The next hop for this route will be InterfaceEndpoint.
This route will allow the traffic to go directly to the PE, bypassing the routing intent and other user-defined routes that are larger than /32. The /32 route propagates to these areas: Any VPN or ExpressRoute connection to an on-premises system.</p>
</blockquote>
<p>See: <a href="https://learn.microsoft.com/en-us/azure/architecture/guide/networking/private-link-hub-spoke-network?WT.mc_id=AZ-MVP-5004796#considerations" target="_blank" rel="noopener noreferrer" class="">Considerations for Hub and Spoke topology</a>.</p>
<p>In an Azure Virtual Wide Area Network (VWAN), you could see this route in the virtual hub <a href="https://learn.microsoft.com/azure/virtual-wan/effective-routes-virtual-hub?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">effective routes</a> and which gets propagated to the expressroute gateway.</p>
<p>My traffic from on-premises to the Azure Arc went directly to the private endpoints (bypassing the Azure Firewall). Still, the route back via the Azure Firewall was completely different, leading to asymmetric routing <em>(a packet traverses from a source to a destination in one path and takes a different path when it returns to the source)</em>.</p>
<p><strong>To resolve this</strong>, we need to enable network security policies for User-Defined Routes on the subnet of the private endpoint(s):</p>
<p><img decoding="async" loading="lazy" alt="Azure Portal - Private Endpoint - Routes" src="/assets/images/AzurePortal_RouteTables_PrivateEndpoint-036eb8b544141f79ad204b3acd2aeb93.png" width="1816" height="708" class="img_ev3q"></p>
<p>Once enabled, you should see the traffic connect and flow through your Azure Firewall almost immediately.</p>
<p>Reference:</p>
<ul>
<li class=""><a href="https://learn.microsoft.com/azure/private-link/disable-private-endpoint-network-policy?tabs=network-policy-portal&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Manage network policies for private endpoints</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/firewall-manager/private-link-inspection-secure-virtual-hub?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Secure traffic destined to private endpoints in Azure Virtual WAN</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Empowering-Resilience-with-Azure-backup-services/">Empowering Resilience with Azure backup services</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-09-23T00:00:00.000Z">September 23, 2023</time> · <!-- -->27 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>This article is part of <a href="https://azurebacktoschool.github.io/" target="_blank" rel="noopener noreferrer" class="">Azure Back to School</a> - 2023 event! Make sure to check out the fantastic content created by the community!</p>
<p><img decoding="async" loading="lazy" alt="Empowering Resilience with Azure backup services" src="/assets/images/Header-Blog-AzureBackup_Services_Innovations-f2d9510f5e2dd62c9ae8c7b0cb844b2b.gif" width="1200" height="628" class="img_ev3q"></p>
<p>Along with the basics of the Azure Backup solutions, particularly on Virtual Machines running on Microsoft Azure, there have been a lot of changes in the last year, including Immutable vaults, enhanced policies, intelligence tiering, and cross-region restore.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" translate="no">​</a></h2>
<p>Let us start with the basics with a user story; what do we need to achieve:</p>
<blockquote>
<p>&quot;As a Cloud Infrastructure Administrator at Contoso, I want to implement an automated backup solution for virtual machines (Windows and Linux) hosted in Microsoft Azure,
So that I can ensure data reliability, disaster recovery, and compliance with minimal manual intervention.&quot;</p>
</blockquote>
<p>With some assumptions around further requirements, we can jump into solutions using native Microsoft Azure services to fulfil the Cloud Administrator&#x27;s need.
It is worth mentioning, especially around disaster recovery, that there is much more you can (and should do) do around <a href="https://learn.microsoft.com/azure/well-architected/mission-critical/mission-critical-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">mission-critical</a> Azure architecture. This article will focus primarily on the data loss portion of disaster recovery with Azure Backup services.</p>









































































<table><thead><tr><th><strong>Requirement</strong></th><th><strong>Azure Service(s) Used</strong></th></tr></thead><tbody><tr><td>Specific (S): Backup virtual machines in Azure</td><td><a href="https://learn.microsoft.com/azure/backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Backup</a>, <a href="https://learn.microsoft.com/azure/site-recovery/site-recovery-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Site Recovery (ASR)</a></td></tr><tr><td>Measurable (M):</td><td></td></tr><tr><td>- Achieve 99% backup success rate</td><td><a href="https://learn.microsoft.com/azure/backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Backup</a>, <a href="https://learn.microsoft.com/azure/azure-monitor/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Monitor</a></td></tr><tr><td>- Define and meet RTO <em>(recovery time objective)</em> for critical VMs</td><td><a href="https://learn.microsoft.com/azure/backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Backup</a>, <a href="https://learn.microsoft.com/azure/site-recovery/site-recovery-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Site Recovery (ASR)</a></td></tr><tr><td>- Monitor and optimise storage consumption</td><td><a href="https://learn.microsoft.com/azure/azure-monitor/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Monitor</a>, <a href="https://learn.microsoft.com/azure/cost-management-billing/costs/reporting-get-started?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Microsoft Cost Management</a></td></tr><tr><td>Achievable (A):</td><td></td></tr><tr><td>- Select and configure Azure-native backup solution</td><td><a href="https://learn.microsoft.com/azure/backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Backup</a></td></tr><tr><td>- Configure Azure permissions and access controls</td><td><a href="https://learn.microsoft.com/azure/role-based-access-control/rbac-and-directory-admin-roles?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Role-Based Access Control (RBAC)</a></td></tr><tr><td>- Define backup schedules and retention policies</td><td><a href="https://learn.microsoft.com/azure/backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Backup</a>, <a href="https://learn.microsoft.com/azure/governance/policy/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Policy</a></td></tr><tr><td>Relevant (R):</td><td></td></tr><tr><td>- Align with Azure best practices</td><td><a href="https://learn.microsoft.com/en-us/azure/well-architected/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Well-Architected Framework</a>, <a href="https://learn.microsoft.com/azure/advisor/advisor-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Advisor</a></td></tr><tr><td>- Comply with data protection regulations</td><td><a href="https://learn.microsoft.com/azure/compliance/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Compliance Center</a>, <a href="https://learn.microsoft.com/azure/governance/policy/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Policy</a></td></tr><tr><td>- Support disaster recovery and business continuity</td><td><a href="https://learn.microsoft.com/azure/site-recovery/site-recovery-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Site Recovery (ASR)</a></td></tr><tr><td>Time-bound (T):</td><td></td></tr><tr><td>- Implement within the next two Azure sprint cycles</td><td><a href="https://learn.microsoft.com/azure/devops/boards/get-started/what-is-azure-boards?view=azure-devops&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure DevOps - Boards</a></td></tr><tr><td>- Regular progress reviews during sprint planning</td><td><a href="https://learn.microsoft.com/azure/devops/boards/get-started/what-is-azure-boards?view=azure-devops&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure DevOps - Boards</a></td></tr></tbody></table>













































<table><thead><tr><th><strong>Definition of Done (DoD):</strong></th><th></th></tr></thead><tbody><tr><td>1. Select a cost-effective Azure-native backup solution</td><td><a href="https://learn.microsoft.com/azure/backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Backup</a></td></tr><tr><td>2. Configure Azure permissions and access controls</td><td><a href="https://learn.microsoft.com/azure/role-based-access-control/rbac-and-directory-admin-roles?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Role-Based Access Control (RBAC)</a></td></tr><tr><td>3. Define backup policies and RTOs</td><td><a href="https://learn.microsoft.com/azure/backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Backup</a>, <a href="https://learn.microsoft.com/azure/governance/policy/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Policy</a></td></tr><tr><td>4. Monitor and meet 99% backup success rate</td><td><a href="https://learn.microsoft.com/azure/azure-monitor/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Monitor</a></td></tr><tr><td>5. Optimize backup storage utilisation</td><td><a href="https://learn.microsoft.com/azure/cost-management-billing/costs/reporting-get-started?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Microsoft Cost Management</a></td></tr><tr><td>6. Create backup and recovery documentation</td><td><a href="https://learn.microsoft.com/azure/backup/backup-azure-restore-files-from-vm?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Microsoft Learn documentation</a></td></tr><tr><td>7. Train the team to manage and monitor the backup system</td><td><a href="https://learn.microsoft.com/training/modules/intro-to-azure-backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Training</a></td></tr><tr><td>8. Integrate with Azure monitoring and alerting</td><td><a href="https://learn.microsoft.com/azure/azure-monitor/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Monitor</a></td></tr><tr><td>9. Conduct disaster recovery tests</td><td><a href="https://learn.microsoft.com/azure/site-recovery/site-recovery-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Site Recovery (ASR)</a></td></tr></tbody></table>
<p><em>Note: <a href="https://learn.microsoft.com/azure/devops/boards/get-started/what-is-azure-boards?view=azure-devops&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure DevOps - Boards</a> are outside of the scope of this article; the main reflection here is to make sure that your decisions and designs are documented in line with business requirements.</em>
<em>There are also some further assumptions we will make, particularly around security and RTO requirements for the organisation of Contoso.</em></p>
<p>We know to fulfil the requirements, we need to implement the following:</p>
<ul>
<li class=""><a href="https://learn.microsoft.com/azure/backup/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Backup</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/site-recovery/site-recovery-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Site Recovery (ASR)</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/azure-monitor/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Monitor</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/cost-management-billing/costs/reporting-get-started?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Microsoft Cost Management</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/role-based-access-control/rbac-and-directory-admin-roles?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Role-Based Access Control (RBAC)</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/governance/policy/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Policy</a></li>
</ul>
<p>So, let us take our notebooks and look at the Backup sections.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="backup-center">Backup Center<a href="#backup-center" class="hash-link" aria-label="Direct link to Backup Center" title="Direct link to Backup Center" translate="no">​</a></h2>
<p>When needing a single control plane for your Backups across multiple tenancies <em>(using <a href="https://learn.microsoft.com/azure/lighthouse/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Lighthouse</a></em>), Subscriptions and regions, then Backup Center is the place to start with.</p>
<blockquote>
<p>&quot;Backup center provides a single unified management experience in Azure for enterprises to govern, monitor, operate, and analyze backups at scale. It also provides at-scale monitoring and management capabilities for Azure Site Recovery. So, it&#x27;s consistent with Azure&#x27;s native management experiences. Backup center is designed to function well across a large and distributed Azure environment. You can use Backup center to efficiently manage backups spanning multiple workload types, vaults, subscriptions, regions, and Azure Lighthouse tenants.&quot;</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Backup center" src="/assets/images/AzureBackupCenter_Portal_Overview-4d2a2bcbdbca103d57558ce738180967.png" width="1589" height="874" class="img_ev3q"></p>
<p>As you can see, Backup center can be used to see manage:</p>
<ul>
<li class="">Backup instances</li>
<li class="">Backup policies</li>
<li class="">Vaults</li>
<li class="">Monitor and report on backup jobs</li>
<li class="">Compliance <em>(ie Azure Virtual Machines that are not configured for backup)</em></li>
</ul>
<p>You can find the <a href="https://portal.azure.com/#view/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/~/gettingstarted" target="_blank" rel="noopener noreferrer" class="">Backup Center</a> directly in the Azure Portal.</p>
<p><img decoding="async" loading="lazy" alt="Backup center" src="/assets/images/AzurePortal-SearchBackupCenter-1a62aa5a6eb2dbcca94a4e8b9040767e.png" width="738" height="524" class="img_ev3q"></p>
<p>We can create and manage these resources by ourselves, but throughout this article, we will refer back to the Backup Center, to take advantage of the single pane of glass and integrate these resources.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-vault">Create Vault<a href="#create-vault" class="hash-link" aria-label="Direct link to Create Vault" title="Direct link to Create Vault" translate="no">​</a></h3>
<p>In Microsoft Azure, there are two types of Vaults that the Backup center works with. These vaults are:</p>
<ul>
<li class=""><a href="https://learn.microsoft.com/azure/backup/backup-azure-recovery-services-vault-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Recovery Services vault</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/backup/backup-vault-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Backup vault</a></li>
</ul>
<p><img decoding="async" loading="lazy" alt="Backup center" src="/assets/images/AzurePortal_CreateVault_VaultTypes-25f7a11e956f7d8ae2072f6d923862c0.png" width="1142" height="486" class="img_ev3q"></p>
<p>Depending on your requirements depends on which Vault you will need to create <em>(for our purposes, we will need the Recovery Services vault)</em>; Backup Center makes it remarkably easy to configure a new vault and select the right vault type by using the wizard.</p>
<p><em>Please refer to: <a href="https://learn.microsoft.com/en-us/azure/backup/backup-support-matrix?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Support matrix for Azure Backup</a> for further information.</em></p>
<ol>
<li class="">Navigate to <strong><a href="https://portal.azure.com/#view/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/~/gettingstarted" target="_blank" rel="noopener noreferrer" class="">Backup Center</a></strong></li>
<li class="">Click on <strong>Vaults</strong></li>
<li class="">Click <strong>+ Vault</strong></li>
<li class="">Select <strong>Recovery Services vault</strong></li>
<li class="">Select <strong>Continue</strong></li>
<li class="">Specify a <strong>location</strong> and <strong>Resource Group</strong> to house your Recovery Services vault</li>
<li class="">Specify your <strong>vault name</strong> <em><a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-abbreviations?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">(abbreviation examples for Azure resources)</a></em></li>
<li class="">Click <strong>Next: Vault properties</strong></li>
</ol>
<blockquote>
<p>Immutability:
I talked a bit about immutability in another blog article: <a href="https://luke.geek.nz/azure/you-can-t-touch-this-how-to-make-your-azure-backup-immutable-and-secure/" target="_blank" rel="noopener noreferrer" class="">You Can&#x27;t Touch This: How to Make Your Azure Backup Immutable and Secure</a>. Essentially an immutable vault, prevents unauthorised changes and restore point deletions, for this article, we will enable it to prevent unintended or malicious data loss (keep in mind with immutable vaults, reducing retention of recovery points is not allowed).</p>
</blockquote>
<ol>
<li class="">Check <strong>enabled immutability</strong>, and click <strong>Next: Networking</strong>.</li>
<li class="">We can join our Recovery Services vault to our <a href="https://learn.microsoft.com/azure/backup/private-endpoints?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">private network using private endpoints</a>, forcing Azure Backup and Site Recovery to traverse a private network, for the purposes of this article, we will skip it. <strong>Click Next: Tags</strong></li>
<li class=""><strong>Enter in Tags</strong> <em>(tags useful for a Recovery Service vault, could be: Application, Support Team, Environment, Cost Center, Criticality)</em></li>
<li class="">Click <strong>Review + Create</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create Azure Recovery Services Vault" src="/assets/images/Create_RSV_BackupCenter_AzurePortal-d198cfdd2dfbb36d0ce11db49921f333.gif" width="1893" height="907" class="img_ev3q"></p>
<p>If we navigate back to the <a href="https://portal.azure.com/#view/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/~/gettingstarted" target="_blank" rel="noopener noreferrer" class="">Backup Center</a> and then Vaults (under Manage), we will be able to see the newly created vault.</p>
<p>We now have our Backup solution provisioned for the Cloud Administrator to use, but we next need to define the policies for the backup.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-backup-policies">Create Backup Policies<a href="#create-backup-policies" class="hash-link" aria-label="Direct link to Create Backup Policies" title="Direct link to Create Backup Policies" translate="no">​</a></h3>
<p>Now that we have our Recovery Services vault, we need to create backup policies; these backup policies will help define the frequency of backups, the retention (Daily, weekly, monthly, yearly) and <a href="https://learn.microsoft.com/azure/backup/use-archive-tier-support?pivots=client-portaltier&amp;WT.mc_id=AZ-MVP-5004796#enable-smart-tiering-to-vault-archive-using-a-backup-policy-preview" target="_blank" rel="noopener noreferrer" class="">vault tiering</a>, which enables the Recovery Services Vault to move recovery vaults to an <a href="https://learn.microsoft.com/en-us/azure/backup/archive-tier-support?WT.mc_id=AZ-MVP-5004796#archive-recommendations-only-for-azure-virtual-machines" target="_blank" rel="noopener noreferrer" class="">archive tier</a> <em>(slower to restore, but can be cheaper overall, for those long retention policies)</em>.</p>
<blockquote>
<p>Backup policies are very organisation-specific and can depend a lot on operational and industry requirements; some industries have a legal obligation to store their backups for a certain number of years, the <a href="https://learn.microsoft.com/en-us/azure/compliance/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure compliance center documentation</a> may help, around security and data requirements, make sure your backup policies are understood by the business you are working with.</p>
</blockquote>
<p>For Contoso, we have the following requirements:</p>













































<table><thead><tr><th>Resource</th><th>Daily</th><th>Weekly</th><th>Monthly</th><th>Yearly</th><th>Snapshot Retention (Hot)</th></tr></thead><tbody><tr><td><strong>Critical Application DB - Prod</strong></td><td>7 days - Every 4 Hours</td><td>4 weeks</td><td>6 months</td><td>7 years</td><td>5 days</td></tr><tr><td><strong>File Server- Prod</strong></td><td>7 days   - Every 4 Hours</td><td>6 weeks</td><td>6 months</td><td>7 years</td><td>5 days</td></tr><tr><td><strong>Web Application VM - Dev</strong></td><td>20 days</td><td>8 weeks</td><td>12 months</td><td>2 years</td><td>2 days</td></tr><tr><td><strong>Database Server - Dev</strong></td><td>30 days</td><td>8 weeks</td><td>12 months</td><td>2 years</td><td>2 days</td></tr></tbody></table>
<p>There are a few things to call out here:</p>
<ul>
<li class="">We can see that for Development, items need to be retained for 2 years</li>
<li class="">For Production, its 7 years</li>
<li class="">Snapshots need to be stored for 5 days and 2 days to allow fast restore</li>
<li class="">Production requires a backup to be taken every 4 hours to reduce RTO <em>(Recovery point objective)</em></li>
</ul>
<p><img decoding="async" loading="lazy" alt="Create Azure Recovery Services Vault" src="/assets/images/rpo-rto-infographic-eaf32ded76ae2a92856df60086ef4c3d.jpg" width="800" height="312" class="img_ev3q"></p>
<p>If we take a look at the Snapshot retention, we can leverage <a href="https://learn.microsoft.com/en-us/azure/backup/backup-instant-restore-capability?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Instant restore</a> snapshots, to restore the workloads, quickly from the previous 5 days, reducing our time RTO (recovery time objective), and overall impact of an outage or restore, by storing the snapshots locally (as close to the original disk) without putting it (waiting for it) into archive (slower disk), this will incurr more cost, but dramatically reduces restores time. I recommend always keeping a few Instant restore snapshots available for all production systems.</p>
<p><img decoding="async" loading="lazy" alt="Snapshot" src="/assets/images/instant-rp-flow-6fd5403e878ce8ea549e7aeaadecb9a8.png" width="1503" height="390" class="img_ev3q"></p>
<p>Let us create the policies <em>(we will only create one policy, but the same process can be used to create the others)</em>.</p>
<ol>
<li class="">Navigate to <strong><a href="https://portal.azure.com/#view/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/~/gettingstarted" target="_blank" rel="noopener noreferrer" class="">Backup Center</a></strong></li>
<li class="">Click on <strong>Backup policies</strong></li>
<li class="">Click <strong>+ Add</strong>
1 .Select <strong>Azure Virtual Machines</strong></li>
<li class=""><strong>Select</strong> the <strong>Vault</strong> created earlier</li>
<li class="">Click <strong>Continue</strong></li>
<li class="">As this will be the policy for the Critical Application DB, we will specify: <strong>Enhanced</strong> <em>(due to the multiple backups, <a href="https://learn.microsoft.com/en-us/azure/storage/common/storage-redundancy?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Zone-redundant storage (ZRS)</a> snapshots)</em></li>
<li class="">Specify a <strong>Policy name</strong>, ie Tier-1-Prod-AppDB</li>
<li class="">Specify <strong>Frequency</strong> to: Hourly, Schedule to Every 4 Hours, and Duration: 24 Hours</li>
<li class="">Specify <strong>Retain instance recovery snapshots</strong> for &#x27;5&#x27; days</li>
<li class="">Update <strong>Daily Backup point</strong> to: 7 days</li>
<li class=""><strong>Configure the Weekly backup point</strong> to occur every Sunday and retain for 4 weeks</li>
<li class=""><strong>Configure the Monthly backup point</strong> to occur on the first Sunday of the month and retain for 6 months</li>
<li class=""><strong>Configure the yearly backup point</strong> to occur on the first Sunday of the year and retain for 7 years</li>
<li class="">Select <strong>enable Tiering</strong>, and specify Recommended recovery points</li>
<li class="">You can also update the Resource Group name used to store the Snapshots.</li>
<li class="">Click <strong>Create</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Snapshot" src="/assets/images/Create_RSV_AzurePolicyEnhanced-cf9bf2264746adf2a84ee130fce7eb2e.gif" width="1893" height="907" class="img_ev3q"></p>
<p>Note: If you want, you can repeat the same process to create any others you need. Remember, with immutable vaults, you cannot reduce the retention (but you can add), so if starting for the first time, keep the retention low until you have a clear direction of what is required. A workload can use the same policy. A Standard <em>(not Enhanced)</em> policy may be all you need for Development workloads.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-virtual-machines">Add Virtual Machines<a href="#add-virtual-machines" class="hash-link" aria-label="Direct link to Add Virtual Machines" title="Direct link to Add Virtual Machines" translate="no">​</a></h3>
<p>Now that we have our Recovery Services Vault and custom backup policies, it&#x27;s time to add our Virtual Machines to the backup! To do this, we can use the Backup center to view Virtual Machines that are not getting backed up, and then configure the backup.</p>
<ol>
<li class="">Navigate to <strong><a href="https://portal.azure.com/#view/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/~/gettingstarted" target="_blank" rel="noopener noreferrer" class="">Backup Center</a></strong></li>
<li class="">Click on <strong>Protectable data sources</strong></li>
<li class="">Click on the <strong>ellipsis</strong> of a  Virtual Machine you want to backup</li>
<li class="">Click on <strong>Backup</strong></li>
<li class=""><strong>Select</strong> the appropriate <strong>Backup vault</strong> and <strong>policy</strong></li>
<li class="">Click <strong>Enable backup</strong></li>
</ol>
<blockquote>
<p>Although cross-region restore is now supported on a Recovery Services vault, the second region is read-only (RA-GRS), so make sure you have a backup recovery vault created in the region (and subscription) of the virtual machines you are trying to protect. Backup center, can see all Recovery services vaults across multiple regions and subscriptions that you have access to.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Add Virtual Machines" src="/assets/images/BackupItem_BackupCenter_RSV_AzurePolicyEnhanced-596ff07a42ef094acce54b682d8f2b7f.gif" width="1893" height="907" class="img_ev3q"></p>
<p>Once added, the Virtual Machine will now get backed up according to the specified policy.</p>
<blockquote>
<p>Its worth noting that you can backup a Virtual Machine if it is deallocated, but it will Crash-consistent <em>(Only the data that already exists on the disk at the time of backup is captured and backed up, and it triggers a disk check during recovery)</em> compared to Application consistent, which is more application and OS aware, so can prepare to the OS and applications for the backups to make sure that everything is written successfully to the disk ahead of the backup. You can read more about <a href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-vms-introduction?WT.mc_id=AZ-MVP-5004796#snapshot-consistency" target="_blank" rel="noopener noreferrer" class="">Snapshot consistency</a>.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitor-backups">Monitor Backups<a href="#monitor-backups" class="hash-link" aria-label="Direct link to Monitor Backups" title="Direct link to Monitor Backups" translate="no">​</a></h2>
<p>Now that we have our Recovery Services Vault, policies and protected items <em>(backed up Virtual Machines)</em>, we need to monitor to make sure that the backups are working. Backup center gives us a complete view of Failed, In Progress, and Completed jobs in the overview pane, which is excellent for a quick view of the status across subscriptions and regions.</p>
<p><img decoding="async" loading="lazy" alt="Azure BackupCenter" src="/assets/images/Azure_BackupCenter_Overview-d1d90cb6e818858550ab15ac1055d547.png" width="1236" height="815" class="img_ev3q"></p>
<p>But you may want something a bit more detailed; let us look into some of the options for monitoring your backups.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="alerts">Alerts<a href="#alerts" class="hash-link" aria-label="Direct link to Alerts" title="Direct link to Alerts" translate="no">​</a></h3>
<p>As part of operational checks, you may want assurance or a ticket raised if there&#x27;s an issue with a backup; one of the ways to achieve this is to set up an email alert that will send an email if a backup fails.</p>
<p>By default, these types of alerts are enabled out-of-the-box on a recovery services vault; examples of alerts can be found here: <a href="https://learn.microsoft.com/azure/backup/backup-azure-monitoring-built-in-monitor?tabs=recovery-services-vaults&amp;WT.mc_id=AZ-MVP-5004796#azure-monitor-alerts-for-azure-backup" target="_blank" rel="noopener noreferrer" class="">Azure Monitor alerts for Azure Backup</a>, these can be displayed in the Recovery Services Vault or Backup Center blade, immediately.</p>
<blockquote>
<p>If a destructive operation, such as stop protection with deleted data is performed, an alert is raised, and an email is sent to subscription owners, admins, and co-admins even if notifications aren&#x27;t configured for the Recovery Services vault.</p>
</blockquote>





























<table><thead><tr><th>Type</th><th>Description</th><th>Example alert scenarios</th><th>Benefits</th></tr></thead><tbody><tr><td>Built-in Azure Monitor alerts (AMP alerts)</td><td>These are alerts that will be available out-of-the-box for customers without needing additional configuration by the customer.</td><td>Security scenarios like deleting backup data, soft-delete disabled, vault deleted, etc.</td><td>Useful for critical scenarios where the customer needs to receive alerts without the possibility of alerts being subverted by a malicious admin. Alerts for destructive operations fall under this category</td></tr><tr><td>Metric alerts</td><td>Here, Azure Backup will surface backup health-related metrics for customers&#x27; Recovery Services vaults and Backup vaults. Customers can write alert rules on these metrics.</td><td>Backup health-related scenarios such as backup success alerts, restore success, schedule missed, RPO missed, etc.</td><td>Useful for scenarios where customers would like some control over the creation of alert rules but without the overhead of setting up LA or any other custom data store.</td></tr><tr><td>Custom Log Alerts</td><td>Customers configure their vaults to send data to the Log Analytics workspace and write alert rules on logs.</td><td>&#x27;N&#x27; consecutive failed backup jobs, Spike in storage consumed, etc.</td><td>Useful for scenarios where there is a relatively complex, customer-specific logic needed to generate an alert.</td></tr></tbody></table>
<p>Backup alerts are supported by Azure Monitor, so under <a href="https://learn.microsoft.com/azure/azure-monitor/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Monitor</a>, and Alerts pane you can see all your other alerts, including Azure Backup alerts from a single pane.</p>
<p><img decoding="async" loading="lazy" alt="Azure BackupCenter" src="/assets/images/AzureMonitor_BackupAlert_AzurePortal-d6f1419a3fbbae2c89f25dc019b71c5e.png" width="1920" height="1009" class="img_ev3q"></p>
<p>If you want to configure notifications via emails for other types of alerts, such as Backup failures, we can use <a href="https://learn.microsoft.com/azure/azure-monitor/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Monitor</a> Action Groups and Alert processing rules, to let us know, without having to login to the Azure Portal directly, so let us create an email alert.</p>
<p>To do this, we will create an Action Group and Alert Processing rule.</p>

















<table><thead><tr><th>Component</th><th>Description</th></tr></thead><tbody><tr><td>Action Group</td><td>An Action Group is a collection of actions or tasks that are executed automatically when an alert that matches specific criteria is triggered. Actions can include sending notifications, running scripts, triggering automation, or escalating the alert. Action Groups help streamline incident response and automate actions based on the nature and severity of an alert.</td></tr><tr><td>Alert Processing Rule</td><td>An Alert Processing Rule is a set of conditions and criteria used to filter, categorize, or route incoming alerts within a monitoring or alerting system. These rules enable organizations to define how alerts are processed, prioritize them, and determine the appropriate actions to take when specific conditions are met. Alert Processing Rules are crucial for managing and efficiently responding to alerts.</td></tr></tbody></table>
<ol>
<li class="">Navigate to <strong><a href="https://portal.azure.com/#view/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/~/gettingstarted" target="_blank" rel="noopener noreferrer" class="">Backup Center</a></strong></li>
<li class="">Click on <strong>Alerts</strong></li>
<li class="">Click on <strong>Alert Processing rule</strong></li>
<li class="">Click <strong>+ Select Scope</strong></li>
<li class="">Click <strong>All Resource Types</strong>, and Filter by: <strong>Recovery Services Vault</strong></li>
<li class=""><strong>Select</strong> your <strong>Recovery Services vault</strong>, you would like to alert on</li>
<li class="">Click <strong>Apply</strong></li>
<li class="">Click on <strong>Filter, and change: Alert condition = Fired</strong>.</li>
<li class="">Click Next: <strong>Rule Settings</strong></li>
<li class="">Click <strong>Apply action group</strong></li>
<li class="">Click <strong>+ Create action group</strong></li>
<li class=""><strong>Select</strong> the Subscription, <strong>Resource Group</strong> to store your action group (i.e. monitor resource group)</li>
<li class="">Give the <strong>Action Group</strong> a <strong>name</strong>, and give it a Display name</li>
<li class="">Specify <strong>Notification</strong> type <em>(ie Email/SMS message/push/voice)</em></li>
<li class="">For this article, we will add an Email <em>(but you can have it ring a number, push a notification to the <a href="https://azure.microsoft.com/en-us/get-started/azure-portal/mobile-app?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Mobile App</a>)</em></li>
<li class="">Enter in <strong>your details</strong>, then click <strong>Next: Actions</strong></li>
<li class="">In the Actions pane, is where you can trigger automation, such as Azure Logic Apps, Runbooks, ITSM connections, Webhooks etc., to help self-remediate the issues, or better notifications, such as a Logic App that posts in a Teams channel when an alert is fired, or a wehbook that triggers a webpage to update. In this example, we will leave it empty and rely on email notifications and click Next: Tags</li>
<li class="">Enter any Tags and click <strong>Review + create</strong></li>
<li class="">Make note of Suppress Notifications; this could be handy during scheduled maintenance windows where backups may fail due to approved work.</li>
<li class="">Once the Action Group has been created, click <strong>Next: Scheduling</strong></li>
<li class="">Select <strong>Always</strong></li>
<li class="">Click <strong>Next: Details</strong></li>
<li class="">Enter in a <strong>Resource Group</strong>, for the Alert processing rule to be placed</li>
<li class="">Enter in <strong>Rule name</strong>, <strong>description</strong> and click <strong>Review + Create</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure BackupCenter" src="/assets/images/BackupItem_BackupCenter_RSV_BackupAlertRuleCreation-cad908e18b35d4b3a12f5c9313330fa5.gif" width="1893" height="907" class="img_ev3q"></p>
<p>As you can see Azure Monitor integration into backups, gives you some great options to keep on top of your backups, and integrate with other systems, like your IT Service Management toolsets.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="azure-site-recovery">Azure Site Recovery<a href="#azure-site-recovery" class="hash-link" aria-label="Direct link to Azure Site Recovery" title="Direct link to Azure Site Recovery" translate="no">​</a></h2>
<p><a href="https://learn.microsoft.com/azure/site-recovery/site-recovery-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Site Recovery (ASR)</a> can be used to migrate workloads, across <a href="https://learn.microsoft.com/azure/reliability/availability-zones-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Availability Zones and regions</a>, by replicating the disks of a Virtual Machine to another region (GRS) or zone (ZRS), in fact <a href="https://learn.microsoft.com/azure/resource-mover/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Resource Mover</a> uses Azure Site Recovery when moving virtual machines between regions. Azure Site Recovery can also help with migrating workloads outside of Azure, to Azure, for disaster recovery.</p>
<p>When looking at migrating workloads, to Azure from the VMWare stack, consider the <a href="https://learn.microsoft.com/azure/site-recovery/site-recovery-deployment-planner?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Site Recovery Deployment Planner for VMware</a> to Azure to assist.</p>
<p>For the purposes of this guide, we will achieve disaster recovery of our virtual machine, by replicating it to another region <em>(i.e. from Australia East to Central India)</em>.</p>
<blockquote>
<p>Azure Recovery Services contributes to your BCDR strategy:
Site Recovery service: Site Recovery helps ensure business continuity by keeping business apps and workloads running during outages. Site Recovery replicates workloads running on physical and virtual machines (VMs) from a primary site to a secondary location. When an outage occurs at your primary site, you fail over to a secondary location, and access apps from there. After the primary location is running again, you can fail back to it.
Backup service: The Azure Backup service keeps your data safe and recoverable.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Azure BackupCenter" src="/assets/images/CausesITDisasters-88a4da45105538385af17f8e3982ecb9.png" width="1098" height="684" class="img_ev3q"></p>
<blockquote>
<p>Just as important (if not more) than the technology to enable this, clear business requirements and preparation is paramount for a successful disaster recovery solution, I highly recommend the <a href="https://techcommunity.microsoft.com/t5/fasttrack-for-azure/introducing-the-azure-business-continuity-guide/ba-p/3905424?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Business Continuity Guide</a>. Supplied by the Microsoft Fastrack team, this guide includes resources to prepare for thorough disaster recovery plan.</p>
</blockquote>
<p>The key to successful disaster recovery is not only the workloads themselves but supporting services, such as DNS, Firewall rules, connectivity etc., that need to be considered, These are out of the scope of this article but the following Microsoft Azure architecture references are worth a read:</p>
<ul>
<li class=""><a href="https://learn.microsoft.com/azure/architecture/solution-ideas/articles/disaster-recovery-enterprise-scale-dr?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Enterprise-scale disaster recovery</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/architecture/solution-ideas/articles/disaster-recovery-smb-azure-site-recovery?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">SMB disaster recovery with Azure Site Recovery</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/site-recovery/azure-to-azure-architecture?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure to Azure disaster recovery architecture</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/architecture/reference-architectures/n-tier/multi-region-sql-server?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Multi-region N-tier application</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/architecture/solution-ideas/articles/build-high-availability-into-your-bcdr-strategy?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Build high availability into your BCDR strategy</a></li>
<li class=""><a href="https://learn.microsoft.com/azure/site-recovery/site-recovery-retain-ip-azure-vm-failover?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Retain IP addresses during failover</a></li>
<li class=""><a href="https://techcommunity.microsoft.com/t5/azure-architecture-blog/empowering-disaster-recovery-for-azure-vms-with-azure-site/ba-p/3885378?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Empowering Disaster Recovery for Azure VMs with Azure Site Recovery and Terraform</a></li>
</ul>
<p>For Azure Site Recovery to work, it relies on a mobility service running within the Virtual Machine to replicate changes, the source virtual machine needs to be on to replicate the changes.</p>
<blockquote>
<p>When you enable replication for a VM to set up disaster recovery, the Site Recovery Mobility service extension installs on the VM and registers it with Azure Site Recovery. During replication, VM disk writes are sent to a cache storage account in the source region. Data is sent from there to the target region, and recovery points are generated from the data.</p>
</blockquote>
<p>Azure Site Recovery, does not currently support virtual machines protected with <a href="https://learn.microsoft.com/azure/virtual-machines/trusted-launch?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Trusted Launch</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enable-azure-site-recovery">Enable Azure Site Recovery<a href="#enable-azure-site-recovery" class="hash-link" aria-label="Direct link to Enable Azure Site Recovery" title="Direct link to Enable Azure Site Recovery" translate="no">​</a></h3>
<p>For now, we have &#x27;VM1&#x27; a Ubuntu workload, running in Australia East, with a Public IP, that we will failover to Central India. The source Virtual Machine can be backed up normally by a vault in the source region, and replicated to another vault in the destination region.</p>
<blockquote>
<p>Azure Site Recovery has a specific Operating System and Linux kernel <a href="https://learn.microsoft.com/azure/site-recovery/azure-to-azure-support-matrix?WT.mc_id=AZ-MVP-5004796#replicated-machine-operating-systems" target="_blank" rel="noopener noreferrer" class="">support</a>. Make sure you confirm that your workloads are supported.</p>
</blockquote>
<ol>
<li class="">Navigate to <strong><a href="https://portal.azure.com/#view/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/~/gettingstarted" target="_blank" rel="noopener noreferrer" class="">Backup Center</a></strong></li>
<li class="">Click on <strong>Vaults</strong></li>
<li class=""><strong>Create</strong> a new Recovery Services <strong>vault</strong> in your <strong>DR</strong> <em>(Disaster Recovery <strong>region</strong> - ie Central India)</em></li>
<li class="">Click on <strong>Site Recovery</strong></li>
<li class="">Under Azure Virtual Machines, click on: <strong>Enable replication</strong></li>
<li class="">Specify the <strong>source Virtual Machine</strong>, you wish to migrate</li>
<li class="">Click <strong>Next</strong></li>
<li class="">Select your <strong>source Virtual Machine</strong></li>
<li class="">Click <strong>Next</strong></li>
<li class="">Select the <strong>target location (i.e. Central India)</strong></li>
<li class="">Select the <strong>target Resource Group</strong></li>
<li class="">Select the <strong>Target Virtual Network</strong> <em>(create one if it doesn&#x27;t exist)</em></li>
<li class="">Select the <strong>target subnet</strong></li>
<li class="">Under the Storage, you can consider changing the replica disk to Standard, to reduce cost (this can be <a href="https://learn.microsoft.com/azure/virtual-machines/disks-convert-types?tabs=azure-portal&amp;WT.mc_id=AZ-MVP-5004796#change-the-type-of-an-individual-managed-disk" target="_blank" rel="noopener noreferrer" class="">changed</a> later).</li>
<li class="">Select a cache storage account <em>(The cache storage account is a storage account used for transferring the replication data before its written to the destination disk)</em></li>
<li class="">You can then adjust the availability zone of the destination virtual machine</li>
<li class="">Click <strong>Next</strong></li>
<li class="">Here we can <strong>define a Replication Policy</strong> <em>(a replication policy in Azure Site Recovery is a set of rules and configurations that determine how data is replicated from the source environment to the target environment (Azure) in case of a disaster or planned failover, such as retention, ie you can restore a point within the retention period)</em> we will leave the default 24-hour retention policy.</li>
<li class="">We can specify a Replication Group, An example of a replication group is application servers that need to be consistent with each other, in terms of data <em>( replication policy in Azure Site Recovery is a set of rules and configurations that determine how data is replicated from the source environment to the target environment (Azure) in case of a disaster or planned failover.)</em>.</li>
<li class="">Specify an automation account to manage the mobility service, and we will leave the update extension to be ASR (Azure Site Recovery) managed.</li>
<li class="">Click <strong>Next</strong></li>
<li class="">Click <strong>Enable replication</strong></li>
<li class="">At the Recovery Services Vault, under Site Recovery Jobs you can monitor the registration, registration and initial replication can take 30-60 minutes to install the agent and start the replication.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure BackupCenter" src="/assets/images/BackupCenter_RSV_EnableAzureSiteRecovery-4fa0daaa292bf6f9113604942480f26a.gif" width="1893" height="907" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="failover-to-the-secondary-region-using-azure-site-recovery">Failover to the secondary region using Azure Site Recovery<a href="#failover-to-the-secondary-region-using-azure-site-recovery" class="hash-link" aria-label="Direct link to Failover to the secondary region using Azure Site Recovery" title="Direct link to Failover to the secondary region using Azure Site Recovery" translate="no">​</a></h3>
<p>Once your virtual machine has been replicated in the secondary region. you can do a Failover, or Test failover. A Test failover is recommended, in your DR testing, and application testing.</p>
<p><img decoding="async" loading="lazy" alt="Azure BackupCenter" src="/assets/images/ASR_AUE_to_CentralIndia-90bc7c5b21d98f57d02164881d88ae43.png" width="1248" height="616" class="img_ev3q"></p>























































<table><thead><tr><th>Aspect</th><th>Failover</th><th>Test Failover</th></tr></thead><tbody><tr><td>Purpose</td><td>To switch to a secondary site during a disaster or planned maintenance event.</td><td>To validate your disaster recovery plan without impacting production.</td></tr><tr><td>Impact on Production</td><td>Disrupts production services as the primary site becomes unavailable during the failover process.</td><td>No impact on production services; the primary site remains operational.</td></tr><tr><td>Data Replication</td><td>Replicates data from primary to secondary site, making it the active site during the failover.</td><td>Uses the same replicated data but doesn&#x27;t make the secondary site the active site; it&#x27;s for testing purposes only.</td></tr><tr><td>Recovery Time</td><td>Longer recovery time, as it involves setting up and activating the secondary site.</td><td>Faster recovery time, as it doesn&#x27;t require making the secondary site the active site.</td></tr><tr><td>Data Consistency</td><td>Ensures data consistency and integrity during the failover process.</td><td>Ensures data consistency for testing but doesn&#x27;t make the secondary site the primary site.</td></tr><tr><td>Cost</td><td>May incur additional costs due to the resources activated at the secondary site.</td><td>Typically incurs minimal additional costs as it&#x27;s for testing purposes.</td></tr><tr><td>Use Cases</td><td>Actual disaster recovery scenarios or planned maintenance events.</td><td>Testing and validating disaster recovery procedures, training, and compliance.</td></tr><tr><td>Post-Operation</td><td>The secondary site becomes the new primary site until failback is initiated.</td><td>No change to the primary site; the secondary site remains inactive.</td></tr><tr><td>Rollback Option</td><td>Failback operation is required to return to the primary site once it&#x27;s available.</td><td>No need for a rollback; the primary site remains unaffected.</td></tr></tbody></table>
<ol>
<li class="">Navigate to your destination Recovery Services Vault</li>
<li class="">Click on REplicated Items</li>
<li class="">Select the Virtual Machine you wish to recover in your second region</li>
<li class="">Select Test Failover (or Failover, depending on your requirements)</li>
<li class="">Select your Recovery point and destination Virtual network</li>
<li class="">Select Failover</li>
<li class="">If it is a test failover, you can then Clean up your Test failover <em>(deleted replicated item)</em> after you have tested</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure BackupCenter" src="/assets/images/BackupCenter_RSV_TestFailoverAzureSiteRecovery-de77d87bfe5d8f04707caba95ad6c4b2.gif" width="1893" height="907" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="azure-policies">Azure Policies<a href="#azure-policies" class="hash-link" aria-label="Direct link to Azure Policies" title="Direct link to Azure Policies" translate="no">​</a></h2>
<p>Automatically, mapping of Virtual Machines, to backup policies can be done using <a href="https://learn.microsoft.com/azure/governance/policy/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Policy</a>.</p>
<p>Azure policies such as:</p>
<ul>
<li class="">Azure Backup should be enabled for Virtual Machines</li>
<li class="">Configure backup on virtual machines without a given tag to an existing recovery services vault in the same location</li>
<li class="">Disable Cross Subscription Restore for Backup Vaults</li>
<li class="">Soft delete should be enabled for Backup Vaults</li>
</ul>
<p>More, are built-in to the Azure policy engine and can be easily assigned, across subscriptions and management groups, found in the Backup Center.</p>
<ol>
<li class="">Navigate to <strong><a href="https://portal.azure.com/#view/Microsoft_Azure_DataProtection/BackupCenterMenuBlade/~/gettingstarted" target="_blank" rel="noopener noreferrer" class="">Backup Center</a></strong></li>
<li class="">Click on <strong>Azure policies for backup</strong></li>
<li class="">Click on a policy and click <strong>Assign</strong></li>
</ol>
<blockquote>
<p>You can find a list of custom and built-in policies at the <a href="https://www.azadvertizer.net/azpolicyadvertizer_all.html" target="_blank" rel="noopener noreferrer" class="">AzPolicyAdvertizerPro</a> website.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Azure AutoManage" src="/assets/images/azure-automanage-intelligently-onboard-services-5a54eeaf53941404cadf42cb7046b4e1.png" width="802" height="562" class="img_ev3q"></p>
<p><a href="https://learn.microsoft.com/azure/automanage/overview-about?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" class="">Azure Automanage</a> can be used alongside Azure policy, to onboard Virtual Machines, into backup, patching etc automatically, with reduced manual intervention, and although not directly part of this article, what you have learned can be used to develop your automanage profiles.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tags/azure/page/17/"><div class="pagination-nav__label">Newer entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tags/azure/page/19/"><div class="pagination-nav__label">Older entries</div></a></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
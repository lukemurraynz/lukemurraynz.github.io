<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">141 posts tagged with &quot;Azure&quot; | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/tags/azure/page/23/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="141 posts tagged with &quot;Azure&quot; | luke.geek.nz"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/tags/azure/page/23/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/23/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/23/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.28b9be22.css">
<script src="/assets/js/runtime~main.35774400.js" defer="defer"></script>
<script src="/assets/js/main.153868fd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/containerapps-env-missing-subnet/">Azure Container Apps Environment deployment - Missing Subnet</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/application-gateway-apim-sinkhole-terraform/">Azure App Gateway Sinkhole for API Management with Terraform</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/proactive-resiliency-assessment/">Running your own Azure Proactive Resiliency Assessment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/iac-github-codespace/">Infrastructure as Code GitHub Codespace Template</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/cloud-design-patterns/">Cloud Design Patterns</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>141 posts tagged with &quot;Azure&quot;</h1><a href="/tags/">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/10/28/benefits-to-using-the-microsoft-azure-cloud-to-host-your-infrastructure/">Benefits to using the Microsoft Azure Cloud to host your Infrastructure</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-10-27T11:00:00.000Z">October 27, 2021</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Cloud computing offers many benefits, from your traditional on-premises infrastructure, ecosystems such as Microsoft Azure, have an underlying fabric built for today&#x27;s &#x27;software as a service&#x27; or &#x27;software defined&#x27; world.</p>
<p>The shift of technologies from managing on-premises Exchange environments for mail to consuming Microsoft 365 services has allowed more time for the IT and businesses to adopt, consume and improve their technology and continuously improve - to get the most use of it and remain competitive in this challenging world.</p>
<p>Below is a high-level list of what I consider some of the benefits of using the Microsoft Azure ecosystem:</p>
<ul>
<li>Each Azure datacentre &#x27;region&#x27; has 3 Availability Zones, each zone acts as a separate datacentre, giving redundant power and networking services, quickly allowing you to separate your services across different fault domains and zones, providing better resiliency, while also giving you the ability to keep them logically and physically close together.</li>
<li>Geo-redundant replication of backups for Virtual Machines, PaaS/File Shares, and ability to do cross-region restore functionality (i.e., Australia/Australia East).</li>
<li>A multitude of hosts (supporting both AMD and Intel workloads), which are continually patched and maintained, and tuned for virtualisation performance, stability and security, no longer do we need to spend hours patching, maintaining, licensing on-premises hypervisors, ever so increasing as these systems get targeted for vulnerabilities and architecting how many physical hosts, we may need to support a system.</li>
<li>Consistent, up-to-date hardware, no need to worry about lead times for new hardware, purchasing new hardware every three years and procurement and implementation costs of hardware, allowing you to spend the time improving on the business and tuning your services <em>(scaling up and down, trying new technologies, turning off devices etc.)</em></li>
<li>For those that like to hoard every file that ever existed, the Azure platform allows scale <em>(in and out to suit your file sizes)</em> along with cost-saving opportunities and tweaks with Automation and migrating files between cool/hot tiers.</li>
<li>No need to pay datacentre hosting costs</li>
<li>No need to worry about redundant switching</li>
<li>With multiple hosts, there is no risk around air conditioning leaks, hardware failure; you don&#x27;t need to worry about some of these unfortunate events occurring.</li>
<li>No need to pay electricity costs to host your workloads.</li>
<li>Reduced IT labour costs and time to implement and maintain systems</li>
<li>OnDemand resources available can stand up separate networks unattached to your production network for testing or other devices easily without working out through VLANs or complex switching and firewalls.</li>
<li>Azure Network have standard DDOS protection enabled by default</li>
<li>Backups are secure by default; they are offline and managed by Microsoft, so if a ransomware attack occurs, won&#x27;t be able to touch your backups.</li>
<li>Constant Security recommendations, improvements built into the platform.</li>
<li>Azure Files is geo-redundant and across multiple storage arrays, encrypted at rest.</li>
<li>Windows/SQL licensing is all covered as part of the costings, so need to worry about not adhering to MS licensing, Azure helps simplify what can sometimes be confusing and complex licensing.</li>
<li>Extended security updates for out-of-date Server OS such as Windows Server 2008 R2, Windows Server 2021 R2 without having to pay for extended update support.</li>
<li>Ability to leverage modern and remote desktop and application technologies such as Windows 365 and Azure Virtual Desktop, by accessing services hosted in Azure.</li>
<li>Having your workloads in Azure gives you a step towards, removing the need for traditional domain controllers and migrating to Microsoft Entra ID joined devices.</li>
<li>Azure AutoManage functionality is built in to automatically patch Linux (and Windows of course!), without having to manage separate patching technologies for cross-platform infrastructure.</li>
<li>Azure has huge support for Automation, via PowerShell, CLI and API, allowing you to standardize, maintain, tear down and create infrastructure and services, monitoring, self-users on an as needed basis.</li>
<li>Azure datacentres are sustainable and run off renewable energy where they can, Microsoft has commitments to be fully renewable.</li>
<li>No need for NAS or Local Backups, the backups are all built into Azure.</li>
<li>Compliant datacentre across various global security standards - <a href="https://learn.microsoft.com/en-us/compliance/assurance/assurance-datacenter-security?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="https://learn.microsoft.com/en-us/compliance/assurance/assurance-datacenter-security?WT.mc_id=AZ-MVP-5004796">https://learn.microsoft.com/en-us/compliance/assurance/assurance-datacenter-security</a></li>
<li>Ability to migrate or expand your resources from Australia to ‘NZ North’ or other new or existing data centres! Azure is global and gives you the ability to scale your infrastructure to a global market easily or bring your resources closer to home if a data centre becomes available.</li>
<li>We all know that despite the best of intentions, we rarely ever test, develop, and improve disaster recovery scenarios, sometimes this is because of the complexity of the applications and backup infrastructure. Azure Site Recovery, Geo-Redundant backup, Load Balancers and automation helps make this a lot easier.</li>
<li>Ability to better utilise Cloud security tools <em>(ie such as the Azure Security Center)</em>, across Cloud and on-premises workloads consistently using Azure Arc and Azure policies.</li>
<li>And finally - more visibility into the true cost and value of your IT infrastructure, the total cost of your IT Infrastructure is hidden behind electricity costs, outages and incidents that would not have impacted cloud resources, slow time to deployment or market, outdated and insecure technologies and most likely services you are running which you don&#x27;t need to run!</li>
</ul>
<p>#ProTip - Resources such as the <a href="https://azure.microsoft.com/en-us/pricing/tco/calculator/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Total Cost of Ownership (TCO) Calculator">Azure Total Cost of Ownership (TCO)</a> can help you calculate the true cost of your workloads.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/07/18/implement-webjea-for-self-service-azure-resource-creation-with-powershell/">Implement WebJEA for self-service Start/Stop of Azure Virtual Machines</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-07-18T00:00:00.000Z">July 18, 2021</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>WebJEA allows you to build web forms for any PowerShell script dynamically. WebJEA automatically <strong>parses the script at page load for description, parameters and validation</strong>, <strong>then dynamically builds a form to take input and display formatted output!</strong></p>
<p>The main goals for WebJEA:</p>
<ul>
<li>Reduce delegation of privileged access to users</li>
<li>Quickly automate on-demand tasks and grant access to less-privileged users</li>
<li>Leverage your existing knowledge in PowerShell to build web forms and automate on-demand processes</li>
<li>Encourage proper script creation by parsing and honouring advanced function parameters and comments</li>
</ul>
<p>Because WebJEA is simply a Self-Service Portal for PowerShell scripts, anything you can script with PowerShell you can run through the Portal! Opening a lot of opportunities for automation without having to learn third party automation toolsets! Anyone who knows PowerShell can use it! Each script can be locked down to specific users and AD groups!</p>
<p>You can read more about WebJEA directly on the GitHub page: <a href="https://github.com/markdomansky/WebJEA" target="_blank" rel="noopener noreferrer" title="https://github.com/markdomansky/WebJEA">https://github.com/markdomansky/WebJEA</a>.</p>
<p>This guide will concentrate on setting up WebJEA for self-service Azure VM management. However, WebJEA can be used to enable much more than what this blog article covers, from things such as new user onboarding, to resource creation.</p>
<p><img decoding="async" loading="lazy" alt="WebJEA - Start/Stop" src="/assets/images/webjea_startstopazvm-db8d952fbe0a4e9a77c1230cfd3c307d.png" width="1631" height="1072" class="img_ev3q"></p>
<p>We will use a Windows Server 2019, running in Microsoft Azure, to run WebJEA from.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<ul>
<li>Domain Joined server running Windows 2016+ Core/Full with PowerShell 5.1</li>
<li>The server must have permission to go out over the internet to Azure and download PowerShell modules.</li>
<li>CPU/RAM Requirements will depend significantly on your usage, start low <em>(2-vCPU/4GB RAM)</em> and grow as needed.</li>
</ul>
<p>I&#x27;ve created a Standard_B2ms <em>(2vCPU, 8GB RAM)</em> virtual machine, called: WEBJEA-P01 in an Azure Resource Group called: webjea_prod</p>
<p>This server is running: Windows Server 2019 Datacenter and is part of my Active Directory domain; I&#x27;ve also created a service account called: webjea_services.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-webjea">Setup WebJEA<a href="#setup-webjea" class="hash-link" aria-label="Direct link to Setup WebJEA" title="Direct link to Setup WebJEA">​</a></h3>
<p>Once we have a Windows Server, now it&#x27;s time to set up WebJEA!</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-self-signed-certificate">Setup Self-Signed Certificate<a href="#setup-self-signed-certificate" class="hash-link" aria-label="Direct link to Setup Self-Signed Certificate" title="Direct link to Setup Self-Signed Certificate">​</a></h4>
<p>If you already have a certificate you can use, skip this step. In the case of this guide, we are going to use a self-signed certificate.</p>
<p><strong>Log</strong> into the WebJEA <strong>Windows server</strong> using your service account <em>(in my case, it is: luke\webjea_services)</em>.</p>
<p>Open <strong>PowerShell</strong> ISE as Administrator, and after replacing the DNS name to suit your own environment, <strong>run the following to create the Root CA and Self-Signed certificate</strong>:</p>
<p>Now that the Root CA is created and trusted, we want to create the actual self-signed certificate:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Create RootCA</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$rootCA = New-SelfSignedCertificate -Subject &quot;CN=MyRootCA&quot;  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-KeyExportPolicy Exportable  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-KeyUsage CertSign,CRLSign,DigitalSignature  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-KeyLength 2048  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-KeyUsageProperty All  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-KeyAlgorithm &#x27;RSA&#x27;  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-HashAlgorithm &#x27;SHA256&#x27;  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Provider &quot;Microsoft Enhanced RSA and AES Cryptographic Provider&quot;  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-NotAfter (Get-Date).AddYears(10)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Create Self-Signed Certificate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$cert = New-SelfSignedCertificate -Subject &quot;CN=WEBJEA-P01.luke.geek.nz&quot;  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Signer $rootCA  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-KeyLength 2048  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-KeyExportPolicy Exportable  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-DnsName WEBJEA-P01.luke.geek.nz, WEBJEA, WEBJEA-P01  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-KeyAlgorithm &#x27;RSA&#x27;  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-HashAlgorithm &#x27;SHA256&#x27;  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Provider &quot;Microsoft Enhanced RSA and AES Cryptographic Provider&quot;  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-NotAfter (Get-Date).AddYears(10)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$certhumbprint = $cert.Thumbprint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Add Root CA to Trusted Root Authorities</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-Item -ItemType Directory &#x27;c:\WebJea\certs&#x27; -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Export-Certificate -Cert $rootCA -FilePath &quot;C:\WebJEA\certs\rootCA.crt&quot; -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Import-Certificate -CertStoreLocation &#x27;Cert:\LocalMachine\Root&#x27; -FilePath &quot;C:\WebJEA\certs\rootCA.crt&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write-Host -ForegroundColor Green -Object &quot;Copy this: $certhumbprint - The Thumbprint is needed for the DSCDeploy.ps1 script&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Copy</strong> the <strong>Thumbprint</strong> <em>(if you do this manually, make sure it is the Thumbprint of the certificate, not the Trusted Root CA certificate)</em>; we will need that later.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-a-group-managed-service-account">Setup a Group Managed Service Account<a href="#setup-a-group-managed-service-account" class="hash-link" aria-label="Direct link to Setup a Group Managed Service Account" title="Direct link to Setup a Group Managed Service Account">​</a></h4>
<p>This is the <strong>account</strong> we will use to <strong>run WebJEA under</strong>; it <strong>can</strong> be a normal <strong>Active Directory</strong> user <strong>account</strong> if you feel more comfortable or want to assign permissions to.</p>
<p>I am using a normal AD (Active Directory) service account in this guide because I am using Microsoft Entra ID Domain Services as my Domain Controller, and GMSA is not currently supported. I have also seen some scripts require the ability to create and read user-specific files. However, it&#x27;s always good to follow best practices where possible.</p>
<p><em>Note: Group Managed Services accounts automatically renew and update the passwords for the accounts; they allow for additional security. You can read more about them here:</em> <a href="https://learn.microsoft.com/en-us/windows-server/security/group-managed-service-accounts/group-managed-service-accounts-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Group Managed Service Accounts Overview"><em>Group Managed Service Accounts Overview</em></a><em>.</em></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Create A group MSA account</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Add-kdsrootkey -effectivetime ((get-date).addhours(-10))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-ADServiceAccount -name webjeagmsa1 -dnshostname (get-addomaincontroller).hostname -principalsallowedtoretrievemanagedpassword WEBJEA-P01.luke.geek.nz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Create AD Group</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-ADGroup -Name &quot;WebJEAAdmins&quot; -SamAccountName WebJEAAdmins -GroupCategory Security -GroupScope Global -DisplayName &quot;WebJEA - Admins&quot; -Description &quot;Members of this group are WebJEA Admins&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Install-adserviceaccount webjeagmsa1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Add-ADGroupmember -identity &quot;luke.geek.nz\WebJEAAdmins&quot; -members (get-adserviceaccount webjeagmsa1).distinguishedname</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Add</strong> the <strong>WebJEAAdmins group</strong> to the Administrators group of your WebJEA server.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="install-webjea">Install WebJEA<a href="#install-webjea" class="hash-link" aria-label="Direct link to Install WebJEA" title="Direct link to Install WebJEA">​</a></h4>
<p><strong>Download</strong> the <strong>latest</strong> <a href="https://github.com/markdomansky/WebJEA/releases" target="_blank" rel="noopener noreferrer" title="WebJEA - Releases">release package</a> <em>(zip file)</em> onto the <strong>WebJEA</strong> Windows server</p>
<p>Extract it, and you should have 2 files and 2 folders:</p>
<ul>
<li>
<p>Site\</p>
</li>
<li>
<p>StarterFiles\</p>
</li>
<li>
<p>DSCConfig.inc.ps1</p>
</li>
<li>
<p>DSCDeploy.ps1</p>
<p>Open PowerShell ISE as Administrator and open DSCDeploy.ps1</p>
</li>
</ul>
<p><strong>WebJEA uses PowerShell DSC <em>(Desired State Configuration)</em> to set up a lot of the setup</strong>.</p>
<p>DSC will do the following for us:</p>
<ul>
<li>Install IIS</li>
<li>Create the App Pool and set the identity</li>
<li>Create and migrate the Site files to the IIS website folder</li>
<li>Configure SSL (if we were using it)</li>
<li>Update the WebJEA config files to point towards the script and log locations</li>
</ul>
<p>Even though most of the work will be automated for us by Desired State Configuration, we have to do some configurations to work in our environment.</p>
<p>I am not using a Group Managed Service Account. Instead, I will use a normal AD account as a service account <em>(i.e. webjea_services)</em>, but if you use a GMSA, you need to put the username in the AppPoolUserName; no credentials are needed <em>(make sure the GMSA has access to the server)</em>.</p>
<p><strong>Change</strong> the <strong>following variables</strong> to suit <strong>your setup</strong>; in my case, I have moved WebJEA resources to their own folder, so it&#x27;s not sitting directly on the OS drive, but until its own Folder.</p>

























































<table><thead><tr><th>Variable</th><th>Note</th></tr></thead><tbody><tr><td>NodeName</td><td>This is a DSC variable, leave this.</td></tr><tr><td>WebAppPoolName</td><td>WebApp Pool Name, it may be best to leave this as: WebJEA, however you   can change this.</td></tr><tr><td>AppPoolUserName</td><td>Add in your GMSA or Domain Service account username</td></tr><tr><td>AppPoolPassword</td><td>If using a Domain Account, add the password in here, if GSMA leave bank</td></tr><tr><td>WebJEAIISURI</td><td>This is the IIS URL, ie server/WebJEA. You can change this if you want.</td></tr><tr><td>WebJEAIISFolder</td><td>IIS folder location, this can be changed if you wanted to move IIS to   another drive or location.</td></tr><tr><td>WebJEASourceFolder</td><td>The source folder, this is the source folder for the WebJEA files when   they are first downloaded and extracted (ie Downloads directory)</td></tr><tr><td>WebJEAScriptsFolder</td><td>This is where the scripts folder will be placed (ie WebJEA installed)</td></tr><tr><td>WebJEAConfigPath</td><td>This is where the config file will be placed (ie WebJEA installed - it   needs to be the same location as the Scripts folder)</td></tr><tr><td>WebJEALogPath</td><td>WebJEA log path</td></tr><tr><td>WebJEA_Nlog_LogFile</td><td>WebJEA system log location</td></tr><tr><td>WebJEA_Nlog_UsageFile</td><td>WebJEA usage log location</td></tr></tbody></table>
<p><img decoding="async" loading="lazy" alt="WebJEA - DSC" src="/assets/images/webjea_dsc-f0e0542599393fcd2f3e18abe3f09208.png" width="890" height="363" class="img_ev3q"></p>
<p>One thing to note is that the DSCDeploy.ps1 is calling <em>(dot sourcing)</em> the DSCConfig deploy script; by default, it is looking for it in the same folder as the DSCDeploy.ps1 folder.</p>
<p>If you just opened up PowerShell ISE, you may notice that you are actually in C:\Windows\System32, so it won&#x27;t be able to find the script to run; you can either change the script to point directly to the file location, or you can change the directory you are into to match the files, in my case in the Script pane I run the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd &#x27;C:\Users\webjea_services\Downloads\webjea-1.1.157.7589&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now <strong>run</strong> the <strong>script</strong> and <strong>wait</strong>.</p>
<p>If you get an error saying that the script is not digitally signed, run the following in the script pane:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is because the PowerShell execution policy hasn&#x27;t been set; depending on the scripts you are running, you may have to update the execution policy for the entire system, but for now, we will set it to Bypass for this process only, now re-run the script again, you should see DSC kick-off and start your configuration and setup of IIS and the WebJEA site.</p>
<p><img decoding="async" loading="lazy" alt="WebJEA - DSC" src="/assets/images/webjea_startingdsc-66c79c87ae373469ddb1b33a42b53b88.png" width="1284" height="209" class="img_ev3q"></p>
<p>You should also see the files/folders starting to be created!</p>
<p><em>Note: If you need to make a configuration change, please change it in the DSCDeploy.ps1, DSC will ensure that the configuration is applied as per your configuration and rerun the script, i.e. if you need to replace the certificate from a self-signed certificate to a managed PKI certificate.</em></p>
<p>Once DSC has been completed, your <strong>server should now be running IIS and the WebJEA site</strong></p>
<p>To add the IIS Management Tool, this is not required but will help you manage IIS, run the following PowerShell cmdlet:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enable-WindowsOptionalFeature -Online -FeatureName IIS-ManagementConsole</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Open an Internet Browser and navigate to <em>(your equivalent of)</em>: <a href="https://webjea-p01.luke.geek.nz/WebJEA" target="_blank" rel="noopener noreferrer" title="https://webjea-p01.luke.geek.nz/WebJEA">https://webjea-p01.luke.geek.nz/WebJEA</a>.</p>
<p>If you need assistance finding the Website path, open the Internet Information (IIS) Manager, installed and uncollapse Sites, Default WebSite, right-click WebJEA, Manage Application and select Browse.</p>
<p><img decoding="async" loading="lazy" alt="WebJEA - IIS" src="/assets/images/webjea_iis_authentication-fae19013434302ea12a734eeedbc981a.png" width="504" height="448" class="img_ev3q"></p>
<p>If successful, you should get a username and password prompt:</p>
<p><img decoding="async" loading="lazy" alt="WebJEA - IIS" src="/assets/images/webjea_authentication-099fdcb7045f35edd4ecdf6c19dfbae4.png" width="1047" height="602" class="img_ev3q"></p>
<p>That&#x27;s normal - it means you haven&#x27;t been given access and now need to configure it.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-webjea">Configure WebJEA<a href="#configure-webjea" class="hash-link" aria-label="Direct link to Configure WebJEA" title="Direct link to Configure WebJEA">​</a></h3>
<p>Now that WebJEA has been set up, it is time to configure it; the first thing we need to do is create a Group for WebJEA admins <em>(see all scripts)</em>.</p>
<p><strong>Create an Active Directory group for:</strong></p>
<ul>
<li><strong>WebJEA-Admins</strong></li>
<li>WebJEA-Users</li>
</ul>
<p><strong>Add</strong> your <strong>account</strong> to the: WebJEA-<strong>Admins group</strong>.</p>
<p><strong>Navigate</strong> to your <strong>WebJEA scripts folder</strong>; in my case, I set it up under c:\WebJEA\Scripts:</p>
<p><img decoding="async" loading="lazy" alt="WebJEA - Scripts" src="/assets/images/webjea_scripts-3f2ad25444e77d4ae541078fa58084af.png" width="485" height="158" class="img_ev3q"></p>
<p>Before we go any further, <strong>take</strong> a <strong>Backup</strong> of the config.json file, rename it to &quot;config.bak&quot;.</p>
<p><em>I recommend using Visual Studio Code to edit the config.json to help avoid any syntax issues.</em></p>
<p>Now right click <strong>config.json</strong> and open it to <strong>edit</strong></p>
<p>This file is the glue that holds WebJEA together.</p>
<p>We are going to make a few <strong>edits</strong>:</p>
<ul>
<li>Feel free to update the <strong>Title</strong> to match your company or Teams</li>
<li><strong>Add in</strong> the WebJEA-<strong>Admins</strong> group earlier <em>(include the Domain Name)</em> into the permitted group&#x27;s session - this controls access for ALL scripts.</li>
</ul>
<p><em>Note the: \\ for each path that is required. If you get a syntax error when attempting to load the WebJEA webpage, this is most likely missing.</em></p>
<p><img decoding="async" loading="lazy" alt="WebJEA - Demo" src="/assets/images/webjea_democonfig-e53400505488bf42c7cb0dfa4f21aae9.png" width="1020" height="313" class="img_ev3q"></p>
<p><strong>Save the config file</strong> and <strong>relaunch</strong> the <strong>WebJEA</strong> webpage. It should now load without prompting for a username and password.</p>
<p><strong>Set</strong> the PowerShell <strong>execution policy</strong> on the machine to Unrestricted so that you can run any PowerShell scripts on it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope LocalMachine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="WebJEA - Demo" src="/assets/images/webjea_initialoverview-cd702c782bbad98763e43ef95f6f40fc.png" width="1251" height="593" class="img_ev3q"></p>
<p>If you get an: AuthorizationManager check failed error, it is because the PowerShell scripts are still in a blocked state from being downloaded from the internet, run the following command to unblock them, then refresh the WebJEA webpage:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-ChildItem -Path &#x27;C:\WebJEA\scripts\&#x27; -Recurse | Unblock-File</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>You now have a base WebJEA install</strong>! By default, WebJEA comes with 2 PowerShell files:</p>
<ul>
<li>overview.ps1</li>
<li>validate.ps1</li>
</ul>
<p>You may have noticed these in the config.json file; WebJEA has actually run the overview.ps1 file as soon as the page loads, so you can have scripts run before running another one, which is handy when you need to know the current state of something before taking action.</p>
<p>The validate.ps1 script is an excellent resource to check out the parameter types used to generate the forms.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-virtual-machine-startstop">Setup Azure Virtual Machine Start/Stop<a href="#setup-azure-virtual-machine-startstop" class="hash-link" aria-label="Direct link to Setup Azure Virtual Machine Start/Stop" title="Direct link to Setup Azure Virtual Machine Start/Stop">​</a></h3>
<p>Now that we have a working WebJEA install, it&#x27;s time to set up the Azure VM Start/Stop script for this demo.</p>
<p>On the WebJEA server, we need to <strong>install</strong> the <strong>Azure PowerShell modules</strong>, run the following in Powershell as Administrator:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Install-Module Az -Scope AllUsers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-service-principal">Create Service Principal<a href="#create-service-principal" class="hash-link" aria-label="Direct link to Create Service Principal" title="Direct link to Create Service Principal">​</a></h4>
<p>Once the Az PowerShell modules are installed, we need to <strong>set</strong> a <strong>Service Principal</strong> for the PowerShell script to connect to Azure to manage our Virtual Machines.</p>
<p>Run the following PowerShell cmdlet to connect to Azure:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connect-AzAccount</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now that we are connected to Azure, we now need to create the SPN, run the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$sp = New-AzADServicePrincipal -DisplayName WebJEA-AzureResourceCreator -Role Contributor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($sp.Secret)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$UnsecureSecret = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now you have created an SPN called: WebJEA-AzureResourceCreator. We now need to grab the Tenant ID, run the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-AzContext | Select-Object Tenant</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now that we have the SPN and Tenant ID, it&#x27;s time to test connectivity.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Login using service principal </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$TenantId = &#x27;TENANTIDHERE&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ApplicationId = &#x27;APPLICATIONIDHERE&#x27;  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Secret = ConvertTo-SecureString -String &#x27;SECRETSTRINGHERE&#x27; -AsPlainText -Force </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Credential = [System.Management.Automation.PSCredential]::New($ApplicationId, $Secret) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connect-AzAccount -ServicePrincipal -Credential $Credential -TenantId $TenantId</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Copy the TenantID into the TenantID section</p>
<p>Type:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$sp.ApplicationID</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To retrieve the ApplicationID created from the SPN in the previous step and add it into the ApplicationID part.</p>
<p>Type in:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$UnsecureSecret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To retrieve the Secret, created in the SPN and add it to the String.</p>
<p>Now run the snippet, and you should be successfully connected to Azure.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-get-vm-script">Create Get-VM script<a href="#create-get-vm-script" class="hash-link" aria-label="Direct link to Create Get-VM script" title="Direct link to Create Get-VM script">​</a></h4>
<p>One of the features of WebJEA is the ability to run scripts on page load. So, we will get the current Power State of our Azure VMs, in the <strong>WebJEA scripts directory</strong> to create a new PS1 file called: <strong>Get-VM.ps1</strong>.</p>
<p>Add the following script to it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Login using service principal </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$TenantId = &#x27;TENANTIDHERE&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ApplicationId = &#x27;APPLICATIONIDHERE&#x27;  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Secret = ConvertTo-SecureString -String &#x27;SECRETSTRINGHERE&#x27; -AsPlainText -Force </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Credential = [System.Management.Automation.PSCredential]::New($ApplicationId, $Secret) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connect-AzAccount -ServicePrincipal -Credential $Credential -TenantId $TenantId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-AzVM -Status | Select-Object Name, PowerState, ResourceGroupName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Save</strong> the file.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-set-vm-script">Create Set-VM script<a href="#create-set-vm-script" class="hash-link" aria-label="Direct link to Create Set-VM script" title="Direct link to Create Set-VM script">​</a></h4>
<p>Now, it&#x27;s time to create the Script to Start/Stop the Virtual Machine. In the <strong>WebJEA scripts directory</strong>, create a new PS1 file called: <strong>Set-VM.ps1</strong></p>
<p>Add the following script to it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[CmdletBinding(SupportsShouldProcess=$True,ConfirmImpact=&#x27;Low&#x27;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">param</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Parameter(Position=1, mandatory=$true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HelpMessage=&#x27;What is the name of the Azure Virtual Machine?&#x27;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$VMName,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Parameter(Position=2, mandatory=$true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HelpMessage=&#x27;What is the name of the Azure Resource Group that the Virtual Machine is in?&#x27;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$RGName,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[Parameter(Position=3, mandatory=$true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HelpMessage=&#x27;What action do you want to do?&#x27;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[VALIDATESET(&#x27;Start&#x27;,&#x27;Stop&#x27;)] </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$VMAction</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Login using service principal </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$TenantId = &#x27;TENANTIDHERE&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ApplicationId = &#x27;APPLICATIONIDHERE&#x27;  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Secret = ConvertTo-SecureString -String &#x27;SECRETSTRINGHERE&#x27; -AsPlainText -Force </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Credential = [System.Management.Automation.PSCredential]::New($ApplicationId, $Secret) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connect-AzAccount -ServicePrincipal -Credential $Credential -TenantId $TenantId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-AzVM -Status | Select-Object Name, PowerState, ResourceGroupName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if ($VMAction -eq &quot;Start&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Start-AzVM -Name $VMName -ResourceGroupName $RGName -Confirm:$false  -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">elseif ($VMAction -eq &quot;Stop&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       Stop-AzVM -Name $VMName -ResourceGroupName $RGName -Confirm:$false  -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Save</strong> the file.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="set-vm-in-webjea-config">Set VM in WebJEA Config<a href="#set-vm-in-webjea-config" class="hash-link" aria-label="Direct link to Set VM in WebJEA Config" title="Direct link to Set VM in WebJEA Config">​</a></h4>
<p>Now that the scripts have been created, it&#x27;s time to add them to WebJEA to use.</p>
<p>Navigate to your scripts file and make a backup of the config.json file, then edit: config.json</p>
<p>On the line beneath the &quot;onloadscript&quot;: &quot;overview.ps1&quot; file, add:</p>
<p>},</p>
<p>Then add in:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;id&quot;: &quot;StartStopAzVM&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;displayname&quot;: &quot;StartStop-AzVM&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;synopsis&quot;: &quot;Starts or Stops Azure Based VMs&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;permittedgroups&quot;: [&quot;.\\Administrators&quot;, &quot;luke.geek.nz\\WebJEAAdmins&quot;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;script&quot;: &quot;Set-VM.ps1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;onloadscript&quot;: &quot;Get-VM.ps1&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So your config.json should look similar to:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">config.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;Title&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Luke Web Automation&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;defaultcommandid&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;overview&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;basepath&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;C:\\WebJEA\\scripts&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;LogParameters&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;permittedgroups&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;.\\Administrators&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;luke.geek.nz\\WebJEAAdmins&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;commands&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;overview&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;displayname&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Overview&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;synopsis&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Congratulations, WebJEA is now working!  We&#x27;ve pre-loaded a demo script that will help you verify everything is working.  &lt;br/&gt;&lt;i&gt;Tip: You can use the synopsis property of default command to display any text you want.  Including html.&lt;/i&gt;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;permittedgroups&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;.\\Administrators&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;script&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;validate.ps1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;onloadscript&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;overview.ps1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;StartStopAzVM&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;displayname&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;StartStop-AzVM&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;synopsis&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Starts or Stops Azure Based VMs&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;permittedgroups&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;.\\Administrators&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;luke.geek.nz\\WebJEAAdmins&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;script&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Set-VM.ps1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;onloadscript&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Get-VM.ps1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-azure-virtual-machine-startstop">Test Azure Virtual Machine Start/Stop<a href="#test-azure-virtual-machine-startstop" class="hash-link" aria-label="Direct link to Test Azure Virtual Machine Start/Stop" title="Direct link to Test Azure Virtual Machine Start/Stop">​</a></h3>
<p>Now that the scripts have been created <strong>open</strong> the <strong>WebJEA</strong> webpage.</p>
<p>Click on the <strong>StartStop-AzVM</strong> page <em>(it may take a few seconds to load, as it is running the Get-VM script</em>). You should be greeted by a window similar to below:</p>
<p><img decoding="async" loading="lazy" alt="WebJEA - Demo" src="/assets/images/webjea_startstopazvm-db8d952fbe0a4e9a77c1230cfd3c307d.png" width="1631" height="1072" class="img_ev3q"></p>
<p><strong>Congratulations, you have now set up WebJEA and can Start/Stop any Azure Virtual Machines using self-service!</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-notes">Additional Notes<a href="#additional-notes" class="hash-link" aria-label="Direct link to Additional Notes" title="Direct link to Additional Notes">​</a></h3>
<ul>
<li>There is room for improvement around error checking, doing more with the scripts, such as sending an email when triggered, etc., to remind the server to be powered off.</li>
<li>Because most of the configuration is JSON/PowerShell files, you could have the entire scripts folder in a git repository to make changes, roll back and keep version history.</li>
<li>Remove any hard coding of any secrets to connect to Azure (as an example) from the scripts and implement a password management tool with API access or even the Windows Credential Manager. You want a system where you can easily update the passwords of accounts, limit access and prevent anything from being stored in plain text.</li>
<li>Using the permitted group&#x27;s section of the config.json file, you can restrict the ability for certain groups to run scripts this way, and you can set granular control on who can do what.</li>
<li>If you use a normal Active Directory user account as the service account - then for added security, make sure that the WebJEA server is the only device that - that account can be logged in as and only has the permissions assigned that it needs to, look at implementing PIM (Privilaged Access Management) for some tasks so it only has access at the time that it needs it.</li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/07/13/validate-that-your-azure-resources-are-deployed-per-the-well-architected-framework/">Well-Architected Framework Azure infrastructure review with PSRule for Azure</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-07-13T00:00:00.000Z">July 13, 2021</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Imagine if you could validate that your Azure Resources are deployed per the Well-Architected Framework (WAF).. just <strong>imagine</strong>!</p>
<p><strong>Of a way of validating your services are secure and deployed following the Azure Architecture framework, both before and after the resources have been created!</strong></p>
<p>Imagine no longer! There is a PowerShell module designed specifically for that purpose: <strong>PSRule for Azure</strong>.</p>
<p><img decoding="async" loading="lazy" alt="PSRule - Azure" src="/assets/images/windowsterminal_data_psrules-azure-632e4b91e286be9af069b1fe176eec84.png" title="PSRule - Azure" width="624" height="325" class="img_ev3q"></p>
<p>PSRule is a suite of rules to validate resources and infrastructure as code <em>(IaC)</em> using PSRule, and the Azure component uses the base PSRule module.</p>
<p>Features of <a href="https://azure.github.io/PSRule.Rules.Azure/" target="_blank" rel="noopener noreferrer" title="PSRule for Azure">PSRule for Azure</a>
include:</p>
<ul>
<li>Leverage over 200 pre-built rules across five WAF pillars:
<ul>
<li>Cost Optimization</li>
<li>Operational Excellence</li>
<li>Performance Efficiency</li>
<li>Reliability</li>
<li>Security</li>
</ul>
</li>
<li>Validate resources and infrastructure code pre or post-deployment using Azure DevOps or Github!</li>
<li>It runs on macOS, Linux, and Windows.</li>
</ul>
<p>With over 200 inbuilt rules <em>(and you can add your own),</em> there is a lot of resource types covered, such as <em>(but not limited to)</em>:</p>
<ul>
<li>Azure App Service</li>
<li>Azure Key vault</li>
<li>Azure Virtual Machine</li>
<li>Azure Storage</li>
<li>Azure Network</li>
<li>Azure Public IP</li>
</ul>
<p>Azure PSRules has been in development since 2019 and is under constant updates and fixes.</p>
<p>PSRule for Azure provides two methods for analyzing Azure resources:</p>
<ul>
<li>Pre-flight - Before resources are deployed from Azure Resource Manager templates.</li>
<li>In-flight - After resources are deployed to an Azure subscription.</li>
</ul>
<p>Pre-flight validation is used to scan ARM (Azure Resource Manager) templates before services are deployed and allow for quality gaps and better information in pull requests to improve and implement your infrastructure as code components.</p>
<p>The in-flight method can also be used in Azure DevOps for validation of Terraform resource deployments etc. Still, in this demo, I will run you through installing the Module and doing an export and scan from your PowerShell console!</p>
<p>We are going to install the PSRule.Azure <em>(based on the Well-Architected Framework &amp; Cloud Adoption Framework)</em>.</p>
<p>I recommend keeping the Modules <em>(and as such the in-built rules)</em> up-to-date and do scans at least every quarter or after a major deployment or project to help verify your resources are set up according to some best-practice rules. This does not replace Security Center and Azure Advisor; this is intended to be a supplement.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-psruleazure">Install PSRule.Azure<a href="#install-psruleazure" class="hash-link" aria-label="Direct link to Install PSRule.Azure" title="Direct link to Install PSRule.Azure">​</a></h3>
<ol>
<li>
<p>Open <strong>PowerShell</strong> console and <strong>run</strong> the following <strong>commands</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#The main Module and base rules to validate Azure resources..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Install-Module PSRule.Rules.Azure -Scope CurrentUser</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Install-Module PSRule" src="data:image/png;base64,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ERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgEZIBAAAoBESAQAAaIREAAAAGiERAACARkgEAACgERIBAABohEQAAAAaIREAAIBGSAQAAKAREgEAAGiERAAAABohEQAAgObEq1/96tkKAAAAjpdXvOIVw4nLL798thIAAIDj5bLLLhtOXHnllbOVAAAAHC+f/vSnhxOPPPLI8IY3vGG2AQAAAMfDBRdcMNx///1PhsS77rprOOecc2YbAgAAcPSdOnXqyZD4ne98Z6igeNFFF802BgAA4GjKFcQKiPfdd9+TVxIffvjh0UMPPTR85jOfGd773vcOL33pS2dXAAAAwOGWvHfJJZcMn/rUp8ZgeO+9947uv//+4f8CIrNRqbzoK4cAAAAASUVORK5CYII=" title="Install-Module PSRule" width="905" height="242" class="img_ev3q">
2. Press &#x27;<strong>Y</strong>&#x27; to <strong>accept PSGallery</strong> as a trusted repository; just a note, you can prevent the confirmation prompt when installing Modules from the PSGallery, by classifying it as a &#x27;Trusted Repository&#x27; by running the following. Just be wary that won&#x27;t get rechallenged:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Set-PSRepository -Name &#x27;PSGallery&#x27; -InstallationPolicy Trusted</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3. You should now have the following modules installed:</p>
<ul>
<li>PSRule</li>
<li>PSRule.Rules.Azure</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="extract-azure-subscription-psrule-json-files">Extract Azure Subscription PSRule JSON files<a href="#extract-azure-subscription-psrule-json-files" class="hash-link" aria-label="Direct link to Extract Azure Subscription PSRule JSON files" title="Direct link to Extract Azure Subscription PSRule JSON files">​</a></h3>
<p>Now that PSRule has been installed, it&#x27;s time to log in to Azure and extract information regarding your Azure resources for analysis; these extracted files are JSON files containing information, such as your resource names, subscription ID, etc. resource groups in plain text.</p>
<p>As you can see from the screenshot below, we can target specific Subscriptions, Tenancies <em>(yes, as long as the account you have access to has access to the subscription, you can export those as well)</em>, Resource Groups and Tags.</p>
<p><img decoding="async" loading="lazy" alt="Export-AzRuleData" src="data:image/png;base64,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" title="Export-AzRuleData" width="309" height="184" class="img_ev3q"></p>
<p>Because I want to get the most data available across all resources, I will target everything with the &#x27;<em>-All</em>&#x27; parameter.</p>
<ol>
<li>
<p>First, we need to connect to the Azure subscription and then <strong>connect</strong> to the <strong>Azure</strong> subscription we have access to or are targeting by running the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connect-AzAccount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-AzSubscription  | ogv -PassThru | Set-AzContext</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Now that you have connected its time to export the Azure resource information, <strong>run</strong> the following <strong>PowerShell</strong> cmdlet, and <strong>point</strong> it towards an <strong>empty folder</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Export-AzRuleData -OutputPath c:\temp\AzRuleData -All</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>If the <strong>folder doesn&#x27;t</strong> <strong>exist</strong>, <em>don&#x27;t worry</em> - the Export command will <strong>create</strong> it <strong>for you</strong>. Depending on how many resources and subscriptions you are extracting, this may take a few minutes.</p>
</li>
</ol>
<p>You should <strong>see</strong> the <strong>JSON files</strong> appearing if you open one of these. In addition, you should be able to see information about the resources it has extracted.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-psrule-across-your-json-files">Run PSRule across your JSON files<a href="#run-psrule-across-your-json-files" class="hash-link" aria-label="Direct link to Run PSRule across your JSON files" title="Direct link to Run PSRule across your JSON files">​</a></h3>
<p>Now that you have extracted the JSON files of your Azure resources, it&#x27;s now time to analyse them following Microsoft Cloud Adoption and Well Architectured framework and the rules builtin into PSRule.Azure!</p>
<p>You don&#x27;t need to be connected to Azure; for this analysis, have the PSRule modules installed and access the JSON files.</p>
<p>PSRule.Azure has a few <a href="https://azure.github.io/PSRule.Rules.Azure/en/baselines/Azure.All/" target="_blank" rel="noopener noreferrer" title=" PSRule for Azure - All Baselines">baselines</a>; these baselines contain the rules used to analyse your resources and range from Preview to newly released rules; again, we will target ALL rules, as we are after all recommendations.</p>
<ol>
<li>
<p>In <strong>PowerShell, run</strong> the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Assert-PSRule -Module &#x27;PSRule.Rules.Azure&#x27; -InputPath &#x27;C:\temp\AzRuleDataExport\*.json&#x27; -Baseline &#x27;Azure.All&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>This will trigger <strong>PSRules</strong> to <strong>scan</strong> your <strong>extracted JSON</strong> files with the <strong>ALL</strong> rules, and you will get <strong>output</strong> like below:</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Invoke-PSRules" src="/assets/images/windowsterminal_data_psrules-azure-632e4b91e286be9af069b1fe176eec84.png" title="Invoke-PSRules" width="624" height="325" class="img_ev3q"></p>
</li>
<li>
<p>Although it is good being able to see a high level, I prefer to look at it all at once in Excel, so run the following to <strong>export</strong> the rules to a <strong>CSV</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Invoke-PSRule -Module &#x27;PSRule.Rules.Azure&#x27; -InputPath &#x27;C:\temp\AzRuleDataExport\*.json&#x27; -Baseline &#x27;Azure.All&#x27; | Export-csv C:\temp\AzRuleDataExport\Exported_Data.csv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>You should now have a CSV file to review and look for common issues, concerns and work on improving your Azure infrastructure setup!</p>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="PS Rules Azure - Export CSV" src="/assets/images/export_azruledata_excel-9450a5fd0637a23b1369552391dc4a67.png" title="PS Rules Azure - Export CSV" width="2578" height="769" class="img_ev3q"></p>
<p><em>Note: The export contains the Subscription/Resource Names, so you can definitely see what resources can improve upon; however, I removed it from my screenshot.</em></p>
<p><strong>Congratulations</strong>! You now have more visibility and, hopefully, some useful recommendations for improving your Azure services!</p>
<p><em>If you want to get a good understanding of the type of data rules, check out my extracted CSV &#x27;</em><a href="http://luke.geek.nz/uploads/files/Exported_Data_PSRuleAzure.csv" target="_blank" rel="noopener noreferrer"><em>here</em></a><em>&#x27;.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources">​</a></h3>
<ul>
<li>If you found PSRules.Azure interesting; how about getting any Failed rules? How about getting any failed rules pushed to Azure Monitor?</li>
</ul>
<p><a href="https://github.com/microsoft/PSRule.Monitor" target="_blank" rel="noopener noreferrer" title="PSRule to Azure Monitor">PSRule to Azure Monitor</a></p>
<ul>
<li>If you are interested in the CI (Continous Integration) options, check out the links below:</li>
</ul>
<p><a href="https://microsoft.github.io/PSRule/" target="_blank" rel="noopener noreferrer" title="PSRule">Azure DevOps Pipeline &amp; Github Actions</a></p>
<ul>
<li>Extend the PSRules to include Cloud Adoption Framework as well?</li>
</ul>
<p><a href="https://github.com/microsoft/PSRule.Rules.CAF" target="_blank" rel="noopener noreferrer" title="PSRule for Cloud Adoption Framework">PSRule for Cloud Adoption Framework</a></p>
<ul>
<li>And finally, creating Custom Rules for your organisation, including Tagging, Naming conventions etc.?</li>
</ul>
<p><a href="https://azure.github.io/PSRule.Rules.Azure/customization/" target="_blank" rel="noopener noreferrer" title="Organization specific rules">PSRule.Azure Custom Rules</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/07/10/configure-azure-virtual-desktop-monitoring-insights/">Configure Azure Virtual Desktop Monitoring Insights</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-07-10T00:00:00.000Z">July 10, 2021</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Microsoft has now added a built-in Monitoring workbook for Azure Virtual Desktop performance monitoring; this monitoring includes dashboards related <em>(but not limited to)</em>:</p>
<ul>
<li>Session host diagnostics</li>
<li>Connection performance</li>
<li>Host performance</li>
<li>User login events</li>
<li>Remote Desktop client versions</li>
</ul>
<p>To configure, we first need to create a Log Analytics workspace that both the Host Pool and Workspace will connect to.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-log-analytics-workspace">Create a Log Analytics workspace<a href="#create-a-log-analytics-workspace" class="hash-link" aria-label="Direct link to Create a Log Analytics workspace" title="Direct link to Create a Log Analytics workspace">​</a></h3>
<p>You can use a Log Analytics workspace if it already exists; if not, we will have to create one.</p>
<ol>
<li>Log in to the <strong>Azure Portal</strong></li>
<li>Click on + <strong>Create a Resource</strong></li>
<li>Search for: <strong>Log Analytics workspace</strong></li>
<li>Click <strong>Create</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Log Analytics Marketplace" src="/assets/images/azportal_loganalyticsworkspace-1731c847286b3b7f27cfe4cd5b15db61.png" title="Azure Portal - Log Analytics Marketplace" width="991" height="500" class="img_ev3q"></li>
<li>Here we can <strong>select</strong> the <strong>Resource Group</strong>, <strong>Name</strong> and <strong>Location</strong> of the Log Analytics workspace we will create.</li>
<li>I am going to <strong>create</strong> a new <strong>Resource Group</strong> called: aad_mgmt</li>
<li>I click Create New and <strong>enter</strong> in the <strong>name</strong> of the <strong>Resource Group</strong></li>
<li>Under Instance Details, make sure you select a name that adheres to your naming governance.</li>
<li><em>Note: the name of your Log Analytics workspace is now scoped to the Resource Group, so you can have Log Analytics workspaces with the same name, as long as they are indifferent resource groups.</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create Log Analytics" src="/assets/images/azportal_createloganalyticsworkspace-de7ccc210cfbffca60f38cbf97d55e97.png" title="Azure Portal - Create Log Analytics" width="725" height="663" class="img_ev3q"></li>
<li>Click on: <strong>Next: Pricing Tier</strong></li>
<li><strong>Select</strong> the applicable <strong>pricing tier</strong>, I only have Pay-as-you-go (Per GB 2018), so I will select that.</li>
<li><em>Note: You can view the Pricing for Log Analytics on the</em> <a href="https://azure.microsoft.com/en-us/pricing/details/monitor/?WT.mc_id=AZ-MVP-5004796," target="_blank" rel="noopener noreferrer" title="Azure Pricing Calculator - Azure Monitor"><em>Pricing Calculator</em></a><em>:  look at the Pay-As-You rates.</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create Log Analytics" src="/assets/images/azportal_createloganalyticsworkspacepricing-82e82e4f329bb29622867177b614e4f7.png" title="Azure Portal - Create Log Analytics" width="743" height="349" class="img_ev3q"></li>
<li>Click <strong>Next: Tags</strong></li>
<li><strong>Enter</strong> in any <strong>applicable tags</strong>, such as Creator, Who it may get billed to, Project ID etc. that’s relevant and select <strong>Review + Create</strong></li>
<li><strong>Review</strong> the <strong>configuration</strong> and click <strong>Create</strong> to create your Log Analytics workspace! <em>(It should take less than a minute.</em>)</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-azure-virtual-desktop-insights">Configure Azure Virtual Desktop Insights<a href="#configure-azure-virtual-desktop-insights" class="hash-link" aria-label="Direct link to Configure Azure Virtual Desktop Insights" title="Direct link to Configure Azure Virtual Desktop Insights">​</a></h3>
<ol>
<li>
<p>Log in to the <strong>Azure Portal</strong></p>
</li>
<li>
<p><strong>Search</strong> for: <strong>Azure Virtual Desktop</strong></p>
</li>
<li>
<p>Click on <a href="https://portal.azure.com/#blade/Microsoft_Azure_WVD/WvdManagerMenuBlade/insights" target="_blank" rel="noopener noreferrer" title="Azure Virtual Desktop - Insights"><strong>Insights</strong></a></p>
</li>
<li>
<p>A Workbook blade should now greet you</p>
</li>
<li>
<p>This is where we will <strong>configure</strong> the Azure Virtual Desktop <strong>Insights</strong>. You can see on the lower right-hand side that we will be deploying Azure Monitor for &#x27;Windows Virtual Desktop v1.0.4&#x27; <em>(however, this will be managed by Microsoft, but it is handy to know the version in case of support later on).</em></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop - Insights" src="/assets/images/azportal_azurevirtualdesktop_insights-dfb15951312d5bd19cec3a739675b4e9.png" title="Azure Virtual Desktop - Insights" width="1700" height="672" class="img_ev3q"></p>
</li>
<li>
<p>Click on <strong>Open Configuration Workbook</strong></p>
</li>
<li>
<p>Here, <strong>select</strong> the Log Analytics <strong>workspace</strong> you created earlier <em>(or want to use)</em></p>
</li>
<li>
<p>Select <strong>Configure host pool</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop - Insights" src="/assets/images/azportal_azurevirtualdesktopcheckconfiguration-f0789585b303fa6f001d9178b019d839.png" title="Azure Virtual Desktop - Insights" width="925" height="997" class="img_ev3q"></p>
</li>
<li>
<p>Click on <strong>Deploy</strong> <em>(make sure all your Session Hosta are started so that Azure can deploy and configure the Log Analytics agent on the Virtual Machines)</em></p>
</li>
<li>
<p>You can select View Template and Parameters if you want to confirm the host pool and workspace configured.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop - Insights" src="/assets/images/azportal_azurevirtualdesktophostpooldeploy-12850b5994f383071022cfd6189a7543.png" title="Azure Virtual Desktop - Insights" width="408" height="309" class="img_ev3q"></p>
</li>
<li>
<p>While the Diagnostic host pool settings are being configured, click on <strong>Configure workspace.</strong></p>
</li>
<li>
<p>Click on: <strong>Deploy</strong></p>
</li>
<li>
<p>Once the Workspace and Host Pool deployments are done, click on <strong>Refresh.</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop - Insights" src="/assets/images/azportal_azurevirtualdesktopcheckconfigrefresh-8a31df74f32458c5c1adfe8218f3426b.png" title="Azure Virtual Desktop - Insights" width="621" height="142" class="img_ev3q"></p>
</li>
<li>
<p><strong>Confirm</strong> that <strong>Enabled</strong> is: True</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop" src="/assets/images/azportal_azurevirtualdesktopcheckconfig-f6b7bf16a6e99d7367517c0ee4496bb0.png" width="1260" height="734" class="img_ev3q"></p>
</li>
<li>
<p>The journey is not over yet; now that the Host Pool and Workspace have been configured, we need to <strong>add</strong> the <strong>Session Hosts</strong> and configure the <strong>performance counters</strong> to the same workspace!</p>
</li>
<li>
<p>Click on: <strong>Session host data settings.</strong></p>
</li>
<li>
<p><strong>Select</strong> your Log Analytics <strong>workspace</strong></p>
</li>
<li>
<p>Select <strong>Add hosts to workspace</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop" src="/assets/images/azportal_sessionhostdatasettings-a761143019816a6cc5e3d73bec9d1b1c.png" width="955" height="578" class="img_ev3q"></p>
</li>
<li>
<p>Confirm the Deployment and click <strong>Deploy</strong></p>
</li>
<li>
<p><strong>Wait until</strong> the <strong>deployment</strong> has <strong>succeeded,</strong> or you may get API errors, then select:</p>
</li>
<li>
<p>Navigate down and click <strong>Configure performance counters</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop" src="/assets/images/azportal_performancecounterssettings-6cf5bc872a2bc3942fb88a172ea99dcd.png" width="1141" height="597" class="img_ev3q"></p>
</li>
<li>
<p>Click on <strong>Apply</strong> config.</p>
</li>
<li>
<p><strong>Wait until</strong> the <strong>deployment</strong> has <strong>succeeded,</strong> or you may get API errors, then select:</p>
</li>
<li>
<p>Navigate down and click on <strong>Configure events</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop" src="/assets/images/azportal_eventlogssettings-673f0134884b13d12f45ee37eac9e2a2.png" width="1347" height="631" class="img_ev3q"></p>
</li>
<li>
<p>Click on <strong>Deploy</strong></p>
<p>Now click on: <strong>Refresh</strong>, and you should see &#x27;No missing performance counters&#x27;, &#x27;No missing events found&#x27;.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop" src="/assets/images/azportal_performancecountersreview-ae75b48856a1e45f3e90086cfbab7187.png" width="1506" height="875" class="img_ev3q"></p>
</li>
<li>
<p><strong>You have now configured Azure Virtual Desktop Insights!</strong></p>
<p><em>It may take a few minutes to an hour to populate and collect the data for some of the events and counters.</em></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop" src="/assets/images/azportal_azurevirtualdesktopinsights-16a5d47b37970b66136cbd3e5f590764.png" width="1576" height="792" class="img_ev3q"></p>
<p><em>On the plus side, all the data is also in Log Analytics so that it can be queried, and you can set up Alert rules against it and get more visibility into your Azure Virtual Desktop environment and use.</em></p>
<p><img decoding="async" loading="lazy" alt="Azure Virtual Desktop" src="/assets/images/azportal_azurevirtualdesktoploganalytiicsquery-49377adee1c7434d0b3a37d4735c5d42.png" width="1694" height="990" class="img_ev3q"></p>
</li>
</ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/07/10/how-to-create-a-free-log-analytics-workspace/">How to create a Free Azure Log Analytics Workspace using PowerShell</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-07-10T00:00:00.000Z">July 10, 2021</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>When you create a Log Analytics workspace using the Azure Portal, you only get the Pricing or &#x27;Pay-as-you-go&#x27; tiers to select.</p>
<p>You used to create a &#x27;Free&#x27; tier using the Azure Portal; however, since 2018; they removed it with a change in plans and it became a legacy offering.</p>
<p>However, using PowerShell, you can still create a Log Analytics Free SKU!</p>
<blockquote>
<p>The Free pricing tier is a <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/cost-logs?WT.mc_id=AZ-MVP-5004796#legacy-pricing-tiers" target="_blank" rel="noopener noreferrer">legacy pricing tier</a> that is available for trying Azure Log Analytics. It has a data cap of 500 MB/day and only 7 days of data retention, so it is intended only for testing and is not to be used for production deployments.</p>
</blockquote>
<p>You can change a Free Tier Log Analytics workspace to a Pay-as-you-go or commitment tier later.</p>
<p>You cannot change a Log Analytics workspace created on a higher tier back to Free, even using PowerShell, due to <a href="https://azure.microsoft.com/en-us/blog/introducing-a-new-way-to-purchase-azure-monitoring-services/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Introducing a new way to purchase Azure monitoring services">adjustments</a> in 2018 around the Log Analytics billing and plans.</p>
<p><img decoding="async" loading="lazy" alt="Azure Log Analytics - Free" src="/assets/images/log_analytics_free-e00e30f4763f8c161fd71b3089786959.png" width="1403" height="246" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-free-tier-log-analytics-using-powershell">Create a &#x27;Free Tier&#x27; Log Analytics using PowerShell<a href="#create-a-free-tier-log-analytics-using-powershell" class="hash-link" aria-label="Direct link to Create a &#x27;Free Tier&#x27; Log Analytics using PowerShell" title="Direct link to Create a &#x27;Free Tier&#x27; Log Analytics using PowerShell">​</a></h2>
<p>Change the script&#x27;s variables below to suit your environment, connect to Azure and run the script to create your Log Analytics workspace.</p>
<p>Note: I tested this script on an MSDN subscription, which I&#x27;ve had for a few years and a recent one created a few months back <em>(2021)</em>, but there may be limitations on other subscription types that I haven&#x27;t tested <em>- see blurb below the script</em>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Connect to Azure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connect-AzAccount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Set Variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ResourceGroup = &#x27;aad_mgmt&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Location = &#x27;australiaeast&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$LogAnalyticsName = &#x27;la-free&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$SKU = &#x27;Free&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Creates Log Analytics Workspace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzOperationalInsightsWorkspace -Location $Location -Name $LogAnalyticsName -Sku $SKU -ResourceGroupName $ResourceGroup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>If you get an error: Error Message: Pricing tier doesn&#x27;t match the subscription&#x27;s billing model. Read <a href="http://aka.ms/PricingTierWarning" target="_blank" rel="noopener noreferrer" title="http://aka.ms/PricingTierWarning?WT.mc_id=AZ-MVP-5004796#moving-to-the-new-pricing-model">http://aka.ms/PricingTierWarning</a> for more details, unfortunately it means that your Subscription is under a different Billing model, and may have been created recently are you are unable to use the &#x27;Free&#x27; tier, instead you may have to create it using &#x27;standard&#x27; instead.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Azure Log Analytics - Free" src="/assets/images/log_analytics_free_tier-4d081be6f32051641bc832cade388f62.png" width="980" height="981" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tags/azure/page/22/"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tags/azure/page/24/"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
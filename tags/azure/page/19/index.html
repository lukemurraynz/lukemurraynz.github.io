<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">130 posts tagged with &quot;Azure&quot; | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/tags/azure/page/19/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="130 posts tagged with &quot;Azure&quot; | luke.geek.nz"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/tags/azure/page/19/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/19/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/19/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.d349528d.css">
<script src="/assets/js/runtime~main.6ec91989.js" defer="defer"></script>
<script src="/assets/js/main.51a362ed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/404-attempting-query-openai-azure-function-binding/">Resolving 404 Error with OpenAI Azure Function Binding</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/implementing-sandbox-vending/">Implementing a Sandbox Environment in Microsoft Azure</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/change-timezone-azure-container-app/">Change the Timezone of your Azure Container App</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azure-container-apps-overview/">Azure Container Apps - Overview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/book-review-cloud-solution-architects-career-master-plan/">Book Review Cloud Solution Architects Career Master Plan</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>130 posts tagged with &quot;Azure&quot;</h1><a href="/tags/">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/controlled-chaos-in-azure-using-chaos-studio/">Controlled Chaos in Azure using Chaos Studio</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-06T00:00:00.000Z">January 6, 2022</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Chaos engineering has been around for a while; Netflix runs their own famous <a href="https://netflix.github.io/chaosmonkey/" target="_blank" rel="noopener noreferrer">Chaos Monkey</a>, supposedly running 24/7, taking down their resources and pushing them to the limit continuously; it almost sounds counter-intuitive – but it&#x27;s not.</p>
<blockquote>
<p>Chaos engineering is defined as “the discipline of experimenting on a system in order to build confidence in the system’s capability to withstand turbulent conditions in production” (Principles of Chaos Engineering, <a href="http://principlesofchaos.org/" target="_blank" rel="noopener noreferrer" title="http://principlesofchaos.org/">http://principlesofchaos.org/</a>). In other words, it’s a software testing method focusing on finding evidence of problems before they are experienced by users.</p>
<p>Chaos engineering is a methodology that helps developers attain consistent reliability by hardening services against failures in production. Another way to think about chaos engineering is that it&#x27;s about embracing the inherent chaos in complex systems and, through experimentation, growing confidence in your solution&#x27;s ability to handle it.</p>
<p>A common way to introduce chaos is to deliberately inject faults that cause system components to fail. The goal is to observe, monitor, respond to, and improve your system&#x27;s reliability under adverse circumstances. For example, taking dependencies offline (stopping API apps, shutting down VMs, etc.), restricting access (enabling firewall rules, changing connection strings, etc.), or forcing failover (database level, Front Door, etc.), is a good way to validate that the application is able to handle faults gracefully.</p>
</blockquote>
<p>Introducing controlled Chaos tools such as Chaos Monkey and now – <a href="https://azure.microsoft.com/en-us/services/chaos-studio/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Chaos Studio</a> allows you to put pressure and, in some cases, take down your services to teach you how your services will react under strain and identity areas of improvement as resiliency and scalability to improve your systems.</p>
<p><img decoding="async" loading="lazy" alt="Chaos" src="/assets/images/chaosengineering-banner-0929ef3aa12bf5e4832160ff75a00b4b.png" title="Chaos" width="2400" height="700" class="img_ev3q"></p>
<p>Azure Chaos Studio <em>(currently in Preview and only supported in several</em> <a href="https://azure.microsoft.com/en-us/global-infrastructure/services/?products=chaos-studio&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer"><em>regions</em></a><em>now)</em> is an enabler for &#x27;controlled Chaos&#x27; in the Microsoft Azure ecosystem. Using that same tool that Microsoft uses to test and improve their services – you can as well!</p>
<p>Chaos Studio works by creating Experiments <em>(i.e., Faults/Capabilities)</em> that run against Targets <em>(your resources, whether they are agent or service-based)</em>.</p>
<p>There are two types of methods you can use to target your resources:</p>
<ul>
<li>Service-direct</li>
<li>Agent-based</li>
</ul>
<p>Service-direct is tied into the Azure fabric and puts pressure on your resources from outside them <em>(i.e., supported on most resources that don&#x27;t need agent-based, PaaS resources, such as Network Security Groups).</em> For example, a service-direct capability may be to add or remove a security rule from your network security group for faulty findings.</p>
<p>Agent-based relies on an agent installed; these are targeted at resources such as Virtual Machine and Virtual Machine scale sets; agent-based targets use a user-assigned managed identity to manage an agent on your virtual machines and wreak havoc by running capabilities such as stopping services and putting memory and disk pressure on your workloads.</p>
<p>Just a word of warning, before you proceed to allow Chaos to reign in your environment, make sure it is done out of hours or, better yet – against development or test resources, also make sure that any resources that support autoscaling are disabled – or you might suddenly find ten more instances of that resource you were running <em>(unless of course you&#x27;re testing that autoscaling is working)</em>! 😊</p>
<p>In my test setup, I have the following already pre-created that I will be running my experiments against:</p>
<ul>
<li>Virtual Machine Scale set <em>(running Windows with two instances)</em></li>
<li>Single Virtual Machine <em>(running Windows)</em> to test shutdown against</li>
</ul>
<p>The currently supported resource types of Azure Chaos Studio can be found &#x27;<a href="https://learn.microsoft.com/en-us/azure/chaos-studio/chaos-studio-fault-providers?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">here</a>&#x27;.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-chaos-studio">Setup Azure Chaos Studio<a href="#setup-azure-chaos-studio" class="hash-link" aria-label="Direct link to Setup Azure Chaos Studio" title="Direct link to Setup Azure Chaos Studio">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-managed-identity">Create Managed Identity<a href="#create-managed-identity" class="hash-link" aria-label="Direct link to Create Managed Identity" title="Direct link to Create Managed Identity">​</a></h4>
<p>Because we will use Agent-based capabilities to generate our Faults, I needed to create a Managed Identity to give Chaos Studio the ability to wreak havoc on my resources!</p>
<ol>
<li>In the <strong>Azure Portal,</strong> search for <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.ManagedIdentity%2FuserAssignedIdentities" target="_blank" rel="noopener noreferrer"><strong>Managed Identities</strong></a></li>
<li>Click on <strong>Create</strong></li>
<li><strong>Select</strong> the <strong>subscrSubscription</strong>ng the resources that you want to test against</li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to place the managed identity in (<em>I suggest creating a new Resource Group, as your Chaos experiments may have a different lifecycle than your resources, but it&#x27;s just a preference, I will be placing mine in the Chaos Studio resource group so I can quickly delete it later)</em>.</li>
<li><strong>Select</strong> the <strong>RegionRegion</strong>ur resources</li>
<li>Type in a <strong>name</strong> (<em>this will be the identity that you will see in logs running these experiments, so make sure its something you can identify with)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create User Management Identity" src="/assets/images/azure_userassignedmanageidentity-8f2cdc8b86ee1f35091c9270a3061f5a.png" title="Azure Portal - Create User Management Identity" width="602" height="347" class="img_ev3q"></li>
<li>Click <strong>Next: Tags</strong></li>
<li>Make sure you enter appropriate tags to make sure that the resource can be identified and tracked, and click <strong>Review + Create</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal Tags" src="/assets/images/azuretags_chaos-3882e50f463cdfc7bb84fb50a0845993.png" title="Azure Portal Tags" width="602" height="238" class="img_ev3q"></li>
<li>Verify that everything looks good and click <strong>Create</strong> to create your User Assigned Managed identity.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-application-insights">Create Application Insights<a href="#create-application-insights" class="hash-link" aria-label="Direct link to Create Application Insights" title="Direct link to Create Application Insights">​</a></h4>
<p>Now, it&#x27;s time to create an Application Insights resource. Applications Insights is for the logs of the experiments to go into, so you can see the faults and their behaviours.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, search for <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.insights%2Fcomponents" target="_blank" rel="noopener noreferrer"><strong>Application Insights</strong></a></li>
<li>Click on <strong>Create</strong></li>
<li><strong>Select</strong> the <strong>Subscription</strong> the resources that you want to test against</li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to place the Application Insights resource into (<em>I suggest creating a new Resource Group, as your Chaos experiments may have a different lifecycle than your resources, but it&#x27;s just a preference, I will be placing mine in the Chaos Studio resource group so I can easily delete it later)</em>.</li>
<li><strong>Select</strong> the <strong>Region</strong> the resources are in</li>
<li>Type in a <strong>name</strong></li>
<li><strong>Select</strong> your <strong>Log Analytics workspace</strong> you want to link Application Insights to <em>(if you don&#x27;t have a Log Analytics workspace, you can create one &#x27;</em><a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.OperationalInsights%2Fworkspaces" target="_blank" rel="noopener noreferrer"><em>here</em></a><em>&#x27;)</em>.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Application Insights" src="/assets/images/azure_applicationinsights-c4676bae524a9a2cafbeaa8ed778cc01.png" title="Azure Portal - Application Insightsv" width="602" height="520" class="img_ev3q"></li>
<li>Click <strong>Tags</strong></li>
<li>Make sure you <strong>enter appropriate tags</strong> to make sure that the resource can be identified and tracked, and click <strong>Review + Create</strong></li>
<li>Verify that everything looks good and click <strong>Create</strong> to create your Application Insights.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-chaos-studio-targets">Setup Chaos Studio Targets<a href="#setup-chaos-studio-targets" class="hash-link" aria-label="Direct link to Setup Chaos Studio Targets" title="Direct link to Setup Chaos Studio Targets">​</a></h4>
<p>It is now time to add the resources targets to Chaos Studio</p>
<ol>
<li>In the <strong>Azure Portal</strong>, search for <a href="https://portal.azure.com/#blade/Microsoft_Azure_Chaos/ChaosStudioMenuBlade/overview" target="_blank" rel="noopener noreferrer"><strong>Chaos Studio</strong></a></li>
<li>On the left band side Blade, select <strong>Targets</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio" src="/assets/images/azure_chaosstudio_targets-989d1638d9ab55b2a648197eb570d72f.png" title="Azure Chaos Studio" width="602" height="125" class="img_ev3q"></li>
<li>As you can see, I have a Virtual Machine Scale Set and a front-end Network Security Group.</li>
<li><strong>Select</strong> the <strong>checkbox</strong> next to Name to <strong>select all</strong> the Resources</li>
<li>Select <strong>Enable Targets</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio" src="/assets/images/azure_chaosstudio_targets2-52ce0a064e8a54465447a2997047630b.png" title="Azure Chaos Studio" width="602" height="106" class="img_ev3q"></li>
<li>Select <strong>Enable service-direct targets (All resources)</strong></li>
<li>Enabling the service-direct targets will then add the capabilities supported by Service-direct targets into Chaos Studio for you to use.</li>
<li>Once completed, I will <strong>select</strong> the scale set and click <strong>Enable Target</strong></li>
<li>Then finally, <strong>Enable agent-based targets (VM, VMSS)</strong></li>
<li>This is where you link the user-managed identity, and Application Insights created earlier</li>
<li><strong>Select</strong> your <strong>Subscription</strong></li>
<li>Select your <strong>managed identity</strong></li>
<li>Select Enabled for Application Insights and select your Application Insights account. The instrumentation key should be selected manually.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio - Enable targets" src="/assets/images/azure_chaosstudio_enableagenttargets-620b1ddfd69c44193fff354eaca7ceb8.png" title="Azure Chaos Studio - Enable targets" width="602" height="584" class="img_ev3q"></li>
<li><em>If your instrumentation key isn&#x27;t filled in, you can find it on the Overview pane of the Application Insights resource.</em></li>
<li>Click <strong>Review + Enable</strong></li>
<li><strong>Review</strong> the <strong>resources</strong> you want to enable Chaos Studio to target and select <strong>Enable</strong></li>
<li>Finally, you should now be back at the Targets pane make sure you select Manage actions and make sure that all actions are ticked and click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio Capabilities" src="/assets/images/azurechaosactions-1af7db09581d9982ae10818aa1075db4.png" title="Azure Chaos Studio Capabilities" width="829" height="679" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-and-run-azure-chaos-studio">Configure and run Azure Chaos Studio<a href="#configure-and-run-azure-chaos-studio" class="hash-link" aria-label="Direct link to Configure and run Azure Chaos Studio" title="Direct link to Configure and run Azure Chaos Studio">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="action-exclusions">Action exclusions<a href="#action-exclusions" class="hash-link" aria-label="Direct link to Action exclusions" title="Direct link to Action exclusions">​</a></h4>
<p>There may be actions that you don&#x27;t want to be run against specific resources; an example might be you don&#x27;t want anyone to kill any processes on a Virtual Machine.</p>
<ol>
<li>In the Target pane of Chaos Studio, select <strong>Actions</strong> next to the resource</li>
<li><strong>Unselect</strong> the <strong>capability</strong> you don&#x27;t want to run on that resource</li>
<li>Select <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio Actions" src="/assets/images/azure_chaosstudio_manageactions-5786b1de8eca578ccac4c06c5e680398.png" title="Azure Chaos Studio - Enable targets" width="602" height="641" class="img_ev3q"></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-experiments">Configure Experiments<a href="#configure-experiments" class="hash-link" aria-label="Direct link to Configure Experiments" title="Direct link to Configure Experiments">​</a></h4>
<p>An experiment is a collection of capabilities to create faults, put pressure on your resources, and cause Chaos that will run against your target resources. These experiments are saved so you can run them multiple times and edit them later, although currently, you cannot reassign the same experiments to other resources.</p>
<p>Note: If you name an Experiment the same as another experiment, it will replace the older Experiment with your new one and retain the previous history.</p>
<ol>
<li>In the <strong>Azure Portal,</strong> search for <a href="https://portal.azure.com/#blade/Microsoft_Azure_Chaos/ChaosStudioMenuBlade/overview" target="_blank" rel="noopener noreferrer"><strong>Chaos Studio</strong></a>.</li>
<li>On the left band side Blade, select <strong>Experiments</strong></li>
<li>Click <strong>+ Create</strong></li>
<li><strong>Select</strong> your <strong>Subscription</strong></li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to save the Experiment into</li>
<li><strong>Type</strong> in a <strong>name</strong> for your <strong>Experiment</strong> that makes sense; in this case, we will put some Memory pressure on the VM scale set.</li>
<li><strong>Select</strong> your <strong>Region</strong></li>
<li>Click <strong>Next: Experiment Designer</strong></li>
<li><strong>Using</strong> Experiment <strong>Designer</strong>, you can <strong>design</strong> your <strong>Faults</strong>; you can have multiple capabilities hit a resource with expected delays, <em>i.e., you can have Memory pressure on a VM for 10 minutes, then CPU pressure, then shutdown.</em></li>
<li>We are going to select <strong>Add Action</strong></li>
<li>Then <strong>Add Fault</strong></li>
<li>I am going to select <strong>Physical Memory</strong> pressure</li>
<li>Leave the duration to <strong>10 minutes</strong></li>
<li>Because this will go against my VM scale set, I will add in the instances I want to target <em>(if you aren&#x27;t targeting a VM Scale set, you can leave this blank, you can find the instance ID by going to your VM Scale set click on Instances, click on the VM instance you want to target and you should see the Instance ID in the Overview pane)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio - Add fault" src="/assets/images/azure_chaosstudio_createexperimentaddfault-f6ff8fd1cfc8dab21fb1bcb99813e20d.png" title="Azure Chaos Studio - Add fault" width="602" height="441" class="img_ev3q"></li>
<li>Select <strong>Next: Target resources</strong></li>
<li><strong>Select</strong> your <strong>resources</strong> <em>(you will notice as this is an Agent-based capability, only agent supported resources are listed)</em></li>
<li>Select <strong>Add</strong></li>
<li>I am then going to <strong>Add delay for 5 Minutes</strong></li>
<li>Then add an <strong>abrupt VM shutdown</strong> for 10 minutes <em>(Chaos Studio will automatically restart the VM after the 10-minute duration)</em>.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio create experiment" src="/assets/images/azure_chaosstudio_createexperimentaddfault2-ab12282d4c3801eb941de223ee7bc627.png" title="Azure Chaos Studio create experiment" width="602" height="266" class="img_ev3q"></li>
<li>As you can see with the Branches <em>(items that will run in parallel)</em> and actions, you can have multiple faults running at once in parallel by using branches or one after the other sequentially.</li>
<li>Now that we are ready with our faulty, we are going to click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><em>Note: I had an API error; after some investigation, I found it was having problems with the &#x27;?&#x27; in my experiment name, so I removed it and continued to create the Experiment.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="assign-permissions-for-the-experiments">Assign permissions for the Experiments<a href="#assign-permissions-for-the-experiments" class="hash-link" aria-label="Direct link to Assign permissions for the Experiments" title="Direct link to Assign permissions for the Experiments">​</a></h4>
<p>Now that the Experiment has been created, we need to give rights to the Managed User account created earlier <em>(and/or the System managed identity that was created when the Experiment was created for service-direct experiments)</em>.</p>
<p>I will assign permissions to the Resource Group that the VM Scale set exists in, but you might be better off applying the rights to the individual resource for more granular control. You can see suggested roles to give resources: <a href="https://learn.microsoft.com/en-us/azure/chaos-studio/chaos-studio-fault-providers?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Supported resource types and role assignments for the Chaos Studio</a> Microsoft page.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, click on the <strong>Resource Group</strong> containing the resources you want to run the Experiment against</li>
<li>Select <strong>Access control (IAM)</strong></li>
<li>Click <strong>+ Add</strong></li>
<li>Click <strong>Add Role Assignment</strong></li>
<li>Click <strong>Reader</strong></li>
<li>Click <strong>Next</strong></li>
<li>Select <strong>Assign access to Managed identity</strong></li>
<li>Click on <strong>+ Select Members</strong></li>
<li><strong>Select</strong> the <strong>User</strong> assigned <strong>management identity</strong></li>
<li>Click <strong>Review</strong> and <strong>assign</strong>.</li>
<li>Because the shutdown is a service-direct, <strong>go back and give the experiment system managed identity Virtual Machine Contributor rights</strong>, so it has access to shutdown the VM.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="run-experiments">Run Experiments<a href="#run-experiments" class="hash-link" aria-label="Direct link to Run Experiments" title="Direct link to Run Experiments">​</a></h4>
<p>Now that the Experiment has been created, it should appear as a resource in the resource group you selected earlier; if you open it, you can see the Experiment&#x27;s History, Start, and Edit buttons.</p>
<ol>
<li>Click <strong>Start</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos studio - Run experiment" src="/assets/images/azure_chaosstudio_whatmemory-09151c403439e67c1de46401589b3418.png" title="Azure Chaos studio - Run experiment" width="602" height="145" class="img_ev3q"></li>
<li>Click <strong>Ok</strong> to <strong>start</strong> the <strong>Experiment</strong> <em>(and place it into the queue)</em></li>
<li><strong>Click</strong> on <strong>Details</strong> to see the <strong>experiment progress</strong> <em>(and any errors)</em>, and if it fails one part, it may move to the next step depending on the fault.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos studio - Run experiment" src="/assets/images/azure_chaosstudio_whatmemoryrun-1bac1d245af3399c523a6792dea66041.png" title="Azure Chaos studio - Run experiment" width="602" height="346" class="img_ev3q"></li>
<li><strong>Azure Chaos studio should now run rampant and do best – cause Chaos</strong>!</li>
</ol>
<p>This service is still currently in Preview. If you have any issues, take a look at the: <a href="https://learn.microsoft.com/en-us/azure/chaos-studio/troubleshooting" target="_blank" rel="noopener noreferrer">Troubleshoot issues with Azure Chaos Studio</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-and-auditing-of-azure-chaos-studio">Monitor and Auditing of Azure Chaos Studio<a href="#monitor-and-auditing-of-azure-chaos-studio" class="hash-link" aria-label="Direct link to Monitor and Auditing of Azure Chaos Studio" title="Direct link to Monitor and Auditing of Azure Chaos Studio">​</a></h3>
<p>Now that Azure Chaos Studio is in use by your organization, you may want to know what auditing is available, along with reporting to Application Insights.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="azure-activity-log">Azure Activity Log<a href="#azure-activity-log" class="hash-link" aria-label="Direct link to Azure Activity Log" title="Direct link to Azure Activity Log">​</a></h4>
<p>When an Azure Chaos Studio experiment has touched a resource, there will be an audit trail in the Azure activity log of that resource; here, you can see that &#x27;WhatMemory&#x27;, which is the Name of my Chaos Experiment, has successfully powered off and on my VM.</p>
<p><img decoding="async" loading="lazy" alt="Azure Activity Log - Azure Chaos Studio" src="/assets/images/azure_chaosstudio_activitylog-27476f7626f821f811db0174c941c034.png" title="Azure Activity Log - Azure Chaos Studio" width="602" height="56" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="azure-alerts">Azure Alerts<a href="#azure-alerts" class="hash-link" aria-label="Direct link to Azure Alerts" title="Direct link to Azure Alerts">​</a></h4>
<p>It is easy to set up alerts when a Chaos experiment kicks off; to create an Azure, do the following.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, click on <strong>Azure Monito</strong>r</li>
<li>Click on <strong>Alerts</strong></li>
<li>Click <strong>+ Create</strong></li>
<li>Select <strong>Alert Rule</strong></li>
<li>Click <strong>Create resource</strong></li>
<li><strong>Filter</strong> your resource <strong>type</strong> to <strong>Chaos Experiments</strong></li>
<li><strong>Filter</strong> your <strong>alert</strong> to <strong>Subscription</strong> and click <strong>Done</strong></li>
<li>Click <strong>Add Condition</strong></li>
<li>Select: <strong>Starts a Chaos Experiment</strong></li>
<li>Make sure that: *<em>Event initiated by is set to (All services and users)</em></li>
<li>Click <strong>Done</strong></li>
<li>Click <strong>Add Action Group</strong></li>
<li>If you have one, <strong>assign</strong> an <strong>action group</strong> <em>(these are who and how the alerts will get to you)</em>. If you don&#x27;t have one, click: <strong>+ Create an action group</strong>.</li>
<li><strong>Specify</strong> a resource <strong>group</strong> to hold your action groups <em>(usually a monitor or management resource group)</em></li>
<li>Type the <strong>Action Group name</strong></li>
<li>Type the <strong>Action group Display name</strong></li>
<li>Click <strong>Next: Notifications</strong></li>
<li>Select <strong>Notification Type</strong></li>
<li>Select <strong>email</strong></li>
<li>Select <strong>Email</strong></li>
<li><strong>Type</strong> in your <strong>email</strong> address to be notified</li>
<li>Click <strong>ok</strong></li>
<li><strong>Type</strong> in the <strong>Name</strong> of the <strong>mail</strong> to be a reference in the future <em>(i.e. Help Desk)</em></li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong> to create your Action group</li>
<li>Type in your <strong>rule name</strong> <em>(i.e. Alert – Chaos Experiment – Started)</em></li>
<li>Type in a <strong>description</strong></li>
<li><strong>Specify</strong> the <strong>resource group</strong> to place the alert in <em>(again, usually a monitor or management resource group)</em></li>
<li>Check <strong>Enable alert rule on creation</strong></li>
<li>Click <strong>Create alert rule</strong></li>
</ol>
<p><em>Note: Activity Log alerts are hidden types; they are not shown in the resource group by default, but if you check the: Show hidden types box, they will appear.</em></p>
<p><img decoding="async" loading="lazy" alt="Azure Activity Log - Azure Chaos Studio" src="/assets/images/azure_chaosstudio_alert-9d90704feb648ce05039987b32de9c97.png" title="Azure Activity Log - Azure Chaos Studio" width="602" height="48" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-active-directory-application-proxy-implementation/">Microsoft Entra ID Application Proxy Implementation</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-02T11:00:00.000Z">January 2, 2022</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Are you running internal web-based applications that you want to give access to users working remotely securely without the need for a VPN or firewall? Do you want to enforce or use Azure Conditional Access policies to protect and manage access?</p>
<p>Let me introduce the Microsoft Microsoft Entra ID Application Proxy...</p>
<blockquote>
<p>Application Proxy is a feature of Azure AD that enables users to access on-premises web applications from a remote client. Application Proxy includes both the Application Proxy service which runs in the cloud, and the Application Proxy connector, which runs on an on-premises server. Azure AD, the Application Proxy service, and the Application Proxy connector work together to securely pass the user sign-on token from Azure AD to the web application. Application Proxy also supports single sign-on.</p>
<p>Application Proxy is recommended for giving remote users access to internal resources. Application Proxy replaces the need for a VPN or reverse proxy.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>The <a href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/what-is-application-proxy?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Microsoft Entra ID Application Proxy</a>has been around for a few years, but appears to be a hidden gem; the Application Proxy allows users_(by using Microsoft Entra ID and an Application Proxy Connector(s))_ to connect to internally hosted web applications, by the connector relaying the traffic.</p>
<p><img decoding="async" loading="lazy" alt="Azure Application Proxy - Network Diagram" src="/assets/images/aadproxynetworkdiagram-2d5765b62500f7d92259285b4c784c9a.png" title="Azure Application Proxy - Network Diagram" width="602" height="504" class="img_ev3q"></p>
<p>Application Proxy supports the following types of applications:</p>
<ul>
<li>Web applications</li>
<li>Web APIs that you want to expose to rich applications on different devices</li>
<li>Applications hosted behind a Remote Desktop Gateway</li>
<li>Rich client apps that are integrated with the Microsoft Authentication Library (MSAL)</li>
</ul>
<p>Azure Application Proxy can often be overlooked to solve your business requirements without the need to implement costly third-party firewalls <em>(it also doesn&#x27;t have to be an on-premises workload, for example, if the web application is running on a VM in Azure, it will also work)</em>.</p>
<p>The Azure Application proxy connector is a lightweight agent installed on a Windows Server machine that is logically close to the backend service that you want to deliver through the proxy.</p>
<p>The Connector gives access to and relays the information to the Application proxy service in Microsoft Azure via HTTP/HTTPS as long as it has access to the following:</p>






























<table><thead><tr><th>URL</th><th>Port</th><th>How it&#x27;s used</th></tr></thead><tbody><tr><td>*.msappproxy.net  *.servicebus.windows.net</td><td>443/HTTPS</td><td>Communication between the connector and the Application Proxy cloud service</td></tr><tr><td>crl3.digicert.com  crl4.digicert.com  ocsp.digicert.com  crl.microsoft.com  oneocsp.microsoft.com  ocsp.msocsp.com</td><td>80/HTTP</td><td>The connector uses these URLs to verify certificates.</td></tr><tr><td>login.windows.net  secure.aadcdn.microsoftonline-p.com  *.microsoftonline.com  *.microsoftonline-p.com  *.msauth.net  *.msauthimages.net  *.msecnd.net  *.msftauth.net  *.msftauthimages.net  *.phonefactor.net  enterpriseregistration.windows.net  management.azure.com  policykeyservice.dc.ad.msft.net  ctldl.windowsupdate.com  <a href="http://www.microsoft.com/pkiops" target="_blank" rel="noopener noreferrer">www.microsoft.com/pkiops</a></td><td>443/HTTPS</td><td>The connector uses these URLs during the registration process.</td></tr><tr><td>ctldl.windowsupdate.com</td><td>80/HTTP</td><td>The connector uses this URL during the registration process.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-application-proxy">Setup Azure Application Proxy<a href="#setup-azure-application-proxy" class="hash-link" aria-label="Direct link to Setup Azure Application Proxy" title="Direct link to Setup Azure Application Proxy">​</a></h2>
<p>I will set up an Azure Application Proxy to grant access to my Synology NAS <em>(Network Attached Storage)</em> device web page in this guide.</p>
<p>Although I am using my local NAS web administration page, it can be any webpage <em>(Unifi Controller, hosted on Apache, IIS etc.)</em> accessible from the connector.</p>
<ul>
<li>I have a Windows Server 2022 Domain Controller.</li>
<li>Synology NAS <em>(not domain joined, but accessible on the network via a DNS record from the domain)</em></li>
<li>Microsoft 365 Developer subscription with appropriate licenses</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites-for-azure-application-proxy-setup">Pre-requisites for Azure Application Proxy setup<a href="#pre-requisites-for-azure-application-proxy-setup" class="hash-link" aria-label="Direct link to Pre-requisites for Azure Application Proxy setup" title="Direct link to Pre-requisites for Azure Application Proxy setup">​</a></h3>
<p>The following resources and rights will be needed to set up Azure Application Proxy:</p>
<ul>
<li>An Microsoft Entra ID tenant</li>
<li>A minimum of Application Administrator rights is required to set up the Application and user and group assignments.</li>
<li>A server running Windows Server 2012 R2 or above to install the Application Proxy connector on (and the permissions to install)</li>
<li>If you are using a third-party domain <em>(you will need a public SSL certificate)</em> and, of course, the ability to edit external DNS records, the domain will need to be added to Microsoft Entra ID as a custom domain in order to be used.</li>
<li>Microsoft Entra ID Premium P1 license or M365 Business Premium/E3 license for each user using Microsoft Entra ID Application Proxy.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Microsoft Entra ID Application Proxy Licensing" src="/assets/images/aadproxylicensing-bda70e279c4daf764b4e2b22e93233e9.png" title="Microsoft Entra ID Application Proxy Licensing" width="633" height="55" class="img_ev3q"></p>
<p><em>(Note: Normal <a href="https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/directory-service-limits-restrictions?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure AD service limits</a> and restrictions apply)</em>.</p>
<p>I will be configuring the Azure Application Proxy on a domain controller running Windows Server 2022.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disable-ie-enhanced-security-configuration">Disable IE Enhanced Security Configuration<a href="#disable-ie-enhanced-security-configuration" class="hash-link" aria-label="Direct link to Disable IE Enhanced Security Configuration" title="Direct link to Disable IE Enhanced Security Configuration">​</a></h3>
<p>The Azure Application Proxy connector requires you to log in to Microsoft Azure, and I will be installing this on a Windows Server 2022 domain controller; if this Enhanced Security Configuration is enabled <em>(as it should be),</em> you will have problems authenticating to Microsoft Azure, so the easiest thing is to turn it off temporarily.</p>
<ol>
<li>Open <strong>Server Manager</strong></li>
<li>Click on <strong>Local Server</strong></li>
<li>Click on: <strong>IE Enhanced Security Configuration</strong></li>
<li>Select Off for: <strong>Administrators</strong></li>
<li><strong>Close</strong> Microsoft <strong>Edge</strong> <em>(if you have it opened)</em></li>
<li><img decoding="async" loading="lazy" alt="Disable IE Enhanced Security Configuration" src="/assets/images/disable_ie_enhancedconfiguration-ecc7f2fdbacc3ea58762a88de73ba352.png" title="Disable IE Enhanced Security Configuration" width="583" height="482" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-azure-application-proxy-connector">Install Azure Application Proxy Connector<a href="#install-azure-application-proxy-connector" class="hash-link" aria-label="Direct link to Install Azure Application Proxy Connector" title="Direct link to Install Azure Application Proxy Connector">​</a></h3>
<ol>
<li>Login to <strong>Azure Portal</strong> <em>(on the server that you want to install the Connector on)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <strong>Application Proxy</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Application Proxy" src="/assets/images/azureportal-applicationproxy-86f9196860d71d2c19d3c4ccfa961650.png" title="Azure Portal - Application Proxy" width="602" height="313" class="img_ev3q"></li>
<li>Click on: <strong>Download connector service</strong>.</li>
<li>Accept the system requirements and click <strong>Accept Terms &amp; Download</strong></li>
<li>A file named: &#x27;AADApplicationProxyConnectorInstaller.exe&#x27; should have been downloaded. <strong>Run</strong> it.</li>
<li>Select: <strong>I agree to the license terms and conditions</strong> and select <strong>Install</strong></li>
<li><img decoding="async" loading="lazy" alt="Microsoft Microsoft Entra ID Application Proxy Connector Installation" src="/assets/images/microsoftazureapplicationproxyconnector-c2f1a096f171f271ab2c9a6e8b45e02a.png" title="Microsoft Microsoft Entra ID Application Proxy Connector Installation" width="493" height="348" class="img_ev3q"></li>
<li>Wait for the Microsoft Microsoft Entra ID Application to display and <strong>log in</strong> with an Microsoft Entra ID account with Application Administrator rights.</li>
<li>The Microsoft Microsoft Entra ID Application <strong>Connector will now</strong> be <strong>registered</strong> in your Microsoft Entra ID tenancy.</li>
<li><img decoding="async" loading="lazy" alt="Microsoft Microsoft Entra ID Application Proxy Connector Installation" src="/assets/images/microsoftazureapplicationproxyconnectorinstalled-61d6ed3714b23ac1900054990e10f310.png" title="Microsoft Microsoft Entra ID Application Proxy Connector Installation" width="491" height="343" class="img_ev3q"></li>
<li>Click <strong>Close</strong></li>
<li>Now <strong>re-enable IE enhanced security configuration</strong>.</li>
</ol>
<p>You should now see two new services appear in services as Automatic (Delayed Start):</p>
<ul>
<li>WAPCsvc - Microsoft AAD Application Proxy Connector</li>
<li>WAPCUpdaterSvc - Microsoft AAD Application Proxy Connector Updater</li>
</ul>
<p>And the following processes running:</p>
<ul>
<li>ApplicationProxyConnectorService</li>
<li>ApplicationProxyConnectorUpdateService</li>
</ul>
<p><img decoding="async" loading="lazy" alt="ApplicationProxyConnectorService" src="/assets/images/azureaadapplicationservices-44038a6b932081da6451e4fa70622052.png" title="ApplicationProxyConnectorService" width="602" height="173" class="img_ev3q"></p>
<p>If you are running Server Core, Microsoft Microsoft Entra ID Application Proxy can be installed via <a href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy-register-connector-powershell?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">PowerShell</a>.</p>
<p>The Azure Application Proxy Connector agent gets <a href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy-faq?WT.mc_id=AZ-MVP-5004796#why-is-my-connector-still-using-an-older-version-and-not-auto-upgraded-to-latest-version-" target="_blank" rel="noopener noreferrer">updated</a> automatically when a new major version is released by Microsoft.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-connector-group">Configure Connector Group<a href="#configure-connector-group" class="hash-link" aria-label="Direct link to Configure Connector Group" title="Direct link to Configure Connector Group">​</a></h3>
<p>Now that you have created the Connector, the Application Proxy has put our Connector in a group that has defaulted to Asia; because you can have more than one Application Proxy Connector for redundancy and different applications, we will create a new Connector Group that is set to use the Australia region if Asia works for you – feel free to skip this step.</p>
<ol>
<li>Login to <strong>Azure Portal</strong> <em>(on any PC/server)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <strong>Application Proxy</strong></li>
<li>You should now see: Default and your Region</li>
<li>If you <strong>expand</strong> the Default <strong>Group</strong>, will you see your Connector:</li>
<li><img decoding="async" loading="lazy" alt="Azure AD Application Proxy Connector Groups" src="/assets/images/azureportal-applicationproxyconnector-56f8578ab1b3a34309b53d160f93e878.png" title="Azure AD Application Proxy Connector Groups" width="602" height="151" class="img_ev3q"></li>
<li>Click on <strong>+ New Connector Group</strong></li>
<li>Give it a <strong>name</strong> <em>(i.e., On-premises</em>)</li>
<li><strong>Select</strong> the <strong>Connector</strong> you had earlier and <strong>select the</strong> region closest to you <em>(currently, the following regions can be chosen: Asia, Australia, Europe, North America)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure AD Application Proxy - New Connector Group" src="/assets/images/azureportal-applicationproxynewconnectorgroup-af685c5de5ec636fd2a720195010423a.png" title="Azure AD Application Proxy - New Connector Group" width="418" height="470" class="img_ev3q"></li>
<li><strong>Click + Create</strong></li>
<li>Clicking create will create your new On-premises connector group and add the Connector to the group.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-your-azure-application-proxy-application">Configure your Azure Application Proxy Application<a href="#configure-your-azure-application-proxy-application" class="hash-link" aria-label="Direct link to Configure your Azure Application Proxy Application" title="Direct link to Configure your Azure Application Proxy Application">​</a></h3>
<p>Now that you have your Connector setup, its time to set up your application</p>
<ol>
<li>Login to <strong>Azure Portal</strong> <em>(on any PC/server)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <strong>Application Proxy</strong></li>
<li>Click on: <strong>+ Configure an app</strong></li>
<li><strong>Fill</strong> in the <strong>details</strong> that match your <strong>application</strong>:</li>
</ol>
<ul>
<li><strong>Name</strong>: This is the application that users will see <em>(i.e. I am going with Pizza, which is the name of my NAS)</em></li>
<li><strong>Internal URL</strong>: This is the internal URL used to access your application inside the network <em>(in my example, it is:</em> <a href="http://pizza.corp.contoso.com/" target="_blank" rel="noopener noreferrer"><em>http://pizza.corp.contoso.com/</em></a><em>)</em></li>
<li><strong>External Url</strong>: This is the external URL that will be created so that users can access the application form; <em>I will go with Pizza.</em> Note this URL down.</li>
<li><strong>Pre-Authentication</strong>: You don&#x27;t have to authenticate with Azure AD, you can use passthrough, but it is not something I would recommend without delving into requirements, testing <em>– I am going to select: Microsoft Entra ID.</em></li>
<li><strong>Connector Group</strong>: Select the connector group you created earlier or that your Connector is signed to.</li>
<li><strong>Leave</strong> all <strong>Additional Settings as default</strong> – they can be changed later if you need to.
<ol>
<li><img decoding="async" loading="lazy" alt="Azure Application Proxy" src="/assets/images/azureportal-applicationproxynewapplication-7cbf63f59473a9b7f78b087eb198d7a4.png" width="602" height="435" class="img_ev3q"></li>
<li><strong>Verify</strong> that <strong>everything</strong> is filled out <strong>correctly</strong> and, click <strong>+ Add</strong></li>
<li>Azure <strong>Application Proxy has now created a new Enterprise Application for you</strong>; based on the name mentioned earlier, if you navigate to the external URL mentioned earlier, you should get a prompt similar to below:</li>
<li><img decoding="async" loading="lazy" alt="Azure AD Login Error" src="/assets/images/azureportal-pizzaloginerror-42785ab1e8d5408afaa8f43d233fe870.png" title="Azure AD Login Error" width="573" height="205" class="img_ev3q"></li>
<li>It is now time to assign the permissions for users to access the Application via Microsoft Entra ID!</li>
</ol>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="assign-rights-to-your-azure-application-proxy-application">Assign rights to your Azure Application Proxy Application<a href="#assign-rights-to-your-azure-application-proxy-application" class="hash-link" aria-label="Direct link to Assign rights to your Azure Application Proxy Application" title="Direct link to Assign rights to your Azure Application Proxy Application">​</a></h3>
<ol>
<li>Login to <strong>Azure Portal</strong> <em>(on any PC/server)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/" target="_blank" rel="noopener noreferrer"><strong>Enterprise Applications</strong></a></li>
<li><strong>Find</strong> the <strong>application</strong> that was <strong>created</strong> earlier by the Azure Application Proxy service.</li>
<li><img decoding="async" loading="lazy" alt="Microsoft Entra ID, Enterprise Application" src="/assets/images/azureportal-enterpriseapplicationspane-2de4247bb9234dde05d2671a5ec32782.png" title="Microsoft Entra ID, Enterprise Application" width="602" height="181" class="img_ev3q"></li>
<li>Click on the <strong>Application</strong></li>
<li>Click on: <strong>Users and Groups</strong></li>
<li>Click <strong>Add Assignment</strong></li>
<li><strong>Add</strong> a <strong>user</strong> or <strong>group</strong> <em>(preferred)</em> you want to have access to this application.</li>
<li>Click <strong>Assigned</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure AD Enterprise Applications - User &amp;amp; Group Assignment" src="/assets/images/azureportal-enterpriseapplicationsuserandgrpassignment-69d996be442fdced516b430831d8bd01.png" title="Azure AD Enterprise Applications - User &amp;amp; Group Assignment" width="602" height="164" class="img_ev3q"></li>
<li>Click on <strong>Application Proxy</strong></li>
<li>Here you can see and edit the information you created earlier when you created the application, <strong>copy</strong> the <strong>External URL</strong></li>
<li><strong>Open</strong> Microsoft <strong>Edge</strong> (<em>or another browser of your choice)</em></li>
<li><strong>Paste</strong> in the External <strong>URL</strong></li>
<li><strong>Log in</strong> with the Microsoft Entra ID <strong>account</strong> that was <strong>assigned</strong> to the Enterprise <strong>application.</strong></li>
<li>You should now have access to your on-premises web application from anywhere in the world, and because you are using Microsoft Entra ID, your conditional access policies and restrictions will be in effect:</li>
<li><img decoding="async" loading="lazy" alt="Synology Login" src="/assets/images/microsoftazureapplicationproxyloginscreen-fe39694a6d81ded2c515d3593bada620.png" title="Synology Login" width="602" height="366" class="img_ev3q"></li>
</ol>
<p><em>Note: Because the Synology web interface was running on port: 5000, I had to go back and add the port to the internal URL, as the Application Proxy was attempting to route to the incorrect port.</em>
<em>Note: You may also notice that Microsoft has supplied an *.msappproxy.net certificate, even if your backend service doesn&#x27;t have one..</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-password-based-single-sign-on">Setup Password-based Single-Sign on<a href="#setup-password-based-single-sign-on" class="hash-link" aria-label="Direct link to Setup Password-based Single-Sign on" title="Direct link to Setup Password-based Single-Sign on">​</a></h3>
<p>Azure Application Proxy supports various <a href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy-config-sso-how-to?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">single</a> sign-on methods, including Kerberos SPN integration.</p>
<p>However, my Synology NAS uses standalone accounts, so I will set Password-based single sign-on, allowing the MyApps extension to store my credentials <em>(if you want single-sign-on using the password-based sign in, then every user will need to have this extension configured)</em>.</p>
<ol>
<li>Download and install the <a href="https://microsoftedge.microsoft.com/addons/detail/my-apps-secure-signin-ex/gaaceiggkkiffbfdpmfapegoiohkiipl#:~:text=My%20Apps%20Secure%20Sign-in%20Extension.%20This%20extension%20is,to%20cloud%20applications%20within%20your%20organization%20or%20school." target="_blank" rel="noopener noreferrer"><strong>MyApps Secure Sign-in extension</strong></a></li>
<li><strong>Log</strong> in using your Microsoft account to the MyApps <strong>extension</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure App Proxy" src="data:image/png;base64,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" width="55" height="42" class="img_ev3q"></li>
<li><strong>Login</strong> to <strong>Azure Portal</strong> (<em>on any PC/server)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/" target="_blank" rel="noopener noreferrer"><strong>Enterprise Applications</strong></a></li>
<li><strong>Find</strong> the <strong>application</strong> that was created earlier by the Azure Application Proxy service.</li>
<li>Click on <strong>Single sign-on</strong></li>
<li>Select <strong>Password-based</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Single Signon" src="/assets/images/azureportal-appproxysso-787853e55af00ba7c8b93691b516313c.png" title="Azure Portal - Single Signon" width="602" height="330" class="img_ev3q"></li>
<li><strong>Type</strong> in the <strong>URL</strong> of the <strong>authentication webpage</strong> and click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure App Proxy" src="/assets/images/azureportal-appproxyssourl-5d42405a2a11ec8a734f62010a7cb9b1.png" width="602" height="177" class="img_ev3q"></li>
<li>The Azure AD Application Proxy didn&#x27;t find my sign-in login and password fields, so I have to manually configure them, select: <strong>Configure Pizza Password Single Sign-on Settings</strong>.</li>
<li>Select: <strong>Manually detect sign-in fields</strong></li>
<li>Select <strong>Capture sign-in fields</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Application Proxy - Configure Sign-on" src="/assets/images/azureportal-configuresignin-3690c855754ef80ac421487f34713026.png" title="Azure Application Proxy - Configure Sign-on" width="427" height="567" class="img_ev3q"></li>
<li>Your MS Edge Extension should show <strong>Capture Field</strong>:</li>
<li><img decoding="async" loading="lazy" alt="Azure Application Configure Extension" src="/assets/images/azureportal-configuresigninextension-a9373fc3fa8b9ce4efd87a8c26837697.png" title="Azure Application Configure Extension" width="602" height="368" class="img_ev3q"></li>
<li><strong>Enter</strong> in your <strong>username</strong></li>
<li>Press <strong>Enter</strong></li>
<li><strong>Enter</strong> in your <strong>password</strong></li>
<li><strong>Select</strong> the MS Apps <strong>extension</strong> and select <strong>Save</strong></li>
<li>Navigate back to the <strong>Azure Portal</strong></li>
<li>Select &#x27;<strong>I was able to sign in.&#x27;</strong></li>
<li>If successful, <strong>Azure AD should now have mapped the fields</strong>:</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Signin Fields" src="/assets/images/azureportal-configuresigninextensionfields-3bff6979c56060c8d3cde50e5410bad1.png" title="Azure Portal - Signin Fields" width="602" height="229" class="img_ev3q"></li>
<li>Click <strong>Save</strong></li>
<li>Next time you log in to the application, the <strong>My Apps Secure Sign-in Extension will have cached the credentials.</strong> It should automatically log you into the application, meaning you should only log in once with your Azure AD credentials.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-your-azure-application-proxy-published-application">Access your Azure Application Proxy published application<a href="#access-your-azure-application-proxy-published-application" class="hash-link" aria-label="Direct link to Access your Azure Application Proxy published application" title="Direct link to Access your Azure Application Proxy published application">​</a></h3>
<ol>
<li>You can now go to <a href="https://myapps.microsoft.com/" target="_blank" rel="noopener noreferrer"><strong>My Apps (microsoft.com)</strong></a>, and you will <strong>see</strong> your <strong>application</strong>.</li>
<li><img decoding="async" loading="lazy" alt="M365 Waffle" src="/assets/images/myapps-99da4d897267d11262df7e4934a5b15f.png" width="894" height="491" class="img_ev3q"></li>
<li>Your application will also <strong>appear</strong> in the <strong>Microsoft 365 Waffle</strong> <em>(it may take up to an hour to appear)</em>:</li>
<li><img decoding="async" loading="lazy" alt="M365 Waffle" src="/assets/images/m365waffle_pizza-b955afd467d7362d5928c3f61e63d073.png" width="310" height="742" class="img_ev3q"></li>
</ol>
<p>I recommend you go into the Enterprise Application and upload a better image/logo so your users can quickly tell it apart.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-bicep-and-insert-resource/">Azure Bicep and Insert Resource</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-29T00:00:00.000Z">December 29, 2021</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Azure Bicep is a Domain Specific Language (DSL) for deploying Azure resources declaratively. Azure Bicep is a transparent abstraction over ARM and ARM templates, which means anything that can be done in an ARM Template can be done in Bicep.</p>
<p>Azure Bicep has recently <em>(December 2021)</em> been updated to: v0.4.1124, along with various other hotfixes and enhancements; this version supports &#x27;Insert Resource&#x27; functionality.</p>
<p>Insert Resource simplifies ARM to Bicep conversion without exporting entire ARM templates, then compiles them to Bicep when you are only after export for a single resource.</p>
<p>To use Insert Resource, you will need to have:</p>
<ul>
<li>Bicep version greater than v0.4.1124</li>
<li>Azure CLI</li>
<li>Visual Studio Code with the Bicep extension</li>
</ul>
<p>You can easily install both or upgrade following the Microsoft documentation on the: <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/install?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Install Bicep tools</a> page.
You can also review the Bicep changes and latest release notes on Github here: <a href="https://github.com/Azure/bicep/releases" target="_blank" rel="noopener noreferrer">Azure Bicep releases</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="import-resources-into-bicep-using-azure-cli-and-bicep">Import Resources into Bicep using Azure CLI and Bicep<a href="#import-resources-into-bicep-using-azure-cli-and-bicep" class="hash-link" aria-label="Direct link to Import Resources into Bicep using Azure CLI and Bicep" title="Direct link to Import Resources into Bicep using Azure CLI and Bicep">​</a></h4>
<ol>
<li>Open a new file in <strong>Visual Studio Code</strong></li>
<li>Set the Language mode to <strong>Bicep</strong></li>
<li><img decoding="async" loading="lazy" alt="Visual Studio Code - Bicep" src="data:image/png;base64,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" title="Visual Studio Code - Bicep" width="602" height="69" class="img_ev3q"></li>
<li>Now we need to <strong>login</strong> to <strong>Azure</strong>; in Visual Studio code, click <strong>View</strong> and <strong>Terminal.</strong></li>
<li>In the terminal, type in: <strong>az login</strong></li>
<li>Login to Azure using the credentials that have read access to the Resource you want to export.</li>
<li>Once you are logged in, type in: <strong>az resource list</strong></li>
<li>In the JSON output in the terminal, <strong>copy</strong> the <strong>resource ID</strong> <em>(inside the double quotes from the id value)</em></li>
<li>Now we need to <strong>open</strong> the <strong>Command Palette</strong>, press: CTRL+Shift+P on your keyboard <em>(or click on View, Command Palette)</em></li>
<li><strong>Start typing</strong> in <strong>Bicep</strong>; if you have the latest version, <strong>you should see: Bicep: Insert Resource.</strong>, select this</li>
<li><img decoding="async" loading="lazy" alt="Azure Bicep - Insert Resource" src="/assets/images/bicepinsertresource-feca0c6284259e2abe241ac983ee275b.png" title="Azure Bicep - Insert Resource" width="602" height="111" class="img_ev3q"></li>
<li>Enter in the resource ID you copied earlier.</li>
<li><img decoding="async" loading="lazy" alt="Azure Bicep - Insert Resource" src="data:image/png;base64,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" width="598" height="57" class="img_ev3q"></li>
<li>Azure Bicep should have connected and exported your Resource straight into Bicep! As below, it had imported a Log Analytics workspace in my subscription straight into Bicep.</li>
<li><img decoding="async" loading="lazy" alt="Azure Bicep - Insert Resource" src="/assets/images/bicepinsertedresource-8658a50350e2f2b8b5f30d6868dd02c7.png" width="602" height="262" class="img_ev3q"></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="to-find-the-resource-id-using-the-azure-portal">To find the resource ID using the Azure Portal.<a href="#to-find-the-resource-id-using-the-azure-portal" class="hash-link" aria-label="Direct link to To find the resource ID using the Azure Portal." title="Direct link to To find the resource ID using the Azure Portal.">​</a></h4>
<p>You can use the Azure CLI to find the Resource ID, but you can also use the Azure Portal by navigating to it below:</p>
<ol>
<li>Log in to the <strong>Azure Portal</strong></li>
<li><strong>Navigate</strong> to the <strong>Resource</strong> you want to export to Bicep</li>
<li>On the <strong>Overview</strong> pane, click on <strong>JSON view</strong></li>
</ol>
<p>I had problems connecting to export an App Service and App Service plan, so for some resources with multiple dependencies, you may be better off exporting the ARM template from the resources/resource groups and decompiling that way, but the Insert Resource functionality is a very quick way to bring your resources into Bicep!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-storage-account-sftp-errors/">Azure Storage Account SFTP errors</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-27T00:00:00.000Z">December 27, 2021</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>As part of standing up and using an Azure Storage account as an SFTP service, I ran into a few issues. This blog post is merely intended to show my findings in case others run into similar issues.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pty-allocation-request-failed-on-channel-0">PTY allocation request failed on channel 0<a href="#pty-allocation-request-failed-on-channel-0" class="hash-link" aria-label="Direct link to PTY allocation request failed on channel 0" title="Direct link to PTY allocation request failed on channel 0">​</a></h4>
<p>Even though you appear to have connected successfully, you may see the following errors:</p>
<ul>
<li>PTY allocation request failed on channel 0</li>
<li>shell request failed on channel 0</li>
</ul>
<p>You may laugh, but the solution for this was very simple, switch from SSH to <strong>SFTP</strong>!</p>
<p>If you were like me, I just flicked to SSH as a habit.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="home-directory-is-not-accessible">Home Directory is not accessible<a href="#home-directory-is-not-accessible" class="hash-link" aria-label="Direct link to Home Directory is not accessible" title="Direct link to Home Directory is not accessible">​</a></h4>
<p>Make sure that the Home directory <em>(Folder)</em> is created in your container, SFTP won&#x27;t create this for you.</p>
<p>Also make sure that the Home directory for the user, references Container/Folder, like the below:</p>
<p><img decoding="async" loading="lazy" alt="Azure Portal - Enable SFTP" src="/assets/images/AzurePortal_SFTPLocalUsercreate-c78a42d5f6be4b35f07b68f984890d4a.png" title="Azure Portal - Enable SFTP" width="565" height="331" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="wrong-username-authentication-failed">Wrong username, authentication failed<a href="#wrong-username-authentication-failed" class="hash-link" aria-label="Direct link to Wrong username, authentication failed" title="Direct link to Wrong username, authentication failed">​</a></h4>
<p>When attempting to connect to SFTP using a tool such as WinSCP, I got:</p>
<ul>
<li>Using username &quot;lukeftpuser&quot;.</li>
<li>Authentication failed.</li>
</ul>
<p>The username is actually comprised of:</p>
<p>STORAGEACCOUNTNAME+FTPNAME, ie: sftpstorageacc1337.lukeftpuser</p>
<p><img decoding="async" loading="lazy" alt="WinSCP Connection Azure SFTP" src="/assets/images/sftp_winscptest-d3c15f460193e1dc9aa4548582c06d19.png" title="WinSCP Connection Azure SFTP" width="1076" height="693" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="unable-to-find-azure-storage-ssh-keys">Unable to find Azure Storage SSH Keys<a href="#unable-to-find-azure-storage-ssh-keys" class="hash-link" aria-label="Direct link to Unable to find Azure Storage SSH Keys" title="Direct link to Unable to find Azure Storage SSH Keys">​</a></h4>
<p>This is not an error, but Azure Keyvault, does not currently support SSH keypairs, so once they are created by Azure, they are stored in a Microsoft.Compute.sshPublicKeys resource found here: <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FsshPublicKeys" target="_blank" rel="noopener noreferrer" title="SSH Keys">SSH Keys</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/sftp-in-microsoft-azure-using-azure-blob-storage/">SFTP in Microsoft Azure using Azure Blob Storage</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-27T00:00:00.000Z">December 27, 2021</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>SSH File Transfer Protocol <em>(SFTP)</em> support is now supported in Preview for Azure Blob Storage accounts with hierarchical namespace enabled.</p>
<p>Although tools such as Storage Explorer, Data Factory, AzCopy allows a copy to and from Azure storage accounts, sometimes your applications need more traditional integration, so SFTP is a welcome addition to the Microsoft Azure ecosystem, which in some cases removes the need for additional Virtual Machine(s).</p>
<p>This support enables standard SFTP connectivity to an Azure Storage account. As an Azure PaaS <em>(Platform as a Service)</em> resource, it offers additional flexibility, reduces operational overhead, and increases redundancy and scalability.</p>
<p>We will run through the initial setup of the Azure Storage account using the Azure Portal.</p>
<p>SFTP using an Azure Storage account does not support shared access signature (SAS) or Microsoft Entra ID (Azure AD) authentication for connecting SFTP clients. Instead, SFTP clients must use a password or a Secure Shell <em>(SSH)</em> private/public keypair.</p>
<p>Before we head into the implementation, just a bit of housekeeping, this is currently still in Preview at the time this post was written; the functionality MAY change by the time it becomes GA (<em>Generally Available)</em>.</p>
<blockquote>
<p>During the public preview, the use of SFTP does not incur any additional charges. However, the standard transaction, storage, and networking prices for the underlying Azure Data Lake Store Gen2 account still apply. SFTP might incur additional charges when the feature becomes generally available. As of the time of the preview SFTP support is only avaliable in certain <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/secure-file-transfer-protocol-support?WT.mc_id=AZ-MVP-5004796#regional-availability" target="_blank" rel="noopener noreferrer" title="SSH File Transfer Protocol (SFTP) support for Azure Blob Storage (preview)">regions</a>.</p>
</blockquote>
<p>You can connect to the SFTP storage account by using local <em>(to the SFTP storage account)</em> SSH public-private keypair or Password <em>(or both)</em>. You can also set up individual HOME directories <em>(because of the hierarchical namespace, these are folders not containers)</em> for each user <em>(maximum 1000 local user accounts</em>).</p>
<p><img decoding="async" loading="lazy" alt="SFTP Azure Storage Account - High Level Diagram" src="/assets/images/SFTP_Azure_HLDiagram-6516346dd698fc51ef89c20d0f3ef5f7.png" title="SFTP Azure Storage Account - High Level Diagram" width="831" height="462" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-an-azure-storage-account-for-sftp">Creating an Azure Storage account for SFTP<a href="#creating-an-azure-storage-account-for-sftp" class="hash-link" aria-label="Direct link to Creating an Azure Storage account for SFTP" title="Direct link to Creating an Azure Storage account for SFTP">​</a></h3>
<p>This article assumes you have an Azure subscription and rights to create a new Storage account resource, however if you have an already existing storage account the following pre-requisites are required:</p>
<ul>
<li>A standard general-purpose v2 or premium block blob storage account. You can also enable SFTP as you create the account.</li>
<li>The account redundancy option of the storage account is set to either locally-redundant storage (LRS) or zone-redundant storage (ZRS); GRS is not supported.</li>
<li>The hierarchical namespace feature of the account must be enabled for existing storage accounts. To enable the hierarchical namespace feature, see <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/upgrade-to-data-lake-storage-gen2-how-to?tabs=azure-portal&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Upgrade Azure Blob Storage with Azure Data Lake Storage Gen2 capabilities</a>.</li>
<li>If you&#x27;re connecting from an on-premises network, make sure that your client allows outgoing communication through port 22. The SFTP uses that port.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fill-out-the-sftp-public-preview-interest-form">Fill out the SFTP Public Preview Interest Form<a href="#fill-out-the-sftp-public-preview-interest-form" class="hash-link" aria-label="Direct link to Fill out the SFTP Public Preview Interest Form" title="Direct link to Fill out the SFTP Public Preview Interest Form">​</a></h4>
<p>Because the SFTP functionality is currently in Private Preview, Microsoft has asked that anyone interested in the SFTP Preview fill out a Microsoft Forms:</p>
<ul>
<li><a href="https://forms.office.com/pages/responsepage.aspx?id=v4j5cvGGr0GRqy180BHbRxE4mlJMX2FKhD4ROGugH69URjBGVVdNSVRRWVUxSFA3WkM5OVk4STJFQS4u" target="_blank" rel="noopener noreferrer" title="SFTP Public Preview Interest Form">SFTP Public Preview Interest Form</a></li>
</ul>
<p>This MAY be required before proceeding to the following steps; initially, I believe this was required - but there appears to have been a few people who I know have registered the feature without the form - either way, the SFTP Public Preview Interest form, is a good opportunity to supply your use-case information to Microsoft directly, to help improve the nature of the service going forward.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="registering-the-feature">Registering the Feature<a href="#registering-the-feature" class="hash-link" aria-label="Direct link to Registering the Feature" title="Direct link to Registering the Feature">​</a></h4>
<p>To create an Azure Storage account that supports SFTP - we need to enable the Preview Feature.</p>
<ol>
<li>
<p>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></p>
</li>
<li>
<p>Navigate to: <strong>Subscriptions</strong></p>
</li>
<li>
<p><strong>Select</strong> the <strong>Subscription</strong> that you want to enable <strong>SFTP</strong> preview for</p>
</li>
<li>
<p>Click on: <strong>Preview features</strong></p>
</li>
<li>
<p>Search for: <strong>SFTP</strong></p>
</li>
<li>
<p>Click on: <strong>SFTP support for Azure Blob Storage</strong> and click <strong>Register</strong> - <em>this may take from minutes to a few days to be registered, as each preview request may need to be manually approved by Microsoft personnel based on the Public Preview Interest form - my feature registration occurred quite quickly, so there is a chance that they either have automated the approvals or I was just lucky.</em></p>
<p><em>As you can see in the screenshot below, I had already registered mine:</em></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Portal SFTP Preview Feature" src="/assets/images/azureportal_sftppreview-fc998075232d7e62e22bff4110f2bd77.png" title="Azure Portal SFTP Preview Feature" width="1195" height="448" class="img_ev3q"></p>
</li>
<li>
<p>You can continue to hit refresh until it changes from: Registering to Registered.</p>
</li>
<li>
<p>While we are here, let&#x27;s check that the Microsoft.Storage resource provider is registered <em>(it should already be enabled, but it is a good opportunity to check before attempting to create a resource and get a surprise</em>), by clicking on Resource providers in the left-hand side menu and search for: Storage, if it is set to NotRegistered - click on Microsoft.Storage and click Register.</p>
</li>
</ol>
<p>To register the SFTP feature using PowerShell, you can run the following cmdlet:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Register-AzProviderFeature -FeatureName &quot;AllowSFTP&quot; -ProviderNamespace &quot;Microsoft.Storage&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-azure-storage-account">Create the Azure Storage Account<a href="#create-the-azure-storage-account" class="hash-link" aria-label="Direct link to Create the Azure Storage Account" title="Direct link to Create the Azure Storage Account">​</a></h4>
<p>Now that the Preview feature has been registered, we can now create a new Storage account.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click on <strong>+Create a resource</strong></li>
<li>Type in: <strong>Storage account</strong> and click on the Microsoft Storage account resource and click Create</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Storage account" src="/assets/images/azureportal_createresourcestorageaccount-d236768f9cf005607009ec496a8817aa.png" title="Azure Portal - Storage account" width="1016" height="417" class="img_ev3q"></li>
<li>Select your <strong>Subscription</strong> you enabled the SFTP feature in earlier</li>
<li>Select your <strong>Resource Group</strong> <em>(or create a new resource group)</em> to place your storage account into.</li>
<li>Select your storage account name <em>(</em><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules?WT.mc_id=AZ-MVP-5004796#microsoftstorage" target="_blank" rel="noopener noreferrer" title="Naming rules and restrictions for Azure resources"><em>this needs to be globally unique and a maximum of 24 characters</em></a><em>), in my example; I am going with: sftpstorageacc1337</em></li>
<li><strong>Select</strong> your <strong>Region</strong>; remember that only specific regions currently have SFTP support at the time of this article _.</li>
<li><strong>Select</strong> your <strong>performance tier</strong>; premium is supported but remember to select Blob, select Standard.</li>
<li><strong>Select</strong> your <strong>Redundancy</strong>; remember that GRS-R, GRS isn&#x27;t supported at this time; I will select Zone-redundant storage (ZRS) so that my storage account is replicated between the three availability zones, but you can also select LRS <em>(Locally Redundant Storage).</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create v2 Storage Account" src="/assets/images/azureportal_createstorageaccount-3ae94aa7ae2e8f5c098b838a0d23e0c7.png" title="Azure Portal - Create v2 Storage Account" width="754" height="756" class="img_ev3q"></li>
<li>Click <strong>Next: Advanced</strong></li>
<li>Leave the Security options as-is and check: <strong>Enable hierarchical namespace</strong> under the Data Lake Storage Gen2 subheading.</li>
<li>Click <strong>Enable SFTP</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Enable SFTP" src="/assets/images/azureportal_createstorageaccountenablesftp-ffd5cd2819f09340b04b65a3a58f8cee.png" title="Azure Portal - Enable SFTP" width="827" height="682" class="img_ev3q"></li>
<li>Click: <strong>Next: Networking</strong></li>
<li>SFTP supports Private Endpoints (<em>as a blob storage sub-resource)</em>, but in this case, I will be keeping Connectivity as a <strong>Public endpoint (all networks)</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Enable SFTP" src="/assets/images/azureportal_createstorageaccountnetwork-d5a825a5bbfec92e83bde690c654a04f.png" title="Azure Portal - Enable SFTP" width="750" height="721" class="img_ev3q"></li>
<li>Click <strong>Next: Data Protection</strong></li>
<li>Here you can enable <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/soft-delete-blob-overview" target="_blank" rel="noopener noreferrer" title="Soft delete for blobs">soft-delete</a> for your blobs and containers, so if a file is deleted, it is retained for seven days until it&#x27;s permanently deleted; I am going to leave mine set as the default of 7 days and click: <strong>Next: Tags.</strong></li>
<li>Add in any applicable Tags, i.e. who created it, when you created it, what you created it for and click <strong>Review + Create</strong></li>
<li>Review your configuration, make sure that Enable SFTP is enabled with Hierarchical namespace and click <strong>Create</strong>.</li>
</ol>
<p>In case you are interested in Infrastructure as Code, here is an Azure Bicep file I created to create a storage account ready for SFTP here that can be deployed to a Resource Group, ready for the next steps:</p>
<div class="language-bicep codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">storageaccount.bicep</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bicep codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> storageaccprefix </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> location </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">resourceGroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> storageacc </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Storage/storageAccounts@2021-06-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token interpolated-string string" style="color:rgb(255, 121, 198)">&#x27;</span><span class="token interpolated-string interpolation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token interpolated-string interpolation expression">storageaccprefix</span><span class="token interpolated-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token interpolated-string interpolation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token interpolated-string interpolation expression function" style="color:rgb(80, 250, 123)">uniqueString</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token interpolated-string interpolation expression function" style="color:rgb(80, 250, 123)">resourceGroup</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token interpolated-string interpolation expression">id</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token interpolated-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token interpolated-string string" style="color:rgb(255, 121, 198)">&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">location</span><span class="token operator">:</span><span class="token plain"> location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">sku</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Standard_ZRS&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">kind</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;StorageV2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">defaultToOAuthAuthentication</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">allowCrossTenantReplication</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">minimumTlsVersion</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;TLS1_2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">allowBlobPublicAccess</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">allowSharedKeyAccess</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">isHnsEnabled</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">supportsHttpsTrafficOnly</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">encryption</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">services</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">blob</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">keyType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Account&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">enabled</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">keySource</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Storage&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">accessTier</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Hot&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-sftp">Setup SFTP<a href="#setup-sftp" class="hash-link" aria-label="Direct link to Setup SFTP" title="Direct link to Setup SFTP">​</a></h4>
<p>Now that you have a compatible Azure storage account, it is time to enable SFTP!</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></li>
<li><strong>Navigate</strong> to the <strong>Storage account</strong> you have created for SFTP and click on it</li>
<li>On the Storage account blade, under <strong>Settings</strong>, you will see: <strong>SFTP</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Enable SFTP" src="/assets/images/azureportal_storageaccountstpblade-d2ea1768cb4a061c4f407926769e6e96.png" title="Azure Portal - Enable SFTP" width="1204" height="668" class="img_ev3q"></li>
<li>Click on <strong>SFTP</strong> and click <strong>+ Add local user.</strong></li>
<li>Type in the username of the user you would like to use <em>(remember you can have up to 1000 local users, but there is no integration into Azure AD, Active Directory or other authentication services currently</em>), in my example I will use: lukeftpuser</li>
<li>You can use either <em>(and both)</em> SSH keys or passwords, in this article - I am simply going to use a password so I select: <strong>SSH Password</strong>.</li>
<li>Click <strong>Next</strong></li>
<li>Our storage account is empty, we now need to create a top-level container, so I will sect <strong>Create new</strong> and set the name to: ftp</li>
<li>I will leave the Public access level to <strong>Private (no anonymous access)</strong></li>
<li>Click <strong>Ok</strong></li>
<li>Now that the ftp container has been created, we need to <strong>set</strong> the <strong>permissions</strong>, I am simply going to give the permissions of Read, Create, Delete, List and Write. <em>It&#x27;s worth noting, that if you only need to read or list contents, then that is the only permissions you need, these permissions are for the Container, not the folder, so you may find your users may have permissions to other folders in the same Container if not managed appropriately.</em></li>
<li>Now we set the <strong>Home directory</strong>. This is the directory that the user will be automatically mapped to, this is optional but if you don&#x27;t have a Home directory filled in for the user, they will need to connect to the appropriate folders when connecting to SFTP manually. The home directory needs to be relative, ie: ftp/files <em>(the container name and the files folder, located in the ftp container).</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Enable SFTP" src="/assets/images/AzurePortal_SFTPLocalUsercreate-c78a42d5f6be4b35f07b68f984890d4a.png" title="Azure Portal - Enable SFTP" width="565" height="331" class="img_ev3q"></li>
<li>Because we specified Password earlier, <strong>Azure</strong> has automatically <strong>created</strong> a new <strong>password</strong> for that account, although you can generate new passwords - you are unable to specify what the Password is, make sure you <strong>copy</strong> this and <strong>store</strong> it in a password <strong>vault</strong> of some kind, the length of the password that was generated for me was: 89 characters.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Enable SFTP" src="data:image/png;base64,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HUf7bcTU87mPMfV8nm77XY5zH2Pq+dzHmHo+9zGmns/Tbb/Lce5jTD2fh2l/3Cjey/jkPdN+GzHN+dzHmHo+9zGmns99jKnn83Tb73Kc+xhTz+c+xtTzuY8x9Xwepv1xo3gv4zdvERHZOxTvZRRvERE5bXgy54mcfbZ5UuctwFGe0DcV7/or8umX5Ir38aB4i4icfM6EeLdsIsyK94Yo3iIiclgU72UUbxER2TuOKt7ta/QeivcGKN4iInJYjiLeZxOKt4iI7B2K9zKKt4iI7B2K9zJbF+8/+tAHuxMjIiIyB9rR0xR5mq2L98+d87PTJHAXJSIisg40A+3oaYo8zdbFW0RERI4XxVtERGQwFG8REZHBULxFREQGQ/EWEREZDMVbRERkMBRvERGRwVC8RUREBkPxFhERGQzFW0REZDAUbxERkcFQvEVERAZD8RYRERkMxVtERGQwFG8REZHBULxFREQGQ/EWEREZDMVbRERkMBRvERGRwVC8RUREBkPxFhERGQzFW0REZDAUbxERkcFQvEVERAZD8RYRERkMxVtERGQwFG8REZHBULxFREQGQ/EWEREZDMVbRERkMBRvERGRwVC8RUREBkPxFhERGQzFW0REZDAUbxERkcFQvEVERAZD8RYRERkMxVtERGQwFG8REZHBULxFREQGQ/EWEREZDMVbRERkMBRvERGRwVC8RUREBkPxFhERGQzFW0REZDAUbxERkcFQvEVERAZD8RYRERkMxVtERGQwFG8REZHBULxFREQGQ/EWEREZDMVbRERkMBRvERGRoXj26v8DJAwszj+sFogAAAAASUVORK5CYII=" title="Azure Portal - Enable SFTP" width="495" height="224" class="img_ev3q"></li>
<li>You should see the connection string of the user, along with the Authentication method and container permissions.</li>
<li><img decoding="async" loading="lazy" alt="Azure Storage Account SFTP - Local User Created" src="/assets/images/azureportal_sftp_localusercreated-48129b645196f1bafdda941d79fc16ca.png" title="Azure Storage Account SFTP - Local User Created" width="1206" height="647" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-connectivity-via-sftp-to-an-azure-storage-account">Test Connectivity via SFTP to an Azure Storage Account<a href="#test-connectivity-via-sftp-to-an-azure-storage-account" class="hash-link" aria-label="Direct link to Test Connectivity via SFTP to an Azure Storage Account" title="Direct link to Test Connectivity via SFTP to an Azure Storage Account">​</a></h3>
<p>I will test Connectivity to the SFTP Azure Storage account using Windows 11, although the same concepts apply across various operating systems <em>(Linux, OSX, etc.)</em>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test-using-sftp-from-windows-using-command-prompt">Test using SFTP from Windows using command prompt<a href="#test-using-sftp-from-windows-using-command-prompt" class="hash-link" aria-label="Direct link to Test using SFTP from Windows using command prompt" title="Direct link to Test using SFTP from Windows using command prompt">​</a></h4>
<ol>
<li>
<p>Make sure you have a copy of the Connection String and user password from the SFTP user account created earlier.</p>
</li>
<li>
<p>Open <strong>Command Prompt</strong></p>
</li>
<li>
<p>Type in <strong>sftp</strong> CONNECTIONSTRING, example below and press Enter:</p>
<ul>
<li><em>sftp <a href="mailto:sftpstorageacc1337.lukeftpuser@sftpstorageacc1337.blob.core.windows.net" target="_blank" rel="noopener noreferrer">sftpstorageacc1337.lukeftpuser@sftpstorageacc1337.blob.core.windows.net</a></em></li>
</ul>
</li>
<li>
<p>If you get a prompt to verify the authenticity of the host matches (i.e. the name/URL of the storage account matches) and type in: Yes, to add the storage account to your known host&#x27;s list</p>
</li>
<li>
<p>Press <strong>Enter</strong> and paste in the copy of the Password that was generated for you earlier.</p>
</li>
<li>
<p>You should be <strong>connected to the Azure Storage account via SFTP</strong>!</p>
</li>
<li>
<p>As you can see below, I am in the Files folder, which is my users home folder, and there is a file named: Test in it.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="SFTP Windows" src="/assets/images/sftp_windowstest-4627ef8c4e69e1978d0b262ec443009a.png" title="SFTP Windows" width="771" height="174" class="img_ev3q"></p>
<blockquote>
<p>Once you have connected to SFTP using the Windows command line you can type in: <strong>?</strong></p>
<p>That will give you a list of all the available commands to run, ie upload files etc</p>
</blockquote>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test-using-winscp">Test using WinSCP<a href="#test-using-winscp" class="hash-link" aria-label="Direct link to Test using WinSCP" title="Direct link to Test using WinSCP">​</a></h4>
<ol>
<li>Make sure you have a copy of the Connection String and user password from the SFTP user account created earlier.</li>
<li>If you haven&#x27;t already, download WinSCP and install it</li>
<li>You should be greeted by the <strong>Login page</strong> <em>(but if you aren&#x27;t, click on Session, New Session)</em></li>
<li>For the hostname, type in the <strong>URL</strong> for the <strong>storage account</strong> <em>(after the @ in the connection string)</em></li>
<li>For the <strong>username,</strong> type in everything before the @</li>
<li>Type in your <strong>Password</strong></li>
<li><strong>Verify</strong> that the port is 22 and file protocol is <strong>SFTP</strong> and click <strong>Login</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure SFTP - WinSCP" src="/assets/images/sftp_winscptest-d3c15f460193e1dc9aa4548582c06d19.png" title="Azure SFTP - WinSCP" width="1076" height="693" class="img_ev3q"></li>
<li><img decoding="async" loading="lazy" alt="Azure SFTP - WinSCP" src="/assets/images/sftp_winscptest2-b9e26d2f65e62740b3c7fe008a6ce8c5.png" title="Azure SFTP - WinSCP" width="1076" height="693" class="img_ev3q"></li>
</ol>
<p>Congratulations! You have now created and tested Connectivity to the Azure Storage SFTP service!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tags/azure/page/18/"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tags/azure/page/20/"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
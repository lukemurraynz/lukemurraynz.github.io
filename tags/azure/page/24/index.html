<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">156 posts tagged with &quot;Azure&quot; | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/tags/azure/page/24/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="156 posts tagged with &quot;Azure&quot; | luke.geek.nz"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/tags/azure/page/24/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/24/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/tags/azure/page/24/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.dcdba76e.css">
<script src="/assets/js/runtime~main.3efce4fa.js" defer="defer"></script>
<script src="/assets/js/main.d1fc2f5a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/enhancing-github-copilot-with-custom-instructions/">Enhancing GitHub Copilot with Custom Instructions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/change-analysis/">Azure Resource - Change Analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/misc/kubernetes-enterprise-guide-book-review/">Book Review - Kubernetes – An Enterprise Guide</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/openai-adoption-challenges-solutions/">Common Challenges and Solutions for Azure OpenAI Adoption</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/policy-deny-creation-azure-openai-studio/">Azure Policy - Deny the creation of Azure OpenAI Studio</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>156 posts tagged with &quot;Azure&quot;</h1><a href="/tags/">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-public-dns-as-code/">Azure Public DNS as Code</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-07T00:00:00.000Z">January 7, 2022</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>The Microsoft Azure ecosystem offers a lot of capabilities that empower individuals and businesses; one of those capabilities that are often overlooked is <a href="https://en.wikipedia.org/wiki/Domain_Name_System" target="_blank" rel="noopener noreferrer">DNS</a><em>(Domain Name System)</em>.</p>
<blockquote>
<p><em>Azure DNS allows you to host your DNS domain in Azure, so you can manage your DNS records using the same credentials, billing, and support contract as your other Azure services. Zones can be either public or private, where Private DNS Zones (in Managed Preview) are only visible to VMs that are in your virtual network.</em></p>
<p><em>You can configure Azure DNS to resolve hostnames in your public domain. For example, if you purchased the contoso.xyz domain name from a domain name registrar, you can configure Azure DNS to host the contoso.xyz domain and resolve <code>www.contoso.xyz</code> to the IP address of your web server or web app.</em></p>
</blockquote>
<p>In this article, we are going to focus on <a href="https://learn.microsoft.com/en-us/azure/dns/dns-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Public DNS</a>.</p>
<p>I had my external DNS under source control using Terraform and the Cloudflare provider a few years ago. I wanted to see if I use source control and continuous integration to do the same thing using Azure DNS and Azure Bicep.</p>
<p>My theory was I could make a change to a file and then commit it and have the Azure DNS records created or modified automatically, allowing changes to DNS to be gated, approved, scheduled and audited, allowing changes and rollback a lot easier – without having to give people access to be able to create DNS records with no auditability, turns out you can!</p>
<p>Using an Azure DevOps pipeline and repository and Azure Bicep, we will deploy an Azure Public DNS zone to a resource group automatically on a successful commit and any records.</p>
<p><img decoding="async" loading="lazy" alt="Azure Bicep - Pipeline High Level" src="/assets/images/azurebicep_dns_hld-d9c6656c1bcbd625f9ea4faebd61a01a.png" title="Azure Bicep - Pipeline High Level" width="1398" height="649" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-public-dns-as-code">Create Azure Public DNS as Code<a href="#create-azure-public-dns-as-code" class="hash-link" aria-label="Direct link to Create Azure Public DNS as Code" title="Direct link to Create Azure Public DNS as Code">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h4>
<ul>
<li>An <a href="https://azure.microsoft.com/en-us/pricing/details/devops/azure-devops-services/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure DevOps</a> account and permissions to create a service endpoint</li>
<li>An Azure subscription that you have at least contributor rights to</li>
<li>A git repository <em>(I am going to use the repository in Azure DevOps, but you could use a nested repository from GitHub)</em></li>
<li>The latest <a href="https://learn.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-7.5.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure PowerShell</a> modules and <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/install?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Bicep/Azure CLI</a> for local editing</li>
<li>A domain name and rights to change the nameservers to point towards Azure DNS</li>
</ul>
<p>In this article, I will be using an Azure subscription. I have access to an Azure DevOps <em>(free)</em> subscription and a custom domain I joined named &#x27;badasscloud.com&#x27;.</p>
<p>I will assume that you have nothing set up but feel free to skip the sections that aren&#x27;t relevant.</p>
<p>That that we have the prerequisites sorted let&#x27;s set it up...</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-devops-repository">Create Azure DevOps Repository<a href="#create-azure-devops-repository" class="hash-link" aria-label="Direct link to Create Azure DevOps Repository" title="Direct link to Create Azure DevOps Repository">​</a></h4>
<ol>
<li>
<p><a href="https://go.microsoft.com/fwlink/?LinkId=2014676&amp;githubsi=true&amp;clcid=0x409&amp;WebUserId=e3e298aac5104b0e8e949b3b5bbeb314" target="_blank" rel="noopener noreferrer"><strong>Sign in to Azure DevOps</strong></a></p>
</li>
<li>
<p>Select <strong>+ New Project</strong></p>
</li>
<li>
<p>Give your <strong>project</strong> a <strong>name</strong> <em>(i.e., I am going with: DNSAsCode)</em></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure DevOps - Create New Project" src="/assets/images/azuredevops-creatednsproject-df36404500efaa8d7c0ef858faab19d9.png" title="Azure DevOps - Create New Project" width="631" height="636" class="img_ev3q"></p>
</li>
<li>
<p>Click <strong>Create</strong> <em>(your project will now be created)</em></p>
</li>
<li>
<p>Click on <strong>Repos</strong></p>
</li>
<li>
<p>Click on <strong>Files</strong></p>
</li>
<li>
<p>Find the &#x27;<strong>Initialize Main branch with a README or gitignore</strong>&#x27; section and click <strong>Initialize.</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure DevOps - Create New Project" src="data:image/png;base64,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" title="Azure DevOps - Create New Project" width="559" height="147" class="img_ev3q"></p>
</li>
<li>
<p>You should now have an empty git repository!</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-devops-service-connection">Create Azure DevOps Service Connection<a href="#create-azure-devops-service-connection" class="hash-link" aria-label="Direct link to Create Azure DevOps Service Connection" title="Direct link to Create Azure DevOps Service Connection">​</a></h4>
<p>For Azure DevOps to connect to Microsoft Azure, we need to set up a service principal; you can create the service connection in Azure DevOps. However, it usually generates a service principal with a name that could be unrecognizable in the future in Azure, and I prefer to develop them according to naming convention and something that I can look at and instantly recognize its use-case. To do that, we will create it using Azure CLI.</p>
<ol>
<li>
<p>Open <strong>PowerShell</strong></p>
</li>
<li>
<p><strong>Run</strong> the following <strong>commands</strong> to connect to Azure and <strong>create</strong> your <strong>Service Principal</strong> with Contributor <strong>access</strong> to <strong>Azure</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Connects to Microsoft Azure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">az.cmd login</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Set SPN name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$AppRegName = &#x27;SPN.AzureSubscription.Contributor&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Creates SPN and sets SPN as Contributor to the subscription</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$spn = az.cmd ad sp create-for-rbac --name $AppRegName --role &#x27;contributor&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Exports Password, Tenant &amp; App ID for better readability - required for Azure DevOps setup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$spn | ConvertFrom-Json | Select-Object -Property password, tenant, appId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">az.cmd account show --query id --output tsv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">az.cmd account show --query name --output tsv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Make sure you <strong>record</strong> the <strong>password</strong>, <strong>application ID</strong> and the <strong>subscription ID/name</strong>; you will need this for the next step - you won&#x27;t be able to view it anywhere else; if you lose it, you can rerun the sp create command to generate a new password. Now that we have the SPN, we need to add the details into Azure DevOps.</p>
</li>
<li>
<p><a href="https://go.microsoft.com/fwlink/?LinkId=2014676&amp;githubsi=true&amp;clcid=0x409&amp;WebUserId=e3e298aac5104b0e8e949b3b5bbeb314" target="_blank" rel="noopener noreferrer"><strong>Sign in to Azure DevOps</strong></a></p>
</li>
<li>
<p>Navigate to the DNS As Code <strong>project</strong> you created earlier</p>
</li>
<li>
<p>Click on <strong>Project Setting</strong>s <em>(bottom right-hand side of the window)</em></p>
</li>
<li>
<p>Click on <strong>Service connections</strong></p>
</li>
<li>
<p>Click on: <strong>Create a service connection</strong></p>
</li>
<li>
<p>Select <strong>Azure Resource Manager</strong></p>
</li>
<li>
<p>Click <strong>Next</strong></p>
</li>
<li>
<p>Click on: <strong>Service Principal (Manual</strong>) and click Next</p>
</li>
<li>
<p><strong>Enter</strong> in the following <strong>details</strong> that we exported earlier from the creation of the service principal:</p>
<ul>
<li>Subscription ID</li>
<li>Subscription Name</li>
<li>Service Principal ID <em>(the appId)</em></li>
<li>Service principal key <em>(password)</em></li>
<li>Tenant ID</li>
</ul>
</li>
<li>
<p>Click <strong>Verify</strong> to verify that Azure DevOps can connect to Azure; you should hopefully see a Verification succeeded.</p>
</li>
<li>
<p>Give the <strong>Service</strong> connection a <strong>name</strong> <em>(this is the display name that is visual in Azure DevOps)</em></p>
</li>
<li>
<p><strong>Add</strong> a <strong>description</strong> <em>(i.e. created by, created on, created for)</em></p>
</li>
<li>
<p>Click on <strong>Verify and save</strong></p>
</li>
<li>
<p>You now have a new Service connection!</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure DevOps - Service Connection" src="/assets/images/new_azure_serviceconnectioncreated-6e213b4808f26d6ffbb00974f46582d3.png" title="Azure DevOps - Service Connection" width="1184" height="353" class="img_ev3q"></p>
</li>
</ol>
</li>
</ol>
<p><em>Note: The password for the service principal is valid for one year, so when they expire, you can come into the Azure DevOps service connection and update it here.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="add-azure-bicep-to-repository">Add Azure Bicep to Repository<a href="#add-azure-bicep-to-repository" class="hash-link" aria-label="Direct link to Add Azure Bicep to Repository" title="Direct link to Add Azure Bicep to Repository">​</a></h4>
<p>Now that Azure DevOps has the delegated rights to create resources in Microsoft Azure, we need to add the Azure Bicep for Azure DNS Zone.</p>
<p>I have created the below Azure Bicep file named: Deploy-PublicDNS.bicep</p>
<p><strong>Don&#x27;t edit the file yet. You can add your DNS records later - after we add some variables into the Azure Pipeline.</strong></p>
<p>This file will:</p>
<ul>
<li>Create a new public Azure DNS zone, if it doesn&#x27;t exist</li>
<li>Add/Remove and modify any records</li>
</ul>
<p>I have added CNAME, A Record and TXT Records as a base.</p>
<div class="language-bicep codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">Deploy-PublicDNS.bicep</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bicep codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">///Variables - Edit, these variables can be set in the script or implemented as part of Azure DevOps variables.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Set the Domain Name Zone:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> PrimaryDNSZone </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Deploys to the location of your resource group, that is specified during the deployment.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> location </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Global&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Variable array for your A records. Add, remove and amend as needed, any new record needs to be included in {}.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> arecords </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">ipv4Address</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;8.8.8.8&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;webmail&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">ipv4Address</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;8.8.8.8&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Variable array for your CNAME records. Add, remove and amend as needed, any new record needs to be included in {}.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> cnamerecords </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;blog&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;luke.geek.nz&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> txtrecords </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;v=spf1 include:spf.protection.outlook.com -all&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">///Deploys your infrastructure below.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Deploys your DNS Zone.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> DNSZone </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/dnsZones@2018-05-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">toLower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">PrimaryDNSZone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">location</span><span class="token operator">:</span><span class="token plain"> location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">zoneType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Public&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Deploys your A records that are listed in the arecord variable table above.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> DNSARecords </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/dnsZones/A@2018-05-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> arecord </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> arecords</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">toLower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arecord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">parent</span><span class="token operator">:</span><span class="token plain"> DNSZone</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">TTL</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">ARecords</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">ipv4Address</span><span class="token operator">:</span><span class="token plain"> arecord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ipv4Address</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">targetResource</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Deploys your CNAME records that are listed in the cnamerecord variable table above.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> CNAMErecords </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/dnsZones/CNAME@2018-05-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> cnamerecord </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> cnamerecords</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">toLower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cnamerecord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">parent</span><span class="token operator">:</span><span class="token plain"> DNSZone</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&#x27;TTL&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">CNAMERecord</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">cname</span><span class="token operator">:</span><span class="token plain"> cnamerecord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">targetResource</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> TXTrecords </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/dnsZones/TXT@2018-05-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> txtrecord </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> txtrecords</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">toLower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">txtrecord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token property">parent</span><span class="token operator">:</span><span class="token plain"> DNSZone</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token property">&#x27;TTL&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token property">TXTRecords</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        txtrecord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">value               </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">output</span><span class="token plain"> cnamerecords </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> CNAMErecords</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">CNAMERecord</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">cname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">output</span><span class="token plain"> arecords </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> arecords</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ipv4Address</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To add the Azure Bicep file into Azure DevOps, you can commit it into the git repository; see a previous post on &#x27;<a href="https://luke.geek.nz/windows/git-using-github-desktop-on-windows-for-sysadmins/" target="_blank" rel="noopener noreferrer" title="Git using Github Desktop on Windows for SysAdmins ">Git using Github Desktop on Windows for SysAdmins</a>&#x27; to help get started. However, at this stage, I will create it manually in the portal.</p>
<ol>
<li><a href="https://go.microsoft.com/fwlink/?LinkId=2014676&amp;githubsi=true&amp;clcid=0x409&amp;WebUserId=e3e298aac5104b0e8e949b3b5bbeb314" target="_blank" rel="noopener noreferrer"><strong>Sign in to Azure DevOps</strong></a></li>
<li>Navigate to the DNS As Code <strong>project</strong> you created earlier</li>
<li>Click on <strong>Repos</strong></li>
<li>Click on <strong>Files</strong></li>
<li>Click on the <strong>Ellipsis</strong> on the right-hand side</li>
<li>Click <strong>New</strong></li>
<li>Click <strong>File</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure DevOps - New File" src="/assets/images/azuredevops-createfile-80e661ef18f63ca331b69fa5f3398dbd.png" title="Azure DevOps - New File" width="536" height="229" class="img_ev3q"></li>
<li>Type in the name of your file <em>(including the bicep extension)</em>, i.e. <strong>Deploy-PublicDNS.bicep</strong></li>
<li>Click <strong>Create</strong></li>
<li><strong>Copy</strong> the <strong>contents</strong> of the Azure <strong>Bicep</strong> file supplied above and <strong>paste</strong> them into the Contents of <strong>Deploy-PublicDNS.bicep in Azure DevOps</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure DevOps - Azure Bicep" src="/assets/images/azuredevops-deploypublicdnsinitialcommit-4ed7c138c81001307db524cda198ed5c.png" title="Azure DevOps - Azure Bicep" width="1170" height="541" class="img_ev3q"></li>
<li>Click <strong>Commit</strong></li>
<li>Click <strong>Commit</strong> again</li>
<li>While we are here, let&#x27;s <strong>delete</strong> the <strong>README.md</strong> file (as it will cause issues with the pipeline later on), click on the README.md file.</li>
<li>Click on the Ellipsis on the right-hand side</li>
<li>Click <strong>Delete</strong></li>
<li>Click <strong>Commit</strong></li>
<li>You should now only have your: Deploy-PublicDNS.bicep in the repository.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-devops-pipeline">Create Azure DevOps Pipeline<a href="#create-azure-devops-pipeline" class="hash-link" aria-label="Direct link to Create Azure DevOps Pipeline" title="Direct link to Create Azure DevOps Pipeline">​</a></h4>
<p>Now that we have the initial Azure Bicep file, it&#x27;s time to create our pipeline that will do the heavy lifting. I have created the base pipeline that you can download, and we will import it into Azure DevOps.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">azure-pipelines.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Variable &#x27;location&#x27; was defined in the Variables tab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Variable &#x27;PrimaryDNSZone&#x27; was defined in the Variables tab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Variable &#x27;ResourceGroupName&#x27; was defined in the Variables tab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Variable &#x27;SPN&#x27; is defined in the Variables tab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">trigger</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">branches</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">include</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> refs/heads/main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">job</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Job_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> Agent job 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">pool</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">vmImage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">checkout</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> self</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token key atrule">task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> AzureCLI@2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">displayName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Azure CLI &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">inputs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">connectedServiceNameARM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> $(SPN)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">scriptType</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> pscore</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">scriptLocation</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> inlineScript</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">inlineScript</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         az group create </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">name $(ResourceGroupName) </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">location $(location)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        az deployment group create  `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">template</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">file $(Build.SourcesDirectory)\Deploy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">PublicDNS.bicep `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">resource</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">group $(ResourceGroupName) `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">parameters PrimaryDNSZone=$(PrimaryDNSZone)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">powerShellErrorActionPreference</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> continue</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This pipeline will run through the following steps:</p>
<ul>
<li>Spin up an Azure-hosted agent running Ubuntu <em>(it already has the Azure CLI and PowerShell setup)</em></li>
<li>Create the Azure resource group to place your DNS zone into <em>(if it doesn&#x27;t already exist)</em></li>
<li>Finally, do the actual Azure Bicep deployment and create your Primary DNS zone resource, and, if necessary, modify any resources.</li>
</ul>
<p>Copy the contents of the YAML pipeline above, and let&#x27;s import it to Azure DevOps.</p>
<ol>
<li><a href="https://go.microsoft.com/fwlink/?LinkId=2014676&amp;githubsi=true&amp;clcid=0x409&amp;WebUserId=e3e298aac5104b0e8e949b3b5bbeb314" target="_blank" rel="noopener noreferrer"><strong>Sign in to Azure DevOps</strong></a></li>
<li>Navigate to the DNS As Code <strong>project</strong> you created earlier</li>
<li>Click on <strong>Pipelines</strong></li>
<li>Click on the <strong>Create Pipeline</strong></li>
<li>Select <strong>Azure Repos Git (YAML)</strong></li>
<li><strong>Select</strong> your DNSAsCode <strong>repository</strong></li>
<li>Select <strong>Starter pipeline</strong></li>
<li><strong>Overwrite</strong> the contents of the starter <strong>pipeline</strong> with the YAML file supplied</li>
<li><img decoding="async" loading="lazy" alt="Azure DevOps - YAML" src="/assets/images/azuredevops-newpipeline-95f1b6881da1b77d479989262306a464.png" title="Azure DevOps - YAML" width="1450" height="832" class="img_ev3q"></li>
<li>Click on the arrow next to Save and Run and select <strong>Save</strong></li>
<li>Select <strong>Commit directly to the main branch</strong></li>
<li>Click <strong>Save</strong></li>
<li>You may get an error about the trigger. You can ignore it - we will need to set the variables and trigger now.</li>
<li>Click on <strong>Pipelines</strong>, select your newly created pipeline</li>
<li>Select <strong>Edit</strong></li>
<li>Click <strong>Variables</strong></li>
<li>Click on <strong>New Variable</strong></li>
<li>We need to <strong>add</strong> four <strong>variables</strong>. To make the deployment more environment-specific, add the following variables into Azure DevOps <em>(these variables will be accessible by this pipeline only).</em></li>
</ol>

























<table><thead><tr><th>Variable</th><th>Note</th></tr></thead><tbody><tr><td>location</td><td>Location where you want to deploy the Resource into – i.e. ‘Australia East’</td></tr><tr><td>PrimaryDNSZone</td><td>The name of your domain you want the public zone to be, i.e. badasscloud.com</td></tr><tr><td>ResourceGroupName</td><td>The name of the Resource Group that the DNS Zone resource will be deployed into, i.e. DNS-PRD-RG</td></tr><tr><td>SPN</td><td>The name of the Service Connection, that we created earlier to connect Azure DevOps to Azure, i.e., SPN.AzureDNSCode</td></tr></tbody></table>
<ol>
<li>
<p><img decoding="async" loading="lazy" alt="Azure DevOps Variables" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdMAAAFgCAYAAADgoJN2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAACWJSURBVHhe7d39axxXnu/x/BeNGmGiJONgYZM4eBaxeUKGIWGtNR6HS2YQZgi6QzyZIRlslGxiuBrWZm8U1r7Qa0hQcMCEJISOlZ0MHvCAHCwxHm8cZiOGWHcu2jFaZq1FIlj5JSD/8r31cKrqnKpTXd065a6W+/2C7466zlNVBfrjU93S3icAAMAJYQoAgCPCFAAAR4QpAACOCFMAABwRpgAAOCJMAQBwRJgCAOCIMAUAwBFhCgCAo20cputy5fT/lB//+HX5aPmOOta+r0+OyMDAgFdH5BN1rKWvT8pI0H9AjrQ1AADQL5zD9Pxzg2EoPfii/LZFpm28d0iF16PyxnV10MWf35QnVLgNvvBrdbB9hCkAoCzOYbpx/jkZDELmQXnpd+pgxkYSuiMn5Wt11Mmdr+TN0R0yMDgsL3yyrg62jzAFgF51R75686fyxpXO39u/+/Kk/PTNr7wZusv9Me+dT+TIYBgyD+al6cZ5eU71GTlZSpQ6I0wBoHd99+WUPLHjCZnsIFCjMVNffqeOdE8Jn5nekU+ORI96XxJbnCa71/1y+qY6WDHCFAB6WyeBWmWQ+kr5AtKd374oDwZBs1smf68OxrRHvPtPi5+ld279m7zz+g/l6V0PqJAdkB07n5bx01dEv2VG4H33pZw+/Ijs8F6Hn5F6O2I1Vt/tbmnu4MtM4/K3D4TnOfjAXnnm9V/LLf05QYswvbP8kbzyzN/Izh1hezD+lfdlyfhv+p0svf+6/PDpncE1hP12ydNH/1X+qnoAAEztBGrVQeorJUy9NJUXHwwDYnc6TbVHvD9ohLHxyZHw9cCOnbJnzx7ZpULMr0e98VGGJYF3SI4ceTDuMxCkmT1MtzL3Cy88HPw8+MADcdD59bC3TvyfLydM13/7kjymrm/Hzj3emrvkAfV68ImT8lWw4B356uQTWrj7/faE4VvWZ8gAcI9qFai9EKS+csLUC4vfvqjC7tE3RP+ybvKI95C8txEe+/Xxv5eTc7fiYPN3bVd++Wg4ftDbKaqGJPC8evg5eedP32pj7GG65bmjbeSdWzI3GQXfw/LS7+IB2TDd8M4h+EfEw3LkI23Nde/4w2Hf/f5z7Y335JAaO3ZW6+ev9d6v5c/qJQDAzhaovRKkvpLC1PO7l9SjXv1XX7RHvIfe81618NWUfD8YPyJRNiaBNyjPnU+PtoepVcu5H5QX07/Tc+eK/HJ3OHe807aE6c3T+8M5LNf21dT3w7YfNOSvf23ID9TYsXfyH1UAAPLpgbp+ZbJngtRXXpjK7+Ql9ag3Drf4m77pMPxOVhb+Vc68PiETP3zaeDRqD7xkV5vIC9NO57Z/ASl+XBwlZyZM78hHP1J9WlXwGPemNH4QPW7eIY8884q8s7DinSkAoBNhoO6QHaldatVKDFOR30/u1gLEz9Ij4ePSweckztLo90NV2PhfwtnzN8/Ij//H42pn227gWcK0tLnbCdOv5eSI6vPoszIx4YW3rU6oLxitX5GTfz8cf27q145HDsvpHvlXFQBsB30Rpl6ayu4gKPzQSn5lZtBLn+hBavxo9OEj8v6KFiRxWG09TMube0PeOxTOnR+mWp8ffaR9RtvadysL8s4rz8gj6pu/xj80AAC59M9I9Ue+vaDcMJXr8sajYUjsnz6tHvGan0lmdnxKvIt1CNOtzW353df19+SQejQcfQM5G6baTrzgTyna3Pl/07I/NR8AwE4P0kgvBWrJYerF6Rvqm7O7d4e71FTQxIH36C/lirond259FH/7tZQw7Whu/1dYJmUu+qVS//dZ/y78VZmBwUPyXvTfyBKm3sXKo+rYw393WvQntne+/ZO8/9NxOe2v9+cP5M33l4zPSO98NaXma/VnGAEAtiCN9Eqglh6mesD4lf4Tg8mvyngV/C6o/0cMBuWJIz9q8Y3b9sJ0a3OPyBNPhI+jdzyQ/KEH/4tCo0ESKrYwFfP3R/0xO/fskT3xH4xQ60Vj1e++hucVjhl84k1+zxQAcrQK0kgvBGr5Yap/Mce66/pOvnxb/2tDfxv+daI4rLYeplue2/9y0OG96lu/g/LA3sOp31X1WMPUd0duzZ2Wce0vGwWh+fS4nJxVu9GN38n//uHT2h+Q8NbY5f9VpjnzrywBAGLtBGmk6kC9C2EKAICbToI0UmWgEqYAgB4T/r9gO9lBkEa27/8LNgAA+hxhCgCAI8IUAABHhCkAAI4IUwAAHBGmAAA4IkwBAHBEmAIA4IgwBQDAEWEKAIAjwhQAAEeEKQAAjghTAAAcEaYAADgiTAEAcESYAgDgiDAFAMARYQoAgCPCFAAAR4QpAACOCFMAABwRpgAAOCJMAQBwRJgCAOCIMAUAwBFhCgCAI8IUAABHhCkAAI4IUwAAHDmH6ebmpnz77beysbFBURRFbaPy37v99/Ai/fY+3+590TmHKUFKURS1fct/Dy/Sj+/z7dwXnXOY2k6CoiiK2j5VxDamH6oThClFUVSfVxHbmH6oThCmFEVRfV5FbGP6oTpBmFIURfV5FbGN6YfqBGFKURTV51XENqYfqhOEKUVRVJ9XEduYfqhO9FSYfvOfX8injX+UV4+9LL/4xS/k5WOvyj82PpUv/vMba3+KoijKvYrYxnSjrp34vnz/xDVrWzeqEz0Tpv/1hxl545VX5a2Pr8l//HcYnt/893/ItU//j3f8DZn5w39lxlAURVHuVcQ2phtFmHZaf/lM/umVX8nHX9t3oN98/bH86pV/ks/+km2jKIqi3KqIbUw3ijDtqL6RP7xzTE59+hdLW1J/+fSUHHvnD/KNpS1by3L144/l46guLcota7+7Ubdk8dIlWbxla7vLtXzVu9521vbvz1VZtrb5VdROUdS9VEVsY7pRhGlH9e9y/h+8XeeKrU2rFW/3+g/n5d9tbUaFQXpp8VZ87Nbi1S6GW4Vh2nYRphRFJVXENqYbRZh2VFfkX37xL3LF2qZXm/1uLcqlSoOAMKUoantVEduYbhRh2lHd/Z2prT16BHx1WWsLHpNGbXogqoBc9oPab4uCxj+ezBUej8JUXyc/mJavZs/11uKl5NF0R+eUCsHcsVE//Rxt7frrqJ95z4Jzjdvyr5OiqN6tIrYx3SjCtKMKPzP9Xx//X0tbUh19ZhrsTm1v7mH4JeHlh0QSIsuL2merfhDFn7Wq0DQ+e1XHri6r136wLHrrqePa2n5g6v2MCgJPP89wfBRYnZ2TGYL5Y6Nw1NY1zkOfJ1zHes/STwGWl5OfKYraNlXENqacuiz/fOSIHMmpQyNDMjRyyNoW1j/LZeu85VQneiBMvbpL3+YNQswLjTgIjEBJ+th3sdlAye5itSCJy++r7/K88kMntW5Sqblb9i04J6M9XXqbFohxuz6f1rfVPQvCND0PRVHbrYrYxpRThGnMdgKd1vqfPvLC8hV5xfZ7ph+/Ja+6/J6p2qUGIREEYBiwesVhqvombXpwpULDEjJhdRqm6lGp2rlmwr2Tc0qHae5Ye+gma6fC1JgjLNs9M4OdoqjtUkVsY7pRPObtoMIg/ZV89Kf1u/QXkMIdV/DmnxuAXgWhoQeMHjh3N0zDQPLXSoVcp+eUCcG8sf7P6bHhfWpnZ2ovfwyBSlHbsYrYxnSjCNM2Sw9SW/uWygumq5mdXRQc4Ru+sfOLKhUa4RdrioLLnCv5zLTDMPXK3xVeveqdg/7Z6pbOyR6C5tjw3M3Pe732uL82T8E9S8JTD2OKorZTFbGN6UYRpm3UXQnSoFRQaGW+wafb9XBKjl/ygjEJFFtw+ZWaKwijrYVpEH45u8X2z0kPwVZjVb9gzahP1JaeJ3qdzBX3Df6hoh3P+5IVRVE9XUVsY7pRhGlB3b0gpSiKojqtIrYx3SjCtEURpBRFUb1VRWxjulGEaW79Xt45RpBSFEX1UhWxjelGEaYURVHUtqkitjH9UJ0gTCmKovq8itjG9EN1gjClKIrq8ypiG9MP1QnClKIoqs+riG1MP1QnCFOKoqg+ryK2Mf1QnXAO02+//dZ6EhRFUVTvl/8eXsQ2rh+qE85hurm5SaBSFEVtw/Lfu/338CL9+B7fzj8ydM5hCgC4t/Xbpqndf2ToCFMAABwRpgAAOCJMAQBwRJgCAOCIMAUAwBFhCgCAI8IUAABHhCkAAI4IUwAAHBGmAAA4IkwBAHBEmAIA4IgwBQDAEWEKAIAjwhQAAEeEKQAAjghTAAAcEaYAADgiTAEAcESYAgDgiDAFAMARYQoAgCPCFAAAR4QpAACOCFMAABwRpgAAOCJMAQBwRJgCAOCIMAUAwBFhCgCAI8IUAABHhCkAAI4IUwAAHJUWppubm7KxsSG3b9/uavlr+msDAFCV0sK0iiCNyl8bAICqlBamtpDrZgEAUJU+C9ObMjM2IAMDWk3O5bcNjMnMTdWstY8lBxXVNjbj/QQA6Dd9FKZzMukHpBF4XgjOpMJUa5+b1ANVD1s9ZH2EKQD0s/4J05szMuYFYbwRzbAEohoT7kSj9rHgWCaUCVMA6Ft9F6b5gddumHrtc5Opx72EKQD0s/76zFSFYFCZ4MsGYviYd1LCzazZ3qoNANBf+uwLSD4VfCpUk8e+5vGworD0pQNTfQYbTECYAkA/64EwXZXPGz+Tn+zfLfX7n5XTi7Y+xdW5KDzb3V1a2tVOd3KOMAWAflZxmK7JwokRGT21KLeXm3LiyJTMrtj6FddW3JwZ88Iw9W3dTsLUE33jd4wwBYC+VW2YLk7LaH1Upm9Y2jqsQt4u0vz90HQ4bi1M48e9fhGmANCXKg3TG9OjUnvsNVmwtEW1troqa5bj6Sqkf/nIGn5bDVNPNDdhCgB9qaIwvSA/3zMsDw3WpDb4kAwPD8vjh8fl4L6dMljfK8curXl9luXisSdlsFaX8Q9tc5gFAEBVKtyZLshrj9VkdPqGdmxF3j5Yl6GJWVk+NyETZy7IB+9+Jn9c08fZCwCAqlQXpitn5UBtl7x8yTy+cvaA1HaNyPj0QluPd6MCAKAq1YXp7IQM1Q7LufSuc/GUPFV7Sk51+CsyAABUpbIwvT41IrWRKbluHF+ThelxGdlVl+fP+5+b6m2tCwCAqlQUpity9kAt+Gw0eL36hVx49wO5cOaoHD2/LLMTQzJ0+JwsZ8blFwAAVakoTGdlYqgmB86uhK8/HJd6bVCenFKfk15+VfbW63L/8D45+NbV1Fh7AQBQlWrC9NoJ2Vc/KG9v8a8d2QoAgKp0L0yXL8qZMxeDR7eXj+2Vkalr9n5brNKtz0vj+HE5HlVjXtaDhiVp6se9asyHLUlb0/tJs9TMHjPkjLur1mW+YV6HX03zxNu7ntx7FVqfbyRtXiX3q03B/A3pdBgAdEv3wvQ3R+V7tbo88szz8sL057Jq6+NQpVLhoAfL0rwZpnEgGH2ToDUCoyhM/fZGU5peuJlhdjeFYZo9T9s/DlpcT8t75Xf1x+vXviTz+lztIEwB9LiKPjMtv0rVMvxSYWqEUtjWbPrjtTf/gjD1A8cfH+zgupamljD1GefaxvW0urayQpAwBdDjCFOraEdmC4k2wtQbFOzIomAsDGcVFEFoJP3Sj0eDCif3fk6Hm3qtfm42/bF64EVzRPPnhKmx02znevLvVXD+qUe+BuO8zHPRr73hhbkRptbrAYDq9FWYho8c05X3ZhyFRLpPeDx+41fhFb5MwscIJSN8Uvy2OHDCgIsyS2c8LjXWTL0OftbOLxXQSSjmhKl+DW1fj/1etQxTI7RTr1NtYbCq68u9HgCoDjvTQlFQRG/genCElbyX60GkQsAPk0z4JKwBnwoHI0x8hWGatOk7vLiCgOtsZ+orvh7zXsX9w0ZDti05n0xbcE7hNeVfDwBUhzBthyVgsjs6nxk+cd+GHwB54aOFoi+18zLXVjoNU2vY2MM0DKto/U6vx6Ofb/o8NU5hSngC6DE85rWFghcC+eGlAsWWEJnw8QRjtXUyYZNeX58j/DnzGDMVsOF12cM0Wj+ewhs7H/xsCdN033aux3udbY/WD9cwr1F9mzd1DeFr/RqStjDg7W3J9QBAddiZ2sSBEZUWTipg2g7TdKBoIZL3eV94/KoalyrVX/+HgfFtWyPMQmEYRf2jtui89GoV7JHU9bS8V6H0P2Li+VJj9XX0MekvINmvBwCqU1qYbmxsWEOuG+WvDQBAVUoL083NzUoC1V/TXxsAgKqUFqYAAPQrwhQAAEeEKQAAjghTAAAcEaYAADgiTAEAcESYAgDgiDAFAMARYQoAgCPCFAAAR4QpAACO7ltbWxOKoiiKorZe7EwBAHBEmAIA4IgwBQDAEWEKAIAjwhQAAEeEKQAAjghTAAAcEaYAADgiTAEAcESYAgDgiDAFAMARYQoAgCPCFAAAR4QpAACOSgvTzc1N2djYkNu3b3e1/DX9tQEAqEppYVpFkEblrw0AQFVKC1NbyHWzAACoSh+F6U2ZGRuQgYFUTc6p9nvLzZmxHrvW5P6PzdxUxyKqbWzG+wkAtp/+C1P9DfvmjIxVHjJlm5PJIDwnvZ903vEeCdOBgTEx85QwBbC99XeYeuYm76038eB6MkHaC6L7Pxb+A8a454QpgO2tz8PUdiza2YWlP5JMPzpNNnrmGGPnpXa/2XmiwFNjJyczO8owGKPSAzLnHC1r2eWtWcZ1zIT3VM2R9Nfu9dxkfps6Yl673te+jv/fQh9j3oOc+wUAJenvMFVv6plQjA7o7em+XrjMBD+rMZkgUEHUbgilHn0acwQH5sz+uedozmNnW7P86zCvwbz/YVs0Nv3fxnsd3tyAOU96neh1cm7m3Krddr8AoCR9/gWk6A1XyYSR9kas3oQzuxpbgOnB0/aOTjsTy5hY4TnqbelrbrHmXb+OdGDq/dNtKereh1Nn1zHDMzovdS2t7hcAlKQHwnRVPm/8TH6yf7fU739WTi/a+hRXsVZv5qHwTdh/Y06V6mO0q3mMN+5YOPeWQ8gID1PLcywcl79mWdeht5vHLIEZn29+m17h6WbPvVWYtrxfAFCSisN0TRZOjMjoqUW5vdyUE0emZHbF1q+4iuW/YUcBYA8UC31c8HNqjOuOLg4Z9VrT+hzzd3jtrVnydRhj7OcWPcId09rCebXrN+7HVsK0jf+mAOCg2jBdnJbR+qhM37C0dVjFWr+Zh2+2tpCZCdui//UZIaHGaPOab+7pdvW6VQhF56oFRO5npj7LuaWvszD4omOu16EFlzk+L+ijcUlbOgDDebYWprb+xv0CgBJUGqY3pkel9thrsmBpi2ptdVXWLMfTVSznzTwKn+jNOH4dlTqudkdx2YIoruSNPWCMnZSZwmDzRYGajIt75J1jLD023S9vzTKuI/qGsF/6jjAvTD3RvJmgDmvSmzP432Ch7Lm3DtPgQMH9AgA3FYXpBfn5nmF5aLAmtcGHZHh4WB4/PC4H9+2UwfpeOXZpzeuzLBePPSmDtbqMf2ibwyxULS+gAeDeV+HOdEFee6wmo9M3tGMr8vbBugxNzMryuQmZOHNBPnj3M/njmj7OXqgaYQqgf1UXpitn5UBtl7x8yTy+cvaA1HaNyPj0QluPd6NC1QhTAP2rujCdnZCh2mE5l951Lp6Sp2pPyakOf0UGAICqVBam16dGpDYyJdeN42uyMD0uI7vq8vx5/3NTva11AQBQlYrCdEXOHqgFn40Gr1e/kAvvfiAXzhyVo+eXZXZiSIYOn5PlzLj8AgCgKhWF6axMDNXkwNmV8PWH41KvDcqTU+pz0suvyt56Xe4f3icH37qaGmsvAACqUk2YXjsh++oH5e0t/rUjWwEAUJXuhenyRTlz5mLw6Pbysb0yMnXN3m+LVa51mW8cl+PHzWouqebAkjSD403vJ81S0zy2Pi8NfZ7GvDd7nmjOpBrzUe9sW3I+7ZyvTas5lfT5H29IfEoAgED3wvQ3R+V7tbo88szz8sL057Jq6+NQ5QrDKQkyTxCS9nDL9lNhqoJID6il+eIwjeczxodt0Vzr841knbbO16bVnB41hxGwS/OEKQCkVPSZaflVLks4+Yxdpwqipn9M263pfYz+7UiFqXEeZvCFQRut28752mxhTgBABmFqlRMkOTvFpaa3Q40SyRK47Qdq+2Ea7CLjR8btnK9NizmNYAUAtNJXYRqEXhBuetmCLm9XpoeP9rMeWpndYNgvfy1d2DdeN5grCjR9Hq+Mz17bOV+bFnOmrkO/d/nzAUB/Ymdq1dnO1Bfv6nIfrUbBpdrUXGFARf1T4eZVElzaekbI+to43xbrWefMrOEzrxkAECJMrezhZH5BJx0s4etGI/UlHp0RxjZqjnQoBvT1wvOLHy23db42reZMX5/PdgwAwGNea9hYwinYqelBYgkW1See03udbW/1OWQ4Z3GY+i/182nnfG1azRmFsX6+hCkA2LAztVK7NC84kkqHri1YonFJmJpztApSXwdhaqzVzvnatJpTyVwDYQoAaaWF6cbGhjXkulH+2gAAVKW0MN3c3KwkUP01/bUBAKhKaWEKAEC/IkwBAHBEmAIA4IgwBQDAEWEKAIAjwhQAAEeEKQAAjghTAAAcEaYAADgiTAEAcESYAgDg6L61tTWhKIqiKGrrxc4UAABHhCkAAI4IUwAAHBGmAAA4IkwBAHBEmAIA4IgwBQDAEWEKAIAjwhQAAEeEKQAAjghTAAAcEaYAADgiTAEAcESYAgDgqLQw3dzclI2NDbl9+3ZXy1/TXxsAgKqUFqZVBGlU/toAAFSltDC1hVw3CwCAqvRRmN6UmbEBGRjQa0xmbqpmKzVmbMb7qRfYrsF2fkm/scwF2q7JMu/kXNg0N2ke1yvqAwB9rv/CVAuRuUk/FFoFqi14qtQ6CJNs08MxfX3pOeZk0u+XnnMmLyijuYv+IQIA/aOvw1RuzsiYFyTZ3VuvslxDIH08ej0WXF8mKPW+6h60vclUO9Xtc88A4O4jTONgUDu0ycnwfwcmvSPpMVGfmfB40C8MonCXG5YeNPpxs63FesHPiWCO4Bws16DcnBnzxkW7Ra1fJvxSc6h7YJszy7aL9anjcem71vx7ljDHE9QAthse88bBFb2h60GQHpPuk4RAFADmnN547XFp2JYeq6/nUeGXhE3YL5w/ew0xY5zZL3NO6Tn0z0VtcyvhPDlBqI1rfZ1q/fR9jybNXD8A9L4+/wKSvgNMvakH0sGT7WMGlTfC2CGmGEFhW89nC5cWQRhpEabmnHlzmPcne1oqcNMNwfHU9Vp3/Mk44x5lxufdFwDoXT0QpqvyeeNn8pP9u6V+/7NyetHWp7iKtQiigO1NvFUohQrDNAohrcLh+aERzhHOGcwf98m/htzHvEGrJw7bovug2o1/aNiOhez/eAivrZ0wDX/2506V5b4AQK+qOEzXZOHEiIyeWpTby005cWRKZlds/YqrWFGIlB+mUVDE3eNAC17khqk30NvZ+XOEfZIuedegjscd7f2ix69jLe9DdN5JQGauQ+e4M02vBQDbUbVhujgto/VRmb5haeuwilUVpklQhH3bCFO17tiYP96yQzSuQc1T2M8X9dXavDCMPu8NpcYWfkFJzam1m/cke53mfbHch7kZwhXAtlJpmN6YHpXaY6/JgqUtqrXVVVmzHE9XsbyAiVje1DNjsn1ahWncX9XkZJs7U5/axVqDTs0XldnH1+Ja1bxxW/Rar3icfb244nM3r9MM9ux1ZnajUWBbxwNA76soTC/Iz/cMy0ODNakNPiTDw8Py+OFxObhvpwzW98qxS2ten2W5eOxJGazVZfxD2xxm3XNsj08BAD2pwp3pgrz2WE1Gp29ox1bk7YN1GZqYleVzEzJx5oJ88O5n8sc1fZy97i1qR5i3awUA9JTqwnTlrByo7ZKXL5nHV84ekNquERmfXmjr8W5U94roc9X8x9EAgF5TXZjOTshQ7bCcS+86F0/JU7Wn5FSHvyIDAEBVKgvT61MjUhuZkuvG8TVZmB6XkV11ef68/7mp3ta6AACoSkVhuiJnD9SCz0aD16tfyIV3P5ALZ47K0fPLMjsxJEOHz8lyZlx+AQBQlYrCdFYmhmpy4OxK+PrDcanXBuXJKfU56eVXZW+9LvcP75ODb11NjbUXAABVqSZMr52QffWD8vYW/9qRrQAAqEr3wnT5opw5czF4dHv52F4Zmbpm77fFKtX6vDSON2R+Xb3eijLmKHI31ujGeQPAPaZ7Yfqbo/K9Wl0eeeZ5eWH6c1m19XGoUhGmhCkAdKCiz0zLr1IRpoQpAHSAMLWJAmXJ/9/jctyv5pJqXJJmdMyvxrxEubM+34iPN5pNLZTyxqzLfCM53gg62475h7VzieZNB99SMx5njA2Op/slr/PPO8V2Dr68ddV1N5e06/fvo94/vq8AsH31VZguNdUbuFFN7y0/JQqNKPTU68z7vn481ScMKEsoaf2CPloY+2zHolBKgnVJlvwfg7nUGulz1F+3CtN2z7vlOeSsG/8jQt3jKESjzunzAoBtip2pTRAI+pt8uFuMgiQdyn42ZEIwNYdtTBwueqDnHssL/XCNbAhr55wOLe110XnHcs6h5bpe73BnGrZk5s5bCwC2GcLUJvMmnwREuHOLQiUJi1ahlDcmEgVtvOvzGMcIUwDoaTzmzQ0pLdyCIAlDIZgjCg/tuPGzJwzQMChyx2iCPqmD8bH0+bT9mNfeFt4H1dbivI1x6mf7OeSsS5gC6BPsTG3Um3yz6QeLHzx6iIThERxvNo2wCENK9de/yJMzJgyuaEwY6rZjARV6YenzamFk9NFCzKOfW9M7h3iOVJvtvON5bOeQOa6vS5gC6A+lhenGxoY15LpR/toAAFSltDDd3NysJFD9Nf21AQCoSmlhCgBAvyJMAQBwRJgCAOCIMAUAwBFhCgCAI8IUAABHhCkAAI4IUwAAHBGmAAA4IkwBAHBEmAIA4Oi+tbU1oSiKoihq68XOFAAAR4QpAACOCFMAABwRpgAAOCJMAQBwRJgCAOCIMAUAwBFhCgCAI8IUAABHhCkAAI4IUwAAHBGmAAA4IkwBAHBEmAIA4Ki0MN3c3JSNjQ25fft2V8tf018bAICqlBamVQRpVP7aAABUpbQwtYVcNwsAgKr0UZjelJmxARkYm/F+6rYq1wYA3G2E6V1wc2ZMBgbGZCZeiDAFgHsZYXoXZMMUAHAv6/MwnZPJAe9YXNkAnJvU2ye9EbbjAzKmBqaPh+t1urZqm5wJx6k+k9HiAICe0sdhqgJLC7gwCJNQS7+WuTkVpt5cM0mypfsVP+YtWjsK2ui1Gq+FOQCgd/RvmM5NpgLPc3NGxrwQC3aZ+s9FgrmSnWNhmBatHYWpthXl0TEA9K4eCNNV+bzxM/nJ/t1Sv/9ZOb1o61NcxcxAs4dTGGJBoKUCMkO169VumBauTZgCwLZScZiuycKJERk9tSi3l5ty4siUzK7Y+hVXsQ53hy3CNAw2rS3VtyhMC9cmTAFgW6k2TBenZbQ+KtM3LG0dVrFUoEWBFb/2M857HX8uqfrrn1Oqz0zTwRaO6yBMC9cmTAFgO6k0TG9Mj0rtsddkwdIW1drqqqxZjqerWDrQfCq04kp/wScK1HS7OW5yMr2L1dqD9TpdmzAFgO2kojC9ID/fMywPDdakNviQDA8Py+OHx+Xgvp0yWN8rxy6teX2W5eKxJ2WwVpfxD21zmAUAQFUq3JkuyGuP1WR0+oZ2bEXePliXoYlZWT43IRNnLsgH734mf1zTx9kLAICqVBemK2flQG2XvHzJPL5y9oDUdo3I+PRCW493owIAoCrVhenshAzVDsu59K5z8ZQ8VXtKTnX4KzIAAFSlsjC9PjUitZEpuW4cX5OF6XEZ2VWX58/7n5vqba0LAICqVBSmK3L2QC34bDR4vfqFXHj3A7lw5qgcPb8ssxNDMnT4nCxnxuUXAABVqShMZ2ViqCYHzq6Erz8cl3ptUJ6cUp+TXn5V9tbrcv/wPjn41tXUWHsBAFCVasL02gnZVz8ob2/xrx3ZCgCAqnQvTJcvypkzF4NHt5eP7ZWRqWv2flusci1J83jT+786/9hxOZ453iXr89I43pD59dTPbYnOPalG+4Nz2O4RAPSn7oXpb47K92p1eeSZ5+WF6c9l1dbHocplCYqlphxvNKXZOC5NpwRZl3lvjo7DrIQwLfe8CVMAiFT0mWn5Va5sUCw1wyBZn2/IcadUKiFMO0aYAsDdRJi2xQ8OfVeohYi/Y9VDzngdBlDyaPXPxuvjjXlZV/2bTS+kg3nD4DP6BFPl7Uxz+hvywjRvbBvnHfQDAPj6Kkz93WUcCHG1sbsKHvGaQRMHU4swDXaxmeBJ7fCC/jk71SA01Vq5YarR+xtSoVkwtq3zBgDE2Jm2wRrCUWK1CNMoKM3AtoWpGW7p9YrC1NrfkLczzRnbznkDAGKEaSE/iMywC8NMBU2rMFWiwAqDqHWYBrvCOMS0EMwJ09z+BvvxorEtzxsAEOMxr7H7sgjCLt0nHXJJCIVrmGHqC46HA1qGadAvesQatOnrZMM0t7/BHqbtjM09bwBAjJ1pgSRMTPrx4GcviIIwaibhGO78orYkkOPjfpClwjQK56Ddm8sM7WyY5vY3hGGanIvf1+uUM7at81bHAAAlhunGxoY15LpR/toAAFSltDDd3NysJFD9Nf21AQCoSmlhCgBAvyJMAQBwRJgCAOCIMAUAwBFhCgCAI8IUAABHhCkAAI4IUwAAHBGmAAA4IkwBAHBEmAIA4Oi+tbU1oSiKoihq68XOFAAAR4QpAACOCFMAABwRpgAAOCJMAQBwRJgCAOCIMAUAwBFhCgCAI8IUAABHhCkAAI4IUwAAHBGmAAA4Efn/nSdVp7T91gAAAAAASUVORK5CYII=" title="Azure DevOps Variables" width="467" height="352" class="img_ev3q"></p>
</li>
<li>
<p>Click <strong>Save</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="test--final-approval-of-azure-devops-pipeline">Test &amp; final approval of Azure DevOps Pipeline<a href="#test--final-approval-of-azure-devops-pipeline" class="hash-link" aria-label="Direct link to Test &amp; final approval of Azure DevOps Pipeline" title="Direct link to Test &amp; final approval of Azure DevOps Pipeline">​</a></h4>
<p>Now that the Azure Pipeline has been created and variables set, it&#x27;s time to test, warning <strong>this will run an actual deployment to your Azure subscription</strong>!</p>
<p>We will deploy a once-off to grant the pipeline access to the service principal created earlier and verify that it works.</p>
</li>
<li>
<p><a href="https://go.microsoft.com/fwlink/?LinkId=2014676&amp;githubsi=true&amp;clcid=0x409&amp;WebUserId=e3e298aac5104b0e8e949b3b5bbeb314" target="_blank" rel="noopener noreferrer"><strong>Sign in to Azure DevOps</strong></a></p>
</li>
<li>
<p>Navigate to the DNS As Code <strong>project</strong> you created earlier</p>
</li>
<li>
<p>Click on <strong>Pipelines</strong></p>
</li>
<li>
<p>Click on your <strong>Pipeline</strong></p>
</li>
<li>
<p>Select <strong>Run pipeline</strong></p>
</li>
<li>
<p>Click <strong>Run</strong></p>
</li>
<li>
<p><strong>Click</strong> on A<strong>gent job 1</strong></p>
</li>
<li>
<p>You will see a message: <strong>This pipeline needs permission to access a resource before this run can continue</strong></p>
</li>
<li>
<p>Click <strong>View</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure DevOps - badasscloud.com DNS deployment" src="/assets/images/azuredevops-spn-approval-0fcf8a42adc8b7fd660fa7450a75810e.png" title="Azure DevOps - badasscloud.com DNS deployment" width="1163" height="268" class="img_ev3q"></p>
</li>
<li>
<p>Click <strong>Permit</strong></p>
</li>
<li>
<p>Click <strong>Permit</strong> again, to authorise your SPN access to your pipeline for all future runs</p>
</li>
<li>
<p>Your <strong>pipeline</strong> will be added to the <strong>queue</strong> and once an agent becomes available will start to <strong>run</strong>.</p>
</li>
</ol>
<p>As seen below, there were no resources before my deployment and the Azure Pipeline agent kicked off and created the resources in the Azure portal.</p>
<p><em>Note: You can expand the Agent Job to see the steps of the job, I hid it as it revealed subscription ID information etc during the deployment.</em></p>
<p><img decoding="async" loading="lazy" alt="Azure DevOps - badasscloud.com DNS deployment" src="/assets/images/azure-devopsdeployment-azurebicep-0f0cec1c6184280292a7b7da08818505.gif" title="Azure DevOps - badasscloud.com DNS deployment" width="1443" height="865" class="img_ev3q"></p>
<p>Remember to update your nameserver records for your domain to point towards the nameserver entries in the Azure DNS zone resource, to use Azure DNS!</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="edit-the-bicep-file">Edit the Bicep file<a href="#edit-the-bicep-file" class="hash-link" aria-label="Direct link to Edit the Bicep file" title="Direct link to Edit the Bicep file">​</a></h4>
<p>Now that you have successfully deployed your Azure Bicep file, you can go into the Azure Bicep and update the A, CNAME records to match your own environment - any new change to this repository will automatically trigger Continous Integration and deployment, you can override this behaviour by editing the Pipeline, clicking Edit Trigger and unselect &#x27;Enable; continuous integration</p>
<p>Each variable <em>(var object) (cnames, arecords)</em> is enclosed in brackets, this array allows you to add multiple records, for example, if I wanted to add another name record, it would look like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">//Variable array for your CNAME records. Add, remove and amend as needed, any new record needs to be included in {}.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var cnamerecords = [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> name: &#x27;blog&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> value: &#x27;luke.geek.nz&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> name: &#x27;fancierblog&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> value: &#x27;azure.com&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Simply add another object under the first, as long as it is included in the brackets, then upon deployment Azure Bicep will parse the variable array and for each record, create/modify the DNS records, you only ever need to edit the content in the variable without touching the actual resource deployment.</p>
<p>As records are added and removed over time, you will develop a commit history and with the power of Azure DevOps, can implement scheduling changes at certain times and approval!</p>
<p>Hopefully, this article helps you achieve Infrastructure as Code for your Azure DNS resource, the same concept can be applied for other resources using Azure Bicep as well.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/controlled-chaos-in-azure-using-chaos-studio/">Controlled Chaos in Azure using Chaos Studio</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-06T00:00:00.000Z">January 6, 2022</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Chaos engineering has been around for a while; Netflix runs their own famous <a href="https://netflix.github.io/chaosmonkey/" target="_blank" rel="noopener noreferrer">Chaos Monkey</a>, supposedly running 24/7, taking down their resources and pushing them to the limit continuously; it almost sounds counter-intuitive – but it&#x27;s not.</p>
<blockquote>
<p>Chaos engineering is defined as “the discipline of experimenting on a system in order to build confidence in the system’s capability to withstand turbulent conditions in production” (Principles of Chaos Engineering, <a href="http://principlesofchaos.org/" target="_blank" rel="noopener noreferrer" title="http://principlesofchaos.org/">http://principlesofchaos.org/</a>). In other words, it’s a software testing method focusing on finding evidence of problems before they are experienced by users.</p>
<p>Chaos engineering is a methodology that helps developers attain consistent reliability by hardening services against failures in production. Another way to think about chaos engineering is that it&#x27;s about embracing the inherent chaos in complex systems and, through experimentation, growing confidence in your solution&#x27;s ability to handle it.</p>
<p>A common way to introduce chaos is to deliberately inject faults that cause system components to fail. The goal is to observe, monitor, respond to, and improve your system&#x27;s reliability under adverse circumstances. For example, taking dependencies offline (stopping API apps, shutting down VMs, etc.), restricting access (enabling firewall rules, changing connection strings, etc.), or forcing failover (database level, Front Door, etc.), is a good way to validate that the application is able to handle faults gracefully.</p>
</blockquote>
<p>Introducing controlled Chaos tools such as Chaos Monkey and now – <a href="https://azure.microsoft.com/en-us/services/chaos-studio/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Chaos Studio</a> allows you to put pressure and, in some cases, take down your services to teach you how your services will react under strain and identity areas of improvement as resiliency and scalability to improve your systems.</p>
<p><img decoding="async" loading="lazy" alt="Chaos" src="/assets/images/chaosengineering-banner-0929ef3aa12bf5e4832160ff75a00b4b.png" title="Chaos" width="2400" height="700" class="img_ev3q"></p>
<p>Azure Chaos Studio <em>(currently in Preview and only supported in several</em> <a href="https://azure.microsoft.com/en-us/global-infrastructure/services/?products=chaos-studio&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer"><em>regions</em></a><em>now)</em> is an enabler for &#x27;controlled Chaos&#x27; in the Microsoft Azure ecosystem. Using that same tool that Microsoft uses to test and improve their services – you can as well!</p>
<p>Chaos Studio works by creating Experiments <em>(i.e., Faults/Capabilities)</em> that run against Targets <em>(your resources, whether they are agent or service-based)</em>.</p>
<p>There are two types of methods you can use to target your resources:</p>
<ul>
<li>Service-direct</li>
<li>Agent-based</li>
</ul>
<p>Service-direct is tied into the Azure fabric and puts pressure on your resources from outside them <em>(i.e., supported on most resources that don&#x27;t need agent-based, PaaS resources, such as Network Security Groups).</em> For example, a service-direct capability may be to add or remove a security rule from your network security group for faulty findings.</p>
<p>Agent-based relies on an agent installed; these are targeted at resources such as Virtual Machine and Virtual Machine scale sets; agent-based targets use a user-assigned managed identity to manage an agent on your virtual machines and wreak havoc by running capabilities such as stopping services and putting memory and disk pressure on your workloads.</p>
<p>Just a word of warning, before you proceed to allow Chaos to reign in your environment, make sure it is done out of hours or, better yet – against development or test resources, also make sure that any resources that support autoscaling are disabled – or you might suddenly find ten more instances of that resource you were running <em>(unless of course you&#x27;re testing that autoscaling is working)</em>! 😊</p>
<p>In my test setup, I have the following already pre-created that I will be running my experiments against:</p>
<ul>
<li>Virtual Machine Scale set <em>(running Windows with two instances)</em></li>
<li>Single Virtual Machine <em>(running Windows)</em> to test shutdown against</li>
</ul>
<p>The currently supported resource types of Azure Chaos Studio can be found &#x27;<a href="https://learn.microsoft.com/en-us/azure/chaos-studio/chaos-studio-fault-providers?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">here</a>&#x27;.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-chaos-studio">Setup Azure Chaos Studio<a href="#setup-azure-chaos-studio" class="hash-link" aria-label="Direct link to Setup Azure Chaos Studio" title="Direct link to Setup Azure Chaos Studio">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-managed-identity">Create Managed Identity<a href="#create-managed-identity" class="hash-link" aria-label="Direct link to Create Managed Identity" title="Direct link to Create Managed Identity">​</a></h4>
<p>Because we will use Agent-based capabilities to generate our Faults, I needed to create a Managed Identity to give Chaos Studio the ability to wreak havoc on my resources!</p>
<ol>
<li>In the <strong>Azure Portal,</strong> search for <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.ManagedIdentity%2FuserAssignedIdentities" target="_blank" rel="noopener noreferrer"><strong>Managed Identities</strong></a></li>
<li>Click on <strong>Create</strong></li>
<li><strong>Select</strong> the <strong>subscrSubscription</strong>ng the resources that you want to test against</li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to place the managed identity in (<em>I suggest creating a new Resource Group, as your Chaos experiments may have a different lifecycle than your resources, but it&#x27;s just a preference, I will be placing mine in the Chaos Studio resource group so I can quickly delete it later)</em>.</li>
<li><strong>Select</strong> the <strong>RegionRegion</strong>ur resources</li>
<li>Type in a <strong>name</strong> (<em>this will be the identity that you will see in logs running these experiments, so make sure its something you can identify with)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create User Management Identity" src="/assets/images/azure_userassignedmanageidentity-8f2cdc8b86ee1f35091c9270a3061f5a.png" title="Azure Portal - Create User Management Identity" width="602" height="347" class="img_ev3q"></li>
<li>Click <strong>Next: Tags</strong></li>
<li>Make sure you enter appropriate tags to make sure that the resource can be identified and tracked, and click <strong>Review + Create</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal Tags" src="/assets/images/azuretags_chaos-3882e50f463cdfc7bb84fb50a0845993.png" title="Azure Portal Tags" width="602" height="238" class="img_ev3q"></li>
<li>Verify that everything looks good and click <strong>Create</strong> to create your User Assigned Managed identity.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-application-insights">Create Application Insights<a href="#create-application-insights" class="hash-link" aria-label="Direct link to Create Application Insights" title="Direct link to Create Application Insights">​</a></h4>
<p>Now, it&#x27;s time to create an Application Insights resource. Applications Insights is for the logs of the experiments to go into, so you can see the faults and their behaviours.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, search for <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.insights%2Fcomponents" target="_blank" rel="noopener noreferrer"><strong>Application Insights</strong></a></li>
<li>Click on <strong>Create</strong></li>
<li><strong>Select</strong> the <strong>Subscription</strong> the resources that you want to test against</li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to place the Application Insights resource into (<em>I suggest creating a new Resource Group, as your Chaos experiments may have a different lifecycle than your resources, but it&#x27;s just a preference, I will be placing mine in the Chaos Studio resource group so I can easily delete it later)</em>.</li>
<li><strong>Select</strong> the <strong>Region</strong> the resources are in</li>
<li>Type in a <strong>name</strong></li>
<li><strong>Select</strong> your <strong>Log Analytics workspace</strong> you want to link Application Insights to <em>(if you don&#x27;t have a Log Analytics workspace, you can create one &#x27;</em><a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.OperationalInsights%2Fworkspaces" target="_blank" rel="noopener noreferrer"><em>here</em></a><em>&#x27;)</em>.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Application Insights" src="/assets/images/azure_applicationinsights-c4676bae524a9a2cafbeaa8ed778cc01.png" title="Azure Portal - Application Insightsv" width="602" height="520" class="img_ev3q"></li>
<li>Click <strong>Tags</strong></li>
<li>Make sure you <strong>enter appropriate tags</strong> to make sure that the resource can be identified and tracked, and click <strong>Review + Create</strong></li>
<li>Verify that everything looks good and click <strong>Create</strong> to create your Application Insights.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-chaos-studio-targets">Setup Chaos Studio Targets<a href="#setup-chaos-studio-targets" class="hash-link" aria-label="Direct link to Setup Chaos Studio Targets" title="Direct link to Setup Chaos Studio Targets">​</a></h4>
<p>It is now time to add the resources targets to Chaos Studio</p>
<ol>
<li>In the <strong>Azure Portal</strong>, search for <a href="https://portal.azure.com/#blade/Microsoft_Azure_Chaos/ChaosStudioMenuBlade/overview" target="_blank" rel="noopener noreferrer"><strong>Chaos Studio</strong></a></li>
<li>On the left band side Blade, select <strong>Targets</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio" src="/assets/images/azure_chaosstudio_targets-989d1638d9ab55b2a648197eb570d72f.png" title="Azure Chaos Studio" width="602" height="125" class="img_ev3q"></li>
<li>As you can see, I have a Virtual Machine Scale Set and a front-end Network Security Group.</li>
<li><strong>Select</strong> the <strong>checkbox</strong> next to Name to <strong>select all</strong> the Resources</li>
<li>Select <strong>Enable Targets</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio" src="/assets/images/azure_chaosstudio_targets2-52ce0a064e8a54465447a2997047630b.png" title="Azure Chaos Studio" width="602" height="106" class="img_ev3q"></li>
<li>Select <strong>Enable service-direct targets (All resources)</strong></li>
<li>Enabling the service-direct targets will then add the capabilities supported by Service-direct targets into Chaos Studio for you to use.</li>
<li>Once completed, I will <strong>select</strong> the scale set and click <strong>Enable Target</strong></li>
<li>Then finally, <strong>Enable agent-based targets (VM, VMSS)</strong></li>
<li>This is where you link the user-managed identity, and Application Insights created earlier</li>
<li><strong>Select</strong> your <strong>Subscription</strong></li>
<li>Select your <strong>managed identity</strong></li>
<li>Select Enabled for Application Insights and select your Application Insights account. The instrumentation key should be selected manually.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio - Enable targets" src="/assets/images/azure_chaosstudio_enableagenttargets-620b1ddfd69c44193fff354eaca7ceb8.png" title="Azure Chaos Studio - Enable targets" width="602" height="584" class="img_ev3q"></li>
<li><em>If your instrumentation key isn&#x27;t filled in, you can find it on the Overview pane of the Application Insights resource.</em></li>
<li>Click <strong>Review + Enable</strong></li>
<li><strong>Review</strong> the <strong>resources</strong> you want to enable Chaos Studio to target and select <strong>Enable</strong></li>
<li>Finally, you should now be back at the Targets pane make sure you select Manage actions and make sure that all actions are ticked and click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio Capabilities" src="/assets/images/azurechaosactions-1af7db09581d9982ae10818aa1075db4.png" title="Azure Chaos Studio Capabilities" width="829" height="679" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-and-run-azure-chaos-studio">Configure and run Azure Chaos Studio<a href="#configure-and-run-azure-chaos-studio" class="hash-link" aria-label="Direct link to Configure and run Azure Chaos Studio" title="Direct link to Configure and run Azure Chaos Studio">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="action-exclusions">Action exclusions<a href="#action-exclusions" class="hash-link" aria-label="Direct link to Action exclusions" title="Direct link to Action exclusions">​</a></h4>
<p>There may be actions that you don&#x27;t want to be run against specific resources; an example might be you don&#x27;t want anyone to kill any processes on a Virtual Machine.</p>
<ol>
<li>In the Target pane of Chaos Studio, select <strong>Actions</strong> next to the resource</li>
<li><strong>Unselect</strong> the <strong>capability</strong> you don&#x27;t want to run on that resource</li>
<li>Select <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio Actions" src="/assets/images/azure_chaosstudio_manageactions-5786b1de8eca578ccac4c06c5e680398.png" title="Azure Chaos Studio - Enable targets" width="602" height="641" class="img_ev3q"></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-experiments">Configure Experiments<a href="#configure-experiments" class="hash-link" aria-label="Direct link to Configure Experiments" title="Direct link to Configure Experiments">​</a></h4>
<p>An experiment is a collection of capabilities to create faults, put pressure on your resources, and cause Chaos that will run against your target resources. These experiments are saved so you can run them multiple times and edit them later, although currently, you cannot reassign the same experiments to other resources.</p>
<p>Note: If you name an Experiment the same as another experiment, it will replace the older Experiment with your new one and retain the previous history.</p>
<ol>
<li>In the <strong>Azure Portal,</strong> search for <a href="https://portal.azure.com/#blade/Microsoft_Azure_Chaos/ChaosStudioMenuBlade/overview" target="_blank" rel="noopener noreferrer"><strong>Chaos Studio</strong></a>.</li>
<li>On the left band side Blade, select <strong>Experiments</strong></li>
<li>Click <strong>+ Create</strong></li>
<li><strong>Select</strong> your <strong>Subscription</strong></li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to save the Experiment into</li>
<li><strong>Type</strong> in a <strong>name</strong> for your <strong>Experiment</strong> that makes sense; in this case, we will put some Memory pressure on the VM scale set.</li>
<li><strong>Select</strong> your <strong>Region</strong></li>
<li>Click <strong>Next: Experiment Designer</strong></li>
<li><strong>Using</strong> Experiment <strong>Designer</strong>, you can <strong>design</strong> your <strong>Faults</strong>; you can have multiple capabilities hit a resource with expected delays, <em>i.e., you can have Memory pressure on a VM for 10 minutes, then CPU pressure, then shutdown.</em></li>
<li>We are going to select <strong>Add Action</strong></li>
<li>Then <strong>Add Fault</strong></li>
<li>I am going to select <strong>Physical Memory</strong> pressure</li>
<li>Leave the duration to <strong>10 minutes</strong></li>
<li>Because this will go against my VM scale set, I will add in the instances I want to target <em>(if you aren&#x27;t targeting a VM Scale set, you can leave this blank, you can find the instance ID by going to your VM Scale set click on Instances, click on the VM instance you want to target and you should see the Instance ID in the Overview pane)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio - Add fault" src="/assets/images/azure_chaosstudio_createexperimentaddfault-f6ff8fd1cfc8dab21fb1bcb99813e20d.png" title="Azure Chaos Studio - Add fault" width="602" height="441" class="img_ev3q"></li>
<li>Select <strong>Next: Target resources</strong></li>
<li><strong>Select</strong> your <strong>resources</strong> <em>(you will notice as this is an Agent-based capability, only agent supported resources are listed)</em></li>
<li>Select <strong>Add</strong></li>
<li>I am then going to <strong>Add delay for 5 Minutes</strong></li>
<li>Then add an <strong>abrupt VM shutdown</strong> for 10 minutes <em>(Chaos Studio will automatically restart the VM after the 10-minute duration)</em>.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio create experiment" src="/assets/images/azure_chaosstudio_createexperimentaddfault2-ab12282d4c3801eb941de223ee7bc627.png" title="Azure Chaos Studio create experiment" width="602" height="266" class="img_ev3q"></li>
<li>As you can see with the Branches <em>(items that will run in parallel)</em> and actions, you can have multiple faults running at once in parallel by using branches or one after the other sequentially.</li>
<li>Now that we are ready with our faulty, we are going to click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><em>Note: I had an API error; after some investigation, I found it was having problems with the &#x27;?&#x27; in my experiment name, so I removed it and continued to create the Experiment.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="assign-permissions-for-the-experiments">Assign permissions for the Experiments<a href="#assign-permissions-for-the-experiments" class="hash-link" aria-label="Direct link to Assign permissions for the Experiments" title="Direct link to Assign permissions for the Experiments">​</a></h4>
<p>Now that the Experiment has been created, we need to give rights to the Managed User account created earlier <em>(and/or the System managed identity that was created when the Experiment was created for service-direct experiments)</em>.</p>
<p>I will assign permissions to the Resource Group that the VM Scale set exists in, but you might be better off applying the rights to the individual resource for more granular control. You can see suggested roles to give resources: <a href="https://learn.microsoft.com/en-us/azure/chaos-studio/chaos-studio-fault-providers?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Supported resource types and role assignments for the Chaos Studio</a> Microsoft page.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, click on the <strong>Resource Group</strong> containing the resources you want to run the Experiment against</li>
<li>Select <strong>Access control (IAM)</strong></li>
<li>Click <strong>+ Add</strong></li>
<li>Click <strong>Add Role Assignment</strong></li>
<li>Click <strong>Reader</strong></li>
<li>Click <strong>Next</strong></li>
<li>Select <strong>Assign access to Managed identity</strong></li>
<li>Click on <strong>+ Select Members</strong></li>
<li><strong>Select</strong> the <strong>User</strong> assigned <strong>management identity</strong></li>
<li>Click <strong>Review</strong> and <strong>assign</strong>.</li>
<li>Because the shutdown is a service-direct, <strong>go back and give the experiment system managed identity Virtual Machine Contributor rights</strong>, so it has access to shutdown the VM.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="run-experiments">Run Experiments<a href="#run-experiments" class="hash-link" aria-label="Direct link to Run Experiments" title="Direct link to Run Experiments">​</a></h4>
<p>Now that the Experiment has been created, it should appear as a resource in the resource group you selected earlier; if you open it, you can see the Experiment&#x27;s History, Start, and Edit buttons.</p>
<ol>
<li>Click <strong>Start</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos studio - Run experiment" src="/assets/images/azure_chaosstudio_whatmemory-09151c403439e67c1de46401589b3418.png" title="Azure Chaos studio - Run experiment" width="602" height="145" class="img_ev3q"></li>
<li>Click <strong>Ok</strong> to <strong>start</strong> the <strong>Experiment</strong> <em>(and place it into the queue)</em></li>
<li><strong>Click</strong> on <strong>Details</strong> to see the <strong>experiment progress</strong> <em>(and any errors)</em>, and if it fails one part, it may move to the next step depending on the fault.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos studio - Run experiment" src="/assets/images/azure_chaosstudio_whatmemoryrun-1bac1d245af3399c523a6792dea66041.png" title="Azure Chaos studio - Run experiment" width="602" height="346" class="img_ev3q"></li>
<li><strong>Azure Chaos studio should now run rampant and do best – cause Chaos</strong>!</li>
</ol>
<p>This service is still currently in Preview. If you have any issues, take a look at the: <a href="https://learn.microsoft.com/en-us/azure/chaos-studio/troubleshooting" target="_blank" rel="noopener noreferrer">Troubleshoot issues with Azure Chaos Studio</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-and-auditing-of-azure-chaos-studio">Monitor and Auditing of Azure Chaos Studio<a href="#monitor-and-auditing-of-azure-chaos-studio" class="hash-link" aria-label="Direct link to Monitor and Auditing of Azure Chaos Studio" title="Direct link to Monitor and Auditing of Azure Chaos Studio">​</a></h3>
<p>Now that Azure Chaos Studio is in use by your organization, you may want to know what auditing is available, along with reporting to Application Insights.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="azure-activity-log">Azure Activity Log<a href="#azure-activity-log" class="hash-link" aria-label="Direct link to Azure Activity Log" title="Direct link to Azure Activity Log">​</a></h4>
<p>When an Azure Chaos Studio experiment has touched a resource, there will be an audit trail in the Azure activity log of that resource; here, you can see that &#x27;WhatMemory&#x27;, which is the Name of my Chaos Experiment, has successfully powered off and on my VM.</p>
<p><img decoding="async" loading="lazy" alt="Azure Activity Log - Azure Chaos Studio" src="/assets/images/azure_chaosstudio_activitylog-27476f7626f821f811db0174c941c034.png" title="Azure Activity Log - Azure Chaos Studio" width="602" height="56" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="azure-alerts">Azure Alerts<a href="#azure-alerts" class="hash-link" aria-label="Direct link to Azure Alerts" title="Direct link to Azure Alerts">​</a></h4>
<p>It is easy to set up alerts when a Chaos experiment kicks off; to create an Azure, do the following.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, click on <strong>Azure Monito</strong>r</li>
<li>Click on <strong>Alerts</strong></li>
<li>Click <strong>+ Create</strong></li>
<li>Select <strong>Alert Rule</strong></li>
<li>Click <strong>Create resource</strong></li>
<li><strong>Filter</strong> your resource <strong>type</strong> to <strong>Chaos Experiments</strong></li>
<li><strong>Filter</strong> your <strong>alert</strong> to <strong>Subscription</strong> and click <strong>Done</strong></li>
<li>Click <strong>Add Condition</strong></li>
<li>Select: <strong>Starts a Chaos Experiment</strong></li>
<li>Make sure that: *<em>Event initiated by is set to (All services and users)</em></li>
<li>Click <strong>Done</strong></li>
<li>Click <strong>Add Action Group</strong></li>
<li>If you have one, <strong>assign</strong> an <strong>action group</strong> <em>(these are who and how the alerts will get to you)</em>. If you don&#x27;t have one, click: <strong>+ Create an action group</strong>.</li>
<li><strong>Specify</strong> a resource <strong>group</strong> to hold your action groups <em>(usually a monitor or management resource group)</em></li>
<li>Type the <strong>Action Group name</strong></li>
<li>Type the <strong>Action group Display name</strong></li>
<li>Click <strong>Next: Notifications</strong></li>
<li>Select <strong>Notification Type</strong></li>
<li>Select <strong>email</strong></li>
<li>Select <strong>Email</strong></li>
<li><strong>Type</strong> in your <strong>email</strong> address to be notified</li>
<li>Click <strong>ok</strong></li>
<li><strong>Type</strong> in the <strong>Name</strong> of the <strong>mail</strong> to be a reference in the future <em>(i.e. Help Desk)</em></li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong> to create your Action group</li>
<li>Type in your <strong>rule name</strong> <em>(i.e. Alert – Chaos Experiment – Started)</em></li>
<li>Type in a <strong>description</strong></li>
<li><strong>Specify</strong> the <strong>resource group</strong> to place the alert in <em>(again, usually a monitor or management resource group)</em></li>
<li>Check <strong>Enable alert rule on creation</strong></li>
<li>Click <strong>Create alert rule</strong></li>
</ol>
<p><em>Note: Activity Log alerts are hidden types; they are not shown in the resource group by default, but if you check the: Show hidden types box, they will appear.</em></p>
<p><img decoding="async" loading="lazy" alt="Azure Activity Log - Azure Chaos Studio" src="/assets/images/azure_chaosstudio_alert-9d90704feb648ce05039987b32de9c97.png" title="Azure Activity Log - Azure Chaos Studio" width="602" height="48" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-active-directory-application-proxy-implementation/">Microsoft Entra ID Application Proxy Implementation</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-02T11:00:00.000Z">January 2, 2022</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Are you running internal web-based applications that you want to give access to users working remotely securely without the need for a VPN or firewall? Do you want to enforce or use Azure Conditional Access policies to protect and manage access?</p>
<p>Let me introduce the Microsoft Microsoft Entra ID Application Proxy...</p>
<blockquote>
<p>Application Proxy is a feature of Azure AD that enables users to access on-premises web applications from a remote client. Application Proxy includes both the Application Proxy service which runs in the cloud, and the Application Proxy connector, which runs on an on-premises server. Azure AD, the Application Proxy service, and the Application Proxy connector work together to securely pass the user sign-on token from Azure AD to the web application. Application Proxy also supports single sign-on.</p>
<p>Application Proxy is recommended for giving remote users access to internal resources. Application Proxy replaces the need for a VPN or reverse proxy.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>The <a href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/what-is-application-proxy?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Microsoft Entra ID Application Proxy</a>has been around for a few years, but appears to be a hidden gem; the Application Proxy allows users_(by using Microsoft Entra ID and an Application Proxy Connector(s))_ to connect to internally hosted web applications, by the connector relaying the traffic.</p>
<p><img decoding="async" loading="lazy" alt="Azure Application Proxy - Network Diagram" src="/assets/images/aadproxynetworkdiagram-2d5765b62500f7d92259285b4c784c9a.png" title="Azure Application Proxy - Network Diagram" width="602" height="504" class="img_ev3q"></p>
<p>Application Proxy supports the following types of applications:</p>
<ul>
<li>Web applications</li>
<li>Web APIs that you want to expose to rich applications on different devices</li>
<li>Applications hosted behind a Remote Desktop Gateway</li>
<li>Rich client apps that are integrated with the Microsoft Authentication Library (MSAL)</li>
</ul>
<p>Azure Application Proxy can often be overlooked to solve your business requirements without the need to implement costly third-party firewalls <em>(it also doesn&#x27;t have to be an on-premises workload, for example, if the web application is running on a VM in Azure, it will also work)</em>.</p>
<p>The Azure Application proxy connector is a lightweight agent installed on a Windows Server machine that is logically close to the backend service that you want to deliver through the proxy.</p>
<p>The Connector gives access to and relays the information to the Application proxy service in Microsoft Azure via HTTP/HTTPS as long as it has access to the following:</p>






























<table><thead><tr><th>URL</th><th>Port</th><th>How it&#x27;s used</th></tr></thead><tbody><tr><td>*.msappproxy.net  *.servicebus.windows.net</td><td>443/HTTPS</td><td>Communication between the connector and the Application Proxy cloud service</td></tr><tr><td>crl3.digicert.com  crl4.digicert.com  ocsp.digicert.com  crl.microsoft.com  oneocsp.microsoft.com  ocsp.msocsp.com</td><td>80/HTTP</td><td>The connector uses these URLs to verify certificates.</td></tr><tr><td>login.windows.net  secure.aadcdn.microsoftonline-p.com  *.microsoftonline.com  *.microsoftonline-p.com  *.msauth.net  *.msauthimages.net  *.msecnd.net  *.msftauth.net  *.msftauthimages.net  *.phonefactor.net  enterpriseregistration.windows.net  management.azure.com  policykeyservice.dc.ad.msft.net  ctldl.windowsupdate.com  <a href="http://www.microsoft.com/pkiops" target="_blank" rel="noopener noreferrer">www.microsoft.com/pkiops</a></td><td>443/HTTPS</td><td>The connector uses these URLs during the registration process.</td></tr><tr><td>ctldl.windowsupdate.com</td><td>80/HTTP</td><td>The connector uses this URL during the registration process.</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-application-proxy">Setup Azure Application Proxy<a href="#setup-azure-application-proxy" class="hash-link" aria-label="Direct link to Setup Azure Application Proxy" title="Direct link to Setup Azure Application Proxy">​</a></h2>
<p>I will set up an Azure Application Proxy to grant access to my Synology NAS <em>(Network Attached Storage)</em> device web page in this guide.</p>
<p>Although I am using my local NAS web administration page, it can be any webpage <em>(Unifi Controller, hosted on Apache, IIS etc.)</em> accessible from the connector.</p>
<ul>
<li>I have a Windows Server 2022 Domain Controller.</li>
<li>Synology NAS <em>(not domain joined, but accessible on the network via a DNS record from the domain)</em></li>
<li>Microsoft 365 Developer subscription with appropriate licenses</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites-for-azure-application-proxy-setup">Pre-requisites for Azure Application Proxy setup<a href="#pre-requisites-for-azure-application-proxy-setup" class="hash-link" aria-label="Direct link to Pre-requisites for Azure Application Proxy setup" title="Direct link to Pre-requisites for Azure Application Proxy setup">​</a></h3>
<p>The following resources and rights will be needed to set up Azure Application Proxy:</p>
<ul>
<li>An Microsoft Entra ID tenant</li>
<li>A minimum of Application Administrator rights is required to set up the Application and user and group assignments.</li>
<li>A server running Windows Server 2012 R2 or above to install the Application Proxy connector on (and the permissions to install)</li>
<li>If you are using a third-party domain <em>(you will need a public SSL certificate)</em> and, of course, the ability to edit external DNS records, the domain will need to be added to Microsoft Entra ID as a custom domain in order to be used.</li>
<li>Microsoft Entra ID Premium P1 license or M365 Business Premium/E3 license for each user using Microsoft Entra ID Application Proxy.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Microsoft Entra ID Application Proxy Licensing" src="/assets/images/aadproxylicensing-bda70e279c4daf764b4e2b22e93233e9.png" title="Microsoft Entra ID Application Proxy Licensing" width="633" height="55" class="img_ev3q"></p>
<p><em>(Note: Normal <a href="https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/directory-service-limits-restrictions?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure AD service limits</a> and restrictions apply)</em>.</p>
<p>I will be configuring the Azure Application Proxy on a domain controller running Windows Server 2022.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disable-ie-enhanced-security-configuration">Disable IE Enhanced Security Configuration<a href="#disable-ie-enhanced-security-configuration" class="hash-link" aria-label="Direct link to Disable IE Enhanced Security Configuration" title="Direct link to Disable IE Enhanced Security Configuration">​</a></h3>
<p>The Azure Application Proxy connector requires you to log in to Microsoft Azure, and I will be installing this on a Windows Server 2022 domain controller; if this Enhanced Security Configuration is enabled <em>(as it should be),</em> you will have problems authenticating to Microsoft Azure, so the easiest thing is to turn it off temporarily.</p>
<ol>
<li>Open <strong>Server Manager</strong></li>
<li>Click on <strong>Local Server</strong></li>
<li>Click on: <strong>IE Enhanced Security Configuration</strong></li>
<li>Select Off for: <strong>Administrators</strong></li>
<li><strong>Close</strong> Microsoft <strong>Edge</strong> <em>(if you have it opened)</em></li>
<li><img decoding="async" loading="lazy" alt="Disable IE Enhanced Security Configuration" src="/assets/images/disable_ie_enhancedconfiguration-ecc7f2fdbacc3ea58762a88de73ba352.png" title="Disable IE Enhanced Security Configuration" width="583" height="482" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-azure-application-proxy-connector">Install Azure Application Proxy Connector<a href="#install-azure-application-proxy-connector" class="hash-link" aria-label="Direct link to Install Azure Application Proxy Connector" title="Direct link to Install Azure Application Proxy Connector">​</a></h3>
<ol>
<li>Login to <strong>Azure Portal</strong> <em>(on the server that you want to install the Connector on)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <strong>Application Proxy</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Application Proxy" src="/assets/images/azureportal-applicationproxy-86f9196860d71d2c19d3c4ccfa961650.png" title="Azure Portal - Application Proxy" width="602" height="313" class="img_ev3q"></li>
<li>Click on: <strong>Download connector service</strong>.</li>
<li>Accept the system requirements and click <strong>Accept Terms &amp; Download</strong></li>
<li>A file named: &#x27;AADApplicationProxyConnectorInstaller.exe&#x27; should have been downloaded. <strong>Run</strong> it.</li>
<li>Select: <strong>I agree to the license terms and conditions</strong> and select <strong>Install</strong></li>
<li><img decoding="async" loading="lazy" alt="Microsoft Microsoft Entra ID Application Proxy Connector Installation" src="/assets/images/microsoftazureapplicationproxyconnector-c2f1a096f171f271ab2c9a6e8b45e02a.png" title="Microsoft Microsoft Entra ID Application Proxy Connector Installation" width="493" height="348" class="img_ev3q"></li>
<li>Wait for the Microsoft Microsoft Entra ID Application to display and <strong>log in</strong> with an Microsoft Entra ID account with Application Administrator rights.</li>
<li>The Microsoft Microsoft Entra ID Application <strong>Connector will now</strong> be <strong>registered</strong> in your Microsoft Entra ID tenancy.</li>
<li><img decoding="async" loading="lazy" alt="Microsoft Microsoft Entra ID Application Proxy Connector Installation" src="/assets/images/microsoftazureapplicationproxyconnectorinstalled-61d6ed3714b23ac1900054990e10f310.png" title="Microsoft Microsoft Entra ID Application Proxy Connector Installation" width="491" height="343" class="img_ev3q"></li>
<li>Click <strong>Close</strong></li>
<li>Now <strong>re-enable IE enhanced security configuration</strong>.</li>
</ol>
<p>You should now see two new services appear in services as Automatic (Delayed Start):</p>
<ul>
<li>WAPCsvc - Microsoft AAD Application Proxy Connector</li>
<li>WAPCUpdaterSvc - Microsoft AAD Application Proxy Connector Updater</li>
</ul>
<p>And the following processes running:</p>
<ul>
<li>ApplicationProxyConnectorService</li>
<li>ApplicationProxyConnectorUpdateService</li>
</ul>
<p><img decoding="async" loading="lazy" alt="ApplicationProxyConnectorService" src="/assets/images/azureaadapplicationservices-44038a6b932081da6451e4fa70622052.png" title="ApplicationProxyConnectorService" width="602" height="173" class="img_ev3q"></p>
<p>If you are running Server Core, Microsoft Microsoft Entra ID Application Proxy can be installed via <a href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy-register-connector-powershell?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">PowerShell</a>.</p>
<p>The Azure Application Proxy Connector agent gets <a href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy-faq?WT.mc_id=AZ-MVP-5004796#why-is-my-connector-still-using-an-older-version-and-not-auto-upgraded-to-latest-version-" target="_blank" rel="noopener noreferrer">updated</a> automatically when a new major version is released by Microsoft.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-connector-group">Configure Connector Group<a href="#configure-connector-group" class="hash-link" aria-label="Direct link to Configure Connector Group" title="Direct link to Configure Connector Group">​</a></h3>
<p>Now that you have created the Connector, the Application Proxy has put our Connector in a group that has defaulted to Asia; because you can have more than one Application Proxy Connector for redundancy and different applications, we will create a new Connector Group that is set to use the Australia region if Asia works for you – feel free to skip this step.</p>
<ol>
<li>Login to <strong>Azure Portal</strong> <em>(on any PC/server)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <strong>Application Proxy</strong></li>
<li>You should now see: Default and your Region</li>
<li>If you <strong>expand</strong> the Default <strong>Group</strong>, will you see your Connector:</li>
<li><img decoding="async" loading="lazy" alt="Azure AD Application Proxy Connector Groups" src="/assets/images/azureportal-applicationproxyconnector-56f8578ab1b3a34309b53d160f93e878.png" title="Azure AD Application Proxy Connector Groups" width="602" height="151" class="img_ev3q"></li>
<li>Click on <strong>+ New Connector Group</strong></li>
<li>Give it a <strong>name</strong> <em>(i.e., On-premises</em>)</li>
<li><strong>Select</strong> the <strong>Connector</strong> you had earlier and <strong>select the</strong> region closest to you <em>(currently, the following regions can be chosen: Asia, Australia, Europe, North America)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure AD Application Proxy - New Connector Group" src="/assets/images/azureportal-applicationproxynewconnectorgroup-af685c5de5ec636fd2a720195010423a.png" title="Azure AD Application Proxy - New Connector Group" width="418" height="470" class="img_ev3q"></li>
<li><strong>Click + Create</strong></li>
<li>Clicking create will create your new On-premises connector group and add the Connector to the group.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-your-azure-application-proxy-application">Configure your Azure Application Proxy Application<a href="#configure-your-azure-application-proxy-application" class="hash-link" aria-label="Direct link to Configure your Azure Application Proxy Application" title="Direct link to Configure your Azure Application Proxy Application">​</a></h3>
<p>Now that you have your Connector setup, its time to set up your application</p>
<ol>
<li>Login to <strong>Azure Portal</strong> <em>(on any PC/server)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <strong>Application Proxy</strong></li>
<li>Click on: <strong>+ Configure an app</strong></li>
<li><strong>Fill</strong> in the <strong>details</strong> that match your <strong>application</strong>:</li>
</ol>
<ul>
<li><strong>Name</strong>: This is the application that users will see <em>(i.e. I am going with Pizza, which is the name of my NAS)</em></li>
<li><strong>Internal URL</strong>: This is the internal URL used to access your application inside the network <em>(in my example, it is:</em> <a href="http://pizza.corp.contoso.com/" target="_blank" rel="noopener noreferrer"><em>http://pizza.corp.contoso.com/</em></a><em>)</em></li>
<li><strong>External Url</strong>: This is the external URL that will be created so that users can access the application form; <em>I will go with Pizza.</em> Note this URL down.</li>
<li><strong>Pre-Authentication</strong>: You don&#x27;t have to authenticate with Azure AD, you can use passthrough, but it is not something I would recommend without delving into requirements, testing <em>– I am going to select: Microsoft Entra ID.</em></li>
<li><strong>Connector Group</strong>: Select the connector group you created earlier or that your Connector is signed to.</li>
<li><strong>Leave</strong> all <strong>Additional Settings as default</strong> – they can be changed later if you need to.
<ol>
<li><img decoding="async" loading="lazy" alt="Azure Application Proxy" src="/assets/images/azureportal-applicationproxynewapplication-7cbf63f59473a9b7f78b087eb198d7a4.png" width="602" height="435" class="img_ev3q"></li>
<li><strong>Verify</strong> that <strong>everything</strong> is filled out <strong>correctly</strong> and, click <strong>+ Add</strong></li>
<li>Azure <strong>Application Proxy has now created a new Enterprise Application for you</strong>; based on the name mentioned earlier, if you navigate to the external URL mentioned earlier, you should get a prompt similar to below:</li>
<li><img decoding="async" loading="lazy" alt="Azure AD Login Error" src="/assets/images/azureportal-pizzaloginerror-42785ab1e8d5408afaa8f43d233fe870.png" title="Azure AD Login Error" width="573" height="205" class="img_ev3q"></li>
<li>It is now time to assign the permissions for users to access the Application via Microsoft Entra ID!</li>
</ol>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="assign-rights-to-your-azure-application-proxy-application">Assign rights to your Azure Application Proxy Application<a href="#assign-rights-to-your-azure-application-proxy-application" class="hash-link" aria-label="Direct link to Assign rights to your Azure Application Proxy Application" title="Direct link to Assign rights to your Azure Application Proxy Application">​</a></h3>
<ol>
<li>Login to <strong>Azure Portal</strong> <em>(on any PC/server)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/" target="_blank" rel="noopener noreferrer"><strong>Enterprise Applications</strong></a></li>
<li><strong>Find</strong> the <strong>application</strong> that was <strong>created</strong> earlier by the Azure Application Proxy service.</li>
<li><img decoding="async" loading="lazy" alt="Microsoft Entra ID, Enterprise Application" src="/assets/images/azureportal-enterpriseapplicationspane-2de4247bb9234dde05d2671a5ec32782.png" title="Microsoft Entra ID, Enterprise Application" width="602" height="181" class="img_ev3q"></li>
<li>Click on the <strong>Application</strong></li>
<li>Click on: <strong>Users and Groups</strong></li>
<li>Click <strong>Add Assignment</strong></li>
<li><strong>Add</strong> a <strong>user</strong> or <strong>group</strong> <em>(preferred)</em> you want to have access to this application.</li>
<li>Click <strong>Assigned</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure AD Enterprise Applications - User &amp;amp; Group Assignment" src="/assets/images/azureportal-enterpriseapplicationsuserandgrpassignment-69d996be442fdced516b430831d8bd01.png" title="Azure AD Enterprise Applications - User &amp;amp; Group Assignment" width="602" height="164" class="img_ev3q"></li>
<li>Click on <strong>Application Proxy</strong></li>
<li>Here you can see and edit the information you created earlier when you created the application, <strong>copy</strong> the <strong>External URL</strong></li>
<li><strong>Open</strong> Microsoft <strong>Edge</strong> (<em>or another browser of your choice)</em></li>
<li><strong>Paste</strong> in the External <strong>URL</strong></li>
<li><strong>Log in</strong> with the Microsoft Entra ID <strong>account</strong> that was <strong>assigned</strong> to the Enterprise <strong>application.</strong></li>
<li>You should now have access to your on-premises web application from anywhere in the world, and because you are using Microsoft Entra ID, your conditional access policies and restrictions will be in effect:</li>
<li><img decoding="async" loading="lazy" alt="Synology Login" src="/assets/images/microsoftazureapplicationproxyloginscreen-fe39694a6d81ded2c515d3593bada620.png" title="Synology Login" width="602" height="366" class="img_ev3q"></li>
</ol>
<p><em>Note: Because the Synology web interface was running on port: 5000, I had to go back and add the port to the internal URL, as the Application Proxy was attempting to route to the incorrect port.</em>
<em>Note: You may also notice that Microsoft has supplied an *.msappproxy.net certificate, even if your backend service doesn&#x27;t have one..</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-password-based-single-sign-on">Setup Password-based Single-Sign on<a href="#setup-password-based-single-sign-on" class="hash-link" aria-label="Direct link to Setup Password-based Single-Sign on" title="Direct link to Setup Password-based Single-Sign on">​</a></h3>
<p>Azure Application Proxy supports various <a href="https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy-config-sso-how-to?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">single</a> sign-on methods, including Kerberos SPN integration.</p>
<p>However, my Synology NAS uses standalone accounts, so I will set Password-based single sign-on, allowing the MyApps extension to store my credentials <em>(if you want single-sign-on using the password-based sign in, then every user will need to have this extension configured)</em>.</p>
<ol>
<li>Download and install the <a href="https://microsoftedge.microsoft.com/addons/detail/my-apps-secure-signin-ex/gaaceiggkkiffbfdpmfapegoiohkiipl#:~:text=My%20Apps%20Secure%20Sign-in%20Extension.%20This%20extension%20is,to%20cloud%20applications%20within%20your%20organization%20or%20school." target="_blank" rel="noopener noreferrer"><strong>MyApps Secure Sign-in extension</strong></a></li>
<li><strong>Log</strong> in using your Microsoft account to the MyApps <strong>extension</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure App Proxy" src="data:image/png;base64,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" width="55" height="42" class="img_ev3q"></li>
<li><strong>Login</strong> to <strong>Azure Portal</strong> (<em>on any PC/server)</em></li>
<li>Navigate to: <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview" target="_blank" rel="noopener noreferrer"><strong>Microsoft Entra ID</strong></a></li>
<li>Select <a href="https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/" target="_blank" rel="noopener noreferrer"><strong>Enterprise Applications</strong></a></li>
<li><strong>Find</strong> the <strong>application</strong> that was created earlier by the Azure Application Proxy service.</li>
<li>Click on <strong>Single sign-on</strong></li>
<li>Select <strong>Password-based</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Single Signon" src="/assets/images/azureportal-appproxysso-787853e55af00ba7c8b93691b516313c.png" title="Azure Portal - Single Signon" width="602" height="330" class="img_ev3q"></li>
<li><strong>Type</strong> in the <strong>URL</strong> of the <strong>authentication webpage</strong> and click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure App Proxy" src="/assets/images/azureportal-appproxyssourl-5d42405a2a11ec8a734f62010a7cb9b1.png" width="602" height="177" class="img_ev3q"></li>
<li>The Azure AD Application Proxy didn&#x27;t find my sign-in login and password fields, so I have to manually configure them, select: <strong>Configure Pizza Password Single Sign-on Settings</strong>.</li>
<li>Select: <strong>Manually detect sign-in fields</strong></li>
<li>Select <strong>Capture sign-in fields</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Application Proxy - Configure Sign-on" src="/assets/images/azureportal-configuresignin-3690c855754ef80ac421487f34713026.png" title="Azure Application Proxy - Configure Sign-on" width="427" height="567" class="img_ev3q"></li>
<li>Your MS Edge Extension should show <strong>Capture Field</strong>:</li>
<li><img decoding="async" loading="lazy" alt="Azure Application Configure Extension" src="/assets/images/azureportal-configuresigninextension-a9373fc3fa8b9ce4efd87a8c26837697.png" title="Azure Application Configure Extension" width="602" height="368" class="img_ev3q"></li>
<li><strong>Enter</strong> in your <strong>username</strong></li>
<li>Press <strong>Enter</strong></li>
<li><strong>Enter</strong> in your <strong>password</strong></li>
<li><strong>Select</strong> the MS Apps <strong>extension</strong> and select <strong>Save</strong></li>
<li>Navigate back to the <strong>Azure Portal</strong></li>
<li>Select &#x27;<strong>I was able to sign in.&#x27;</strong></li>
<li>If successful, <strong>Azure AD should now have mapped the fields</strong>:</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Signin Fields" src="/assets/images/azureportal-configuresigninextensionfields-3bff6979c56060c8d3cde50e5410bad1.png" title="Azure Portal - Signin Fields" width="602" height="229" class="img_ev3q"></li>
<li>Click <strong>Save</strong></li>
<li>Next time you log in to the application, the <strong>My Apps Secure Sign-in Extension will have cached the credentials.</strong> It should automatically log you into the application, meaning you should only log in once with your Azure AD credentials.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="access-your-azure-application-proxy-published-application">Access your Azure Application Proxy published application<a href="#access-your-azure-application-proxy-published-application" class="hash-link" aria-label="Direct link to Access your Azure Application Proxy published application" title="Direct link to Access your Azure Application Proxy published application">​</a></h3>
<ol>
<li>You can now go to <a href="https://myapps.microsoft.com/" target="_blank" rel="noopener noreferrer"><strong>My Apps (microsoft.com)</strong></a>, and you will <strong>see</strong> your <strong>application</strong>.</li>
<li><img decoding="async" loading="lazy" alt="M365 Waffle" src="/assets/images/myapps-99da4d897267d11262df7e4934a5b15f.png" width="894" height="491" class="img_ev3q"></li>
<li>Your application will also <strong>appear</strong> in the <strong>Microsoft 365 Waffle</strong> <em>(it may take up to an hour to appear)</em>:</li>
<li><img decoding="async" loading="lazy" alt="M365 Waffle" src="/assets/images/m365waffle_pizza-b955afd467d7362d5928c3f61e63d073.png" width="310" height="742" class="img_ev3q"></li>
</ol>
<p>I recommend you go into the Enterprise Application and upload a better image/logo so your users can quickly tell it apart.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-bicep-and-insert-resource/">Azure Bicep and Insert Resource</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-29T00:00:00.000Z">December 29, 2021</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Azure Bicep is a Domain Specific Language (DSL) for deploying Azure resources declaratively. Azure Bicep is a transparent abstraction over ARM and ARM templates, which means anything that can be done in an ARM Template can be done in Bicep.</p>
<p>Azure Bicep has recently <em>(December 2021)</em> been updated to: v0.4.1124, along with various other hotfixes and enhancements; this version supports &#x27;Insert Resource&#x27; functionality.</p>
<p>Insert Resource simplifies ARM to Bicep conversion without exporting entire ARM templates, then compiles them to Bicep when you are only after export for a single resource.</p>
<p>To use Insert Resource, you will need to have:</p>
<ul>
<li>Bicep version greater than v0.4.1124</li>
<li>Azure CLI</li>
<li>Visual Studio Code with the Bicep extension</li>
</ul>
<p>You can easily install both or upgrade following the Microsoft documentation on the: <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/install?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Install Bicep tools</a> page.
You can also review the Bicep changes and latest release notes on Github here: <a href="https://github.com/Azure/bicep/releases" target="_blank" rel="noopener noreferrer">Azure Bicep releases</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="import-resources-into-bicep-using-azure-cli-and-bicep">Import Resources into Bicep using Azure CLI and Bicep<a href="#import-resources-into-bicep-using-azure-cli-and-bicep" class="hash-link" aria-label="Direct link to Import Resources into Bicep using Azure CLI and Bicep" title="Direct link to Import Resources into Bicep using Azure CLI and Bicep">​</a></h4>
<ol>
<li>Open a new file in <strong>Visual Studio Code</strong></li>
<li>Set the Language mode to <strong>Bicep</strong></li>
<li><img decoding="async" loading="lazy" alt="Visual Studio Code - Bicep" src="data:image/png;base64,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" title="Visual Studio Code - Bicep" width="602" height="69" class="img_ev3q"></li>
<li>Now we need to <strong>login</strong> to <strong>Azure</strong>; in Visual Studio code, click <strong>View</strong> and <strong>Terminal.</strong></li>
<li>In the terminal, type in: <strong>az login</strong></li>
<li>Login to Azure using the credentials that have read access to the Resource you want to export.</li>
<li>Once you are logged in, type in: <strong>az resource list</strong></li>
<li>In the JSON output in the terminal, <strong>copy</strong> the <strong>resource ID</strong> <em>(inside the double quotes from the id value)</em></li>
<li>Now we need to <strong>open</strong> the <strong>Command Palette</strong>, press: CTRL+Shift+P on your keyboard <em>(or click on View, Command Palette)</em></li>
<li><strong>Start typing</strong> in <strong>Bicep</strong>; if you have the latest version, <strong>you should see: Bicep: Insert Resource.</strong>, select this</li>
<li><img decoding="async" loading="lazy" alt="Azure Bicep - Insert Resource" src="/assets/images/bicepinsertresource-feca0c6284259e2abe241ac983ee275b.png" title="Azure Bicep - Insert Resource" width="602" height="111" class="img_ev3q"></li>
<li>Enter in the resource ID you copied earlier.</li>
<li><img decoding="async" loading="lazy" alt="Azure Bicep - Insert Resource" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAlYAAAA5CAMAAADDRpWLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAA5UExURevr6////wCQ8fPz82FhYYuLi9TU1Kurq3p6es3NzWlpaePj48TExNzc3LOzs5ubm7y8vOjo5wAAAK6uBLsAAAATdFJOU////////////////////////wCyfdwIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAF9UlEQVR4Xu2YiWLbNhBEIZHgLdH9/5/tzO6Ch5U4cQ05rTovkQGCuBZYDpZM6aJ/+veUf/5fqdKa6flKqdIa6SGrVGml9HylVGnF1PJKlVZNr0JU4uBZ14sQVbi6Uplrya1EJVytTKyS3EpU4tq4VOFPI7cSlXhQq9aKhfgK19S4XzWhVnIr8XVwCJpX0bHkVqIS16ZpGFvBq+RWohaIreBS/Ce3EtVAbIV3QQDVkluJSuAQlFqJ2jC2itBKbiVqIbUST2BTK7mVqEdRK8qV3EpUItSKoZXcStQi1Eohu6iJ1Eo8gRJb6U1QVKSolQ5BURGplXgCoVZ7yC7E1ylqBa+SW4lalNhKbiUqEmpFr5JbiVq4WjWuVkJUImIrj66EqAZDK3mVqIvUSjyD8t1KiHpIq8QzKN+thKgH1SqyQlRDL4KiPhZbfWt0lXIXuW+mb4dx+kNjn+mmOXIvy+m71dKCJS7Srar1xZ22dOhtuI82ustpnlAnxzUaldk5fW9J9uRD5uF3Xeph1J8yD1yhTy9UN6T8687/y5zVajkZ29mi1eK9W2EsDrd8tCXc4NMkvuRWv2vNw6g/Jap9dqFQ/49p9jdx+m7lbjUPdz6q1JK+6dp2mvE8rq5iuW0Hqz4PK+729kxbHf5FSZNRb8nRAvdRHY16dydcr76gdJARbVH82JU1ANjg5FvWZ5R1FJHSn7Uyt0qDNUIHRfow9b0grwOuOjTtsZ82r7xObUZnZi5swb1M0XEj91F9Nry9hOU2D1RiWYeRWW1bKJ+0T8gMspXDYqLcy7wZ3bCPsV+To1bRHXgxTwN+o1nPo2MZEA34is0r1sey84S6C/e49+OFLegr7lYXa9Hj/j1hBXGDbsX6vcc37BzVzK2mFU0OXR2XfEY56NsRvaE2evf+rFWwYizKHjsFzL7NpSBPN7gWOrJLm1ceZhiJ38jO03BH0X0zEviou2HdGJZzHt3UpcGXx2GumA9Yb35LKwxaUTl7gzvLvBnrw3et7Yty+m7F526auZoXnCu0njuMZ3JfQuyquxUq2TKO2VfTfGHMF2x8ggyxhSu9bU7f48IqeqEtK9UKnvfQ1eiuZCQ835Q9VEWXvB/9WRJgst6SXhd/twL6HHqksqAHdkLjyg8VbTjM52Ckjxqz2Zz8DrfiRe7ZJAwBbBjm2+XmMbEOzbBYmY2EZiwLPXxRqFaRBeUQtH3DQwZtwfK2ky2EweuDW3H1KW3ceBZj9fJo/bCFhx4UfhwydCtuROwG1YlePPygK4yyOVZRK2gjsnzco7+TW93R7Q0ZPxRthK2AvoN5sSNMyixB/e0XVmOum5HbqLthxXLznt5fNjhTgw2L+fjrq2jWQbVtvNHLohnLYoRX5fTdyp+2za3KavnCEa6qF5kvlOf1gqs72+JYo1TEU+o7P2drS7fi05/iEMQOxPo/dIXEeiPxVPOaWaqV9+f1DKrOQa08WwpMkjDarlauUuWH2XKHUaMYCYqWcDbmScVym1deYuYBG1otK3b1s+cG8ot7UMclyrwZ67++Wm3RVWKwc3arDoEJKCtOWYjYyiqVRw572E04/bCVWF+GPdYiQ4vueJlmr3Qc1n8XW4H3XUHubFOMTa0saze9v92tEMNAdfo9tuohs29zKeDNk1p5/fJDTxOzbm+waUkY1o2oarEV1mOZEiOpHcq6m2+l7G9+44wZW9k6jIjcURbNrP52Ur4kj9+tPGqhJmWovkn5tuKIOSZ/xK3SBa9FCEFwKqGM71oQiBnvXW/RgvexunxT8xNw3d8EkUTU4g6CWy3icDtp7AXMsShnSEWtRh6P1t/uVk1zm1Afb1zR6oIOUM0Ljmp1m/AmaEVbfEWKAWEk8FFvUY6kC8v7DPPwpN1sVlEZZjJk2E5Ftl44y9XXweJNK/NmLDN1e1lOavWtnM+R9xwCvk/grQ7W/LNuPgAxXuQ+wQ+Wdzv0X5TTd6vvJA7TqjwYUt2yLeb7Iv+Hr+yRF7+m1tlVXUb/ZZy+WwlRBapVZIWoBtXqrzQLUZGU/gaL7x3+Dh6MZAAAAABJRU5ErkJggg==" width="598" height="57" class="img_ev3q"></li>
<li>Azure Bicep should have connected and exported your Resource straight into Bicep! As below, it had imported a Log Analytics workspace in my subscription straight into Bicep.</li>
<li><img decoding="async" loading="lazy" alt="Azure Bicep - Insert Resource" src="/assets/images/bicepinsertedresource-8658a50350e2f2b8b5f30d6868dd02c7.png" width="602" height="262" class="img_ev3q"></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="to-find-the-resource-id-using-the-azure-portal">To find the resource ID using the Azure Portal.<a href="#to-find-the-resource-id-using-the-azure-portal" class="hash-link" aria-label="Direct link to To find the resource ID using the Azure Portal." title="Direct link to To find the resource ID using the Azure Portal.">​</a></h4>
<p>You can use the Azure CLI to find the Resource ID, but you can also use the Azure Portal by navigating to it below:</p>
<ol>
<li>Log in to the <strong>Azure Portal</strong></li>
<li><strong>Navigate</strong> to the <strong>Resource</strong> you want to export to Bicep</li>
<li>On the <strong>Overview</strong> pane, click on <strong>JSON view</strong></li>
</ol>
<p>I had problems connecting to export an App Service and App Service plan, so for some resources with multiple dependencies, you may be better off exporting the ARM template from the resources/resource groups and decompiling that way, but the Insert Resource functionality is a very quick way to bring your resources into Bicep!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-storage-account-sftp-errors/">Azure Storage Account SFTP errors</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-27T00:00:00.000Z">December 27, 2021</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>As part of standing up and using an Azure Storage account as an SFTP service, I ran into a few issues. This blog post is merely intended to show my findings in case others run into similar issues.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pty-allocation-request-failed-on-channel-0">PTY allocation request failed on channel 0<a href="#pty-allocation-request-failed-on-channel-0" class="hash-link" aria-label="Direct link to PTY allocation request failed on channel 0" title="Direct link to PTY allocation request failed on channel 0">​</a></h4>
<p>Even though you appear to have connected successfully, you may see the following errors:</p>
<ul>
<li>PTY allocation request failed on channel 0</li>
<li>shell request failed on channel 0</li>
</ul>
<p>You may laugh, but the solution for this was very simple, switch from SSH to <strong>SFTP</strong>!</p>
<p>If you were like me, I just flicked to SSH as a habit.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="home-directory-is-not-accessible">Home Directory is not accessible<a href="#home-directory-is-not-accessible" class="hash-link" aria-label="Direct link to Home Directory is not accessible" title="Direct link to Home Directory is not accessible">​</a></h4>
<p>Make sure that the Home directory <em>(Folder)</em> is created in your container, SFTP won&#x27;t create this for you.</p>
<p>Also make sure that the Home directory for the user, references Container/Folder, like the below:</p>
<p><img decoding="async" loading="lazy" alt="Azure Portal - Enable SFTP" src="/assets/images/AzurePortal_SFTPLocalUsercreate-c78a42d5f6be4b35f07b68f984890d4a.png" title="Azure Portal - Enable SFTP" width="565" height="331" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="wrong-username-authentication-failed">Wrong username, authentication failed<a href="#wrong-username-authentication-failed" class="hash-link" aria-label="Direct link to Wrong username, authentication failed" title="Direct link to Wrong username, authentication failed">​</a></h4>
<p>When attempting to connect to SFTP using a tool such as WinSCP, I got:</p>
<ul>
<li>Using username &quot;lukeftpuser&quot;.</li>
<li>Authentication failed.</li>
</ul>
<p>The username is actually comprised of:</p>
<p>STORAGEACCOUNTNAME+FTPNAME, ie: sftpstorageacc1337.lukeftpuser</p>
<p><img decoding="async" loading="lazy" alt="WinSCP Connection Azure SFTP" src="/assets/images/sftp_winscptest-d3c15f460193e1dc9aa4548582c06d19.png" title="WinSCP Connection Azure SFTP" width="1076" height="693" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="unable-to-find-azure-storage-ssh-keys">Unable to find Azure Storage SSH Keys<a href="#unable-to-find-azure-storage-ssh-keys" class="hash-link" aria-label="Direct link to Unable to find Azure Storage SSH Keys" title="Direct link to Unable to find Azure Storage SSH Keys">​</a></h4>
<p>This is not an error, but Azure Keyvault, does not currently support SSH keypairs, so once they are created by Azure, they are stored in a Microsoft.Compute.sshPublicKeys resource found here: <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FsshPublicKeys" target="_blank" rel="noopener noreferrer" title="SSH Keys">SSH Keys</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tags/azure/page/23/"><div class="pagination-nav__label">Newer entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tags/azure/page/25/"><div class="pagination-nav__label">Older entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
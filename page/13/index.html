<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/page/13/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz"><meta data-rh="true" name="description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" property="og:description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/page/13/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/13/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/13/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://luke.geek.nz/page/13","mainEntityOfPage":"https://luke.geek.nz/page/13","headline":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!","description":"Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!","blogPost":[{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Bring-Your-Data-to-Life-with-Azure-OpenAI","mainEntityOfPage":"https://luke.geek.nz/azure/Bring-Your-Data-to-Life-with-Azure-OpenAI","url":"https://luke.geek.nz/azure/Bring-Your-Data-to-Life-with-Azure-OpenAI","headline":"Bring Your Data to Life with Azure OpenAI","name":"Bring Your Data to Life with Azure OpenAI","description":"Today, we will look at using Azure OpenAI and 'Bring Your Data' to allow recent documentation to be referenced and bring life (and relevance) to your data.","datePublished":"2023-07-04T15:15:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Call-to-LLM-failed","mainEntityOfPage":"https://luke.geek.nz/azure/Call-to-LLM-failed","url":"https://luke.geek.nz/azure/Call-to-LLM-failed","headline":"Azure OpenAI - Call to LLM failed","name":"Azure OpenAI - Call to LLM failed","description":"I recently, ran into an error  when attempting to use Azure OpenAI and custom data, in the Chat Playground.","datePublished":"2023-07-04T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Management-Groups-not-displaying-AzurePortal","mainEntityOfPage":"https://luke.geek.nz/azure/Management-Groups-not-displaying-AzurePortal","url":"https://luke.geek.nz/azure/Management-Groups-not-displaying-AzurePortal","headline":"Azure Management Groups not displaying in the Azure Portal","name":"Azure Management Groups not displaying in the Azure Portal","description":"When logging into the Microsoft Azure Portal, to view your Management Group You might have found it blank or constantly attempting to load.","datePublished":"2023-06-24T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Cleanup-your-unwanted-Azure-resources-on-a-schedule","mainEntityOfPage":"https://luke.geek.nz/azure/Cleanup-your-unwanted-Azure-resources-on-a-schedule","url":"https://luke.geek.nz/azure/Cleanup-your-unwanted-Azure-resources-on-a-schedule","headline":"Cleanup your unwanted Azure resources on a schedule","name":"Cleanup your unwanted Azure resources on a schedule","description":"Cleanup your unwanted Azure resources on a schedule","datePublished":"2023-06-06T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Bytes-Blocks-and-Elasticity-Getting-Started-with-Azure-Elastic-SAN","mainEntityOfPage":"https://luke.geek.nz/azure/Bytes-Blocks-and-Elasticity-Getting-Started-with-Azure-Elastic-SAN","url":"https://luke.geek.nz/azure/Bytes-Blocks-and-Elasticity-Getting-Started-with-Azure-Elastic-SAN","headline":"Getting Started with Azure Elastic SAN","name":"Getting Started with Azure Elastic SAN","description":"Deployment and look into Azure Elastic SAN","datePublished":"2023-05-27T12:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.dcdba76e.css">
<script src="/assets/js/runtime~main.409d2de4.js" defer="defer"></script>
<script src="/assets/js/main.d5974e6c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/change-analysis/">Azure Resource - Change Analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/misc/kubernetes-enterprise-guide-book-review/">Book Review - Kubernetes – An Enterprise Guide</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/openai-adoption-challenges-solutions/">Common Challenges and Solutions for Azure OpenAI Adoption</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/policy-deny-creation-azure-openai-studio/">Azure Policy - Deny the creation of Azure OpenAI Studio</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/cloudcloak/">Cloudcloak</a></li></ul></div></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Bring-Your-Data-to-Life-with-Azure-OpenAI/">Bring Your Data to Life with Azure OpenAI</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-04T15:15:00.000Z">July 4, 2023</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Today, we will look at using Azure OpenAI and &#x27;Bring Your Data&#x27; to allow recent documentation to be referenced and bring life (and relevance) to your data.</p>
<p><img decoding="async" loading="lazy" alt="Bring Your Data to Life with Azure OpenAI" src="/assets/images/Header-BringYourDatatoLifewithAzureOpenAI-14aa9bf07355be2435698babf4f6e779.gif" title="Bring Your Data to Life with Azure OpenAI" width="1200" height="628" class="img_ev3q"></p>
<p>The example we are going to use today is the Microsoft Learn documentation for <a href="https://learn.microsoft.com/azure/?product=popular&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Microsoft Azure</a>.</p>
<p>Our scenario is this:</p>
<ul>
<li>We would like to use ChatGPT functionality to query up-to-date information on Microsoft Azure; in this example, we will look for information on Azure Elastic SAN (which was added in late 2022).</li>
</ul>
<p>When querying ChatGPT for Azure Elastic SAN, we get the following:</p>
<p><img decoding="async" loading="lazy" alt="ChatGPT - Azure Elastic SAN Query" src="/assets/images/ChatGPT_Query_AzureElasticSAN-37dd8b8b9753c89bbeda35390dbf8174.png" title="ChatGPT - Azure Elastic SAN Query" width="808" height="338" class="img_ev3q"></p>
<p>Just like the prompt states, ChatGPT only has data up to September 2021 and isn&#x27;t aware of Elastic SAN <em>(or any other changes/updates or new (or retired) services after this date)</em>.</p>
<p>So let us use the Azure OpenAI and bring in outside data <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/chatgpt?pivots=programming-language-chat-completions&amp;WT.mc_id=AZ-MVP-5004796#using-data-for-grounding" target="_blank" rel="noopener noreferrer">(ground data)</a>, in this case, the Azure document library, to overlay on top of the GPT models, giving the illusion the model is aware of the data.</p>
<p>To do this, we will leverage native &#x27;<a href="https://learn.microsoft.com/azure/cognitive-services/openai/use-your-data-quickstart?tabs=command-line&amp;pivots=programming-language-studio&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Bring Your Own Data</a>&#x27; functionality, now in Azure OpenAI - <strong>this is in Public Preview as of 04/07/2023</strong>.</p>
<p><strong>To be clear, I don&#x27;t expect you to start downloading from GitHub; this is just an example I have used to add your data. The ability to bring in updated data on Azure, specifically, will be solved by <a href="https://techcommunity.microsoft.com/t5/ai-cognitive-services-blog/generative-ai-for-developers-exploring-new-tools-and-apis-in/ba-p/3817003?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Plugins</a>, such as Bing Search.</strong></p>
<p>To do this, we will need to provision a few Microsoft Azure services, such as:</p>
<ol>
<li><a href="https://learn.microsoft.com/azure/storage/common/storage-account-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Storage Account</a> <em>(this will hold the Azure document library (markdown files) in a blob container)</em></li>
<li><a href="https://learn.microsoft.com/azure/search/search-what-is-azure-search?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Cognitive Search</a> <em>(this search functionality, is the glue that will hold this solution together, by breaking down and indexing the documents in the Azure blob store)</em></li>
<li><a href="https://learn.microsoft.com/azure/cognitive-services/openai/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure OpenAI</a> <em>(to do this, we will need GPT3.5 turbo or GPT4 models deployed)</em></li>
<li>Optional - <a href="https://learn.microsoft.com/azure/app-service/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Web App</a> <em>(this can be created by the Azure OpenAI service, to give users access to your custom data)</em></li>
</ol>
<p><em><a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/use-your-data-quickstart?tabs=command-line&amp;pivots=programming-language-studio&amp;WT.mc_id=AZ-MVP-5004796#prerequisites" target="_blank" rel="noopener noreferrer">Make sure you have Azure OpenAI approved for your subscription</a></em></p>
<p>We will use the following tools to provision and configure our services:</p>
<ol>
<li>Azure Portal</li>
<li>PowerShell <a href="https://learn.microsoft.com/powershell/azure/install-azure-powershell?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">(Az Modules)</a></li>
<li><a href="https://learn.microsoft.com/azure/storage/common/storage-use-azcopy-v10?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">AzCopy</a></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="download-azure-documents">Download Azure Documents<a href="#download-azure-documents" class="hash-link" aria-label="Direct link to Download Azure Documents" title="Direct link to Download Azure Documents">​</a></h3>
<p>First, we will need the Azure documents to add to our blob storage.</p>
<p>The Microsoft Learn documentation is open-sourced and constantly updated using a git repository hosted on GitHub. We will download and extract the document repository locally <em>(roughly 6 GB)</em>. To do this, we will use a PowerShell script:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $gitRepoUrl = &quot;https://github.com/MicrosoftDocs/azure-docs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $localPath = &quot;C:\temp\azuredocs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $zipPath = &quot;C:\temp\azurdocs.zip&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     #Download the Git repository and extract</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Invoke-WebRequest -Uri &quot;$gitRepoUrl/archive/master.zip&quot; -OutFile $zipPath</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Expand-Archive -Path $zipPath -DestinationPath $localPath</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-storage-account">Create Azure Storage Account<a href="#create-azure-storage-account" class="hash-link" aria-label="Direct link to Create Azure Storage Account" title="Direct link to Create Azure Storage Account">​</a></h3>
<p>Now that we have a copy of the Azure document repository, it&#x27;s time to create an Azure Storage account to copy the data into. To create this storage account, we will use PowerShell.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Login to Azure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Connect-AzAccount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Set variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $resourceGroupName = &quot;azuredocs-ai-rg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $location = &quot;eastus&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $uniqueId = [guid]::NewGuid().ToString().Substring(0,4)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $storageAccountName = &quot;myaistgacc$uniqueId&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $containerName = &quot;azuredocs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Create a new resource group</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     New-AzResourceGroup -Name $resourceGroupName -Location $location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Create a new storage account</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     New-AzStorageAccount -ResourceGroupName $resourceGroupName -Name $storageAccountName -Location $location -SkuName Standard_LRS -AllowBlobPublicAccess $false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Create a new blob container</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     New-AzStorageContainer -Name $containerName -Context (New-AzStorageContext -StorageAccountName $storageAccountName -StorageAccountKey (Get-AzStorageAccountKey -ResourceGroupName $resourceGroupName -Name $storageAccountName).Value[0])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We have created our Resource Group and Storage account to hold our Azure documentation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upload-microsoft-learn-documentation-to-an-azure-blob-container">Upload Microsoft Learn documentation to an Azure blob container<a href="#upload-microsoft-learn-documentation-to-an-azure-blob-container" class="hash-link" aria-label="Direct link to Upload Microsoft Learn documentation to an Azure blob container" title="Direct link to Upload Microsoft Learn documentation to an Azure blob container">​</a></h3>
<p>Now that we have the Azure docs repo downloaded and extracted and an Azure Storage account to hold the documents, it&#x27;s time to use AzCopy to copy the documentation to the Azure storage account.
We will use PowerShell to create a SAS token (open for a day) and use that with AzCopy to copy the Azure repo into our newly created container.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Set variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $resourceGroupName = &quot;azuredocs-ai-rg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $storageAccountName = &quot;myaistgacc958b&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $containerName = &quot;azuredocs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $storageAccountKey = (Get-AzStorageAccountKey -ResourceGroupName $resourceGroupName -Name $storageAccountName).Value[0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $localPath = &quot;C:\Temp\azuredocs\azure-docs-main&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $azCopyPath = &quot;C:\tools\azcopy_windows_amd64_10.19.0\AzCopy.exe&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Construct SAS URL for destination container</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $sasToken = (New-AzStorageContainerSASToken -Name $containerName -Context (New-AzStorageContext -StorageAccountName $storageAccountName -StorageAccountKey $storageAccountKey) -Permission rwdl -ExpiryTime (Get-Date).AddDays(1)).TrimStart(&quot;?&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $destinationUrl = &quot;https://$storageAccountName.blob.core.windows.net/$containerName/?$sasToken&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Run AzCopy command as command line</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $command = &quot;&amp; `&quot;$azCopyPath`&quot; copy `&quot;$localPath`&quot; `&quot;$destinationUrl`&quot; --recursive=true&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Invoke-Expression $command</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Note: I took roughly 6 minutes to copy the Azure docs repo from my local computer (in New Zealand) into a blob storage account in East US, so roughly a gigabyte a minute.</em></p>
<p><img decoding="async" loading="lazy" alt="Azure Storage Account - Microsoft Learn Docs" src="/assets/images/AzureStorage_AzureDocs_UploadedAzCopy-3168f472dca978e719a4ad6d500f63e0.png" title="Azure Storage Account - Microsoft Learn Docs" width="1122" height="635" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-cognitive-search">Create Cognitive Search<a href="#create-cognitive-search" class="hash-link" aria-label="Direct link to Create Cognitive Search" title="Direct link to Create Cognitive Search">​</a></h3>
<p>Now that we have our Azure Blob storage accounts, it&#x27;s time to create our Cognitive Search.
We will need to create a Cognitive Search, with an SKU of Standard, to support the 6GBs of Azure documents that must be indexed. Please check your costs; this is roughly NZ$377.96 a month to run; you can reduce this cost by limiting the amount of data you need to index (i.e., only certain documents, not an entire large repository of markdown files). Make sure you refer to the <a href="https://azure.microsoft.com/pricing/details/search/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Pricing Calculator</a>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Set variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $resourceGroupName = &quot;azuredocs-ai-rg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $searchServiceName = &quot;azuredocssearchservice&quot; #Cognitive Service name needs to be lowercase.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Create a search service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Install-Module Az.Search</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $searchService = New-AzSearchService -ResourceGroupName $resourceGroupName -Name $searchServiceName -Location &quot;eastus&quot; -Sku Standard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now that the cognitive search has been created, we need to create the index, and indexers, which will index our Azure documents to be used by Azure OpenAI by creating the index and linking it to the Azuredocs blob container, we created earlier.</p>
<p><em>Note: There is no PowerShell cmdlet support for Azure Cognitive Search indexes; you can create using the <a href="https://learn.microsoft.com/azure/search/search-get-started-powershell?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">RestAPI</a> - but we will do this in the Azure Portal as part of the next step.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-cognitive-search-index">Create Azure Cognitive Search Index<a href="#create-azure-cognitive-search-index" class="hash-link" aria-label="Direct link to Create Azure Cognitive Search Index" title="Direct link to Create Azure Cognitive Search Index">​</a></h3>
<p>It&#x27;s time to time to create the Cognitive Search Index, an indexer that will index the content.</p>
<p>We will move away from PowerShell and into the Microsoft Azure Portal to do this.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Microsoft Azure Portal</a></li>
<li>In the top center search bar, type in Cognitive Search</li>
<li>Click on <a href="https://portal.azure.com/#view/Microsoft_Azure_ProjectOxford/AppliedAIHub/~/CognitiveSearch" target="_blank" rel="noopener noreferrer">Cognitive Search</a></li>
<li>Click on your newly created Cognitive Search
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search" src="/assets/images/AzurePortal_CognitiveSearch_Resource-ff7e924354830c860b415f6a7c7413cd.png" title="Azure Portal - Cognitive Search" width="1422" height="446" class="img_ev3q"></li>
<li>Select Import Data</li>
<li>Select Azure Blob Storage
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Add Azure Blob Storage" src="/assets/images/AzurePortal_CognitiveSearch_AddDataStorage-42bb4d887f49d5e20ede9be7fe5a61e0.png" title="Azure Portal - Cognitive Search" width="671" height="551" class="img_ev3q"></li>
<li>Type in your data source name <em>(i.e., azuredocs)</em></li>
<li>For the Connection string, select Choose an existing connection</li>
<li>Select your Azure Storage account and a container containing the Azure document repository uploaded earlier.</li>
<li>Click Select
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Add Azure Blob Storage" src="/assets/images/AzurePortal_CognitiveSearch_ConnectBlobStorage-0bdd08ffb60559a9fc83270b829cd18d.png" title="Azure Portal - Cognitive Search - Add Azure Blob Storage" width="1429" height="674" class="img_ev3q"></li>
<li>Click Next: Add cognitive skills (Optional)</li>
<li>Here, you can Enrich your data, such as enabling OCR (extracting text from images automatically) or extracting people&#x27;s names, and translating text from one language to another; these enrichments are billed separately, and we won&#x27;t be using any enrichments so we will select Skip to: Customize target index.</li>
<li>Here is the index mapping that was done by Cognitive Search automatically by scanning the schema of the documents. You can bring in additional data about your documents if you want, but I am happy with the defaults, so I click: Next: Create an indexer
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Search Index" src="/assets/images/AzurePortal_CognitiveSearch_SearchIndex-3f2984b586dd5bb7b55d604ac60b0670.png" title="Azure Portal - Cognitive Search - Search Index" width="1210" height="748" class="img_ev3q"></li>
<li>The indexer is what is going to create your index, which will be referenced by Azure OpenAI later; you can schedule an indexer to run hourly, if new data is being added to the Azure blob container where your source files are sitting, for my purposes I am going leave the Schedule as: Once</li>
<li>Uncollapse Advanced Options and scroll down a bit</li>
<li>Here, we can select to only index certain files; for our purposes, we are going to exclude png files, the Azure document repository contains png images files that aren&#x27;t able to be indexed (we aren&#x27;t using OCR), so I am going to optimize the indexing time slightly by excluding them. You can also exclude gif/jpg image files.
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Create Search Indexer" src="/assets/images/AzurePortal_CognitiveSearch_CreateIndexer-80f63d0ec6de7263802dbaf82dd6bdeb.png" title="Azure Portal - Cognitive Search - Create Search Indexer" width="935" height="728" class="img_ev3q"></li>
<li>Finally, hit Submit to start the indexing process. <em>This could take a while, depending on the amount of data</em></li>
<li>Leave this running in the background and navigate to the Cognitive Search resource, Overview pane to see the status.
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Indexer" src="/assets/images/AzurePortal_CognitiveSearch_OverviewIndexer.png-e5694fe64cf12b0a6fee286d9bc033d6.png" title="Azure Portal - Cognitive Search - Indexer" width="1751" height="525" class="img_ev3q"></li>
</ol>
<p><em>Note: You can also run the Import Data in Azure OpenAI Studio, which will trigger an index - but you need to keep your browser open and responsive. Depending on how much data you are indexing, doing it manually through this process could be preferred to avoid browser timeout. You also get more options around the index.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-openai">Create Azure OpenAI<a href="#create-azure-openai" class="hash-link" aria-label="Direct link to Create Azure OpenAI" title="Direct link to Create Azure OpenAI">​</a></h3>
<p>Now that we have our base Azure resources, it&#x27;s time to create Azure OpenAI.
Make sure your region and subscription have been approved for Azure OpenAI.</p>
<p>Run the following PowerShell cmdlets to create the Azure OpenAI service:</p>
<p>To create the Azure OpenAI service, we will be using the Azure Portal.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Microsoft Azure Portal</a></li>
<li>In the top center search bar, type in Azure OpenAI</li>
<li>In the Cognitive Services, <a href="https://portal.azure.com/#view/Microsoft_Azure_ProjectOxford/CognitiveServicesHub/~/OpenAI" target="_blank" rel="noopener noreferrer">Azure OpenAI</a> section, click + Create</li>
<li>Select your subscription, region, name, and pricing tier of your Azure OpenAI service (remember certain <a href="https://learn.microsoft.com/azure/cognitive-services/openai/concepts/models?WT.mc_id=AZ-MVP-5004796#model-summary-table-and-region-availability" target="_blank" rel="noopener noreferrer">models</a> are only available in specific regions - we need GPT 3.5+), then select Next
<img decoding="async" loading="lazy" alt="Azure OpenAI - Create Resource" src="/assets/images/AzurePortal_AzureOpenAI_Create-65d3f0e2fed89c4f7923782be9dfae31.png" title="Azure OpenAI - Create Resource" width="718" height="775" class="img_ev3q"></li>
<li>Update your Network Configuration; for this demo, we will select &#x27;All Networks&#x27; - but the best practice is to restrict it. Click Next
<img decoding="async" loading="lazy" alt="Azure OpenAI - Create Resource" src="/assets/images/AzurePortal_AzureOpenAI_CreateSelectNetwork-394a9438b78ff10f3764624e8a5bd091.png" title="Azure OpenAI - Create Resource" width="717" height="843" class="img_ev3q"></li>
<li>If you have any Tags, enter them, then click Next</li>
<li>The Azure platform will now validate your deployment (an example is ensuring that the Azure OpenAI has a unique name). Review the configuration, then click Create to create your resource.
<img decoding="async" loading="lazy" alt="Azure OpenAI - Create Resource" src="/assets/images/AzurePortal_AzureOpenAI_CreateReview-154a2f415ff6929acff748aae408786b.png" title="Azure OpenAI - Create Resource" width="733" height="835" class="img_ev3q"></li>
</ol>
<p>Now that the Azure OpenAI service has been created, you should now have the following:</p>
<ul>
<li>An Azure OpenAI service</li>
<li>A Storage account</li>
<li>A Cognitive Search service</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - RAG Deployed Resources" src="data:image/png;base64,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" title="Azure OpenAI - RAG Deployed Resources" width="1094" height="149" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-model">Deploy Model<a href="#deploy-model" class="hash-link" aria-label="Direct link to Deploy Model" title="Direct link to Deploy Model">​</a></h3>
<p>Now that we have our Azure OpenAI instance, it&#x27;s time to deploy our Chat model.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Microsoft Azure Portal</a></li>
<li>In the top center search bar, type in Azure OpenAI</li>
<li>Open your Azure OpenAI instance to the Overview page, and click: Go to Azure OpenAI Studio</li>
<li>Click on Models, and verify that you have gpt models <em>(ie, gpt-36-turbo, or gpt-4)</em>. If you don&#x27;t, then make sure you have been <a href="https://azure.microsoft.com/en-us/products/cognitive-services/openai-service?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">onboarded</a>.</li>
<li>Once verified, click on Deployments</li>
<li>Click on + Create new deployment</li>
<li>Select your model (I am going to go with gpt-35-turbo), type in a deployment name, and then click Create</li>
<li>Once deployment has been completed, you may have to wait up to 5 minutes for the Chat API to be aware of your new deployment.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Deploy Model" src="/assets/images/Create_AzureOpenAI_GPT3.5_Deployment-420c2e49212da761ab2891b3d7f07009.gif" title="Azure OpenAI - Deploy Model" width="1859" height="924" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-chat-against-your-data">Run Chat against your data<a href="#run-chat-against-your-data" class="hash-link" aria-label="Direct link to Run Chat against your data" title="Direct link to Run Chat against your data">​</a></h3>
<p>Finally, it&#x27;s time to query and work with our Azure documents.</p>
<p>We can do this using the Chat Playground, a feature of Azure OpenAI that allows us to work with our Chat models and adjust <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/concepts/advanced-prompt-engineering?pivots=programming-language-chat-completions&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">prompts</a>.</p>
<p>We will not change the System Prompt (although to get the most out of your own data, I recommend giving it ago); the System Prompt will remain as: You are an AI assistant that helps people find information.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Microsoft Azure Portal</a></li>
<li>In the top center search bar, type in Azure OpenAI</li>
<li>Open your Azure OpenAI instance to the Overview page, and click: Go to Azure OpenAI Studio</li>
<li>Click Chat</li>
<li>Click Add your data (preview) - if this doesn&#x27;t show, ensure you have deployed a GPT model as part of the previous steps.</li>
<li>Click on + Add a data source</li>
<li>Select the dropdown list in the Select data source pane and select Azure Cognitive Search</li>
<li>Select your Cognitive Search service, created earlier</li>
<li>Select your Index</li>
<li>Check, I acknowledge that connecting to an Azure Cognitive Search account will incur usage to my account. <a href="https://azure.microsoft.com/en-us/pricing/details/search/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">View Pricing</a></li>
<li>Click Next</li>
<li>It should bring in the index metadata; for example - our content data is mapped to content - so I will leave this as is; click Next</li>
<li>I am not utilizing Semantic search, so I click Next</li>
<li>Finally, review my settings and click Save and Close</li>
<li>Now we can verify our own data is getting checked by leaving the: Limit responses to your own data content checked</li>
<li>Then, in the Chat session, in the User message, I type: Tell me about Azure Elastic SAN?</li>
<li>It will now reference the Cognitive Search and bring in the data from the index, including references to the location where it found the data!</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Chat Playground" src="/assets/images/Query_AzureOpenAI_ChatPlayground_AzureDocs-32466787de94187804d0b5195479240b.gif" title="Azure OpenAI -Chat Playground" width="1859" height="924" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional---deploy-to-an-azure-webapp">Optional - Deploy to an Azure WebApp<a href="#optional---deploy-to-an-azure-webapp" class="hash-link" aria-label="Direct link to Optional - Deploy to an Azure WebApp" title="Direct link to Optional - Deploy to an Azure WebApp">​</a></h3>
<p>Interacting with our data in the Chat playground can be an enlightening experience, but we can go a step further and leverage the native tools to a chat interface - straight to an Azure web app.</p>
<p>To do this, we need to navigate back to the Chat playground, ensure you have added your own cognitive search, and can successfully retrieve data from your index.</p>
<ol>
<li>Click on Deploy to</li>
<li>Select A new web app...</li>
<li>If you have an existing WebApp, you can update it with an updated System Message or Search Index from the Chat playground settings, but we will: Create a new web app</li>
<li>Enter a suitable name (i.e., AI-WebApp-Tst - this needs to be unique)</li>
<li>Select the Subscription and Resource Group and location to deploy to. I had issues accessing my custom data, when deployed to Australia East (as AI services are in East US), so I will deploy in the same region as my OpenAI and Cognitive Search service - i.e., East US.</li>
<li>Specify a plan (i.e., Standard (S1))</li>
<li>Click Deploy</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Deploy" src="/assets/images/Deploy_AzureOpenAI_ChatPlayground_WebApp-6edc6b90559c3ffcc0bb7d508724da0c.gif" title="Azure OpenAI -Chat Playground" width="1859" height="924" class="img_ev3q"></p>
<p>Note: Deployment may take up to 10 minutes to deploy; you can navigate to the Resource Group you are deploying to, select Deployments, and monitor the deployment. Once deployed, it can take another 10 minutes for authentication to be configured.</p>
<p>Note: By default, the Azure WebApp is restricted to only be accessible by yourself; you can expand this out by adjusting the <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/use-your-data-quickstart?tabs=command-line&amp;pivots=programming-language-studio&amp;WT.mc_id=AZ-MVP-5004796#important-considerations" target="_blank" rel="noopener noreferrer">authentication</a>.</p>
<p>Once it is deployed, you can access the Chat interface, directly from an Azure WebApp!</p>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Run Azure WebApp" src="/assets/images/Run_AzureOpenAI_ChatPlayground_WebApp-a4d3f087ecc69ddc57fc841e18bcb155.gif" title="Azure OpenAI - Run Azure WebApp" width="1859" height="924" class="img_ev3q"></p>
<p>If you navigate to the WebApp resource in the Azure Portal, and look at the Configuration and Application Settings of your WebApp, you can see variables used as part of the deployment. You can adjust these, but be wary as it could break the WebApp, I would recommend redeploying/updating the WebApp for major changes, from Azure OpenAI studio.
<img decoding="async" loading="lazy" alt="Azure OpenAI - App Service - App Settings" src="/assets/images/AzureOpenAI_AzureAppService_Deployment_AppSettings-eb1fe14d2986e66a4d3e6de2ec0fb234.png" title="Azure OpenAI - App Service - App Settings" width="1179" height="871" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Call-to-LLM-failed/">Azure OpenAI - Call to LLM failed</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-04T00:00:00.000Z">July 4, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>I recently, ran into an error  when attempting to use Azure OpenAI and custom data, in the Chat Playground.
The error I was getting was:</p>
<blockquote>
<p>Error
Cannot connect to host aidocsopenaiaccount.openai.azure.com:443 ssl:default [Name of Service not known]
Call to LLM failed.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Call to LLM failed." src="/assets/images/CalltoLLMFailed_AzureOpenAIError-fe264731a2c2aad7624f785539e26360.png" title="Azure OpenAI - Call to LLM failed." width="793" height="197" class="img_ev3q"></p>
<p>As I was calling data, that was indexed by Azure Cognitive Search, I thought the index was corrupted or invalid, but after mulitple index attempts, continuted to have the same error, all other prompts (not using my custom data) succeeded.</p>
<p>I recreated the Azure OpenAI service, and was able to succesffuly call the custom data, so started to look at the comparisons between the Azure OpenAI instance, that was working and the Azure OpenAI instance that wasn&#x27;t.</p>
<p>I did this by taking a look at the JSON of each Azure OpenAI instance, then did a comparison, and discovered a major difference.</p>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Diff" src="/assets/images/AzureOpenAI_CalltoLLMFailed_ErrorJSON-4c12966d3fbea4cc1bbdaa92759e2964.png" title="Azure OpenAI - Diff" width="1579" height="327" class="img_ev3q"></p>
<p><em>Note: The one on the left is the working one, the one of the right is the failed one.</em></p>
<p>The version that was working, had an endpoint of https://*.openai.azure.com , and the version that didn&#x27;t work, had a different endpoint: eastus.api.cognitive.microsoft.com.</p>
<p>You can check the JSON output of a resource, by navigating to it on the Azure Portal, in the Overview Pane, clicking JSON view.</p>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - JSON View" src="/assets/images/CalltoLLMFailed_AzureOpenAI_JSON_View-435e94acdc9925408a6e615449de2e77.png" title="Azure OpenAI - JSON View" width="1843" height="306" class="img_ev3q"></p>
<p>So why would this have been the case?</p>
<p>When I originally created the Azure OpenAI instance that had this issue, I used PowerShell to create the instance:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$skuName = &quot;S0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$kind = &quot;OpenAI&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create Cognitive Services resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzCognitiveServicesAccount -ResourceGroupName $resourceGroupName -Name $accountName -Location $location -SkuName $skuName -Kind $kind</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This seemed to call an older API or different schema.</p>
<p>The version that worked, I created using the Azure Portal - which was correct.</p>
<p><strong>If you run into the same problem, then recreate your Azure OpenAI instance using the Azure Portal, or one of the currently supported methods: <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/create-resource?pivots=web-portal&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Create a resource and deploy a model using Azure OpenAI</a>, currently (as of the 4th of July 2023) PowerShell is not a supported method of creating an Azure OpenAI instance, until the cmdlets have been updated.</strong></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Management-Groups-not-displaying-AzurePortal/">Azure Management Groups not displaying in the Azure Portal</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-06-24T00:00:00.000Z">June 24, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>When logging into the Microsoft Azure Portal, to view your <a href="https://learn.microsoft.com/azure/governance/management-groups/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="What are Azure management groups?">Management Group</a> You might have found it blank or constantly attempting to load.</p>
<p><img decoding="async" loading="lazy" alt="Azure Management Group - Not loading" src="/assets/images/azure-management-group-notloading-64dd2b99ae45c16df4a59bb7a3ee566a.png" title="Azure Management Group - Not loading" width="1660" height="739" class="img_ev3q"></p>
<p>It looks like a potential bug in the Portal interface, especially  if you have the correct permissions to see those Management Groups. Here is a few things to look for:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="elevated-rights---global-administrator">Elevated rights - Global Administrator<a href="#elevated-rights---global-administrator" class="hash-link" aria-label="Direct link to Elevated rights - Global Administrator" title="Direct link to Elevated rights - Global Administrator">​</a></h3>
<p>By default, if you are a Global Administrator, it does not allow you to see Azure Resources and manage Azure management groups.</p>
<p>If you have a Global Administrator role, and this is the first time you are setting up Management Groups, then you can <a href="https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin?WT.mc_id=AZ-MVP-5004796#elevate-access-for-a-global-administrator" target="_blank" rel="noopener noreferrer">elevate</a> your rights, to manage the Azure Management Groups.</p>
<p>Note: Because of the elevated nature of this role, it is recommended to enable it only for the period you need to do your work, and make sure you have <a href="https://learn.microsoft.com/azure/role-based-access-control/role-assignments-portal?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">specific roles assigned to</a> manage your Azure infrastructure, as necessary.</p>
<p>If this is not the first time you set up Management Groups, ensure you have the right to see the Management Groups.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-azure-management-group-using-powershell">Create an Azure Management Group using PowerShell<a href="#create-an-azure-management-group-using-powershell" class="hash-link" aria-label="Direct link to Create an Azure Management Group using PowerShell" title="Direct link to Create an Azure Management Group using PowerShell">​</a></h3>
<p>One of the fixes (workaround) discovered is that creating a Management Group triggers the Azure Portal to update, allowing management.</p>
<p>You can do this using the <a href="https://learn.microsoft.com/powershell/azure/install-azure-powershell?view=azps-10.0.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure PowerShell</a> cmdlets, by running:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     New-AzManagementGroup -GroupName &#x27;Contoso&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once the Management Group is created, you should be able to refresh the <a href="https://portal.azure.com/#view/Microsoft_Azure_ManagementGroups/ManagementGroupBrowseBlade/%7E/MGBrowse_overview" target="_blank" rel="noopener noreferrer">Azure Management Group</a> page in the Portal and view your Management Groups, if that doesn&#x27;t work then log out and back into the Portal.</p>
<p>You can then use the Remove cmdlet to delete the new Management Group you created.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Remove-AzManagementGroup -GroupName &#x27;Contoso&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note: This article was based on findings from the Microsoft Q&amp;A article: <a href="https://learn.microsoft.com/en-us/answers/questions/1315218/management-groups-unavailable-in-tenant-limited-ac?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Management Groups Unavailable in Tenant: Limited Account Control and Organization</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Cleanup-your-unwanted-Azure-resources-on-a-schedule/">Cleanup your unwanted Azure resources on a schedule</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-06-06T00:00:00.000Z">June 6, 2023</time> · <!-- -->12 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Cleanup your unwanted Azure resources on a schedule</p>
<p>Every few months, I get that dreaded email &quot;Your Microsoft Azure subscription has been suspended&quot; - this is due to creating resources, and leaving them provisioned, so I needed a method of deleting the resources I didn&#x27;t need, or wanted to spin up for a few days. I also needed away to creating resources that can stay, either for learning or a demo, independent of how the resources were deployed into the environment <em>(via the Azure Portal, Terraform, Bicep)</em>.</p>
<p>Naturally I went straight to <a href="https://learn.microsoft.com/azure/automation/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Automation documentation">Azure Automation</a> and using PowerShell.</p>
<p>What I ended up with was a Runbook capable of <strong>EXTREME AZURE DESTRUCTION</strong> which was exactly what I wanted.</p>
<blockquote>
<p>This script is provided as-is with no warranties or guarantees. Use at your own risk. This is not intended to be a script to use in Production, mainly test environments, as this WILL CAUSE massive destruction and irretrievable data loss... You have been warned.</p>
</blockquote>
<p>I am not going to go into setting up Azure Automation, if interested you can refer to a few of my blog posts I have done previously that goes through the process:</p>
<ul>
<li><a href="https://luke.geek.nz/azure/deallocate-stopped-virtual-machines-using-azure-automation/" target="_blank" rel="noopener noreferrer" title="Deallocate ‘Stopped’ Virtual Machines using Azure Automation">Deallocate ‘Stopped’ Virtual Machines using Azure Automation</a></li>
<li><a href="https://luke.geek.nz/azure/turn-on-a-azure-virtual-machine-using-azure-automation/" target="_blank" rel="noopener noreferrer" title="Turn on a Azure Virtual Machine using Azure Automation">Turn on a Azure Virtual Machine using Azure Automation</a></li>
<li><a href="https://luke.geek.nz/azure/disable-sftp-support-on-an-azure-storage-account-on-a-schedule/" target="_blank" rel="noopener noreferrer" title="Disable SFTP support on an Azure Storage account on a Schedule">Disable SFTP support on an Azure Storage account on a Schedule</a></li>
</ul>
<p>The script named: Invoke-DakaraSuperWeapon, aptly named as a reference to the Dakara weapon from the TV series Stargate SG1 - a weapon if great power.</p>
<blockquote>
<p>The <a href="https://stargate.fandom.com/wiki/Dakara_superweapon" target="_blank" rel="noopener noreferrer">Dakara superweapon</a> was a Ancient device capable of reducing all matter to its basic elemental components, and/or restructuring it. Possessing the ability to pass through the shields of known ships it also functions (and has been used) as a devastating weapon to kill the entire crew of orbiting ships or wipe out all life on the surface of hundreds of planets at a time. &quot;It is not only capable of destroying the Replicators but all life in the galaxy.&quot;</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Azure Dakara superweapon" src="/assets/images/CleanupyourUnwantedAzureResourcesonaSchedule-12c7b44ba5ec86e0b52839f1e1857ac2.png" title="Azure Dakara superweapon" width="1200" height="628" class="img_ev3q"></p>
<p>Using the latest Windows PowerShell release - 7.2 (Preview), this script is built around the following capabilities:</p>
<ul>
<li><strong>Delete ALL resource groups</strong> (without a specific Tag) <strong>under all subscriptions</strong>, under a specific <strong>Management Group</strong></li>
<li><strong>Delete all resources</strong> within those resource groups</li>
<li><strong>Delete</strong> Azure <strong>Recovery Vaults</strong> and their backed up items</li>
<li><strong>Delete</strong> any <strong>Azure policy assignments</strong>, assigned directly to any subscription under the Management Group</li>
<li><strong>Delete</strong> any Azure <strong>RBAC role assignments</strong>, assigned directly to any subscription under the Management Group.</li>
</ul>
<p>In my demo environment, I have a range of Management Groups, and 2 Azure subscriptions.</p>
<p><img decoding="async" loading="lazy" alt="Luke&amp;#39;s Azure Management Group structure" src="/assets/images/VisualStudio_Luke_MG_Structure-40dc226f63445dd3e2d69fded3754f0b.png" title="Luke&amp;#39;s Azure Management Group structure" width="837" height="932" class="img_ev3q">`</p>
<p>For my purposes, I created a <a href="https://learn.microsoft.com/azure/automation/enable-managed-identity-for-automation?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Using a system-assigned managed identity for an Azure Automation account">System Managed Identity</a> from the Azure Automation account, and applied it to the: &#x27;mg&#x27; Management Group as &#x27;Owner&#x27; (Contributor will work, as long as you don&#x27;t plan on removing the rights from the Azure subscriptions - theoretically, so could Contributor + User Access Administrator roles).</p>
<p>Again - this was created for my own environment - if you decide to run this, TEST IT! And Make sure it has as limited permissions as possible, potentially the Managed Identity will only have access to a specific test Subscription that you may not care about. I take no responsibily.</p>
<p>The System Identity will be used to execute the runbook.</p>
<p>I also needed a Tag <em>(ie a Safe word)</em> to save the Resource Groups that I need to remain, an example is a project I am working on, demo etc. This Tag is in name only - as Tags are Key/Value pairs in Azure - in this case I only cared about the Key (ie NotDelete) - what was in the value, didn&#x27;t matter.</p>
<p><img decoding="async" loading="lazy" alt="NotDelete - Azure Tag" src="/assets/images/Initiate-DakaraSuperWeapon_SafeWord-92859365cce18c815d763468ba530288.png" title="NotDelete - Azure Tag" width="1311" height="323" class="img_ev3q"></p>
<p>Important: When importing the Runbook it is imperative that you Tag the Resource Group it is in, with your safe word! Or else could will be deleted!</p>
<p>The script has a couple of parameters:</p>



































<table><thead><tr><th>Parameter</th><th>Type</th><th>Notes</th></tr></thead><tbody><tr><td>ManagementGroupId</td><td>String</td><td>The ID of the management group to delete resource groups under. WARNING: This script will delete all resource groups under the specified management group except for the ones with the specified tag. Make sure you have specified the correct management group ID, or you may accidentally delete resources that you did not intend to delete.</td></tr><tr><td>TagName</td><td>String</td><td>The name of the tag to check for. WARNING: This script will delete all resource groups that do not have this tag. Make sure you have specified the correct tag name, or you may accidentally delete resources that you did not intend to delete.</td></tr><tr><td>RemoveResourceGroups</td><td>Boolean</td><td>True or False, do you want to Remove the Resource Groups? True means it will, and False means it will skip the Resource Group deletion.</td></tr><tr><td>DeletePolicyAssignments</td><td>Boolean</td><td>True or False, do you want to Remove the Azure Policy assignments on the subscriptions? True means it will, and False means it will skip the Azure Policy assignment deletion.</td></tr><tr><td>DeleteSubRoleAssignments</td><td>Boolean</td><td>This will need Owner rights (or User Administrator role) in order to remove roles from a Subscription. Make sure your rights are set to be inherited from a Management Group, before running this. True or False, True means it will delete the Subscription direct assignments, False means it will skip it.</td></tr></tbody></table>
<p>As you can tell, you can enable or disable specific parts of the script, for example - if you just want to use it to clean up direct role assignments on your subscriptions, while not deleting Azure resources you can by entering True or False.</p>
<p><img decoding="async" loading="lazy" alt="Initiate-DakaraSuperWeapon - Azure Runbook Parameters" src="/assets/images/Initiate-DakaraSuperWeapon_Parameters-8252d698d141f7eca306f1cb0f5d66cf.png" title="Initiate-DakaraSuperWeapon - Azure Runbook Parameters" width="1655" height="850" class="img_ev3q"></p>
<p>When ran it will stream the Logs to the Azure Automation Log Stream, there is no waiting time or approval - it will just run.</p>
<p><img decoding="async" loading="lazy" alt="Initiate-DakaraSuperWeapon - Azure Automation Log Stream" src="/assets/images/Initiate-DakaraSuperWeapon_Delete-48239d0a516933a4176e00ab9890b332.png" title="Initiate-DakaraSuperWeapon - Azure Automation Log Stream" width="933" height="912" class="img_ev3q"></p>
<p>As below, you can see the Resource Groups get removed (at the time of this recording, I had a limit on the amount of <a href="https://devblogs.microsoft.com/powershell/powershell-foreach-object-parallel-feature/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="PowerShell ForEach-Object Parallel Feature">parallel</a> delete tasks:</p>
<p><img decoding="async" loading="lazy" alt="Remove Azure Resoure Groups" src="/assets/images/Remove_AzResource-4a5dfc5be3e3278355fa4b961d132457.gif" title="Remove Azure Resoure Groups" width="1343" height="836" class="img_ev3q"></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">Initiate-DakaraSuperWeapon.ps1</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># This runbook deletes all resource groups under a management group except for the ones with a specific tag.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.SYNOPSIS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">Deletes all resource groups under a management group except for the ones with a specific tag.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.DESCRIPTION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">This script deletes all resource groups under a specified management group except for the ones with a specific tag. It can also delete policy assignments and subscription role assignments if specified.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.PARAMETER ManagementGroupId</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">The ID of the management group to delete resource groups under. WARNING: This script will delete all resource groups under the specified management group except for the ones with the specified tag. Make sure you have specified the correct management group ID, or you may accidentally delete resources that you did not intend to delete.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.PARAMETER TagName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">The name of the tag to check for. WARNING: This script will delete all resource groups that do not have this tag. Make sure you have specified the correct tag name, or you may accidentally delete resources that you did not intend to delete.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.PARAMETER RemoveResourceGroups</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">If specified, deletes the resource groups that do not have the specified tag.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.PARAMETER DeletePolicyAssignments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">If specified, deletes the policy assignments for the management group and all child subscriptions.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.PARAMETER DeleteSubRoleAssignments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">If specified, deletes the subscription role assignments for all child subscriptions.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.EXAMPLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.\Initiate-DakaraSuperWeapon.ps1 -ManagementGroupId &quot;my-management-group&quot; -TagName &quot;my-tag&quot; -RemoveResourceGroups -DeletePolicyAssignments -DeleteSubRoleAssignments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">Deletes all resource groups under the &quot;my-management-group&quot; management group that do not have the &quot;my-tag&quot; tag, and deletes the policy assignments and subscription role assignments for all child subscriptions.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.NOTES</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">This script requires the Azure PowerShell module to be installed. It also requires Owner rights (or User Administrator role) in order to remove roles from a subscription. Make sure your rights are set to be inherited from a management group before running this script.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> HelpMessage = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;The ID of the management group to delete resource groups under. WARNING: This script will delete all resource groups under the specified management group except for the ones with the specified tag. Make sure you have specified the correct management group ID, or you may accidentally delete resources that you did not intend to delete.&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[string]</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ManagementGroupId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> HelpMessage = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;The name of the tag to check for. WARNING: This script will delete all resource groups that do not have this tag. Make sure you have specified the correct tag name, or you may accidentally delete resources that you did not intend to delete.&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[string]</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$TagName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[Parameter(Mandatory = $false)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[switch]</span><span class="token namespace">[bool]</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RemoveResourceGroups</span><span class="token plain"> = </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[Parameter(Mandatory = $false)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[switch]</span><span class="token namespace">[bool]</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$DeletePolicyAssignments</span><span class="token plain"> = </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Mandatory = </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> HelpMessage = </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;This will need Owner rights (or User Administrator role) in order to remove roles from a Subscription. Make sure your rights are set to be inherited from an Management Group, before running this.&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[switch]</span><span class="token namespace">[bool]</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$DeleteSubRoleAssignments</span><span class="token plain"> = </span><span class="token boolean">$false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Convert string values to boolean values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RemoveResourceGroups</span><span class="token plain"> = </span><span class="token namespace">[System.Boolean]</span><span class="token plain">::Parse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RemoveResourceGroups</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$DeletePolicyAssignments</span><span class="token plain"> = </span><span class="token namespace">[System.Boolean]</span><span class="token plain">::Parse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$DeletePolicyAssignments</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$DeleteSubRoleAssignments</span><span class="token plain"> = </span><span class="token namespace">[System.Boolean]</span><span class="token plain">::Parse</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$DeleteSubRoleAssignments</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Ensures you do not inherit an AzContext in your runbook</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Disable-AzContextAutosave</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Scope </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#Toggle to stop warnings with regards to Breaking Changes in Azure PowerShell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Set-Item</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Path Env:\SuppressAzurePowerShellBreakingChangeWarnings </span><span class="token operator">-</span><span class="token plain">Value </span><span class="token boolean">$true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Connect to Azure with system-assigned managed identity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">Connect-AzAccount</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Identity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Write an initial log message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Initilizing superweapon....&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Get the subscription IDs under the specified management group AND child management groups</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzSubscriptionsFromManagementGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ManagementGroupName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$mg</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzManagementGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">GroupId </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ManagementGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Expand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$child</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$mg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Children</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$child</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Type</span><span class="token plain"> </span><span class="token operator">-match</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/managementGroups$&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzSubscriptionsFromManagementGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ManagementGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$child</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$child</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Select-Object</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">N = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> E = </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DisplayName </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">N = </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Id&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> E = </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$mgid</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzManagementGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">GroupId </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ManagementGroupID</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Expand</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subIds</span><span class="token plain"> = </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzSubscriptionsFromManagementGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ManagementGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$mgid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DisplayName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Delete the policy assignments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$DeletePolicyAssignments</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Deleting management group policy assignments...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzPolicyAssignment</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Scope </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$mgid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Id </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzPolicyAssignment</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Deleting subscription group policy assignments...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subId</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subIds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Setting subscription context...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzContext</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Subscription </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subId</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Deleting subscription group policy assignments...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzPolicyAssignment</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Scope </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/subscriptions/</span><span class="token string function" style="color:rgb(80, 250, 123)">$</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string function variable" style="color:rgb(189, 147, 249);font-style:italic">$subId</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzPolicyAssignment</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Skipping policy assignment deletion...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Delete the resource groups</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RemoveResourceGroups</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Deleting resource groups...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subIds</span><span class="token plain"> </span><span class="token operator">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subIds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Count </span><span class="token operator">-gt</span><span class="token plain"> 0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subId</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subIds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Setting subscription context...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzContext</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Subscription </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subId</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupsfordeletion</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResourceGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Tags </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-or</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Tags</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ContainsKey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$tagName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token boolean">$false</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;The following Resource Groups will be deleted...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">InputObject </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupsfordeletion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">## Checks to see if a Recovery Services Vaults exists, the Recovery Services Vault and backups need to be deleted first.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RSV</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzRecoveryServicesVault</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-in</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupsfordeletion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RSV</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RV</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RSV</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Backup Vault deletion supports deletion of Azure VM backup vaults ONLY currently.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token comment" style="color:rgb(98, 114, 164)">#Credit to Wim Matthyssen for reference in the backup section of the script - https://wmatthyssen.com/2020/11/17/azure-backup-remove-a-recovery-services-vault-and-all-cloud-backup-items-with-azure-powershell/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzRecoveryServicesVaultProperty</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Vault </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RV</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ID </span><span class="token operator">-</span><span class="token plain">SoftDeleteFeatureState Disable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzRecoveryServicesVaultContext</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Vault </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$containerSoftDelete</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzRecoveryServicesBackupItem</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">BackupManagementType AzureVM </span><span class="token operator">-</span><span class="token plain">WorkloadType AzureVM </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DeleteState </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ToBeDeleted&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$item</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$containerSoftDelete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token function" style="color:rgb(80, 250, 123)">Undo-AzRecoveryServicesBackupItemDeletion</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Item </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$item</span><span class="token plain">  </span><span class="token operator">-</span><span class="token plain">Force </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$containerBackup</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzRecoveryServicesBackupItem</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">BackupManagementType AzureVM </span><span class="token operator">-</span><span class="token plain">WorkloadType AzureVM  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">DeleteState </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;NotDeleted&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$item</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$containerBackup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token function" style="color:rgb(80, 250, 123)">Disable-AzRecoveryServicesBackupProtection</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Item </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$item</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">RemoveRecoveryPoints </span><span class="token operator">-</span><span class="token plain">Force </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzRecoveryServicesVault</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Vault </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RV</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">## Checks to see if a Azure Resource Mover resource exists, as this need to be deleted first.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ARM</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResource</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-in</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupsfordeletion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceType </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Migrate/moveCollections&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">InputObject </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ARM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ARM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ARM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Azure Resource Mover collections exists.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">InputObject </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$a</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResourceMoverMoveResource</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-</span><span class="token plain">MoveCollectionName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$b</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">InputObject </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Remove a resource using the resource ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token function" style="color:rgb(80, 250, 123)">Invoke-AzResourceMoverDiscard</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-</span><span class="token plain">MoveResourceInputType </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Id </span><span class="token operator">-</span><span class="token plain">MoveResource </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        </span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzResourceMoverMoveResource</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-</span><span class="token plain">MoveCollectionName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Name </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Name </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzResourceMoverMoveCollection</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-</span><span class="token plain">MoveCollectionName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Deleting resource groups...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ResourceGroupsfordeletion</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ForEach-Object</span><span class="token plain"> </span><span class="token operator">-</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Parallel</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-</span><span class="token plain">Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ThrottleLimit 20 </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Remove the Network Watcher resource group - if remaining - in some scenarios the script left this RG behind.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Get the resource group with the specified tag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$networkWatcherRG</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzResourceGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;NetworkWatcherRG&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$networkWatcherRG</span><span class="token plain"> </span><span class="token operator">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$networkWatcherRG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Tags </span><span class="token operator">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$networkWatcherRG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Tags</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ContainsKey</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$tagName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token boolean">$false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$networkWatcherRG</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ResourceGroupName </span><span class="token operator">-</span><span class="token plain">Force </span><span class="token operator">-</span><span class="token plain">ErrorAction </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Continue</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Write a final log message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Resource group deletion process completed.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;No child subscriptions found under the specified management group.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Skipping resource group deletion...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$DeleteSubRoleAssignments</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token boolean">$true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subIds</span><span class="token plain"> </span><span class="token operator">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subIds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Count </span><span class="token operator">-gt</span><span class="token plain"> 0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subId</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subIds</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Setting subscription context...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzContext</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Subscription </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$subId</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignments</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzRoleAssignment</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Scope </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/subscriptions/</span><span class="token string function" style="color:rgb(80, 250, 123)">$</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string function variable" style="color:rgb(189, 147, 249);font-style:italic">$subId</span><span class="token string function punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">IncludeClassicAdministrators</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">InputObject </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)"># Loop through each role assignment and delete it if it is not inherited a management group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignment</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignments</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Scope </span><span class="token operator">-like</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/subscriptions/*&quot;</span><span class="token plain"> </span><span class="token operator">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ObjectId </span><span class="token operator">-and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ObjectId </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Deleting role assignment...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Remove-AzRoleAssignment</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Scope </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Scope </span><span class="token operator">-</span><span class="token plain">ObjectId </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ObjectId </span><span class="token operator">-</span><span class="token plain">RoleDefinitionName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$roleAssignment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">RoleDefinitionName </span><span class="token operator">-</span><span class="token plain">Verbose </span><span class="token operator">-</span><span class="token plain">ErrorAction </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Continue</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Deleting subscription role assignments...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Output</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Skipping policy subscription role assignments deletion...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using the Azure Automation schedule, I can then set this Runbook to run every Day, Week etc - knowing my environment will be fresh for my next project, learning exercise.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Bytes-Blocks-and-Elasticity-Getting-Started-with-Azure-Elastic-SAN/">Getting Started with Azure Elastic SAN</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-05-27T12:00:00.000Z">May 27, 2023</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Today we are going to take a look at the <a href="https://azure.microsoft.com/products/storage/elastic-san/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Microsoft Azure Elastic SAN</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h4>
<blockquote>
<p>“Azure Elastic SAN is a unique cloud-native and fully managed storage area network (SAN) service. Combining SAN-like capabilities with the benefits of being a cloud-native service, Azure Elastic SAN offers a massively scalable, cost-effective, high-performance, and resilient storage solution. It can connect to a variety of Azure compute services, enabling you to seamlessly transition your SAN data estate to the cloud without having to refactor your application architectures.”</p>
</blockquote>
<p>Azure Elastic SAN provides a storage solution that is highly scalable, cost-effective, high-performing, and resilient. It caters to various storage needs, whether you&#x27;re migrating your on-premises SAN to the cloud or creating your application directly in the cloud.</p>
<blockquote>
<p>As Azure Elastic SAN is still in the preview stage, as of 28/05/2023, it is important to note that its <a href="https://learn.microsoft.com/azure/storage/elastic-san/elastic-san-introduction?WT.mc_id=AZ-MVP-5004796#support-for-azure-storage-features" target="_blank" rel="noopener noreferrer">features
and functionality</a> may change before it reaches production. Microsoft continues to actively gather feedback from users and refine the offering to ensure a seamless experience when it finally becomes
generally available. Request access to the Preview by filling out this <a href="https://aka.ms/AzureElasticSANPreviewAccess" target="_blank" rel="noopener noreferrer">form</a>. This feature should not be used for production workloads until General Availability (GA).</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Bytes, Blocks and Elasticity - Getting Started with Azure Elastic SAN" src="/assets/images/BytesBlocksAzureElasticSAN_Blog_Heading-0f8da5158ccce6a7ce59d317f784d240.gif" title="Bytes, Blocks and Elasticity - Getting Started with Azure Elastic SAN" width="1200" height="628" class="img_ev3q"></p>
<p>A Storage Area Network (SAN) typically comprises one or more physical appliances equipped with multiple drive bays, which are used to create volumes – it is considered a high-performance and low-latency connectivity
storage solution.</p>
<p>The benefits of a SAN are:</p>
<ul>
<li>Grow storage footprint independent of Compute</li>
<li>Low latency and high storage throughput</li>
<li>Cost efficient with massive scale.</li>
<li>Built for databases and IOPS-intensive applications.</li>
<li>Supports large virtualization deployments.</li>
</ul>
<p>Introducing <a href="https://azure.microsoft.com/products/storage/elastic-san/?WT.mc_id=AZ-MVP-5004796#overview" target="_blank" rel="noopener noreferrer">Azure Elastic SAN</a>.</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Overview" src="/assets/images/AzureElasticSAN-85c4a27935f630a4edb027da048030a3.PNG" title="Azure Elastic SAN - Overview" width="1280" height="720" class="img_ev3q"></p>
<p>With the Azure Elastic SAN, we can the elasticity of the Microsoft Azure block storage systems, to supply expandable block storage capabilities to workloads via <a href="https://learn.microsoft.com/en-gb/azure/storage/elastic-san/elastic-san-planning?WT.mc_id=AZ-MVP-5004796#iscsi-support" target="_blank" rel="noopener noreferrer">iSCSI</a> (Internet Small Computer Systems Interface), or services such as Azure Kubernetes Services through <a href="https://techcommunity.microsoft.com/t5/azure-storage-blog/azure-container-storage-in-public-preview/ba-p/3819246?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Container Storage</a>.</p>
<p>When looking at some of the <a href="https://learn.microsoft.com/azure/storage/elastic-san/elastic-san-introduction?WT.mc_id=AZ-MVP-5004796#benefits-of-elastic-san" target="_blank" rel="noopener noreferrer">benefits</a> of an Azure Elastic SAN, over a traditional SAN, we will delve into several
common user stories around SAN provisioning and capacity management, with key differences around time to deployment and skills required.</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - User journey" src="/assets/images/AzureElasticSAN_UserJourney-ad2b68110b9607036ed6e398fe6d299f.PNG" title="Azure Elastic SAN - User journey" width="1280" height="720" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-and-components">Architecture and Components<a href="#architecture-and-components" class="hash-link" aria-label="Direct link to Architecture and Components" title="Direct link to Architecture and Components">​</a></h4>
<p>The Azure Elastic SAN consists of 3 layers:</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Overview" src="/assets/images/AzureElasticSAN_3Layers-48ea9dacabd741c8142f8b6f7140db93.PNG" title="Azure Elastic SAN - Overview" width="1280" height="720" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="the-elastic-san">The Elastic SAN<a href="#the-elastic-san" class="hash-link" aria-label="Direct link to The Elastic SAN" title="Direct link to The Elastic SAN">​</a></h5>
<p>The Elastic SAN itself, the Elastic SAN consists of the control plane, where you create and manage your Volume Groups from. The Elastic SAN is where the resources are provisioned, and the Cost Management takes place (i.e., Tags on the Elastic SAN resource).</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="volume-group">Volume Group<a href="#volume-group" class="hash-link" aria-label="Direct link to Volume Group" title="Direct link to Volume Group">​</a></h5>
<p>An Azure Elastic SAN can have up to 20 volume groups, the volume group is where your security, encryption, and data protection configurations get applied.</p>
<p>The volume group is where your Network Security rule and service endpoints are applied. Any settings or configurations applied to a volume group, such as virtual network rules, are inherited by any volumes associated with that volume group.</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Volume Group Network Security Rules" src="/assets/images/AzureElasticSAN_VolumeGroup_NetworkSecurityRule-2f1914a86541d912c3e4d254da5fe6b6.PNG" title="Azure Elastic SAN - Volume Group Network Security Rules" width="1280" height="720" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="volume">Volume<a href="#volume" class="hash-link" aria-label="Direct link to Volume" title="Direct link to Volume">​</a></h5>
<p>The volume in an Azure Elastic SAN is the actual storage, that gets delivered and mapped to your workload or service.</p>
<p>Multiple volumes can be a part of a single-volume group, or separate groups – depending on requirements, such as accessibility across different virtual networks.</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Volume" src="/assets/images/AzureElasticSAN_Volume-04c57c0199a1852bd11efbfd48408cd4.PNG" title="Azure Elastic SAN - Volume" width="1280" height="720" class="img_ev3q"></p>
<p>You partition the SAN&#x27;s storage capacity into individual volumes. These individual volumes can be mounted to your clients with iSCSI. The name of your volume is part of their iSCSI IQD</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Volume" src="/assets/images/AzureElasticSAN_Volume2-8b916c0882e33a5e18a77733669dffeb.PNG" title="Azure Elastic SAN - Volume" width="1280" height="720" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-and-configuration">Deployment and Configuration<a href="#deployment-and-configuration" class="hash-link" aria-label="Direct link to Deployment and Configuration" title="Direct link to Deployment and Configuration">​</a></h4>
<p>Now that we know what Azure Elastic SAN is, let&#x27;s deploy it using the Azure Portal.</p>
<p>At the time of this article, the Azure Elastic SAN is only available in <a href="https://azure.microsoft.com/en-us/updates/regional-expansion-azure-elastic-san-public-preview-is-now-available-in-more-regions/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">specific regions</a> – and whether the SAN is capable of ZRS or LRS <a href="https://learn.microsoft.com/azure/storage/common/storage-redundancy?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">storage redundancy</a>. As I am based in New Zealand, the closest region at this time to me is Australia East, this region only supports LRS so this is what I will be configuring.</p>
<p>If you haven’t already – as part of Public Preview, your Azure subscription needs to be <a href="https://aka.ms/AzureElasticSANPreviewAccess" target="_blank" rel="noopener noreferrer">enabled</a> to provision Azure Elastic SAN.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h5>
<ol>
<li>Login to the Microsoft Azure <a href="https://portal.azure.com/" target="_blank" rel="noopener noreferrer">portal</a></li>
<li>In the search box at the top of the portal, type in Elastic SAN, and navigate to the <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.ElasticSan%2Felasticsans" target="_blank" rel="noopener noreferrer">Elastic SAN</a> resource page.</li>
<li>Click Create Elastic SAN</li>
<li><img decoding="async" loading="lazy" alt="Create Azure Elastic SAN using the Azure Portal" src="/assets/images/Create-Portal-AzElasticSAN-e4cde7c39c105399ee6cc818bc8167f6.png" title="Create Azure Elastic SAN using the Azure Portal" width="1220" height="577" class="img_ev3q"></li>
<li>I will create a new Resource Group named: AzureElasticSAN-dev-rg</li>
<li>I will name my Azure Elastic SAN: azelasticsan_aue
(Name has to be between 3 to 24 characters in length, and may only contain
lowercase letters, numbers, hyphens, and underscores (hyphens and underscores
must be surrounded by letters or numbers).</li>
<li><img decoding="async" loading="lazy" alt="Create an Azure Elastic SAN" src="/assets/images/Create-Portal-AzElasticSAN-Redunancy-e5dec7ce35b04c9cfbe4541f756cf78e.png" title="Create an Azure Elastic SAN" width="744" height="575" class="img_ev3q"></li>
<li>Now we need to specify the base and capacity size, the base size will determine what your iOPS and throughput your SAN will support. It’s cheaper to go with, a lower Base size, and higher additional storage – but it will affect your IOPS and bandwidth. These values can be changed later (start with a minimum and increase as needed, as you can’t downsize) – I will set my Base as the minimum of 1 TB and add size of 1TB.</li>
<li><img decoding="async" loading="lazy" alt="Create Azure Elastic SAN - Resource Provisioning" src="/assets/images/Create-Portal-AzElasticSAN-ResourceProvisioning-0c81de1d61847c750f09e45af6ce232d.png" title="Create Azure Elastic SAN - Resource Provisioning" width="783" height="241" class="img_ev3q"></li>
<li>Click Next</li>
<li>This is where we can create a volume group, click + Create volume group</li>
<li>The volume group will be used to contain our volumes, I will name a volume group as demo</li>
<li>I will then allow the volume group, to connect to my DevBox virtual network and set up a service endpoint, on my devbox subnet</li>
<li><img decoding="async" loading="lazy" alt="Create an Azure Elastic SAN - Volume Group" src="/assets/images/Create-Portal-AzElasticSAN-AddVolumeGrpVNET-1a5145ee81092d773ed248d2342b3f1a.png" title="Create an Azure Elastic SAN - Volume Group" width="901" height="541" class="img_ev3q"> </li>
<li>Click Create, and finally Review + Create to create your Azure Elastic SAN.</li>
<li>Configuration</li>
</ol>
<p>Now that we have an Azure Elastic SAN, it’s now time to add some volumes. We can partition the SAN&#x27;s total storage into individual volumes, used for block storage.</p>
<p>A volume can only be part of one volume group, but you can have multiple volumes, across multiple volume groups – that equals the total size of the SAN (in my example 2 TB, the 1 TB Base size, and 1 TB additional capacity), however unlike the SAN – a volume can be Gigabytes in size.</p>
<p>A volume cannot be higher than the total allocated capacity assigned to the SAN.</p>
<p>Remember when you create a new Volume, you can increase the size later (but you can’t downsize the volume).</p>
<p>The volume name is part of your volume&#x27;s iSCSI Qualified Name and can&#x27;t be changed once deployed.</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Overview" src="/assets/images/Create-Portal-AzElasticSAN-Overview-8e06b66fbc00bfa737a322e2dc9e81d9.png" title="Azure Elastic SAN - Overview" width="1375" height="697" class="img_ev3q"></p>
<ol>
<li>To create a new Volume, let&#x27;s navigate to our <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.ElasticSan%2Felasticsans" target="_blank" rel="noopener noreferrer">Azure Elastic SAN</a>.</li>
<li>Click on Volumes (under SAN Management)</li>
<li>Click Create a volume.</li>
<li>We are going to give the volume a name, in this example I will go with: vol1</li>
<li>For the size, I will select 500GB.</li>
<li>Click Save</li>
<li>Once the volume has been created, we can see the volume and the assigned volume group, including the size of the volume and the remaining capacity of the SAN.</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="connect">Connect<a href="#connect" class="hash-link" aria-label="Direct link to Connect" title="Direct link to Connect">​</a></h5>
<p>Now that the SAN, Volume Group, and Volume have been setup – it’s time to connect to the storage.</p>
<p>In my demo environment, I have a Volume Group, assigned to a storage service endpoint on my devbox virtual network and subnet, so I will connect to the SAN through a Windows Server 2022 server, that is attached to the same virtual network.</p>
<blockquote>
<p>Following this guide will set up a single path, for more production scenarios to achieve higher IOPS and throughput, and configure mulipathing using the Microsoft document ‘<a href="https://learn.microsoft.com/en-us/azure/storage/elastic-san/elastic-san-connect-windows?tabs=azure-portal&amp;WT.mc_id=AZ-MVP-5004796#connect-to-a-volume" target="_blank" rel="noopener noreferrer">here</a>’.</p>
</blockquote>
<ol>
<li>To connect, we need to navigate to our volume, lets navigate to our <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.ElasticSan%2Felasticsans" target="_blank" rel="noopener noreferrer">Azure Elastic SAN</a>.</li>
<li>Click Volumes</li>
<li>Click your volume, you want to connect to and select Connect.</li>
<li>Microsoft Azure, gives us the PowerShell/Bash cmdlets to run on Windows and Linux. Copy the scripts, we will need to run both.</li>
<li>Login to your Windows Server that you want to
connect to the volume. If this is a new Windows Server, that hasn’t been configured to iSCSI – you will need to <a href="https://github.com/lukemurraynz/PowerOfTheShell/blob/master/Other/Start-iSCSI.ps1" target="_blank" rel="noopener noreferrer">start the iSCSI Initiator service and set it to Automatic start.</a></li>
<li>Open a PowerShell prompt as Administrator and run the Add Target command, you should have ‘Operation completed successfully’.</li>
<li>Then run the login to target script.</li>
<li><img decoding="async" loading="lazy" alt="Connect Windows Server to iSCSI " src="/assets/images/Run_iSCSI_AzElasticSANConnect-68551318dd23bf1df798ac731b37fb3e.gif" title="Connect Windows Server to iSCSI " width="973" height="506" class="img_ev3q"></li>
<li>Once completed, you can confirm your connectivity, by opening up Server Manager and launching iSCSI Initiator, you should see &#x27;Connected&#x27;.</li>
<li><img decoding="async" loading="lazy" alt="Azure iSCSI initiator" src="/assets/images/AzureElasticSAN_SingleThreaded_iSCSI_Initiator-e2e7e42fb2e7a872238e666e82385b23.png" title="Azure iSCSI initiator" width="454" height="385" class="img_ev3q"></li>
<li>Now that your iSCSI target has been mapped – lets create a volume we can actually use!</li>
<li>Right Click your Start Menu and click Disk Management</li>
<li>You should see an Unallocated Disk</li>
<li><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Disk Management" src="/assets/images/AzureElasticSAN_DiskManagement_Unallocated-6fe5c9dca74eabe3e4b586e5fdfebcaf.png" title="Azure Elastic SAN - Disk Management" width="1082" height="838" class="img_ev3q"></li>
<li>The unallocated disk here, is our 500GB Azure Elastic SAN volume, it’s time to initialize it, right click and select Create New Simple Volume, I will go through the defaults and now I have a new drive I can use within Windows</li>
<li><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Windows mounted volume" src="/assets/images/AzureElasticSAN_WindowsExplorer_Allocated-5b88be037c26106b97036aab5ae85b04.png" title="Azure Elastic SAN - Windows mounted volume" width="709" height="148" class="img_ev3q"></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="scalability-and-performance">Scalability and Performance<a href="#scalability-and-performance" class="hash-link" aria-label="Direct link to Scalability and Performance" title="Direct link to Scalability and Performance">​</a></h4>
<p>Now that we have provisioned the Azure Elastic SAN, and connected to it, let’s take a high-level look at the scalability and performance.</p>
<p>For performance, I ran a single threaded test on my 500GB iSCSI target using <a href="https://learn.microsoft.com/azure-stack/hci/manage/diskspd-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Diskspd</a>, using the following parameters:</p>
<div class="language-bat codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bat codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">.\diskspd.exe - d60 - W15 - C15 - c128M - t4 - o4 - b8k - L - r - Sh - w50 f: \disk - speed - test.dat</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The output was:</p>
<p>Total IO:</p>
<ul>
<li>I/Os: 109,541</li>
<li>I/O per second: 1,825.30</li>
</ul>
<p>Read IO:</p>
<ul>
<li>I/Os: 54,547</li>
<li>I/O per second: 908.93</li>
</ul>
<p>Write IO:</p>
<ul>
<li>I/Os: 54,994</li>
<li>I/O per second: 916.38</li>
</ul>
<p>The output does not directly provide the exact IOPS (Input/Output Operations Per Second) value, but we can calculate it based on the total number of I/Os and the test duration.</p>
<p>To calculate the overall IOPS, divide the total number of I/Os by the test duration:</p>
<ul>
<li>Total IOPS: 109,541 I/Os / 60 seconds = 1,825.68 IOPS</li>
</ul>
<p>Similarly, you can calculate the read and write IOPS:</p>
<ul>
<li>Read
IOPS: 54,547 I/Os / 60 seconds = 909.12 IOPS</li>
<li>Write
IOPS: 54,994 I/Os / 60 seconds = 916.57 IOPS</li>
</ul>
<p>Therefore, based on the given Diskspd output, the SAN is performing approximately 1,825 IOPS in total, with 909 IOPS for reads and 917 IOPS for writes.</p>
<p>Note: This was a very basic test, running on a Windows Server 2022 Azure Virtual Machine (Standard D4s v3 (4 vcpus, 16 GiB memory)), single threaded.</p>
<p>At the time I ran this test – the IOPS limit of the SAN was 5000, and bandwidth was 80. I highly encourage you to run your own tests. This was more intended as a baseline for reference.</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - storage throughput" src="/assets/images/AzureElasticSAN_StorageThroughput-ac6bf44e26cc4864df8a25e46245b7a0.PNG" title="Azure Elastic SAN - storage throughput" width="1280" height="720" class="img_ev3q"></p>
<p>Pathping, reported 0 hops for DNS resolution, this Virtual Machine is in another Availability Zone from the SAN.</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Pathping" src="/assets/images/AzureElasticSAN_Pathping-8b46df60fa0232feec784219065810f7.png" title="Azure Elastic SAN - Pathping" width="615" height="199" class="img_ev3q"></p>
<p>In terms of Scalability, a few things to note:</p>
<ul>
<li>You cannot increase the volume size, while an active session (i.e., in use by a workload) is in use.</li>
<li>You can increase the Base and Additional size of the SAN, while sessions are in use.</li>
<li>The Additional size of the Azure Elastic SAN has to be less than the Base size (for example, you cannot have an Azure Elastic SAN with a Base size of 3, and an Additional size of 4).</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-protection-and-redundancy">Data Protection and Redundancy<a href="#data-protection-and-redundancy" class="hash-link" aria-label="Direct link to Data Protection and Redundancy" title="Direct link to Data Protection and Redundancy">​</a></h4>
<p>At the moment, Azure Elastic SAN, only supports specific regions and <a href="https://learn.microsoft.com/azure/storage/common/storage-redundancy?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">configurations</a>, for example in Australia East, the Azure Elastic SAN only supports LRS, so the volumes sit within a single datacenter, replicated across 3 storage stacks.</p>
<p><img decoding="async" loading="lazy" alt="LRS (Locally Redundant Storage)" src="data:image/png;base64,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" title="LRS (Locally Redundant Storage)" width="273" height="285" class="img_ev3q"></p>
<p>LRS is still decent in terms of resiliency but for those who are use to cross SAN replication - I expect, we will see ZRS start to become common place, as this service is rolled out.</p>
<p><img decoding="async" loading="lazy" alt="ZRS (Zone Redundant Storage)" src="/assets/images/zone-redundant-storage-3368776db23efc10e705aceb5e5a8d5b.png" title="ZRS (Zone Redundant Storage)" width="503" height="501" class="img_ev3q"></p>
<p>At the time of this writing, there is no Azure Backup  Support, I expect this capacity to be released closer to GA (Generally Available).
For day to day operations, I was able to enable the <a href="https://learn.microsoft.com/windows-server/storage/file-server/volume-shadow-copy-service?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Volume Shadow Copies</a>, which allowed me to go back to  previous versions of files and folders.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="security-and-compliance">Security and Compliance<a href="#security-and-compliance" class="hash-link" aria-label="Direct link to Security and Compliance" title="Direct link to Security and Compliance">​</a></h4>
<p>Other than the usual filesystem permissions, you can use with your filesystems across Windows and Linux on the Azure Elastic SAN, there are built-in roles that can be leveraged for Azure Elastic SAN management.</p>
<p>Assigning least privilege operations or creating your own custom role is possible with Azure Elastic SAN, and roles such as Volume Group Owner will be key to how the SAN is architectured for an organisation.</p>





















<table><thead><tr><th><strong>Name</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>Elastic SAN Owner</td><td>Allows for full access to all resources under Azure Elastic SAN including changing network security policies to unblock data path access.</td></tr><tr><td>Elastic SAN Reader</td><td>Allows for control path read access to Azure Elastic SAN</td></tr><tr><td>Elastic SAN Volume Group Owner</td><td>                Allows for full access to a volume group in Azure Elastic SAN including changing network security policies to unblock data path access.</td></tr></tbody></table>
<p>All data stored in an Elastic SAN is encrypted at rest using Azure storage service encryption (SSE). Storage service encryption works similarly to BitLocker on Windows: data is encrypted beneath the file system level. SSE protects your data and to helps you meet your organizational security and compliance commitments. Data stored in Elastic SAN is encrypted with Microsoft-managed keys, that are rotated frequently.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="integration-with-azure-services">Integration with Azure Services<a href="#integration-with-azure-services" class="hash-link" aria-label="Direct link to Integration with Azure Services" title="Direct link to Integration with Azure Services">​</a></h4>
<p>At the moment, Azure Elastic SAN supports, Service Endpoints only, <a href="https://learn.microsoft.com/azure/private-link/private-endpoint-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Private endpoints</a> are not yet available, but enabling service endpoints on subnet/s was easily done.</p>
<p>Connectivity to Windows and Linux machines, will be done through native iSCSI protocols, as the Azure Portal displayed when attempting to connect.</p>
<p>At the time of this writing, <a href="https://techcommunity.microsoft.com/t5/azure-storage-blog/azure-container-storage-in-public-preview/ba-p/3819246?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Container Storage</a> – connecting to Azure Kubernetes Service, can be leveraged by Azure Elastic SAN (Azure Container Storage is also in Public Preview).</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Azure services integration" src="/assets/images/AzureElasticSAN_ComputeIntegration-5af15fb2d2d76143ef6369ee0101eaa2.PNG" title="Azure Elastic SAN - Azure services integration" width="1280" height="720" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cost-and-pricing">Cost and Pricing<a href="#cost-and-pricing" class="hash-link" aria-label="Direct link to Cost and Pricing" title="Direct link to Cost and Pricing">​</a></h4>
<p>The Azure Elastic SAN is <a href="https://azure.microsoft.com/en-us/pricing/details/elastic-san/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">charged by the amount you provision based on units</a>:</p>
<ul>
<li>Base unit</li>
<li>Capacity-only unit</li>
</ul>
<p>They are designed to offer a simple bulk provisioning experience while also providing flexibility to expand your data footprint.</p>
<p>The Base unit has a capacity of 5000 IOPs and a throughput of 80 MBps per TiB.</p>
<p>The Capacity only unit, on the other hand, allows you to provision capacity only without provisioning performance at a lower cost.</p>
<p>As a result, you can cost-effectively scale performance while migrating workloads from on-premises to Azure.</p>
<p>The total price of Azure Elastic SAN depends on the base and capacity scale unit (LRS and ZRS dependent).</p>
<p>Elastic SAN will need to be provisioned with at least one base unit of 1TiB. It is also important to note that the SAN-provisioned resources are shared by all volume groups and volumes.</p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Provisioning Model" src="/assets/images/AzureElasticSAN_ProvisioningModel-19ea6943f358dd27eaf8d0a31c11a37e.PNG" title="Azure Elastic SAN - Provisioning Model" width="1280" height="720" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Azure Elastic SAN - Cost Management" src="/assets/images/AzureElasticSAN_CostManagement-7f0a5f67b1f19048961a1f2874e45262.PNG" width="1280" height="720" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="tips">Tips<a href="#tips" class="hash-link" aria-label="Direct link to Tips" title="Direct link to Tips">​</a></h4>
<p>I will cover a few titbits, I found in my discovery.</p>
<ul>
<li>Authentication Failure – if you get ‘Authentication
Failure’, when attempting to connect to your iSCSI target (Azure Elastic SAN Volume), from your Windows or Linux workload, make sure that the Volume Group has had the Service Endpoint enabled for the subnet and virtual network you are connecting from, by default all traffic is denied to the Azure Elastic SAN – this includes traffic from other subnets, the storage endpoint needs to be enabled on the subnet that hosts your virtual machines.</li>
<li>Persistent Login - When connecting to the iSCSI target (the Volume) this is a once off session, if your system is rebooted, the volume won’t automatically remap. You can set a Persistent Login, by replacing ‘LoginTarget’
in your iscsicli command to: PersistentLoginTarget (for example: iscsicli PersistentLoginTarget iqn.2023-05.net.windows.core.blob.ElasticSan.es-rsip05eo4sx0:vol1 t es-rsip05eo4sx0.z40.blob.storage.azure.net 3260 Root\ISCSIPRT\0000_0 -1 * * * * * * * * * * * 0), then the next time you reboot your Windows server, the volume will be automatically mounted.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="updates-and-new-features">Updates and New Features<a href="#updates-and-new-features" class="hash-link" aria-label="Direct link to Updates and New Features" title="Direct link to Updates and New Features">​</a></h4>
<p>As this is a Private Preview service, there will be updates on functionality and features that I have gone through today and may have missed.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-gb/azure/storage/elastic-san/elastic-san-introduction?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">aka.ms/ElasticSANOverview</a></li>
<li><a href="https://learn.microsoft.com/azure/storage/elastic-san/elastic-san-planning?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">aka.ms/ElasticSANPlanning</a></li>
<li><a href="https://azure.microsoft.com/pricing/details/elastic-san/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">aka.ms/ElasticSANPricing</a></li>
<li>Keep an eye out on the <a href="https://azure.microsoft.com/updates/?query=SAN&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Updates</a> page for updates.</li>
<li>Or if you are Linkedin member, follow <a href="https://www.linkedin.com/in/azure-feeds-709457212/recent-activity/all/" target="_blank" rel="noopener noreferrer" title="Azure Feeds">Azure Feeds</a> on Linkedin.</li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/page/12/"><div class="pagination-nav__label">Newer entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/page/14/"><div class="pagination-nav__label">Older entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/page/31/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz"><meta data-rh="true" name="description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" property="og:description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/page/31/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/31/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/31/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://luke.geek.nz/page/31","mainEntityOfPage":"https://luke.geek.nz/page/31","headline":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!","description":"Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!","blogPost":[{"@type":"BlogPosting","@id":"https://luke.geek.nz/2021/12/11/cloud-adoption-framework-for-azure","mainEntityOfPage":"https://luke.geek.nz/2021/12/11/cloud-adoption-framework-for-azure","url":"https://luke.geek.nz/2021/12/11/cloud-adoption-framework-for-azure","headline":"Cloud Adoption Framework for Azure - Tools and Templates","name":"Cloud Adoption Framework for Azure - Tools and Templates","description":"To help with your Microsoft Cloud Adoption and Azure migration, you need a few things to be successful:","datePublished":"2021-12-11T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2021/12/03/azure-nat-gateway","mainEntityOfPage":"https://luke.geek.nz/2021/12/03/azure-nat-gateway","url":"https://luke.geek.nz/2021/12/03/azure-nat-gateway","headline":"Azure NAT Gateway - Implementation and Testing","name":"Azure NAT Gateway - Implementation and Testing","description":"With most Cloud resources being accessible over the internet, each publically accessible resource has its own public IP address, this makes it a lot more challenging to administer the security and access rules to access third party services.","datePublished":"2021-12-03T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2021/10/28/benefits-to-using-the-microsoft-azure-cloud-to-host-your-infrastructure","mainEntityOfPage":"https://luke.geek.nz/2021/10/28/benefits-to-using-the-microsoft-azure-cloud-to-host-your-infrastructure","url":"https://luke.geek.nz/2021/10/28/benefits-to-using-the-microsoft-azure-cloud-to-host-your-infrastructure","headline":"Benefits to using the Microsoft Azure Cloud to host your Infrastructure","name":"Benefits to using the Microsoft Azure Cloud to host your Infrastructure","description":"Cloud computing offers many benefits, from your traditional on-premises infrastructure, ecosystems such as Microsoft Azure, have an underlying fabric built for today's 'software as a service' or 'software defined' world.","datePublished":"2021-10-27T11:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2021/08/25/always-on-vpn-error-809-the-network-connection-between-your-computer-and-the-vpn-server-could-not-be-established","mainEntityOfPage":"https://luke.geek.nz/2021/08/25/always-on-vpn-error-809-the-network-connection-between-your-computer-and-the-vpn-server-could-not-be-established","url":"https://luke.geek.nz/2021/08/25/always-on-vpn-error-809-the-network-connection-between-your-computer-and-the-vpn-server-could-not-be-established","headline":"Always on VPN - Error 809 The network connection between your computer and the VPN server could not be established ","name":"Always on VPN - Error 809 The network connection between your computer and the VPN server could not be established ","description":"I ran into a weird issue, troubleshooting an 'Always On VPN' installation running off Windows Server 2019, the clients were getting the following error in the Application event log:","datePublished":"2021-08-25T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2021/08/21/update-admpwdadschema-the-requested-attribute-does-not-exist","mainEntityOfPage":"https://luke.geek.nz/2021/08/21/update-admpwdadschema-the-requested-attribute-does-not-exist","url":"https://luke.geek.nz/2021/08/21/update-admpwdadschema-the-requested-attribute-does-not-exist","headline":"Update-AdmPwdAdSchema - The requested attribute does not exist","name":"Update-AdmPwdAdSchema - The requested attribute does not exist","description":"Are you attempting to update the Active Directory Schema for LAPS (Local Administrator Password Solution) and keep getting the error below?","datePublished":"2021-08-21T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.a8967c60.css">
<script src="/assets/js/runtime~main.89a0c6ca.js" defer="defer"></script>
<script src="/assets/js/main.3f806bba.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, make sure you sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/sftp-event-hub-function/">Processing SFTP Events with Azure Function and Event Hub</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/mcp-acs-email-integration/">Sending Emails with MCP and Azure Communication Services</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/business-critical-workloads/">Understanding Workload Criticality in the Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/github-codespaces-azure-devops-repo/">How to Use GitHub Codespaces with Azure DevOps Repositories</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azure-landing-zone-accelerator/">Deploying Azure Landing Zones with the Terraform Accelerator</a></li></ul></div></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/12/11/cloud-adoption-framework-for-azure/">Cloud Adoption Framework for Azure - Tools and Templates</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-11T00:00:00.000Z">December 11, 2021</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>To help with your Microsoft Cloud Adoption and Azure migration, you need a few things to be successful:</p>
<ol>
<li>Define your <strong>strategy</strong>, what are your expected outcomes? Where do you start, what skills do you have or need?</li>
<li><strong>Plan</strong>, this may include organisational alignment to get moving to the Cloud</li>
<li><strong>Ready</strong>, this is where you look at your governance, Landing Zones /Blueprints</li>
<li><strong>Adopt</strong>, this is where you actually migrate your workloads into the cloud, existing apps and new</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Cloud Adoption Framework for Azure" src="/assets/images/Microsoft_CloudAdoptionFramework_Azure-c0f0869fb7f378e44b0b145ff2ed765b.png" title="Cloud Adoption Framework for Azure" width="1416" height="746" class="img_ev3q"></p>
<p>Here are some useful tools, templates, and assessments provided by Microsoft to help on your journey:</p>
<p><em>Note: It is not as if you can&#x27;t get these resources elsewhere, I purely just wanted a list format for easy reference.</em></p>
<p><strong>Define strategy</strong></p>
<ul>
<li><a href="https://aka.ms/adopt/journeytracker?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Cloud journey tracker</a>
Navigate to the most relevant adoption content efficiently, and detect early adoption blockers</li>
<li><a href="https://archcenter.blob.core.windows.net/cdn/business-outcome-template.xlsx" target="_blank" rel="noopener noreferrer">Business outcome template</a></li>
</ul>
<p><strong>Plan</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/plan/template?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Cloud adoption plan generator</a></li>
<li><a href="https://azuredevopsdemogenerator.azurewebsites.net/?name=CloudAdoptionPlan" target="_blank" rel="noopener noreferrer">Azure DevOps demo generator</a>
Leverage Azure DevOps to log and track your cloud adoption plan</li>
</ul>
<p><strong>Ready</strong></p>
<ul>
<li><a href="https://aka.ms/adopt/setupguide?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure setup guide</a>
Step-by-step guidance to help admins plan, set up, and secure Azure for your organization</li>
<li><a href="https://raw.githubusercontent.com/microsoft/CloudAdoptionFramework/master/ready/readiness-checklist.docx" target="_blank" rel="noopener noreferrer">Readiness checklist</a></li>
<li><a href="https://raw.githubusercontent.com/microsoft/CloudAdoptionFramework/master/ready/naming-and-tagging-conventions-tracking-template.xlsx" target="_blank" rel="noopener noreferrer">Naming and tagging tracking template</a></li>
<li><a href="https://github.com/mspnp/AzureNamingTool" target="_blank" rel="noopener noreferrer">Azure naming tool</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/landing-zone/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Landing zone blueprints</a>
Host your workloads, pre-provisioned through code. Including foundational capabilities using a defined set of cloud services and best practices.</li>
</ul>
<p><strong>Adopt</strong></p>
<ul>
<li><a href="https://aka.ms/smarttool?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Strategic migration assessment and readiness tool (SMART)</a>
Prepare for a scale migration</li>
<li><a href="https://aka.ms/adopt/migration/guide?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure migration guide</a>
Step-by-step guidance to help assess your current environment, prepare for migration, and make the shift to Azure</li>
<li><a href="https://github.com/Azure/migration/tree/main" target="_blank" rel="noopener noreferrer">Azure migration execution guide</a>
Step-by-step guidance to help assess your current environment, prepare for migration, and make the shift to Azure</li>
<li><a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/innovate/innovation-guide/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure innovation guide</a>
Step-by-step guidance to help build innovative solutions leveraging Azure platform capabilities</li>
</ul>
<p><strong>Govern</strong></p>
<ul>
<li><a href="https://archcenter.blob.core.windows.net/cdn/fusion/governance/Governance%20Discipline%20Template.docx" target="_blank" rel="noopener noreferrer">Governance process template</a></li>
<li><a href="https://archcenter.blob.core.windows.net/cdn/fusion/governance/Cost%20Management%20Discipline%20Template.docx" target="_blank" rel="noopener noreferrer">Cost Management process template</a></li>
<li><a href="https://archcenter.blob.core.windows.net/cdn/fusion/governance/Deployment%20Acceleration%20Discipline%20Template.docx" target="_blank" rel="noopener noreferrer">Deployment acceleration process template</a></li>
<li><a href="https://archcenter.blob.core.windows.net/cdn/fusion/governance/Identity%20Baseline%20Discipline%20Template.docx" target="_blank" rel="noopener noreferrer">Identity process template</a></li>
<li><a href="https://archcenter.blob.core.windows.net/cdn/fusion/governance/Resource%20Consistency%20Discipline%20Template.docx" target="_blank" rel="noopener noreferrer">Resource consistency process template</a></li>
<li><a href="https://archcenter.blob.core.windows.net/cdn/fusion/governance/Security%20Baseline%20Discipline%20Template.docx" target="_blank" rel="noopener noreferrer">Security baseline process template</a></li>
</ul>
<p><strong>Manage</strong></p>
<ul>
<li><a href="https://aka.ms/adopt/architecturereview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Well-Architecture review</a>
Examine your workloads through the lenses of resiliency, cost, DevOps practices, security, and scalability.</li>
<li><a href="https://github.com/microsoft/CloudAdoptionFramework/tree/master/manage/Automation-Best-Practices" target="_blank" rel="noopener noreferrer">Best practices source code</a></li>
<li><a href="https://raw.githubusercontent.com/microsoft/CloudAdoptionFramework/master/manage/opsmanagementworkbook.xlsx" target="_blank" rel="noopener noreferrer">Operations management workbook</a></li>
</ul>
<blockquote>
<p>The <a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Microsoft Cloud Adoption Framework for Azure">Microsoft Cloud Adoption Framework</a> page has everything listed above and more! If you are serious about Cloud Adoption, then reading through the official documentation not only gives you better context to the resources linked to this page but gives you more ways to think about potential opportunities to help with your Cloud adoption!</p>
</blockquote>
<blockquote>
<p>Most of these tools can be found directly in the public Cloud Adoption Framework GitHub repository: <a href="https://github.com/microsoft/CloudAdoptionFramework/tree/master#microsoft-cloud-adoption-framework-for-azure" target="_blank" rel="noopener noreferrer">microsoft/CloudAdoptionFramework</a> so keep an eye on that!</p>
</blockquote>
<blockquote>
<p>Make sure you follow the <a href="https://learn.microsoft.com/azure/cloud-adoption-framework/get-started/whats-new?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Cloud Adoption Framework - Whats new page, to keep up with the current best practices</a></p>
</blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/12/03/azure-nat-gateway/">Azure NAT Gateway - Implementation and Testing</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-03T00:00:00.000Z">December 3, 2021</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>With most Cloud resources being accessible over the internet, each publically accessible resource has its own public IP address, this makes it a lot more challenging to administer the security and access rules to access third party services.</p>
<p><em>Think along the lines of - you or your organisation might use software-as-a-service CRM product. That product is only accessible from your organisations IP for compliance/security reasons, you might access the CRM product from various Azure Virtual Desktop hosts, each with its public IP or a random Microsoft Azure datacenter IP, or you want to control Multifactor authentication/conditional access policies for users using Azure services</em>.</p>
<p>The administration of this, particularly in scenarios where other people or teams can create and manage resources, can be complex, sure; you can use Standard Load Balancers, which would help, but you have to manage and pay for it, which is sometimes overkill.</p>
<p>Tunnelling outbound traffic through to a specific IP address or IP addresses to <em>&#x27;known controllable IP addresses</em>&#x27; for Azure resources <em>(both IaaS and PaaS)</em> which sit in the same Virtual Network is where the Azure NAT Gateway comes in, allowing you to easily allow and control what IPs your traffic is coming from. NAT Gateway replaces the default Internet destination in the virtual network’s routing table for the subnets identified</p>
<p>&quot;The Azure NAT gateway is a fully managed, highly resilient service built into the Azure fabric, which can be associated with one or more subnets in the same Virtual Network, that ensures that all outbound Internet-facing traffic will be routed through the gateway. As a result, the NAT gateway gives you a predictable public IP for outbound Internet-facing traffic. It also significantly increases the available <a href="https://learn.microsoft.com/en-us/azure/app-service/troubleshoot-intermittent-outbound-connection-errors?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">SNAT ports</a> in scenarios where you have a high number of concurrent connections to the same public address/port combination.&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="my-testing">My Testing<a href="#my-testing" class="hash-link" aria-label="Direct link to My Testing" title="Direct link to My Testing">​</a></h3>
<p>Now lets get testing the Azure NAT Gateway! To test the gateway, I created:</p>
<ul>
<li>Virtual Network</li>
<li>NAT Gateway</li>
<li>IP Public Address prefix</li>
<li>1 Windows VM (Windows Server 2019) with Public IP</li>
<li>1 Linux (Ubuntu 18.04) VM with Public IP</li>
<li>1 Windows VM (Windows Server 2019) as a backend pool for an Azure Load Balancer</li>
<li>Virtual Machine Scale Set with four instances (each with Windows Server 2019)</li>
</ul>
<p><em>Note: Each VM has RDP opened to allow inbound traffic from my network using the Public IP and a NAT rule allowing RDP traffic on the Load Balancer. There is no point-to-site or site-to-site VPN; RDP connections are directly over the internet to Australia East, from New Zealand.</em></p>
<p><img decoding="async" loading="lazy" alt="NAT Gateway - Test" src="/assets/images/natgw_test-00b5b43e607a11f781e20ca0aeaafb77.png" title="NAT Gateway - Test" width="825" height="727" class="img_ev3q"></p>
<p>Once the Azure resources were created, I then connected to each machine using RDP/SSH on their Public IP address and tested:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-machine-with-public-ip-for-rdp">Linux Machine with Public IP for RDP<a href="#linux-machine-with-public-ip-for-rdp" class="hash-link" aria-label="Direct link to Linux Machine with Public IP for RDP" title="Direct link to Linux Machine with Public IP for RDP">​</a></h4>
<ul>
<li>Inbound Public IP: 20.53.92.19</li>
<li>Outbound IP: 20.53.73.184</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Linux Azure NAT Gateway" src="/assets/images/linux_ubuntu_nat_test-33238a3f8c0cfd898ed2dc4a2689dce5.png" title="Linux Azure NAT Gateway" width="702" height="265" class="img_ev3q"></p>
<p>As you can see, I connected to the Linux VM&#x27;s public IP via SSH and did a curl to: <a href="https://ifconfig.me/" target="_blank" rel="noopener noreferrer" title="https://ifconfig.me/">https://ifconfig.me/</a> to grab my public IP. The public IP of my Linux box was my NAT Gateway Public IP prefix!</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="windows-machine-with-public-ip-for-rdp">Windows Machine with Public IP for RDP<a href="#windows-machine-with-public-ip-for-rdp" class="hash-link" aria-label="Direct link to Windows Machine with Public IP for RDP" title="Direct link to Windows Machine with Public IP for RDP">​</a></h4>
<ul>
<li>Inbound Public IP: 20.70.228.211</li>
<li>Outbound IP: 20.53.73.184</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Windows Azure NAT Gateway" src="/assets/images/window_nat_test-a03d77e5ea0ca976d4f8fc6461b099ed.png" title="Windows Azure NAT Gateway" width="683" height="583" class="img_ev3q"></p>
<p>Using RDP to the public IP of the Windows Server, I navigated to: <a href="https://www.whatismyip.com/" target="_blank" rel="noopener noreferrer" title="https://www.whatismyip.com/">https://www.whatismyip.com/</a>. As you can see, the Public IP of my outbound IP address was my NAT Gateway Public IP prefix!</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="windows-machine-behind-an-azure-load-balancer">Windows Machine behind an Azure Load Balancer<a href="#windows-machine-behind-an-azure-load-balancer" class="hash-link" aria-label="Direct link to Windows Machine behind an Azure Load Balancer" title="Direct link to Windows Machine behind an Azure Load Balancer">​</a></h4>
<ul>
<li>Inbound Public IP: 20.211.100.67</li>
<li>Outbound IP: 20.53.73.185</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Windows Machine behind Azure Load Balancer NAT Gateway" src="/assets/images/windows_nat_test_loadbalancer-1c5763ffd5f99c2c00730edfbb327ce3.png" title="Windows Machine behind Azure Load Balancer NAT Gateway" width="1188" height="676" class="img_ev3q"></p>
<p>This was the last of the 3 test machines; I stood up. Using RDP to the public IP of the Azure Load BalancerI navigated to: <a href="https://www.whatismyip.com/" target="_blank" rel="noopener noreferrer" title="https://www.whatismyip.com/">https://www.whatismyip.com/</a>. As you can see, the Public IP of my outbound IP address was my NAT Gateway Public IP prefix; however, this was &#x27;20.53.73.18<strong>5</strong>&#x27;, which was the second IP address available in my /31 IP address prefix.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="windows-machine-behind-a-vm-scale-set">Windows Machine behind a VM Scale Set<a href="#windows-machine-behind-a-vm-scale-set" class="hash-link" aria-label="Direct link to Windows Machine behind a VM Scale Set" title="Direct link to Windows Machine behind a VM Scale Set">​</a></h4>
<p>Although not in the diagram, I decided to add a VM Scale Set of 4 Virtual Machines into my testing <em>(to save on cost, they are just Standard_B2ms machines but more than enough for my testing)</em>.</p>
<p><img decoding="async" loading="lazy" alt="Azure NAT Gateway - VM Scale Set" src="/assets/images/vmss_nat_test-1f9e77a0214602816a616e2129b1e87f.png" title="Azure NAT Gateway - VM Scale Set" width="1376" height="1190" class="img_ev3q"></p>
<p>As you can see from the mess that is my screenshot above, all machines had completely different inbound Public IP addresses. Still, the outbound public IP addresses came from the NAT Gateway as expected.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="findings-and-observations">Findings and Observations<a href="#findings-and-observations" class="hash-link" aria-label="Direct link to Findings and Observations" title="Direct link to Findings and Observations">​</a></h4>
<ul>
<li>The outbound public IP did seem to change between the workloads; if I refreshed &#x27;<em>whatismyip</em>&#x27; and &#x27;<em>ifconfig</em>&#x27;, the public IP changed between 184 and 185. However, no loss of connectivity occurred to the Virtual Machines. This was linked to the &#x27;4-minute idle timeout&#x27; configured on the NAT Gateway; I saw no reason to change the default timeout value; if I were that worried about the same IP address - I would have chosen with a Public IP vs a Public IP prefix on the NAT Gateway.</li>
<li>Any Public IP used on the same subnet as a NAT Gateway needs to be Standard.</li>
<li>If I had both a Public IP address and a Public IP prefix on my NAT gateway, the Prefix seemed to take precedence.</li>
<li>You cannot use a Public IP Prefix that is in use by the NAT Gateway for any other workload, <em>i.e. any inbound Public IPs. It would be best if you had another Public IP prefix resource.</em></li>
<li>A single <a href="https://learn.microsoft.com/en-us/azure/virtual-network/nat-gateway/nat-gateway-resource?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">NAT gateway resource</a> supports from 64,000 up to 1 million concurrent flows. Each IP address provides 64,000 SNAT ports to the available inventory. Therefore, you can use up to 16 IP addresses per NAT gateway resource. The SNAT mechanism is described <a href="https://learn.microsoft.com/en-us/azure/virtual-network/nat-gateway/nat-gateway-resource?WT.mc_id=AZ-MVP-5004796#source-network-address-translation" target="_blank" rel="noopener noreferrer">here</a> in more detail.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-nat-gateway">Create a NAT Gateway<a href="#create-a-nat-gateway" class="hash-link" aria-label="Direct link to Create a NAT Gateway" title="Direct link to Create a NAT Gateway">​</a></h3>
<p>To create my NAT Gateway, I used the ARM Quickstart template, located here: <a href="https://learn.microsoft.com/en-us/azure/virtual-network/nat-gateway/quickstart-create-nat-gateway-template?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="https://learn.microsoft.com/en-us/azure/virtual-network/nat-gateway/quickstart-create-nat-gateway-template?WT.mc_id=AZ-MVP-5004796">https://learn.microsoft.com/en-us/azure/virtual-network/nat-gateway/quickstart-create-nat-gateway-template</a>.</p>
<p>Then I created the additional Virtual Machines and Load Balancers and added them to the same VNET created as part of the NAT Gateway.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="to-create-a-nat-gateway-using-the-azure-portal"><strong>To create a NAT Gateway using the Azure Portal</strong><a href="#to-create-a-nat-gateway-using-the-azure-portal" class="hash-link" aria-label="Direct link to to-create-a-nat-gateway-using-the-azure-portal" title="Direct link to to-create-a-nat-gateway-using-the-azure-portal">​</a></h4>
<ol>
<li>Log in to the <strong>Azure Portal</strong> and navigate to <strong>Create a resource</strong>, <strong>NAT Gateway</strong> (this link will get you there: <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FAzure%2Fazure-quickstart-templates%2Fmaster%2Fquickstarts%2Fmicrosoft.network%2Fnat-gateway-1-vm%2Fazuredeploy.json" target="_blank" rel="noopener noreferrer" title="Create network address translation (NAT) gateway">Create-NATGateway</a>).</li>
<li>Select your <strong>Subscription</strong></li>
<li><strong>Enter</strong> your NAT <strong>Gateway name</strong></li>
<li>Enter your <strong>Region</strong></li>
<li>Enter your availability zone</li>
<li>Set your idle timeout <em>(I suggest leaving this at 4 minutes, you can change it later if it presents issues)</em></li>
<li><img decoding="async" loading="lazy" alt="Create Azure NAT Gateway" src="/assets/images/create_natgateway1-b0e6eafcd83aea2fba3cde27182eda08.png" title="Create Azure NAT Gateway" width="784" height="596" class="img_ev3q"></li>
<li>Click <strong>Next: Outbound IP</strong></li>
<li>We are just going to <strong>create</strong> a new <strong>Public IP address</strong> (<em>it has to be Standard and Static, the Azure Portal automatically selects this for you - although you can create your Public IP prefix here for scalability, you don&#x27;t need it both)</em>.</li>
<li><img decoding="async" loading="lazy" alt="Create Azure NAT Gateway" src="/assets/images/create_natgateway2-324efe21f23232b8c4d4daf8d4711584.png" title="Create Azure NAT Gateway" width="820" height="377" class="img_ev3q"></li>
<li>Click <strong>Next: Subnet</strong></li>
<li>Create or <strong>link</strong> your existing <strong>Virtual Network</strong> and <strong>subnets</strong> and click <strong>Next: Tags</strong></li>
<li><strong>Enter</strong> in any <strong>tags</strong> that may be relevant <em>(Creator, Created on, Created for, Support Team etc.)</em></li>
<li>Click <strong>Next: Review  + Create</strong></li>
<li>Verify everything looks ok then click <strong>Create</strong></li>
</ol>
<p><strong>Congratulations, you have now created your NAT Gateway!</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="to-create-a-nat-gateway-using-azure-bicep"><strong>To create a NAT Gateway using Azure Bicep</strong><a href="#to-create-a-nat-gateway-using-azure-bicep" class="hash-link" aria-label="Direct link to to-create-a-nat-gateway-using-azure-bicep" title="Direct link to to-create-a-nat-gateway-using-azure-bicep">​</a></h4>
<p>Just a quick Bicep snippet I created to create the NAT Gateway resource only:</p>
<div class="language-bicep codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">Create-NATGateway.bicep</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bicep codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Target Scope is: Resource Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">targetScope</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;resourceGroup&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Set Variables and Parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token decorator">@allowed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Prod&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Dev&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> environment </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Prod&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> location </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">resourceGroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> dateTime </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">utcNow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;d&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> resourceTags </span><span class="token datatype class-name">object</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">Application</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Azure NAT Gateway/Azure Network Management&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">CostCenter</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Operational&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">CreationDate</span><span class="token operator">:</span><span class="token plain"> dateTime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">Environment</span><span class="token operator">:</span><span class="token plain"> environment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//// Resource Creation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">/// Create - NAT Gateway</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> NATGW </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Network/natGateways@2021-03-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;aznatgw&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">tags</span><span class="token operator">:</span><span class="token plain"> resourceTags</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">location</span><span class="token operator">:</span><span class="token plain"> location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">sku</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Standard&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">idleTimeoutInMinutes</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It can be deployed by opening PowerShell <em>(after</em> <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/install?WT.mc_id=AZ-MVP-5004796#windows" target="_blank" rel="noopener noreferrer" title="Install Bicep tools"><em>Bicep is installed</em></a><em>using the PowerShell method)<em>and logging into your Azure and running the following</em>(replace RGNAME with the name of the Resource Group you will be deploying it to)</em>:</p>
<p><em>When you are actually ready to deploy, remove the -Whatif at the end. Then you can go into the resource and add the Public IP/prefix. PowerShell will prompt you for the name of the NAT Gateway and be created in the same location as the Resource Group by default.</em></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzResourceGroupDeployment -Name NatGwDeployment -ResourceGroupName RGNAME -TemplateFile .\Create_NATGateway.bicep -whatif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources">​</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-network/nat-gateway/nat-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">What is Virtual Network NAT?</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-network/nat-gateway/nat-gateway-resource?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Design Virtual Networks that use NAT gateway resources</a></li>
<li><a href="https://azure.microsoft.com/en-us/pricing/details/virtual-network/?WT.mc_id=AZ-MVP-5004796#pricing" target="_blank" rel="noopener noreferrer" title="Azure NAT Gateway Pricing">NAT Gateway Pricing</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/10/28/benefits-to-using-the-microsoft-azure-cloud-to-host-your-infrastructure/">Benefits to using the Microsoft Azure Cloud to host your Infrastructure</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-10-27T11:00:00.000Z">October 27, 2021</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Cloud computing offers many benefits, from your traditional on-premises infrastructure, ecosystems such as Microsoft Azure, have an underlying fabric built for today&#x27;s &#x27;software as a service&#x27; or &#x27;software defined&#x27; world.</p>
<p>The shift of technologies from managing on-premises Exchange environments for mail to consuming Microsoft 365 services has allowed more time for the IT and businesses to adopt, consume and improve their technology and continuously improve - to get the most use of it and remain competitive in this challenging world.</p>
<p>Below is a high-level list of what I consider some of the benefits of using the Microsoft Azure ecosystem:</p>
<ul>
<li>Each Azure datacentre &#x27;region&#x27; has 3 Availability Zones, each zone acts as a separate datacentre, giving redundant power and networking services, quickly allowing you to separate your services across different fault domains and zones, providing better resiliency, while also giving you the ability to keep them logically and physically close together.</li>
<li>Geo-redundant replication of backups for Virtual Machines, PaaS/File Shares, and ability to do cross-region restore functionality (i.e., Australia/Australia East).</li>
<li>A multitude of hosts (supporting both AMD and Intel workloads), which are continually patched and maintained, and tuned for virtualisation performance, stability and security, no longer do we need to spend hours patching, maintaining, licensing on-premises hypervisors, ever so increasing as these systems get targeted for vulnerabilities and architecting how many physical hosts, we may need to support a system.</li>
<li>Consistent, up-to-date hardware, no need to worry about lead times for new hardware, purchasing new hardware every three years and procurement and implementation costs of hardware, allowing you to spend the time improving on the business and tuning your services <em>(scaling up and down, trying new technologies, turning off devices etc.)</em></li>
<li>For those that like to hoard every file that ever existed, the Azure platform allows scale <em>(in and out to suit your file sizes)</em> along with cost-saving opportunities and tweaks with Automation and migrating files between cool/hot tiers.</li>
<li>No need to pay datacentre hosting costs</li>
<li>No need to worry about redundant switching</li>
<li>With multiple hosts, there is no risk around air conditioning leaks, hardware failure; you don&#x27;t need to worry about some of these unfortunate events occurring.</li>
<li>No need to pay electricity costs to host your workloads.</li>
<li>Reduced IT labour costs and time to implement and maintain systems</li>
<li>OnDemand resources available can stand up separate networks unattached to your production network for testing or other devices easily without working out through VLANs or complex switching and firewalls.</li>
<li>Azure Network have standard DDOS protection enabled by default</li>
<li>Backups are secure by default; they are offline and managed by Microsoft, so if a ransomware attack occurs, won&#x27;t be able to touch your backups.</li>
<li>Constant Security recommendations, improvements built into the platform.</li>
<li>Azure Files is geo-redundant and across multiple storage arrays, encrypted at rest.</li>
<li>Windows/SQL licensing is all covered as part of the costings, so need to worry about not adhering to MS licensing, Azure helps simplify what can sometimes be confusing and complex licensing.</li>
<li>Extended security updates for out-of-date Server OS such as Windows Server 2008 R2, Windows Server 2021 R2 without having to pay for extended update support.</li>
<li>Ability to leverage modern and remote desktop and application technologies such as Windows 365 and Azure Virtual Desktop, by accessing services hosted in Azure.</li>
<li>Having your workloads in Azure gives you a step towards, removing the need for traditional domain controllers and migrating to Microsoft Entra ID joined devices.</li>
<li>Azure AutoManage functionality is built in to automatically patch Linux (and Windows of course!), without having to manage separate patching technologies for cross-platform infrastructure.</li>
<li>Azure has huge support for Automation, via PowerShell, CLI and API, allowing you to standardize, maintain, tear down and create infrastructure and services, monitoring, self-users on an as needed basis.</li>
<li>Azure datacentres are sustainable and run off renewable energy where they can, Microsoft has commitments to be fully renewable.</li>
<li>No need for NAS or Local Backups, the backups are all built into Azure.</li>
<li>Compliant datacentre across various global security standards - <a href="https://learn.microsoft.com/en-us/compliance/assurance/assurance-datacenter-security?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="https://learn.microsoft.com/en-us/compliance/assurance/assurance-datacenter-security?WT.mc_id=AZ-MVP-5004796">https://learn.microsoft.com/en-us/compliance/assurance/assurance-datacenter-security</a></li>
<li>Ability to migrate or expand your resources from Australia to ‘NZ North’ or other new or existing data centres! Azure is global and gives you the ability to scale your infrastructure to a global market easily or bring your resources closer to home if a data centre becomes available.</li>
<li>We all know that despite the best of intentions, we rarely ever test, develop, and improve disaster recovery scenarios, sometimes this is because of the complexity of the applications and backup infrastructure. Azure Site Recovery, Geo-Redundant backup, Load Balancers and automation helps make this a lot easier.</li>
<li>Ability to better utilise Cloud security tools <em>(ie such as the Azure Security Center)</em>, across Cloud and on-premises workloads consistently using Azure Arc and Azure policies.</li>
<li>And finally - more visibility into the true cost and value of your IT infrastructure, the total cost of your IT Infrastructure is hidden behind electricity costs, outages and incidents that would not have impacted cloud resources, slow time to deployment or market, outdated and insecure technologies and most likely services you are running which you don&#x27;t need to run!</li>
</ul>
<p>#ProTip - Resources such as the <a href="https://azure.microsoft.com/en-us/pricing/tco/calculator/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Total Cost of Ownership (TCO) Calculator">Azure Total Cost of Ownership (TCO)</a> can help you calculate the true cost of your workloads.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/08/25/always-on-vpn-error-809-the-network-connection-between-your-computer-and-the-vpn-server-could-not-be-established/">Always on VPN - Error 809 The network connection between your computer and the VPN server could not be established </a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-08-25T00:00:00.000Z">August 25, 2021</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>I ran into a weird issue, troubleshooting an &#x27;Always On VPN&#x27; installation running off Windows Server 2019, the clients were getting the following error in the Application event log:</p>
<blockquote>
<p>Error 809 The network connection between your computer and the VPN server could not be established</p>
</blockquote>
<p>In my case, the issue wasn&#x27;t due to <a href="https://directaccess.richardhicks.com/2019/02/14/troubleshooting-always-on-vpn-error-code-809/" target="_blank" rel="noopener noreferrer" title="Troubleshooting Always On VPN Error Code 809">IKEv2 Fragmentation</a> or anything to do with <a href="https://directaccess.richardhicks.com/2020/04/13/always-on-vpn-ikev2-load-balancing-and-nat/" target="_blank" rel="noopener noreferrer" title="Always On VPN IKEv2 Load Balancing and NAT">NAT</a> to allow the origin IP to flow to the Always-on VPN server. It was due to the ports being limited to: &#x27;2&#x27;. I found an old post regarding Windows Server 2008 R2:</p>
<ul>
<li><a href="https://support.microsoft.com/en-us/topic/the-maximum-number-of-wan-miniport-ikev2-ports-changes-from-128-to-two-after-you-install-windows-server-2008-r2-sp1-15aeb929-abe9-ece0-5d71-d2223d6a94d0" target="_blank" rel="noopener noreferrer" title=" The maximum number of WAN Miniport (IKEv2) ports changes from 128 to two after you install Windows Server 2008 R2 SP1">The maximum number of WAN Miniport (IKEv2) ports changes from 128 to two after you install Windows Server 2008 R2 SP1</a></li>
</ul>
<blockquote>
<p>&quot;If more than two clients try to connect to the server at the same time, the Routing and Remote Access service rejects the IKEv2 connection requests. Additionally, the following message is logged in the Rastapi.log file:&quot;</p>
</blockquote>
<p>This matched my issue; I had never seen more than 2 connections at once.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="increase-ports">Increase Ports<a href="#increase-ports" class="hash-link" aria-label="Direct link to Increase Ports" title="Direct link to Increase Ports">​</a></h3>
<ol>
<li>Open <strong>Routing and Remote Access</strong></li>
<li><strong>Click</strong> on your Routing and <strong>Remote Access server</strong></li>
<li><strong>Right</strong>-<strong>click</strong> on <strong>Ports</strong></li>
<li>Click on: <strong>WAN Miniport (IKEv2)</strong></li>
<li>Click <strong>Configure</strong></li>
<li><strong>Ensure</strong> that: To <strong>enable remote access</strong>, select Remote access <strong>connections</strong> (inbound only) is <strong>checked.</strong></li>
<li><strong>Change Maximum ports</strong> from 2 <em>(as an example)</em> to a number that matches how many connections you want - I went with <strong>128</strong></li>
<li>Click <strong>Ok</strong></li>
<li>Click <strong>Apply</strong></li>
<li><strong>Restart</strong> the Routing and Remote Access <strong>server. You</strong> should now see more ports listed &#x27;as inactive&#x27; until a new session comes along and uses it.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Routing and Remote Access" src="/assets/images/wan_miniport_ikev2-508265e55ade0da0ddcb5a62869efeb3.png" title="Routing and Remote Access" width="407" height="343" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Routing and Remote Access" src="/assets/images/wan_miniport_ports-e49748c1ad5e7590899a3cb0d1989eb4.png" title="Routing and Remote Access" width="396" height="301" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-tls-11">Enable TLS 1.1<a href="#enable-tls-11" class="hash-link" aria-label="Direct link to Enable TLS 1.1" title="Direct link to Enable TLS 1.1">​</a></h3>
<p>Although this wasn&#x27;t my initial fix, I had a Microsoft Support call opened regarding this issue; after analysing the logs, they recommended enabling TLS 1.1 <em>(which was disabled by default on a Windows Server 2019 server)</em>. I would only do this as a last resort - if required.</p>
<p>Run the PowerShell script below (as Administrator) to Enable; you can always rerun the Disable script to remove the changes.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enable-tls-11-1">Enable TLS 1.1<a href="#enable-tls-11-1" class="hash-link" aria-label="Direct link to Enable TLS 1.1" title="Direct link to Enable TLS 1.1">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">function enable-tls-1.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-Item &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#x27; -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-Item &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#x27; -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-ItemProperty -Path &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#x27; -name &#x27;Enabled&#x27; -value &#x27;1&#x27; –PropertyType &#x27;DWORD&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-ItemProperty -Path &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#x27; -name &#x27;DisabledByDefault&#x27; -value &#x27;0&#x27; –PropertyType &#x27;DWORD&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-ItemProperty -Path &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#x27; -name &#x27;Enabled&#x27; -value &#x27;1&#x27; –PropertyType &#x27;DWORD&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-ItemProperty -Path &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#x27; -name &#x27;DisabledByDefault&#x27; -value &#x27;0&#x27; –PropertyType &#x27;DWORD&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Write-Host &#x27;Enabling TLSv1.1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">enable-tls-1.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="disable-tls-11">Disable TLS 1.1<a href="#disable-tls-11" class="hash-link" aria-label="Direct link to Disable TLS 1.1" title="Direct link to Disable TLS 1.1">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">function disable-tls-1.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-Item &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#x27; -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-Item &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#x27; -Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-ItemProperty -Path &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#x27; -name &#x27;Enabled&#x27; -value &#x27;0&#x27; –PropertyType &#x27;DWORD&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-ItemProperty -Path &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&#x27; -name &#x27;DisabledByDefault&#x27; -value &#x27;1&#x27; –PropertyType &#x27;DWORD&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-ItemProperty -Path &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#x27; -name &#x27;Enabled&#x27; -value &#x27;0&#x27; –PropertyType &#x27;DWORD&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    New-ItemProperty -Path &#x27;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&#x27; -name &#x27;DisabledByDefault&#x27; -value &#x27;1&#x27; –PropertyType &#x27;DWORD&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Write-Host &#x27;Disabling TLSv1.1&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">disable-tls-1.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/windows/">Windows</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2021/08/21/update-admpwdadschema-the-requested-attribute-does-not-exist/">Update-AdmPwdAdSchema - The requested attribute does not exist</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-08-21T00:00:00.000Z">August 21, 2021</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Are you attempting to update the Active Directory Schema for LAPS (Local Administrator Password Solution) and keep getting the error below?</p>
<p><strong>Update-AdmPwdAdSchema: The requested attribute does not exist</strong></p>
<p>Here are few things you can check:</p>
<ul>
<li>Make sure you are a Schema Admin</li>
<li>Run PowerShell as Administrator</li>
<li>Run the PowerShell to update the schema directly from the Schema Master</li>
</ul>
<p>You can use the snippet below to check which Domain Controller the Schema Master role is running from:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-ADDomainController -Filter * | Select-Object Name, Domain, Forest, OperationMasterRoles | Where-Object {$_.OperationMasterRoles}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/power-shell/">PowerShell</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/page/30/"><div class="pagination-nav__label">Newer entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/page/32/"><div class="pagination-nav__label">Older entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
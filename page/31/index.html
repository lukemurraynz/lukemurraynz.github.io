<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Luke&#x27;s Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/page/31/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Luke&#x27;s Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz"><meta data-rh="true" name="description" content="Follow Luke, Microsoft Azure MVP, on a journey through the latest Microsoft and Azure Cloud innovations. Learn, explore, and stay ahead in the fast-moving world of cloud computing."><meta data-rh="true" property="og:description" content="Follow Luke, Microsoft Azure MVP, on a journey through the latest Microsoft and Azure Cloud innovations. Learn, explore, and stay ahead in the fast-moving world of cloud computing."><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/page/31/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/31/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/31/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://luke.geek.nz/page/31","mainEntityOfPage":"https://luke.geek.nz/page/31","headline":"Luke's Tech Blog - Unleashing the power of the cloud and other technologies!","description":"Follow Luke, Microsoft Azure MVP, on a journey through the latest Microsoft and Azure Cloud innovations. Learn, explore, and stay ahead in the fast-moving world of cloud computing.","blogPost":[{"@type":"BlogPosting","@id":"https://luke.geek.nz/2022/01/29/just-in-time-access-to-azure-virtual-machines","mainEntityOfPage":"https://luke.geek.nz/2022/01/29/just-in-time-access-to-azure-virtual-machines","url":"https://luke.geek.nz/2022/01/29/just-in-time-access-to-azure-virtual-machines","headline":"Just in Time access to Azure Virtual Machines","name":"Just in Time access to Azure Virtual Machines","description":"Microsoft Defender for Cloud offers advanced security features, combining functions such as adaptive application controls application whitelisting , net...","datePublished":"2022-01-28T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/application-security-groups-in-microsoft-azure","mainEntityOfPage":"https://luke.geek.nz/azure/application-security-groups-in-microsoft-azure","url":"https://luke.geek.nz/azure/application-security-groups-in-microsoft-azure","headline":"Application Security Groups in Microsoft Azure","name":"Application Security Groups in Microsoft Azure","description":"Azure Application Security Groups ASG allow you to define what workloads Virtual Machines you are running in Azure has access to what resource - without...","datePublished":"2022-01-21T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2022/01/16/awesome-azure-architecture-list","mainEntityOfPage":"https://luke.geek.nz/2022/01/16/awesome-azure-architecture-list","url":"https://luke.geek.nz/2022/01/16/awesome-azure-architecture-list","headline":"AWESOME-Azure-Architecture List","name":"AWESOME-Azure-Architecture List","description":"A very brief Blog article today, I have created an AWESOME-Azure-Architecture list, this list is hosted in Github and located here:","datePublished":"2022-01-16T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication","mainEntityOfPage":"https://luke.geek.nz/azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication","url":"https://luke.geek.nz/azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication","headline":"Create Azure Point to Site VPN using Microsoft Entra ID authentication","name":"Create Azure Point to Site VPN using Microsoft Entra ID authentication","description":"You may be working remotely or only have a few devices needing access to your resources in Azure; a solution that can be deployed is a point to site con...","datePublished":"2022-01-12T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2022/01/08/my-website","mainEntityOfPage":"https://luke.geek.nz/2022/01/08/my-website","url":"https://luke.geek.nz/2022/01/08/my-website","headline":"My Website Setup","name":"My Website Setup","description":"Pretty simple article today regarding 'My website setup'.","datePublished":"2022-01-08T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script>






<meta property="og:type" content="website">
<meta property="og:site_name" content="luke.geek.nz">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@lukemurraynz">
<meta name="twitter:creator" content="@lukemurraynz">
<meta name="author" content="Luke Murray">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"luke.geek.nz","description":"Microsoft MVP - Microsoft Azure ☁, Technical Consultant, Azure Solutions Architect Expert, Technologist and a drinker of coffee.","url":"https://luke.geek.nz","author":{"@type":"Person","name":"Luke Murray","url":"https://luke.geek.nz/about","sameAs":["https://twitter.com/lukemurraynz","https://www.linkedin.com/in/ljmurray/","https://aus.social/@lukemurray","https://bsky.app/profile/lukemurraynz.bsky.social"]},"publisher":{"@type":"Person","name":"Luke Murray"},"potentialAction":{"@type":"SearchAction","target":"https://luke.geek.nz/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script><link rel="stylesheet" href="/assets/css/styles.dd27eb3d.css">
<script src="/assets/js/runtime~main.d838af4d.js" defer="defer"></script>
<script src="/assets/js/main.e4391417.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/tags/">Tags</a><a class="navbar__item navbar__link" href="/archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/akahu-mcp-apim/">Expose Akahu APIs via Azure API Management MCP Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/container-apps-vnc-dosbox/">Azure Container Apps with VNC and DOSBox</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/partner-admin-link-tool/">Bulk Link Partner Admin Link (PAL) to Azure Tenants</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/microsoft-learn-contributor-chatmode/">Microsoft Learn Contributor Chatmode</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/service-groups-terraform-azapi/">Deploying Azure Service Groups with Terraform AzAPI</a></li></ul></div></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2022/01/29/just-in-time-access-to-azure-virtual-machines/">Just in Time access to Azure Virtual Machines</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-28T00:00:00.000Z">January 28, 2022</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Microsoft Defender for Cloud offers advanced security features, combining functions such as adaptive application controls <em>(application whitelisting)</em>, networking hardening <em>(machine learning that learns the traffic passing through your network security group, which helps you create more restricted rules)</em> and advanced antivirus and threat protection; however, a hidden gem of this suite is: Just in Time VM Access.</p>
<p>For a <a href="https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" Microsoft Defender for Cloud pricing">fee</a> for Microsoft Defender for Cloud, you can use Just In Time or JIT to lock down inbound traffic to your Azure Virtual Machines when you only need it.</p>
<p>This reduces exposure to attacks while providing easy access when you need to connect to a VM.</p>
<p>Today, we will use the Azure Portal and configure Just-in-Time access for RDP for a Windows virtual machine running in Microsoft Azure that has a public IP.</p>
<p>This article assumes you have the authority and permissions (<em>at least the Security Administrator role)</em> to configure and pay for Defender for Cloud.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-defender-for-cloud">Configure Defender for Cloud<a href="#configure-defender-for-cloud" class="hash-link" aria-label="Direct link to Configure Defender for Cloud" title="Direct link to Configure Defender for Cloud">​</a></h3>
<ol>
<li>Open the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Navigate to the Virtual Machine you would like to enable Defender for Cloud on and enable Just in Time Access for</li>
<li>Click on <strong>Configuration</strong></li>
<li>Click on: <strong>Upgrade your Security Center subscription</strong> to enable just-in-time access.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Configuration" src="/assets/images/azureportal-configurationinitialjit-b7e6cd55537179f29e3fb0df2ac94b65.png" width="1026" height="668" class="img_ev3q"></li>
<li><strong>Select</strong> the <strong>Subscription</strong> that holds your VM and select <strong>Upgrade</strong></li>
<li>If you want to make use of the rest of the Cloud Defender offerings (and you should), then make sure you install the Log Analytics agent; however, you don&#x27;t need it for Just In Time Access.</li>
<li><strong>Navigate</strong> back to your <strong>Virtual Machine</strong></li>
<li>Click on <strong>Configuration</strong></li>
<li>Now you should see: <strong>Enable for Just-in-Time VM access</strong>; select this to <strong>enable</strong> Just in Time.</li>
</ol>
<p>Now, if you go to the Network Security Group attached to the network interface of the VM, you should see a Deny Rule for 3389 that&#x27;s been created with a priority lower than the allowed rules, forcing the block.</p>
<p><img decoding="async" loading="lazy" alt="Azure Portal" src="/assets/images/azureportal-justintime_nsgblock-289ae9b8283c9b36ebf5ca83aa2920f3.png" width="1431" height="449" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-just-in-time">Configure Just In Time<a href="#configure-just-in-time" class="hash-link" aria-label="Direct link to Configure Just In Time" title="Direct link to Configure Just In Time">​</a></h3>
<p>Now that we have enabled Defender for Cloud, it&#x27;s time to configure what ports (can be used for more than just RDP and SSH access) and the length of time that access is allowed.</p>
<ol>
<li>Click on <strong>Microsoft Defender for Cloud</strong></li>
<li>Select <strong>Workload Protections</strong></li>
<li>Select <strong>Just-In-Time VM access</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Defender for Cloud" src="/assets/images/azureportal-defenderforcloud-ed47c1fde2f8773c2e076da1d6baa2e0.png" width="1695" height="1043" class="img_ev3q"></li>
<li><strong>Select</strong> the <strong>VM</strong> you have configured.</li>
<li>Click the <strong>ellipsis</strong> on the right-hand side</li>
<li>Select <strong>Edit</strong></li>
<li>Azure has automatically added the port for RDP (3389) and sets a maximum 3 hour request time (that I am allowed to connect to the VM); I can also restrict Just In TIme access from specific IP addresses, and IP ranges to avoid anyone being able to RDP from their home IP.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Defender for Cloud" src="/assets/images/azureportal-configurationports-99082b2eaff241ac4b7f63d037d12223.png" width="1312" height="425" class="img_ev3q"></li>
<li><strong>Make any adjustments</strong> you feel suits your environment. I am going to leave the configuration as is.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-access-for-just-in-time-access-to-rdp">Request Access for Just In Time Access to RDP<a href="#request-access-for-just-in-time-access-to-rdp" class="hash-link" aria-label="Direct link to Request Access for Just In Time Access to RDP" title="Direct link to Request Access for Just In Time Access to RDP">​</a></h3>
<p>You can <a href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/just-in-time-access-usage?tabs=jit-config-asc%2Cjit-request-powershell&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Secure your management ports with just-in-time access">programmatically</a>_request JiT access to Azure VM through PowerShell and the REST API <em>(see Additional Resources below for a PowerShell script to get you started)</em>, but we are going to use the Azure Portal.</p>
<ol>
<li>Open the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></li>
<li><strong>Navigate</strong> to the <strong>Virtual Machine</strong> you would like to enable Defender for Cloud on and enable Just in Time Access for</li>
<li>Click <strong>Connect</strong></li>
<li>You should see an information alert at the top of the blade &quot;This VM has a just-in-time access policy. Select &quot;Request access&quot; before connecting.&quot;</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Just In Time" src="/assets/images/azureportal-requestaccess-190761f3e83b87cd3f319d4415bee51a.png" width="1073" height="708" class="img_ev3q"></li>
<li>Select <strong>Source IP (My IP)</strong></li>
<li>Click <strong>Request access</strong></li>
<li>You should now have access to RDP to the machine!</li>
<li>If you look at the Network Security Group, you should be able to see a new &#x27;Allow&#x27; rule has been created with a priority lower than the block rule.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Just In Time" src="/assets/images/azureportal-justintime_nsgallow-d02eb1af9eb96ebfd07f9653f46a734f.png" width="1386" height="584" class="img_ev3q"></li>
<li>After 3 hours, the allowed rules will be removed automatically.</li>
</ol>
<p>Hopefully, this helps keep your environment secure; if you implement this, make sure you read about the custom roles. To prevent the people from just adding in a rule for their public IP in the address manually, it may be better to create a custom role <em>(see the script in Additional Resources below to create this role)</em>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources">​</a></h3>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/just-in-time-access-usage?tabs=jit-config-asc%2Cjit-request-asc&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Secure your management ports with just-in-time access">Secure your management ports with just-in-time access</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/defender-for-cloud/just-in-time-access-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Understanding just-in-time (JIT) VM access">Understanding just-in-time (JIT) VM access</a></li>
<li><a href="https://github.com/Azure/Microsoft-Defender-for-Cloud/tree/main/Powershell%20scripts/JIT%20Scripts" target="_blank" rel="noopener noreferrer" title="JIT Scripts">Just in Time Access Policy Script &amp; Custom Role Script</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/application-security-groups-in-microsoft-azure/">Application Security Groups in Microsoft Azure</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-21T00:00:00.000Z">January 21, 2022</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Azure Application Security Groups (ASG) allow you to define what workloads <em>(Virtual Machines)</em> you are running in Azure has access to what resource - without being tied by managing complex IP address rules inside a <a href="https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Network security groups">Network Security Group</a>.</p>
<blockquote>
<p>Application security groups enable you to configure network security as a natural extension of an application&#x27;s structure, allowing you to group virtual machines and define network security policies based on those groups. You can reuse your security policy at scale without manual maintenance of explicit IP addresses.</p>
</blockquote>
<p>These Azure Application Security groups allow you to define your workloads, for example, Azure Virtual Desktop Session Hosts as a &#x27;group&#x27; and what they may have access to in your Azure Virtual Network without opening up the service to everything inside of that VNET or creating overly complex rules that could make it hard to troubleshoot.</p>
<p>There are a few things to be mindful of:</p>
<ul>
<li>Azure Application Security Groups are Virtual Network-specific, so they can work to allow resources across subnets, but not in separate Virtual Networks, even if they have peered.</li>
<li>As with most Azure resources, there are Subscription level<a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/azure-subscription-service-limits?toc=%2Fazure%2Fvirtual-network%2Ftoc.json&amp;WT.mc_id=AZ-MVP-5004796#azure-resource-manager-virtual-networking-limits" target="_blank" rel="noopener noreferrer" title="Networking limits - Azure Resource Manager">limits</a>; you cannot have more than 3,000 Azure Application Security groups in a single subscription and region.</li>
<li>The rules that specify an application security group as the source or destination are only applied to the network interfaces that are members of the application security group; this does not affect anything not in this group, even though your Network Security Group is based on the subnet.</li>
<li>You can assign more than one Application Security group to a resource</li>
</ul>
<p>In my example, I have a single virtual network, with 2 subnets <em>(one subnet, has an Azure Virtual Desktop session host and the other one has a webserver running IIS)</em>, using Azure Application Security Groups, we will restrict IIS access to the webserver from the Azure Virtual Session hosts only - so IIS won&#x27;t be accessible from any other machine in the Virtual Network.</p>
<p><img decoding="async" loading="lazy" alt="High Level  - Diagram ASG" src="/assets/images/highleveldiagram_asg-b3541199809fbe28888be07cd337ab22.png" title="High Level  - Diagram ASG" width="627" height="527" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-application-security-group">Create Application Security Group<a href="#create-application-security-group" class="hash-link" aria-label="Direct link to Create Application Security Group" title="Direct link to Create Application Security Group">​</a></h4>
<p>Let&#x27;s get started by creating an Application Security Group.</p>
<ol>
<li>Open the <strong>Azure Portal</strong></li>
<li>Click on <a href="https://portal.azure.com/#create/hub" target="_blank" rel="noopener noreferrer" title="Azure Portal - Create a resoruce"><strong>+ Create a resource</strong></a></li>
<li>Search for: <strong>Application security group</strong> and select it</li>
<li>Click <strong>Create</strong></li>
<li><strong>Select</strong> the <strong>subscription</strong> that the Application Security group will be created in</li>
<li><strong>Select</strong> the <strong>Resource Group</strong> <em>(in my example, I am selecting AVD)</em></li>
<li><img decoding="async" loading="lazy" alt="Create an Application Security Group" src="/assets/images/create-applicationsecuritygroup-7c738b80cdc65d2afbc2e536ee6a13fb.png" title="Create an Application Security Group" width="795" height="416" class="img_ev3q"></li>
<li>Click <strong>Review + create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="assign-application-security-group">Assign Application Security Group<a href="#assign-application-security-group" class="hash-link" aria-label="Direct link to Assign Application Security Group" title="Direct link to Assign Application Security Group">​</a></h4>
<p>Now that the Application Security group has been created it&#x27;s time to assign it this our Azure Virtual Desktop session hosts.</p>
<ol>
<li>Open the <strong>Azure Portal</strong></li>
<li><strong>Navigate</strong> to your <strong>Azure Virtual Desktop</strong> session host <em>(or other workloads you are going to use)</em></li>
<li>Select <strong>Networking</strong></li>
<li>Select <strong>Application security groups</strong></li>
<li>Click <strong>Configure the application security groups</strong></li>
<li><strong>Select</strong> the Application Security <strong>group</strong> created earlier</li>
<li><img decoding="async" loading="lazy" alt="Assign Application Security Group" src="/assets/images/assign-applicationsecuritygroup-a027d76b6b8017a47834f83cd8e195dd.png" title="Assign Application Security Group" width="1090" height="370" class="img_ev3q"></li>
<li>Click <strong>Save</strong></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="assign-block-rule-security-group">Assign Block Rule Security Group<a href="#assign-block-rule-security-group" class="hash-link" aria-label="Direct link to Assign Block Rule Security Group" title="Direct link to Assign Block Rule Security Group">​</a></h4>
<p>Now it&#x27;s time to assign a block rule to our web server, for port 80 as by default it is allowed through the &#x27;AllowVnetInBound&#x27; default rule.</p>
<ol>
<li>Navigate to the <strong>Network Security Group</strong> that holds your web server <em>(I am going to make the change on a Network Security group that is tied to the Network Interface of the web server, but the same principle applies if it was applied to a Network Security Group on the subnet - you just need to add the destination IP of the webserver)</em></li>
<li>Click on <strong>Inbound security rules</strong></li>
<li>Click <strong>+ Add</strong></li>
<li>Add a <strong>Deny</strong> port <strong>rule</strong> for port <strong>80</strong> for all source</li>
<li><img decoding="async" loading="lazy" alt="Assign Block Network Security Group Rule" src="/assets/images/create-blocknsg80rule-bc26478f693a52a88eca9ec532b4150a.png" title="Assign Block Network Security Group Rule" width="1721" height="964" class="img_ev3q"></li>
<li>Click <strong>Save</strong></li>
</ol>
<p>After a few minutes, traffic from any workloads on the virtual network will now be blocked from accessing the web server on port 80.</p>
<p><img decoding="async" loading="lazy" alt="Port 80 blocked" src="/assets/images/avd-testport80_deny-14b3573e8ea4a22bd77000fdfe5ab572.png" title="Port 80 blocked" width="999" height="748" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-allow-rule-using-application-security-group">Create Allow rule using Application Security Group<a href="#create-allow-rule-using-application-security-group" class="hash-link" aria-label="Direct link to Create Allow rule using Application Security Group" title="Direct link to Create Allow rule using Application Security Group">​</a></h4>
<p>Just a note around the priorities of Network Security Group rules:</p>
<blockquote>
<p>Rules are processed in priority order <em>(using a number between 100 and 4096)</em>, with lower numbers processed before higher numbers, because lower numbers have higher priority. Once traffic matches a rule, processing stops.</p>
<p>As a result, any rules that exist with lower priorities (higher numbers) that have the same attributes as rules with higher priorities are not processed.</p>
</blockquote>
<ol>
<li>Navigate to the <strong>Network Security Group</strong> that holds your web server <em>(I am going to make the change on a Network Security group that is tied to the Network Interface of the web server, but the same principle applies if it was applied to a Network Security Group on the subnet - you just need to add the destination IP of the webserver)</em></li>
<li>Click on <strong>Inbound security rules</strong></li>
<li>Click <strong>+ Add</strong></li>
<li>For <strong>Source</strong>, select the <strong>Application Security Group</strong></li>
<li>Select <strong>HTTP</strong> as the service</li>
<li>Select <strong>Allow</strong> as the action</li>
<li>Set the <strong>Priority</strong> to be <strong>lower</strong> than the block rule, ie 4095</li>
<li>Click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Create Network Security Rule Allow" src="/assets/images/avd-testport80_allow-3b6c766ed0c1fd30f863b2698e3733ac.png" title="Create Network Security Rule Allow" width="1263" height="971" class="img_ev3q"></li>
</ol>
<p>After a few minutes, traffic from any workloads on the virtual network will now be allowed for any workloads from your Azure Virtual Desktop farm only <em>(assigned to the Application Security group)</em>.</p>
<p><img decoding="async" loading="lazy" alt="AVD - Test Port 80 Allow" src="/assets/images/avd-testport80_edgeallow-1e2a72b524e604e0989c21987b646f7c.png" width="1276" height="688" class="img_ev3q"></p>
<p>If I attempted to access the webserver from my application server, it fails:</p>
<p><img decoding="async" loading="lazy" alt="AVD - Test Port 80 Deny" src="/assets/images/avd-testport80_deny-14b3573e8ea4a22bd77000fdfe5ab572.png" width="999" height="748" class="img_ev3q"></p>
<p>Hopefully, this helps you avoid overly complex security rules that are reliant on knowing and managing the IP of your workloads and help secure your networks.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2022/01/16/awesome-azure-architecture-list/">AWESOME-Azure-Architecture List</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-16T00:00:00.000Z">January 16, 2022</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>A very brief Blog article today, I have created an AWESOME-Azure-Architecture list, this list is hosted in Github and located here:</p>
<ul>
<li><a href="https://github.com/lukemurraynz/awesome-azure-architecture/blob/main/README.md" target="_blank" rel="noopener noreferrer" title="AWESOME-Azure-Architecture">AWESOME-Azure-Architecture</a></li>
</ul>
<p>This list is a curated list of AWESOME blogs, videos, tutorials, code, tools &amp; scripts, related to the design and implementation of solutions in Microsoft Azure.</p>
<p>This list contains anything that can help with your <strong>Microsoft Azure architecture</strong> and quickly get you up and running when designing, planning, and implementing services that empower organisations around the planet to achieve more.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication/">Create Azure Point to Site VPN using Microsoft Entra ID authentication</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-12T00:00:00.000Z">January 12, 2022</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>You may be working remotely or only have a few devices needing access to your resources in Azure; a solution that can be deployed is a point to site connection straight into your Microsoft Azure network.</p>
<p>This functionality allows your computer to connect privately to resources over a secure tunnel using your internet connection, using an Azure Virtual Network gateway, you can seamlessly connect to resources without the need of opening up your resources to the internet or having to whitelist your <em>(or third party vendor)</em> IP address, which may change daily.</p>
<p>You know only your specified users access your Azure resources using Microsoft Entra ID.</p>
<p>You can have a site to site and point to site VPN running on the same Gateway today. We will set up a Point to Site VPN using Windows 11.</p>
<p><img decoding="async" loading="lazy" alt="Azure Point to Site" src="/assets/images/hl_azurep2s-b91230db64b1534a63ed0a1112fb73ed.png" width="620" height="293" class="img_ev3q"></p>
<p>Depending on the SKU of your Virtual Network Gateway, depends on the number of concurrent connections and throughput you are allowed; because we are using Microsoft Entra ID and the OpenVPN protocol, I will be selecting Generation 1, VpnGw1, supporting a max of 250 connections <em>(you can double the number of throughput and connections if you are running in Active/Active and have a second gateway, or select a higher SKU)</em>.</p>
<blockquote>
<p>Azure AD authentication is supported for OpenVPN® protocol connections only and requires the Azure VPN client.</p>
</blockquote>
<p>A note about Gateway SKUs <em>(apart from Basic)</em> you can resize in the same generation <em>(i.e. Generation 1 VpnGw1 to VpnGw3, but you can&#x27;t go from Generation 1 VpnGw1 to Generation 2 VpnGw5, in order to upgrade, you have to delete and recreate the Gateway, just keep this in mind when deciding on the SKU of your resources</em>).</p>
<p>You can read more about the Virtual Network Gateways and VPN SKUs at the official Microsoft documentation <a href="https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">here</a>; your Gateway SKU may differ depending on your requirements.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-point-to-site-vpn-using-microsoft-entra-id-authentication">Create Azure Point to Site VPN using Microsoft Entra ID authentication<a href="#create-azure-point-to-site-vpn-using-microsoft-entra-id-authentication" class="hash-link" aria-label="Direct link to Create Azure Point to Site VPN using Microsoft Entra ID authentication" title="Direct link to Create Azure Point to Site VPN using Microsoft Entra ID authentication">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h4>
<ul>
<li>An Azure subscription <em>(that you have at least contributor rights to and the ability to create Users and Groups)</em></li>
<li>An endpoint device running Windows 10 or 11 that you can install the <a href="https://www.microsoft.com/en-us/p/azure-vpn-client-preview/9np355qt2sqb?rtc=2&amp;activetab=pivot:overviewtab" target="_blank" rel="noopener noreferrer" title=" Azure VPN Client">Azure VPN client</a> onto</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-virtual-network">Create Virtual Network<a href="#create-virtual-network" class="hash-link" aria-label="Direct link to Create Virtual Network" title="Direct link to Create Virtual Network">​</a></h4>
<p>First things first, let&#x27;s create a Virtual Network.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click on <strong>+ Create a resource</strong></li>
<li>Search for: <strong>Virtual Network</strong> and click on it</li>
<li>Click <strong>Create</strong></li>
<li><strong>Select</strong> or create your <strong>Resource Group</strong> that you want your network resource to sit in <em>(I recommend Virtual Network and the gateway resources sit in its own Resource Group away from other resources so that they can be protected by resource locks, RBAC and they are usually classified as a shared resource)</em>.</li>
<li><img decoding="async" loading="lazy" alt="Azure Virtual Network" src="/assets/images/azureportal-createvirtualnetwork-a1fbd5e45e24eb1276224ba7ce936150.png" title="Azure Virtual Network" width="782" height="481" class="img_ev3q"></li>
<li>Click <strong>Next: IP Addresses</strong></li>
<li>Now we need to <strong>define</strong> the <strong>Address space</strong> and subnets; I will leave the Address space as 10.0.0.0/16 but remove the Default subnet <em>(select the checkbox next to the Subnet and select Delete)</em></li>
<li>Click +<strong>Add Subnet</strong>, and add a new subnet with the name of GatewaySubnet with an IP range of: 10.0.1.0/27 <em>(this Subnet will be used by our Virtual Network Gateway, and the name needs to be exactly GatewaySubnet)</em>.</li>
<li>Now I will add a subnet named: app servers, for the Virtual Machines I will need to connect to will be placed.</li>
<li><img decoding="async" loading="lazy" alt="Azure Virtual Network" src="/assets/images/azureportal-createvirtualnetworksubnets-646829ca5d787c48027b5d59962ab0c0.png" title="Azure Virtual Network" width="782" height="493" class="img_ev3q"></li>
<li>Click <strong>Next: Security</strong></li>
<li>Leave everything <em>(BastionHost, DDoS Protection Standard, Firewall)</em> as Disabled.</li>
<li>Click <strong>Next: Tags</strong></li>
<li>Enter in any tags and click <strong>Review + Create</strong></li>
<li>Review your configuration and click <strong>Create</strong></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-virtual-network-gateway">Create Virtual Network Gateway<a href="#create-virtual-network-gateway" class="hash-link" aria-label="Direct link to Create Virtual Network Gateway" title="Direct link to Create Virtual Network Gateway">​</a></h4>
<p>Now that we have the foundation of our setup - an Azure Virtual Network, it is time to provision the Gateway itself; just a note before we continue, the Gateway can take 30-60 minutes to provision.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal">Azure Portal</a></li>
<li>Click on <strong>+ Create a resource</strong></li>
<li>Type in and search for: <strong>Virtual Network Gateway</strong></li>
<li>Click <strong>Create</strong></li>
<li>Type in the <strong>name</strong> of your Azure Virtual Network <strong>Gateway</strong></li>
<li>Select the <strong>region</strong> <em>(it must be the same region as your virtual network)</em></li>
<li>Select the Gateway Type: <strong>VPN</strong></li>
<li>The VPN type is: <strong>Route-based</strong></li>
<li><strong>Select</strong> the <strong>SKU</strong>, in this example - I will be going with VpnGw1</li>
<li><strong>Select</strong> the <strong>Generation</strong> of the Virtual Network Gateway; I am going with: Generation 1</li>
<li><strong>Select</strong> the <strong>Virtual Network</strong> that you created earlier, and it will automatically find and assign the Gateway to the Subnet named: GatewaySubnet</li>
<li><strong>Select</strong> Standard <strong>public IP</strong> address <strong>SKU</strong></li>
<li><strong>Select Public IP</strong> address and select: <strong>Create new</strong></li>
<li><strong>Type</strong> in your public IP <strong>name</strong></li>
<li><strong>Leave</strong> &#x27;Enable active-active mode&#x27; and &#x27;Configure BGP&#x27; as <strong>Disabled</strong>.</li>
<li>Click <strong>Review + Create</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Virtual Network Gateway" src="/assets/images/azureportal-createvnetfgw-5d497c12b28d82b47ebe4cfe171943d6.png" title="Azure Virtual Network Gateway" width="809" height="1004" class="img_ev3q"></li>
<li><strong>Verify configuration</strong> is correct and clicks <strong>Create</strong></li>
<li>It can take up to 30-60 minutes for the Virtual Network Gateway to be created.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-microsoft-entra-id-authentication-on-the-virtual-network-gateway">Setup Microsoft Entra ID authentication on the Virtual Network Gateway<a href="#setup-microsoft-entra-id-authentication-on-the-virtual-network-gateway" class="hash-link" aria-label="Direct link to Setup Microsoft Entra ID authentication on the Virtual Network Gateway" title="Direct link to Setup Microsoft Entra ID authentication on the Virtual Network Gateway">​</a></h4>
<p>Now that the Virtual Network has been created, we can now set up Microsoft Entra ID authentication.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="collect-microsoft-entra-id-tenant-id">Collect Microsoft Entra ID Tenant ID<a href="#collect-microsoft-entra-id-tenant-id" class="hash-link" aria-label="Direct link to Collect Microsoft Entra ID Tenant ID" title="Direct link to Collect Microsoft Entra ID Tenant ID">​</a></h5>
<p>First, we need to collect the Azure AD Tenancy ID</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click on <strong>Microsoft Entra ID</strong></li>
<li>In the Overview pane, <strong>copy</strong> the <strong>Tenant ID</strong> and save this for the next step.</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="grant-azure-vpn-client-permisisons">Grant Azure VPN Client permisisons<a href="#grant-azure-vpn-client-permisisons" class="hash-link" aria-label="Direct link to Grant Azure VPN Client permisisons" title="Direct link to Grant Azure VPN Client permisisons">​</a></h5>
<p>Now we need to grant the Azure VPN application permissions.</p>
<ol>
<li>
<p>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></p>
</li>
<li>
<p>Open a new window and type in and press Enter:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://login.microsoftonline.com/common/oauth2/authorize?client_id=41b23e61-6c1e-4545-b367-cd054e0ed4b4&amp;response_type=code&amp;redirect_uri=https://portal.azure.com&amp;nonce=1234&amp;prompt=admin_consent</span><br></span></code></pre></div></div>
</li>
<li>
<p>If you get an error about external identity, then replace /<strong>common</strong>/ with your tenant ID.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure VPN Permissions" src="/assets/images/azureportal_azurevpnpermissions-4859ac00017f2a1a732286341841759f.png" title="Azure VPN Permissions" width="458" height="588" class="img_ev3q"></p>
</li>
<li>
<p>Click <strong>Accept</strong></p>
</li>
<li>
<p>Navigate back to <strong>Microsoft Entra ID</strong></p>
</li>
<li>
<p>Select <strong>Enterprise Applications</strong></p>
</li>
<li>
<p>Select <strong>Azure VPN</strong></p>
</li>
<li>
<p><strong>Copy</strong> the <strong>Application ID</strong> of the Azure VPN enterprise application <em>(you will need both Application ID and tenant ID for the next steps)</em></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure VPN" src="/assets/images/azurevpn_enterpriseappvpn-48f8cda9eb6f9303035c244b742d5c11.png" title="Azure VPN" width="652" height="338" class="img_ev3q"></p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-point-to-site-connection">Configure Point to Site Connection<a href="#configure-point-to-site-connection" class="hash-link" aria-label="Direct link to Configure Point to Site Connection" title="Direct link to Configure Point to Site Connection">​</a></h5>
<p>Now its time to configure the Virtual Network Gateway</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></li>
<li><strong>Navigate</strong> to the Virtual Network <strong>Gateway</strong> you created earlier</li>
<li>Click on <strong>Point-to-site configuration</strong></li>
<li>Click <strong>Configure now</strong></li>
<li>Enter in your <strong>address pool</strong> <em>(this is the address pool of the VPN clients, make sure this doesn&#x27;t overlap with any other IP range you use, I will go with: 172.0.0.0/16)</em></li>
<li>Make sure the Tunnel type is: <strong>OpenVPN (SSL)</strong></li>
<li>Select <strong>Microsoft Entra ID</strong> for the <strong>Authentication</strong> type</li>
<li>For <strong>Tenant, ID enter</strong> in: <a href="https://login.microsoftonline.com/**TENANTID**/" target="_blank" rel="noopener noreferrer">https://login.microsoftonline.com/**TENANTID**/</a> and enter in your own Tenant ID.</li>
<li>For the Audience (this is the users and groups that are assigned to the Enterprise Azure VPN application), put in the Application ID of the Azure VPN.</li>
<li>For the Issuer, enter in: <a href="https://sts.windows.net/**TENANTID**/" target="_blank" rel="noopener noreferrer">https://sts.windows.net/**TENANTID**/</a></li>
<li><img decoding="async" loading="lazy" alt="Azure Virtual Network Gateway" src="/assets/images/azure-point-to-site-configuration-14d899979995fe8bec94fe6971233b8e.png" title="Azure Virtual Network Gateway" width="893" height="912" class="img_ev3q"></li>
<li>Click <strong>Save</strong></li>
<li>It may take 1-5 minutes to save the configuration</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="install-and-connect-using-the-azure-vpn-client">Install and connect using the Azure VPN client<a href="#install-and-connect-using-the-azure-vpn-client" class="hash-link" aria-label="Direct link to Install and connect using the Azure VPN client" title="Direct link to Install and connect using the Azure VPN client">​</a></h5>
<p>Now that the Point to Site VPN has been configured it&#x27;s time to connect!</p>
<ol>
<li>Click on <strong>Download VPN client</strong> <em>(if it is greyed out, then navigate to the Overview pane, then back to the Point-to-site configuration)</em>.</li>
<li>Extract the zip file, you will need these files</li>
<li><strong>Download</strong> the <a href="https://go.microsoft.com/fwlink/?linkid=2117554" target="_blank" rel="noopener noreferrer">Azure VPN Client</a> to your computer.</li>
<li><img decoding="async" loading="lazy" alt="Azure VPN Client" src="/assets/images/windowsstore-azurevpn-e3c19700463ac2ec4b149f6c5dffffd5.png" title="Azure VPN Client" width="1200" height="929" class="img_ev3q"></li>
<li>Once, downloaded click <strong>Open.</strong></li>
<li>Click the <strong>+</strong> sign (lower left)</li>
<li>Click <strong>Import</strong></li>
<li><strong>Navigate</strong> to the: <strong>azurevpnconfig.xml</strong> file that you downloaded earlier and click <strong>Open</strong></li>
<li>You can change the Connection Name to something more user friendly <em>(you can also edit the file directly for when you look at pushing out this to multiple users, but make sure you have a backup of the file)</em></li>
<li>Click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure VPN Connection" src="/assets/images/azurevpnclient-beforeconnection-9c72c647ae6b840531511a45307f43b5.png" title="Azure VPN Connection" width="1160" height="850" class="img_ev3q"></li>
<li>Click <strong>Connect</strong></li>
<li>Enter in your Microsoft Entra ID credentials <em>(you may be prompted for MFA, depending on the rules - you can use Azure VPN application under conditional access)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure VPN Connection" src="/assets/images/azurevpnclient-afterconnection-17f6b2c4077a7fa39392fc321fddb00c.png" title="Azure VPN Connection" width="1160" height="850" class="img_ev3q"></li>
<li><strong>You should now be connected to the Azure network through a point to site VPN!</strong></li>
<li>If I run &#x27;ipconfig /all&#x27; on my device, I can see a PPP adapter that is connected and on the VPN address range created earlier: 172.0.0.2</li>
<li><img decoding="async" loading="lazy" alt="Azure Point to Site Connections" src="/assets/images/azurevpn-ipconfig-2c8c0b092f836ec502ad15d41cc3cc31.png" title="Azure Point to Site Connections" width="564" height="227" class="img_ev3q"></li>
<li>If I navigate back to the Point-to-site connection in the Azure Portal, I can see, my connection has been allocated:</li>
<li><img decoding="async" loading="lazy" alt="Azure Point to Site Connections" src="/assets/images/azurevpn-p2sconnections-a5656eeefdd5297cec6ce9c2fef165d7.png" title="Azure Point to Site Connections" width="871" height="552" class="img_ev3q"></li>
<li>I can now use Remote Desktop to connect to a Virtual Machine, running in my AppServers Subnet, which I am running without the need of a Public IP or bastion/jump host:</li>
<li><img decoding="async" loading="lazy" alt="Azure Point to Site VPN" src="/assets/images/azurevpn-rdp-1e634ab96e9fa3a4173047be002a127a.png" title="Azure Point to Site VPN" width="1380" height="692" class="img_ev3q"></li>
</ol>
<p>Note: I don&#x27;t have a DNS service running in Azure, but the Azure VPN agent will take DNS from the Virtual Network if you have this configured to point towards a DNS server (Active Directory, or other DNS forwarder (pointing towards Azure DNS IP: 168.63.129.16) such as Azure Firewall DNS proxy; you can set Custom DNS servers by modifying your DNS configuration, or add entries into the host file of the computers.</p>
<p>You can set your Custom DNS settings (remember to add the DNS suffix if needed) and configure the VPN to automatically connect by following the details on the <a href="https://learn.microsoft.com/en-us/azure/vpn-gateway/openvpn-azure-ad-client#faq" target="_blank" rel="noopener noreferrer" title="Microsoft Entra ID authentication: Configure a VPN client for P2S OpenVPN protocol connections">OpenVPN Azure AD</a> Client page.</p>
<p>Using Intune, you can also push this configuration to your Windows 10 and 11 clients</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-profile-intune?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Create custom Intune profiles to deploy VPN client profiles</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2022/01/08/my-website/">My Website Setup</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-08T00:00:00.000Z">January 8, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Pretty simple article today regarding &#x27;My website setup&#x27;.</p>
<p>I&#x27;ve had a few people ask what CMS <em>(Content Management System)</em> my website runs on - and no it&#x27;s not running on an Azure App Service!</p>
<p>I am using:</p>
<ul>
<li>Github Pages (running Jekyll and Ruby on Rails)</li>
<li>Cloudflare as my DNS CDN (which also allows me to set HTTPS) and cache the website across the planet</li>
</ul>
<p>Because the pages are in a git repository, I have version control across my pages, can roll back or make any changes easily and allow others to submit pull requests for changes, or issues natively.</p>
<p>The pages are created using Markdown, I usually have a OneNote page with an idea or blurb, then Forestry to do the initial post, and then manually edit the files and verify the syntax is correct, add tables into the page and fix any issues that may have been caused (Forestry doesn&#x27;t support markdown tables and can make some content look a bit weird and unstructured, but its usually an easy fix editing the markdown manually).</p>
<p>Having it on Github pages, helped me learn a lot more about using git and source control, versioning methodologies.</p>
<p>Then for comments, I use Disqus and for analytics, Google Analytics and Bing Webmaster Tools.</p>
<ul>
<li><a href="https://www.markdownguide.org/getting-started/" target="_blank" rel="noopener noreferrer" title="https://www.markdownguide.org/getting-started/">Markdown</a></li>
<li><a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer" title="https://pages.github.com/">https://pages.github.com/</a></li>
<li><a href="https://whatcms.org/?s=luke.geek.nz" target="_blank" rel="noopener noreferrer" title="https://whatcms.org/?s=luke.geek.nz">What CMS is this site using?</a></li>
<li><a href="https://forestry.io/" target="_blank" rel="noopener noreferrer" title="https://forestry.io/">https://forestry.io/</a></li>
<li><a href="https://disqus.com/" target="_blank" rel="noopener noreferrer" title="https://disqus.com/">https://disqus.com/</a></li>
</ul>
<p>All in all - I just have to pay for the domain, everything else is free and because it&#x27;s stateless, caching content is a lot easier and I don&#x27;t have to worry about keeping a CMS up to date/patched or a database tuned!</p>
<p>If you&#x27;re wondering why it&#x27;s not running on an Azure App Service? I wanted something cheap, could further challenge and learn from, at the end of the day I wanted a stateless website (static websites in Storage account, wasn&#x27;t available when I set this up) and I wanted to reserve my limited Azure credits to be able to actually learn and play more. I have no regrets in putting it in Github Pages and depending on your requirements - recommend you try it out!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/misc/">Misc</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/page/30/"><div class="pagination-nav__label">Newer entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/page/32/"><div class="pagination-nav__label">Older entries</div></a></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
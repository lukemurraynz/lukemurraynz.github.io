<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/page/9/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz"><meta data-rh="true" name="description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" property="og:description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/page/9/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/9/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/9/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.4a383e58.css">
<script src="/assets/js/runtime~main.658085c0.js" defer="defer"></script>
<script src="/assets/js/main.09ce054a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Happy New Year! This is a redesign of my website, hopefully you like it!</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azure-email-communication-services/">Deploying and Testing Azure Email Communication Services</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/microsoft-copilot-azure-preview/">Microsoft Copilot for Azure - Preview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/Azure-DevTest-Subscription-Considerations/">Azure Dev/Test Subscription considerations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/Azure-Image-Builder-Build-Pipeline-with-Azure-DevOps/">Azure Image Builder Image Build with Bicep and Azure DevOps</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/misc/Book-Review-Azure-architecture-explained/">Book Review Azure Architecture Explained</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="An IP Group in Microsoft Azure is a logical container of IP address ranges for private and public addresses."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2023/01/02/create-azure-ip-groups-based-on-the-ip-address-ranges-of-countries/">Create Azure IP Groups based on the IP address ranges of countries</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-01-02T00:00:00.000Z" itemprop="datePublished">January 2, 2023</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Luke Murray</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>An <a href="https://learn.microsoft.com/azure/firewall/ip-groups?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="IP Groups in Azure Firewall">IP Group</a> in Microsoft Azure is a logical container of IP address ranges for private and public addresses.</p>
<blockquote>
<p>IP Groups allow you to group and manage IP addresses for Azure Firewall rules in the following ways:</p>
<ul>
<li>As a source address in DNAT rules</li>
<li>As a source or destination address in network rules</li>
<li>As a source address in application rules</li>
</ul>
<p>An IP Group can have a single IP address, multiple IP addresses, one or more IP address ranges or addresses and ranges in combination.</p>
</blockquote>
<p>The IP Group allows you to define an IP address that can be used in conjunction with Azure Firewall, to allow or deny internal or external traffic from a perspective set of IP addresses.</p>
<blockquote>
<p>The following IPv4 address format examples are valid to use in IP Groups:</p>
<ul>
<li>Single address: 10.0.0.0</li>
<li>CIDR notation: 10.1.0.0/32</li>
<li>Address range: 10.2.0.0-10.2.0.31</li>
</ul>
</blockquote>
<p>By default, the Azure Firewall blocks outbound and inbound traffic; however, you may want to enable <em>(or block)</em> traffic to and from specific countries - there is no built-in geo-filtering with Azure Firewall, as you can use other services, such as the Web Application Gateway and with the <a href="https://learn.microsoft.com/azure/application-gateway/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="What is Azure Application Gateway?">Application Gateway</a> and <a href="https://learn.microsoft.com/azure/web-application-firewall/afds/waf-front-door-geo-filtering?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="What is geo-filtering on a domain for Azure Front Door Service?">Azure Front Door</a> to block and allow access, and other third party services such as Cloudflare. This script can be adapted for any list of IP ranges; it doesn&#x27;t need to be country IP addresses.</p>
<p>However, you may want to control access to and from specific countries <em>(or other services)</em> with Azure Firewall - this is where the IP Groups can be effective, and because we won&#x27;t be editing the Firewall directly - we won&#x27;t run into issues with delays without having to wait for the Azure Firewall policies to be updated.</p>
<p>To solve the issue of creating the IP groups and finding and keeping the IP groups up-to-date with various countries&#x27; IP ranges - I have created a PowerShell function to retrieve supported <a href="https://www.ipdeny.com/ipblocks/data/aggregated/" target="_blank" rel="noopener noreferrer" title="IP Deny aggregated list">countries</a>&#x27; IP CIDR ranges and create the relevant IP groups.</p>
<p><img loading="lazy" alt="Azure IP Group - Country IP ranges" src="/assets/images/azureipgroupscript-721e9086bd746513f1e421a89e749679.png" title="Azure IP Group - Country IP ranges" width="4000" height="2250" class="img_ev3q"></p>
<p>With IP Groups, there are a few things to keep in mind:</p>
<ul>
<li>You can have 200 IP Groups per firewall with a maximum of <strong>5000 individual IP addresses or prefixes per each IP Group</strong>.</li>
</ul>
<p>For a country like New Zealand, the 5000 limit for the address ranges is acceptable - but for other countries, like the United States or United Kingdom, this can be an issue, where the total IP ranges can grow to over 20k - to deal with this, the script will create multiple IP Groups, and append a number to the end.</p>
<p>Suppose IPs are manually added to the groups. In that case, they won&#x27;t be added - the script will add in any different or new IP ranges, ignoring any current IP ranges (<em>this means it won&#x27;t delete any IP ranges that are removed from the source IP list from IPDeny)</em>; however, I recommend that anything added outside of this script is kept in a separate IP group.</p>
<p><em>As with any script, I recommend this is tested in a test environment first.</em></p>
<p>Before we run it, we need a few prerequisites.</p>
<ul>
<li>At least <a href="https://learn.microsoft.com/powershell/scripting/install/installing-powershell?view=powershell-7.3&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Install PowerShell on Windows, Linux, and macOS">PowerShell 3.0+</a></li>
<li>Azure <a href="https://learn.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-9.2.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Introducing the Azure Az PowerShell module">Az PowerShell Modules</a><em>(specifically Az.Network, Az.Resources)</em></li>
</ul>
<p>The function assumes you have <a href="https://luke.geek.nz/azure/powershell/Using-PowerShell-to-connect-to-Azure/" target="_blank" rel="noopener noreferrer" title="Using PowerShell to connect to Microsoft Azure">connected to Microsoft Azure and your relevant subscription</a>.</p>
<p>Before we import the function, I am going to check if any IP groups already exist quickly <em>(this isn&#x27;t required) -</em> but it&#x27;s a good opportunity to check that you are connected to your Azure subscription and that the AzIPGroup cmdlets exist -  and whether you have any IP groups already existing.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-AzIpGroup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="Get-AzIpGroup" src="/assets/images/checkexistingipgroups_empty-e5de11bd4a5063cc4f5e4819d81e9a74.gif" title="Get-AzIpGroup" width="996" height="466" class="img_ev3q"></p>
<p>I have received no errors or existing IP groups in my subscription, so I will continue importing my function.</p>
<p>The function can be found here:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">New-AzCountryIPGroup.p1</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzCountryIPGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.SYNOPSIS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">Creates an Azure IP group, with the IP address ranges for various countrues.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">The code does the following:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">1. It downloads the IP address ranges for the country specified.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">2. It checks if the IP Group already exists, if it does, it adds the IP addresses to the existing IP Group.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">3. If the total number of IP addresses is less than 5000, it will add the IP addresses to the existing IP Group.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">4. If the total number of IP addresses is over 5000, it will create a new IP Group, with the same name as the existing IP Group, and it will add the IP addresses to the new IP Group.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">5. If the new IP Group is over 5000, it will create a new IP Group, with the same name as the existing IP Group, and it will add the IP addresses to the new IP Group.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">6. It will continue to create new IP Groups until all of the IP addresses are added.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">The code can be used to create IP Groups for multiple countries, and if the number of IP addresses is over 5000, it will create multiple IP Groups, with the same name, but with a counter after the name, so that it will be unique.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.EXAMPLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">New-AzCountryIPGroup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">New-AzCountryIPGroup -CountryCode NZ -IPGroupName IP -IPGroupRGName NetworkRG -IPGroupLocation AustraliaEast</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.AUTHOR</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">Luke Murray - https://luke.geek.nz/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    #&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[CmdletBinding()]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Parameter(Mandatory = $true, Position = 0)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[System.String]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Parameter(Mandatory = $true, Position = 1)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Object]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Parameter(Mandatory = $true, Position = 2)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[System.String]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Parameter(Mandatory = $true, Position = 3)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[System.String]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPBlocks</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Invoke-WebRequest</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Uri </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;https://www.ipdeny.com/ipblocks/data/aggregated/{0}-aggregated.zone&#x27;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">f </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ToLower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#Exports the IPBlock content from the HTML request, into a String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPBlock</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPBlocks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Content </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#Spilts each IP block, into a seperate object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPBlock</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\s+&#x27;</span><span class="token plain"> </span><span class="token operator">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\r?\n\r?&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Length </span><span class="token operator">-lt</span><span class="token plain"> 5000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">If</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Group doesn&#x27;t exist, creating a new IP Group called </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)"> in the following Azure Resource Group </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token string" style="color:rgb(255, 121, 198)"> and location </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">Country = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">If</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">Country = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">Country = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">IpAddresses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Adding </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token string" style="color:rgb(255, 121, 198)"> to </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)">.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzIPGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Group already exists called:</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)"> in the following Azure Resource Group </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token string" style="color:rgb(255, 121, 198)"> and location </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token string" style="color:rgb(255, 121, 198)">. Adding IPs to the group... Please note that this script doesn&#x27;t check already existing IP addresses, if identical IP addresses exist, it will overrite it, if IP addresses outside of the Country List exist, it will remain in the IP Group - but there is no checking, if there is pre-equisting IP addresses in the IP Group that will raise the Group Limit above 5000. I recommend keeping the Country IP group seperate.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">IpAddresses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Adding </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token string" style="color:rgb(255, 121, 198)"> to </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzIPGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Azure IP Groups only support IPAddresses of up-to 5000 (the country you have specified is: &quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Length</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;), also please make sure the country code matches https://www.ipdeny.com/ipblocks/data/aggregated/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token plain"> = </span><span class="token namespace">[pscustomobject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> Value = 0 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$groupSize</span><span class="token plain"> = 5000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$groups</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Group-Object</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Property </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token namespace">[math]</span><span class="token plain">::Floor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Value+</span><span class="token operator">+</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$groupSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token plain"> = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$group</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$groups</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">If</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token string" style="color:rgb(255, 121, 198)"> doesn&#x27;t exist. Creating... </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token string" style="color:rgb(255, 121, 198)"> in the following Resource Group </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token string" style="color:rgb(255, 121, 198)"> and location </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token string" style="color:rgb(255, 121, 198)">.&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">Country = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose </span><span class="token operator">-</span><span class="token plain">Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipgroup</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IP</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">IpAddresses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Adding </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token string" style="color:rgb(255, 121, 198)"> to </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzIPGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipgroup</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IP</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">IpAddresses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Adding </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token string" style="color:rgb(255, 121, 198)"> to </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzIPGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Note: Make sure your country matches the supported country shortcodes found here:</strong> <a href="https://www.ipdeny.com/ipblocks/data/aggregated/" target="_blank" rel="noopener noreferrer" title="Index of /ipblocks/data/aggregated/"><strong>IPBlock Aggregated</strong></a><strong>. IPDeny is the source for the IP address list.</strong></p>
<p>Once saved to your computer, it&#x27;s time to import it into your active PowerShell terminal and run it <em>(after you have verified you have connected to the correct Azure subscription)</em>.</p>
<p>So I will navigate to the script and import it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd D:\git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">. .\New-AzCountryIPGroup.ps1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzCountryIPGroup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="Import New-AzCountryIPGroup.ps1" src="/assets/images/import_countryipgrpfunction-696bc2348102c3247c9d087e27e45ba0.gif" title="Import New-AzCountryIPGroup.ps1" width="996" height="466" class="img_ev3q"></p>
<p>The &#x27;New-AzCountryIPGroup&#x27; Azure function relies on 4 parameters:</p>

























<table><thead><tr><th>Parameters</th><th>Values</th></tr></thead><tbody><tr><td>CountryCode</td><td>NZ</td></tr><tr><td>IPGroupName</td><td>IPGrpNZ</td></tr><tr><td>IPGroupRGName</td><td>NetworkRG</td></tr><tr><td>IPGroupLocation</td><td>AustraliaEast</td></tr></tbody></table>
<p>Make sure that the values change to your environment; in my example, I am specifying an IP Group and Resource Group that doesn&#x27;t exist so that the script will create it for me - and the location I will be deploying to will be the Australia East region.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzCountryIPGroup -CountryCode NZ -IPGroupName IPGrpNZ -IPGroupRGName NetworkRG -IPGroupLocation AustraliaEast</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="New-AzCountryIPGroup" src="/assets/images/run_countryipgrpfunctionnz-09be99efe4949ca31baac8d37dac4d6f.gif" title="New-AzCountryIPGroup" width="996" height="466" class="img_ev3q"></p>
<p>As you can see, the script created an Azure Resource Group and imported the New Zealand IP ranges to a new IP Group...</p>
<p>Not required - but if I rerun it, it will simply override any IP addresses that are the same and add any new addresses to the same IP Group that already exists, as below:</p>
<p><img loading="lazy" alt="Rerun New-AzCountryIPGroup" src="/assets/images/rerun_countryipgrpfunctionnz-1c5f53e13bef98c2865c57107f76918e.gif" title="Rerun New-AzCountryIPGroup" width="996" height="466" class="img_ev3q"></p>
<p>The Azure IP Group is visible in the Azure Portal as below:</p>
<p><img loading="lazy" alt="Azure Portal - Azure IP Group " src="/assets/images/azureportal_ipgrpnz-077757e739b3adc55761e2d499b3defb.png" title="Azure Portal - Azure IP Group " width="1660" height="766" class="img_ev3q"></p>
<p>And a Tag was added to include the country:</p>
<p><img loading="lazy" alt="Azure IP Group - Tag" src="/assets/images/azureportal_ipgrpnztag-9c6ec05a965b9d151fdad26326748305.png" title="Azure IP Group - Tag" width="1682" height="310" class="img_ev3q"></p>
<p>As New Zealand was under the 5000 limit, only one IP Group was needed, but if we change the Country Code to the US...</p>
<p><img loading="lazy" alt="Run New-AzCountryIPGroup - US" src="/assets/images/run_countryipgrpfunctionus-5ea57e5b4664923ffabc2c62e26058eb.gif" title="Run New-AzCountryIPGroup - US" width="996" height="469" class="img_ev3q"></p>
<p>It created 5 IP groups, each containing 5000 CIDR IP ranges, with the last containing the remaining IP address ranges.</p>
<p>As you can see, it&#x27;s reasonably easy to create IP Groups containing a list of IP ranges for multiple countries quickly:</p>
<p><img loading="lazy" alt="Azure Portal - Azure IP Groups" src="/assets/images/azureportal_ipgrps-e3190807a83060430e7663c1536f7b9d.png" title="Azure Portal - Azure IP Groups" width="1070" height="434" class="img_ev3q"></p>
<p>Note: The script can also be found in my Public Git Repo <a href="https://github.com/lukemurraynz/Azure" target="_blank" rel="noopener noreferrer">here</a>, feel free to recommend pull requests if you have anything to add or change.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Festive Tech Calender - Microsoft Dev Box"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2022/12/11/microsoft-devbox-wrapped-in-a-bow/">Microsoft Dev Box wrapped in a bow</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-11T00:00:00.000Z" itemprop="datePublished">December 11, 2022</time> · <!-- -->17 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Luke Murray</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><strong><img loading="lazy" alt="Festive Tech Calender - Microsoft Dev Box" src="/assets/images/festivetechcalendar2022-c7b5088791477c7de8e17d5b01211927.png" title="Festive Tech Calender - Microsoft Dev Box" width="1280" height="720" class="img_ev3q"></strong></p>
<p>It&#x27;s that time of year again! The time to be jolly and experience the Month of December by looking at the <a href="https://festivetechcalendar.com/" target="_blank" rel="noopener noreferrer" title="Festive Tech Calender">Festive Tech Calendar</a>!</p>
<blockquote>
<p>This year the Festive Tech Calendar Team is <strong>raising money</strong> for the charity <a href="https://www.missingpeople.org.uk/" target="_blank" rel="noopener noreferrer">@missingpeople</a>.</p>
<p>We believe its important to support charities that do great work. Without fundraising Missing People wouldn’t be able to find vulnerable missing people and reunite families.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="if-you-would-like-to-donate-please-visit-our-just-giving-page">If you would like to donate please visit our <a href="https://www.justgiving.com/fundraising/festivetechcalendar2022" target="_blank" rel="noopener noreferrer">Just Giving Page</a><a href="#if-you-would-like-to-donate-please-visit-our-just-giving-page" class="hash-link" aria-label="Direct link to if-you-would-like-to-donate-please-visit-our-just-giving-page" title="Direct link to if-you-would-like-to-donate-please-visit-our-just-giving-page">​</a></h4>
</blockquote>
<p>Today, we sent our present and took a peek inside the box - at Microsoft Dev Box!</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h4>
<p><a href="https://azure.microsoft.com/products/dev-box/?WT.mc_id=AZ-MVP-5004796#overview" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box">Microsoft Dev Box</a> provides self-service access for developers to high-performance, cloud-based workstations preconfigured and ready-to-code for specific projects - all while maintaining security and corporate governance. With Microsoft Dev Box, organizations can:</p>
<ul>
<li>Maximize dev productivity with ready-to-code, self-service Dev Boxes.</li>
<li>Central management of workstations running anywhere to maintain greater security, compliance, and cost efficiency.</li>
<li>Customize dev boxes with everything developers need for their current projects.</li>
</ul>
<p>Microsoft Dev Box supports any developer IDE, SDK, or tool that runs on Windows. Developers can target any development workload built from Windows, including desktop, mobile, IoT, and web applications. Microsoft Dev Box even supports building cross-platform apps thanks to Windows Subsystem for Linux and Windows Subsystem for Android. Remote access allows developers to securely access dev boxes from any device, whether it&#x27;s Windows, macOS, Android, iOS, or a web browser.</p>
<p><img loading="lazy" alt="High-level Azure Devbox workflow" src="/assets/images/hl-devbox_workflow-7b0f581b91b284611b490af27fbf465a.png" title="High-level Devbox workflow" width="975" height="410" class="img_ev3q"></p>
<p><a href="https://learn.microsoft.com/azure/dev-box/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box documentation">Microsoft Dev Box</a> is a managed service that enables developers to create on-demand, high-performance, secure, ready-to-code, project-specific workstations in the cloud.</p>
<p>Microsoft Dev Box is available today as a <a href="https://azure.microsoft.com/en-us/updates/public-preview-microsoft-dev-box/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Public preview: Microsoft Dev Box">preview</a> from the Azure Portal. During this period, organizations get the first 15 hours of the dev box 8vCPU and 32 GB Memory SKU for free every month, along with the first 365 hours of the dev box Storage SSD 512 GB SKU.</p>
<p>Beyond that, organizations pay only for what they use with a consumption-based pricing model. With this model, organizations are charged per hour depending on the number of Compute and Storage consumed.</p>
<p>To use Microsoft Dev Box, each user must be licensed for Windows 11 or 10 Enterprise, Microsoft Endpoint Manager, and Microsoft Entra ID P1. These licenses are included in M365 F3, E3, E5, A3, A5, Microsoft Business Premium and Microsoft 365 Education benefit plans.</p>
<p><img loading="lazy" alt="Microsoft Dev Box" src="/assets/images/microsoft_devbox_selfservicedevelopment-818a670b16eaa2e1de702e7c7fae391c.png" title="Microsoft Dev Box" width="4079" height="2296" class="img_ev3q"></p>
<blockquote>
<p><em>Disclaimer: At the time of writing, this service is still in Public Preview, some services and license requirements may change by the time this becomes generally avaliable.</em></p>
</blockquote>
<p>So, where does Microsoft Dev Box fit in?</p>
<p>Microsoft offers a plethora of services, from <a href="https://azure.microsoft.com/products/virtual-desktop/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Virtual Desktop">Azure Virtual Desktop</a>, <a href="https://www.microsoft.com/en-us/windows-365?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Windows 365 Cloud PC">Windows 365</a>, and now <a href="https://azure.microsoft.com/products/dev-box/?WT.mc_id=AZ-MVP-5004796#overview" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box">Microsoft Dev Box</a> - where would you use Microsoft Dev Box over another service, such as Windows 365?</p>
<p>General scenarios at a high level are:</p>





















<table><thead><tr><th>Scenario</th><th>Product</th></tr></thead><tbody><tr><td>Production multi-session, supporting Windows Server and Client OS, Published Aps</td><td>Azure Virtual Desktop</td></tr><tr><td>Production dedicated personal PCs, for shift/party time users - or small environments</td><td>Windows 365</td></tr><tr><td>Dev/Test Ondemand Windows machines for Testing and development with custom image support</td><td>Azure Dev Box</td></tr></tbody></table>
<p><img loading="lazy" alt="Microsot Windows Experiances Strategy" src="/assets/images/ms_microsoftwindowsexperiances_strategy-55edb6f4e0e6b6def8045cc7c677aafd.png" title="Microsoft Windows Experiances Strategy" width="1173" height="619" class="img_ev3q"></p>
<p>Microsoft Dev box can help project and development teams get up and running quickly, independent of what hardware a developer or contractor has, whether they prefer Mac, Windows, or Linux - the Microsoft Dev box can be used to get developers and contractors up and running in a secure environment that supports Intune!</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="concepts--roles">Concepts &amp; Roles<a href="#concepts--roles" class="hash-link" aria-label="Direct link to Concepts &amp; Roles" title="Direct link to Concepts &amp; Roles">​</a></h5>

































<table><thead><tr><th>Concepts</th><th>Notes</th></tr></thead><tbody><tr><td>Dev center</td><td>A dev center is a collection of projects that require similar settings. Dev centers enable dev infrastructure managers to manage the images and SKUs available to the projects using dev box definitions and configure the networks the development teams consume using network connections.</td></tr><tr><td>Projects</td><td>A project is the point of access for the development team members. When you associate a project with a dev center, all the settings at the dev center level will be applied to the project automatically. Each project can be associated with only one dev center.</td></tr><tr><td>Dev box definition</td><td>A dev box definition specifies a source image and size, including compute size and storage size. You can use a source image from the marketplace, or a custom image.</td></tr><tr><td>Network connection</td><td>Network connections store configuration information like Active Directory join type and virtual network that dev boxes use to connect to network resources.</td></tr><tr><td>Dev box pool</td><td>A dev box pool is a collection of dev boxes that you manage together and to which you apply similar settings.</td></tr><tr><td>Dev box</td><td>A dev box is a preconfigured ready-to-code workstation that you create through the self-service developer portal. The new dev box has all the tools, binaries, and configuration required for a dev box user to be productive immediately</td></tr></tbody></table>
<p><img loading="lazy" alt="DevBoxHierarchy" src="/assets/images/festivetechcalendar2022_devboxhierarchy-76e4241019761ac00639a8eeda293c29.png" title="DevBoxHierarchy" width="4000" height="2250" class="img_ev3q"></p>
<p>The following are typical Azure Dev Box roles.</p>

























<table><thead><tr><th>Role</th><th>Responsibilities</th><th>Permissions</th></tr></thead><tbody><tr><td>Dev Infra Admins</td><td>Providing developer infrastructure and tools to the development teas</td><td>Can create and manage dev centers, can create projects and define images that are used to create the dev boxes</td></tr><tr><td>Project Admins</td><td>Does administrative tasks for the Dev Box solution and assist with day to day tasks.</td><td>Can create and manage dev box pools across different regions</td></tr><tr><td>Dev Box Users</td><td>Members of your development teams</td><td>Can self-service and create one or more dev boxes, depending on the projects assigned.</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-dev-center">Create Dev Center<a href="#create-dev-center" class="hash-link" aria-label="Direct link to Create Dev Center" title="Direct link to Create Dev Center">​</a></h5>
<p>First, we need to create our <a href="https://learn.microsoft.com/azure/dev-box/concept-dev-box-concepts?WT.mc_id=AZ-MVP-5004796#dev-center" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box Preview key concepts">Dev Center</a>. A Dev Center allows us to centrally manage our developer environments and enable development teams with self-service capability. Dev Center is used by more than just Microsoft DevBox - an example is <a href="https://azure.microsoft.com/products/deployment-environments/?WT.mc_id=AZ-MVP-5004796#overview" target="_blank" rel="noopener noreferrer" title="Azure Deployment Environments">Azure Deployment Environments</a> - which allows devs to spin up templated <em>(ARM)</em> application infrastructure quickly - but we will focus on components of Dev Center - used by Microsoft Dev Box.</p>
<blockquote>
<p>Please confirm what <a href="https://azure.microsoft.com/products/dev-box/?WT.mc_id=AZ-MVP-5004796#faq" target="_blank" rel="noopener noreferrer" title="Frequently asked questions about Microsoft Dev Box">region</a> you can deploy Dev Box. As this is in Public Preview at the time of writing - only certain regions are supported.</p>
</blockquote>
<p>Let&#x27;s create a standard Dev Box environment in your favourite browser, starting with the Dev Center...</p>
<ol>
<li>Log in to the Microsoft <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click <strong>+ Create a resource</strong></li>
<li>Search for: Dev center, select your Dev center and click <strong>Create</strong></li>
<li><img loading="lazy" alt="Microsoft Azure Portal - Dev center" src="/assets/images/azuredevbox-createdevcentermarketplace-1b3fda7545855164233aeabea8591240.png" title="Microsoft Azure Portal - Dev center" width="1067" height="439" class="img_ev3q"></li>
<li>Select the <strong>Subscription</strong> and <strong>ResourceGroup</strong> you want to deploy your Dev Center; you can use this opportunity to create a new Resource Group.</li>
<li>Type in the <strong>name__ of your</strong> DevCenter **<em>(in my example, it is named DevCenter-Devs)</em></li>
<li>Then select the <strong>location</strong> <em>(region)</em> in which you want to deploy your DevCenter.</li>
<li><img loading="lazy" alt="Azure Portal - Create a dev center" src="/assets/images/azuredevbox-createdevcenterbasicspage-a91d35ee6c82998b09414a02cd02caff.png" title="Azure Portal - Create a dev center" width="780" height="474" class="img_ev3q"></li>
<li>Click <strong>Review + Create,</strong> then <strong>Create</strong></li>
</ol>
<p><em>Deployment of the Microsoft Dev Center will take a few minutes.</em></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-virtual-network">Create Virtual Network<a href="#create-virtual-network" class="hash-link" aria-label="Direct link to Create Virtual Network" title="Direct link to Create Virtual Network">​</a></h5>
<p>To use Microsoft Dev Boxes - like any Virtual Machine in Azure, you need a Virtual Network! The Dev Boxes can connect to existing Virtual Networks, which could be peered with other VNETs, have connectivity to on-premises - or have standalone secure connectivity through network links! In my demo, I don&#x27;t currently have a Virtual Network - so I will create a Virtual Network from scratch.</p>
<ol>
<li>Log in to the Microsoft <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click <strong>+ Create a resource</strong></li>
<li>Search for: <strong>Virtual Network</strong></li>
<li><strong>Create</strong> a <strong>Virtual Network</strong></li>
<li><strong>Select</strong> your Virtual Network <strong>name</strong> and <strong>region</strong> <em>(make sure the region aligns with your workloads and Azure DevCenter location)</em></li>
<li><img loading="lazy" alt="Azure Portal - Create VNET" src="/assets/images/azuredevbox-createvnetbasicspage-9d034703586145a7ec60e4e598559f28.png" title="Azure Portal - Create VNET" width="785" height="469" class="img_ev3q"></li>
<li>Click <strong>Next: IP Addresses</strong></li>
<li>I will leave the IP address space the default of 10.1.0.0/16 - but change the default subnet name to devbox-subnet.</li>
<li><img loading="lazy" alt="Azure Portal - Create VNET" src="/assets/images/azuredevbox-createvnetipaddressespage-10a749d801307b089630098e72fa834c.png" title="Azure Portal - Create VNET" width="1678" height="621" class="img_ev3q"></li>
<li>Click <strong>Review + create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-virtual-network-connection-and-link-to-dev-center">Create a Virtual Network Connection and link to Dev Center<a href="#create-a-virtual-network-connection-and-link-to-dev-center" class="hash-link" aria-label="Direct link to Create a Virtual Network Connection and link to Dev Center" title="Direct link to Create a Virtual Network Connection and link to Dev Center">​</a></h5>
<p>Now that we have our Dev Center and our Virtual Network - it&#x27;s time to make a Network connection - this connection will be used by Dev Center - to allow our Dev Boxes to connect to the Virtual Network - and to select your Virtual Machine identification <em>(i.e. Microsoft Entra ID, or Hybrid Microsoft Entra ID)</em>.</p>
<ol>
<li>Log in to the Microsoft <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click <strong>+ Create a resource.</strong></li>
<li>Type in: <strong>Network Connection,</strong> find and click <strong>Create</strong></li>
<li><img loading="lazy" alt="Create Network Connection " src="/assets/images/azuredevbox-createnetworkconnectionmarketplace-e6503ff5d4dda9e8945cf49ea802f137.png" title="Create Network Connection " width="1050" height="445" class="img_ev3q"></li>
<li>As I will be using Microsoft Entra ID joined Virtual Machines, I will ensure that the Domain join type is: <strong>Microsoft Entra ID join</strong>.</li>
<li>For the <strong>Network connection name</strong>, I will select: ProductionVNETAADJConnection</li>
<li>I will select my Virtual Network and subnet, which the Dev Box will be placed into.</li>
<li><img loading="lazy" alt="Create Azure Network Connection " src="/assets/images/azuredevbox-createnetworkconnectionbasicspage-87ae994580a5d0fdd973e61896d29a1b.png" title="Create Azure Network Connection " width="778" height="586" class="img_ev3q"></li>
<li>Click <strong>Review + Create,</strong> and click <strong>Create</strong></li>
<li>Now that we have created the Network connection - it is time to link it to our Dev Center - so it can be used.</li>
<li><strong>Navigate</strong> to your <strong>Dev Center</strong></li>
<li>Under Dev Box configuration, select <strong>Networking</strong></li>
<li>Click <strong>+ Add</strong></li>
<li><strong>Select</strong> your Network <strong>connection</strong> that has just been created</li>
<li><img loading="lazy" alt="Azure Dev Center - Link Network Connection" src="/assets/images/azuredevbox-createnetworkconnectionlinkdevcenter-78b6f49205be9ab121f476ee38851132.png" title="Azure Dev Center - Link Network Connection" width="1689" height="471" class="img_ev3q"></li>
<li>Click <strong>Add</strong></li>
<li>The Network Connection will check all the network requirements for the Dev Box service, such as the Azure tenant and Intune configuration <em>(i.e. is there a restriction in Endpoint Management for Windows).</em></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-dev-box-definitions">Create Dev box definitions<a href="#create-dev-box-definitions" class="hash-link" aria-label="Direct link to Create Dev box definitions" title="Direct link to Create Dev box definitions">​</a></h5>
<p>It&#x27;s time to create our Dev box definition. The Dev box definition is the type of Virtual Machines -or Dev Boxes that are standard for your environment. A dev box definition will be used to define the image <em>(whether a</em> <a href="https://luke.geek.nz/azure/capturing-virtual-machine-images-and-snapshots-in-azure-using-wvdadmin/" target="_blank" rel="noopener noreferrer" title="Capturing Virtual Machine images and Snapshots in Azure using WVDAdmin"><em>custom</em></a> <em>or marketplace image),</em> SKU of virtual machines <em>(Compute + Memory)</em>, and available storage. Note that if you want to use a Custom Image - you will need an <a href="https://learn.microsoft.com/azure/virtual-machines/azure-compute-gallery?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Store and share resources in an Azure Compute Gallery">Azure Compute gallery</a>, and if you decide to go down this route, make sure you check out <a href="https://learn.microsoft.com/azure/virtual-machines/image-builder-overview?tabs=azure-powershell&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure VM Image Builder overview">Azure VM Image Builder</a> to help automate and build your images. You can have multiple definitions per project.</p>
<ol>
<li>Log in to the Microsoft <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Navigate to your <strong>Dev center</strong></li>
<li>Navigate to <strong>Dev box definitions</strong></li>
<li>Click <strong>+ Create</strong></li>
<li>For our <strong>Image definition name</strong>, I will go with Win11-VS</li>
<li>For Images, there are a plethora of images available! For this guide, I will use Visual Studio 2019 Enterprise on Windows 11 Enterprise + Microsoft 365 Apps 22H2 image.</li>
<li><img loading="lazy" alt="Azure Dev Box definitions" src="/assets/images/azuredevbox-createpdevboxdefinitionsimages-ba42ac5b590f46f2525be11405ac450b.png" title="Azure Dev Box definitions" width="1524" height="679" class="img_ev3q"></li>
<li>I will select the Latest image version and specify <strong>4vCPU, 16GB of RAM</strong>, and a <strong>256 GB</strong> SSD drive.</li>
<li><img loading="lazy" alt="Azure Dev Box definitions" src="/assets/images/azuredevbox-createpdevboxdefinitions-23a054c28eed58d096ec2a3bb2649f14.png" title="Azure Dev Box definitions" width="616" height="465" class="img_ev3q"></li>
<li>Click <strong>Create</strong></li>
</ol>
<p>You can edit a Dev box definition, change the image, Compute, and storage after it has been created; this could be useful if there are issues with the latest version of the image, you can roll back the version - so people can make their Dev Boxes while the image is worked on.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-and-assign-project">Create and assign Project<a href="#create-and-assign-project" class="hash-link" aria-label="Direct link to Create and assign Project" title="Direct link to Create and assign Project">​</a></h5>
<p>Now that we have our Dev Center and Virtual Network connection - it is time to create a Project. A Project is intended to be task specific - an example being the following user story <em>&quot;As a developer working on a mobile game, I need access to a Windows 11 Development workstation with Visual Studio installed&quot;</em> - so all users working on that mobile game - will get an identical virtual machine setup with all the pre-requisites that the need to start development, a project team working on another mobile game, may need different software or dependencies - so will be part of another project.</p>
<ol>
<li>Log in to the Microsoft <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Navigate to your <strong>Dev center</strong></li>
<li>Navigate to <strong>Projects</strong></li>
<li>Select <strong>+ Create</strong></li>
<li>Select your <strong>Resource Group</strong></li>
<li>Select your <strong>Dev center</strong></li>
<li>Please type in the name of our <strong>Project</strong> and enter a <strong>description.</strong></li>
<li><img loading="lazy" alt="Azure DevBox - Create Project" src="/assets/images/azuredevbox-createprojectbasics-0ea92e0813b121ce1ff15c99fea4788c.png" width="771" height="512" class="img_ev3q"></li>
<li>You can use Tags to add additional information on billing for the project or the project administrator&#x27;s contact details - but we will select <strong>Review + create</strong> and <strong>Create</strong></li>
<li>Once the Project has been created, we need to assign assignees to use the project. I will give a DevBox User role to the project so I can make a Dev Box.</li>
<li>Within the Project, click on the <strong>Access Control (IAM)</strong></li>
<li>Click <strong>+ Add</strong></li>
<li>Select <strong>Add Role assignment</strong></li>
<li>Select <strong>DevCenter Dev Box User</strong></li>
<li>Click <strong>Next</strong></li>
<li>Make sure User, Group, or Service principal is selected and click <strong>+ Select Members.</strong></li>
<li>Ideally, you would assign the Dev Box User role to an Azure AD group - but in my demo, I will select an individual user.</li>
<li>Click <strong>Next</strong></li>
<li><img loading="lazy" alt="Azure Dev Box - Assign Project Members" src="/assets/images/azuredevbox-assignprojectmembers-149ab3c45fa80c9a106363aa7f27f74c.png" title="Azure Dev Box - Assign Project Members" width="1199" height="426" class="img_ev3q"></li>
<li>Once you have confirmed your users have been assigned, click on <strong>Review + assign</strong> to give your users or groups to the project, allowing them to create Dev Boxes.</li>
</ol>
<p><em>Note: I have found it can take 5-10 minutes for access to be granted to the users before they can create Dev Boxes.</em></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-dev-box-pool">Create Dev Box Pool<a href="#create-dev-box-pool" class="hash-link" aria-label="Direct link to Create Dev Box Pool" title="Direct link to Create Dev Box Pool">​</a></h5>
<p>Now that we have our project and dev box definitions - it&#x27;s time to create our Dev Box Pool - which is what the Dev Boxes will be made from.</p>
<ol>
<li>Log in to the Microsoft <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Navigate to your <strong>Dev center</strong></li>
<li>Navigate to <strong>Projects</strong></li>
<li><strong>Navigate</strong> to <strong>the project</strong> you created earlier <em>(i.e. for me, its MobileGameDevelopment)</em></li>
<li>Click on the <strong>Dev box pools</strong></li>
<li>Click on <strong>+ Create</strong></li>
<li><img loading="lazy" alt="Azure Dev Box - Create Dev Box Pools" src="/assets/images/azuredevbox-createdevboxpools-019cad9ad0d64b531fbcfbb7019793a5.png" title="Azure Dev Box - Create Dev Box Pools" width="1479" height="553" class="img_ev3q"></li>
<li>Type in a <strong>name</strong> - <em>i.e. MobleDevelopmentWin11</em></li>
<li><strong>Select</strong> your <strong>Network connection</strong></li>
<li>Select your <strong>definition</strong></li>
<li>Select your Creator <strong>privileges</strong> <em>(i.e. select whether your user will be a standard user or have Local administrator rights on their devbox)</em></li>
<li>Configure Auto-stop or skip and confirm <a href="https://learn.microsoft.com/azure/virtual-machines/windows/windows-desktop-multitenant-hosting-deployment?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="How to deploy Windows 11 on Azure">licensing</a>.</li>
<li>Click <strong>Create</strong></li>
</ol>
<p>After 1-2 minutes, your Dev Box pool has been created.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create--connect">Create &amp; Connect<a href="#create--connect" class="hash-link" aria-label="Direct link to Create &amp; Connect" title="Direct link to Create &amp; Connect">​</a></h4>
<p>Now that your Dev Center, Network, and Dev Box project has been stood up - it&#x27;s time to Create and connect to your new Dev box! Microsoft Dev Box - offers a few ways to connect to the DevBox; we will go through a few options now.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-dev-box">Create Dev Box<a href="#create-dev-box" class="hash-link" aria-label="Direct link to Create Dev Box" title="Direct link to Create Dev Box">​</a></h5>
<p>Now it&#x27;s time to create our Dev Box! To do this, we need to go to the Dev box Developer portal <em>(as a Dev Center Devbox, User)</em></p>
<ol>
<li>Navigate to the <a href="https://devbox.microsoft.com/" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box"><strong>Microsoft Dev Box portal</strong></a></li>
<li>Click on <strong>+ New Dev Box</strong></li>
<li>Enter your <strong>name</strong> of the DevBox <em>(i.e. what you will name the Virtual Machine and see in the portal - make sure this is meaningful - as you may have more than one Dev Box)</em></li>
<li><strong>Select</strong> your assigned <strong>Dev Box Pool,</strong> and select your <strong>Dev Box definition</strong></li>
<li><img loading="lazy" alt="Microsoft Dev Box - Create Virtual Machine" src="/assets/images/azuredevbox-createdevbox-01414803a346135b126a709b8e1f9c3d.png" title="Microsoft Dev Box - Create Virtual Machine" width="439" height="452" class="img_ev3q"></li>
<li>Click <strong>Create</strong></li>
<li><img loading="lazy" alt="DevBox - Creating " src="/assets/images/devboxcreating-2023de28cb0e08ba8a2b6767d69ad514.gif" title="DevBox - Creating " width="289" height="455" class="img_ev3q"></li>
</ol>
<p><em>Note: Dev box creation can take 30-90 minutes. <strong>Dev boxes will automatically start upon creation.</strong></em></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="connect-dev-box-using-microsoft-dev-box-portal">Connect Dev Box using Microsoft Dev Box Portal<a href="#connect-dev-box-using-microsoft-dev-box-portal" class="hash-link" aria-label="Direct link to Connect Dev Box using Microsoft Dev Box Portal" title="Direct link to Connect Dev Box using Microsoft Dev Box Portal">​</a></h5>
<ol>
<li>Navigate to the <a href="https://devbox.microsoft.com/" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box"><strong>Microsoft Dev Box portal</strong></a></li>
<li><strong>Click</strong> on the Dev <strong>Box</strong> you want to connect to.</li>
<li>Select <strong>Open in the browser</strong></li>
<li><img loading="lazy" alt="Azure DevBox - HTML Client" src="/assets/images/azuredevbox-desktophtml-caf3e2180a22a30a35cd9e0c2a9caf69.png" title="Azure DevBox - HTML Client" width="283" height="451" class="img_ev3q"></li>
<li><img loading="lazy" alt="Azure Dev Box /Windows 365 Connection" src="/assets/images/azuredevbox-desktophtmlconnecting-d9c3ba65efbf3f7a7aa04e0fae532879.png" title="Azure Dev Box/Windows 365 Connection" width="566" height="454" class="img_ev3q"></li>
<li>If prompted, then log in with your credentials.</li>
<li><img loading="lazy" alt="Azure Dev Box - Sign In" src="/assets/images/azuredevbox-desktophtml_login-407779d2a117565d0e11eb36522759ff.png" title="Azure Dev Box - Sign In" width="641" height="554" class="img_ev3q"></li>
<li>You will now be connected to your new Azure Dev Box!</li>
<li><img loading="lazy" alt="Azure Dev Box" src="/assets/images/azuredevbox-desktophtmldevbox-2a0e255983b17c5e515cb61eb2b0e3c5.jpg" title="Azure Dev Box" width="1596" height="882" class="img_ev3q"></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="connect-dev-box-using-remote-desktop-application">Connect Dev Box using Remote Desktop Application<a href="#connect-dev-box-using-remote-desktop-application" class="hash-link" aria-label="Direct link to Connect Dev Box using Remote Desktop Application" title="Direct link to Connect Dev Box using Remote Desktop Application">​</a></h5>
<p>Like Azure Virtual Desktop, you can connect to your Dev Box using the Remote Desktop client.</p>
<ol>
<li>Download and install the <a href="https://learn.microsoft.com/azure/virtual-desktop/users/connect-windows?tabs=subscribe&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Remote Desktop Client"><strong>Remote Desktop Client</strong></a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-desktop/users/connect-windows?tabs=subscribe-with-url&amp;WT.mc_id=AZ-MVP-5004796#subscribe-to-a-workspace" target="_blank" rel="noopener noreferrer" title="Subscribe to a workspace"><strong>Subscribe</strong></a> to the Azure workspace</li>
<li>As long as the Dev Box has been created, you can see your Dev Box and connect to it directly.</li>
<li><img loading="lazy" alt="Remote Desktop Client - Microsoft Dev Box" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABCoAAACfCAYAAAA/HTgfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABJtSURBVHhe7d3bj13VfQdw/pJEJU2hUBruGMLN3OMYQoE04R0V0lptIA29hD5Uah8aVepLU0UohKpVI6XDxYCNsRmuLg6Yi2wnQMD2QLETRzgWg1O3FUq1eta+nFn7cs7MmPHxOuazpY9mzt57rb322scPv6/XOXPSpz/16QAAAACQA0EFAAAAkA1BBQAAAJANQQUAAACQDUEFAAAAkA1BBQAAAJANQQUAAACQDUEFAAAAkA1BBQAAAJANQQUAAACQDUEFAAAAkA1BBQAAAJANQQUAAACQjZNOO/W0AAAAADBJfSFFJKgAAAAAJq4vpIgEFQAAAMDE9YUUkaACAAAAmLi+kCISVAAAAAAT1xdSRIIKAAAAYOL6QopIUAEAAABMXF9IEQkqAAAAgInrCykiQQUAAAAwcX0hRSSoAAAAACauL6SIBBUAAADAxPWFFJGgAgAAAJi4vpAiElQAAAAAE9cXUkSCCgAAAGDi+kKKaOJBxcxc6G7z28M9PecevXvC9vmq72qbf+menvMY6/xvhx2HPwpv3Rdfrwrf3nE4/Prgc+GuvnOzcmXYuK8ed6q8h8FNhOfubB8rrfq7HWFwl+Hgc3f1Hu9ozFGP4vhCf0X/H70Vvt8+b4wrN+yr3sUL20c//X7vucdSOTftbcy9r6CjmTcAACBvfSFFdFyCinZoUIYX82H7t5rnHpVvbR/01L7GPWH73MqEIX3jz9XHLu4WK8InaDn3MvrcGFTMh/n5wyMK/RhwxPfiCgYVLct7JtV42uev3hjeOw6BUd/Yi31xiMc4OFnevGUmo39HAACQk76QIlpSUHHG6WeEhx9+OKz7o3WN/eecdU6YfXI23PrVWxv7xxlV6N/z0nwIczOd/cszE2LmMTfTd2xlCCqOj6XfSxlG9AcN1aqQ+fnevsprzIW5fXkEFXElRU4rWEaOffXGsG/MKpWV8LHfy8eToAIAAHr1hRTRkoKKGEhse2FbOHz48DCs6Nu3FCML/WIlxFyYGe4rQ4d6q9v0BRrDfUXnS1g5Ec8bbulKjnjNweuZclVGudVjan+cJGm3WH8vVcfHBTGx2CvPKraFArUsrhv/Y90qfIoirmpXL8Vvf1ygaF+12/NSeX59jea5SZHeuk6zcK4+RjHcWoVY0bY6NNga4x95r8u4l7qvtnjd+VFFcz2XM2FjJ4yoA46/6R5rjbexwqGeo39L7zedi7gqYqG/TsE9ap5acz/Oos9vZmH8C++DakcnYKhXlZRb59n0hgXNe+y8N6o2fe2b+/rbdc8baM1b8z7q8cRnWR1vrZIp38vbwvq6k6p9Opft91ljntPrVUHNtvWDMVaHh2Mf994BAICcnP2d8OKBg+Htx25P9q8J9792IBx47f6wJjn39sfeDgcPvBi+c/bCvqPRF1JES/7oRxpM3P3Nu48qpIhGr0ioivqiyG+vjEiO9QYa5bElrcooQoWkfSPcKK+78LoKJ5I+O+NfSn+LjWngyg1zC0VpUdzURWpdXCdFU1rEtgva1TNhpvp9VHGXFp9FUTe3cE5RjNVtWn2XxV3VdnDs1T11P+UY02Pp9zJ0+xlxr63zxt7LCI0xdizMZae/qth87s5W0V2Mr1uEN+918IyTwrXoe/i62V/juuPmaTiess/RFnt+g7HVr4t7SccaxzY4PHxv9b0eMfaG9D3amp/0WPv5Nvof027wujtv6Thb913dx2BH//usPn/4XMtrFS3S6yXz3+y/9T6r5rX9nhiOr3PfAACQoWkMKqI6rDhy5MhRhRRRp9AfSsKIRrFfiiFE2a4MD4YhRnLuUoKK7vVjf2lAUv9eaY2l3X7Z/S1Jt4BLi7JG4VP8nhS7iU5huZSCKS2QW+c3irOW9Fp9BW1s27iHoeRel3MvvWJf4+5vVNGcznE69yPuecwcldI+mv0teZ7SayTHhtuouRg7tjiWpIAeaNxfzzXjGOer46Ofwah5rcR+i3at9/Ji8zhst/i8Nds357zUvHb7uRZ9pve+WH/xeL1yp2feGv333RsAANAbUkTL/jLNGFZsfX7rUYUUUbewryQrJYrAoW+rQ4jYSfV7+WvVR9F5M+Boan98Y2Er+1huUHEU/f1gb/i/6py4ffjKX4fPxf1FMVPtLLa6MGoVd8Nzk8InaZue1ynoRhRMxXll83IbUTy2i7tG4Ry36lqd/dXWLNyqncWWFIFLvZc+SWHbe3xUsdq4z7Qo7Zn7KD2/NUel2K7+nozRQcXYeertt9Sei6U+v+a4yn3pM+30U2/VtUY/g+Qe4zOomjW2ekzJM4rXHs7tIu3a85a+Dztj6AsWBtLrdfpov3c6z7gaT2Orjse2ggoAAFi2vpAiWnZQ8XE1C/0R++OLsSsjYgAQQ436Z7p//AqGsuv+Y8sPKo6ivz6dQmaRYnlk4RPbLRT4ncKyp13nnLToap2fFl/tQi/tJ/5e/y98fZ2hsfeanLfYvXSMCBUaWufEscwfDNtfSe+lOZ5OQZu06w8DorSPZn9Lnqcx99PuY6nPb7GgolOst4x6Bo396dy0zivF+Yhjqn9W+xdpN/aeC2l/zTkvNeez81zHBRWNvnsIKgAA4Kj0hRRRBkFFtSqhsRIiFvjjAoAqIJgrUoLG/no1RrPt4Br1nyeNDRvhRmr5QcWy++vTLnTi62SVQSx6Fpb6lwVX+r+5c8NitlmMdQq6noKpXbAV11o0qGgX0dWY6msV7dqFYmXcvS7nXtriNccWyNGIcaffZdAuclvPom7TLEKrVRDF8fbzavbXKepHzdPweLPvKO1jOc+vHPuYoKIY62Dow/lp6nsGxfUa89eanx6xzUeDf7vNUGR8u+68NcdZjGPYX3kfC6+r9sn7rnnfA/E5p+NpzV2z/5b2e3qg0X/nOQAAAFFfSBEdl6CivfUGEsVHQdKtJ0AYFQJ02jav0floyTCIWDyoWOh74bxl9derLpirrfMnMqvCq9gG+7etXyh8qqKt3pqF3kK7oqjrK5ha7YsCctGgYvC6KODr7dfh0Nx7zSK2cTxudT9j7nU59zLcX4qF6OjVCbXy2o327QK1uE4rPGjdS2Nc1RzVf0ml2BpFa7O/TrE/cp7S9tWh4Zacs4znV97/uKCiblN1VmytsVd76635jGrdMXfmvBH+LN6uM2/tcfY9w5deTea2Oa/LDSo679vBNmwf244LKqrXxdYYJwAAfLL1hRTRxIMKWHnNMIBPOu8HAACYBn0hRSSoYPq1/zecTzhBBQAATIO+kCISVAAnGEEFAABMg76QIhJUAAAAABPXF1JEggoAAABg4vpCikhQAQAAAExcX0gRCSoAAACAiesLKSJBBQAAADBxfSFFJKgAAAAAJq4vpIgEFQAAAMDE9YUUkaACAAAAmLi+kCISVAAAAAAT1xdSRCf17QQAAAA4HgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANgQVAAAAQDYEFQAAAEA2BBUAAABANrIJKu78s78M23a8GdZef2PvcQAAAODEl01Qcd7Fl4drN4dw8TVrhRYAAADwCZVVUHH9kyHc8FQIXxpYO/j94qu/KLQAAACAT5Csgoqbng7h958p3fxUCDfMhrDmyVCstLjwimuFFgAAAHCCyyqo+PIzIdz6bAhfHfjy0yH83lMhXD8bwhe2hHD15hBWbwrh0sdDWLX6GqEFAAAAnIDyCiqeDuEr1YqKWwZiUFGvqrhmcwhXPRHC5ZtCuGRjCBdtCOG8x0K44PKrhRYAAABwgsgqqLjl6VCsqoji7/GjIF+aDWFtsqriik0hXPZ4CJ/fGMKqx0I499EQznwkhN9dH8J5l14ptAAAAIAplt13VNRhxc2Dn3FFxY3VF2vGoCKuqriyXlXxeAgXbgjh/MdC+OyDIfzGTOnk6IEQ/vWBR3qvAwAAAOQru6AiBhRR/D2GFHFFRfxrIGu2lF+qeVX1XRVxVcXZj4bwmQdKvznw2ejBEH5rQFABAAAA0yeroOLG2XIVxU0DxWqKwev4HRVxRcUXB66rv6fi8TKUiIFEdErl1IdC+O2KoAIAAACmT1ZBRVw9EVdRDCVBRVxRcd1AO5A4rXL6wyH8TuWMAUEFAAAATJ+sgooYSsSwIhU/9hGDijSQqEOJGEhE8Ys0o88NnBk9IqgAAACAaZRVUBFDiRtSs2UQUYcSnUBi4KxHSmdXznm0/EsgggoAAACYPlkFFZd85fZi9UQMLFZtaAYScZVEI5BIQonzKvEvgEQXDAgqAAAAYPpkE1SkYmhx7k23dQKJOpRIA4lo1UD8U6XRRRVBBQAAAEyfLIOKVAwtzrvptmEgEVdapIHE56ONIVw8cEnl0scFFQAAADCNsg8qUjG0OP/m24ahxKVVKHHZQPyTpdHqTSVBBQAAAEyfqQoqTjnl1OLni9tfLUKLC26+LVyxKRSuHLjqidLVA4IKAAAAmD7ZBxVPPP9i2LbjzYbde98twoq//+79xTkxtFh1823h2s0hXFcRVAAAAMD0Oe5Bxeu73w2//OBweHP3O8XvTz77H8Njl113fXh55086QUW066d7w30/fKT4feurr4d//N6/FG1iaHHhLbcJKgAAAGAKHZegog4ndr65J/z7Q48WP/9g3dfDT95+J6y76+5w4OAHjdDirPMuHBtabH3t9fD09l3hb//hnzrXAgAAAKbHRIOKi664Jjy77eUihNj4zAvhj//0z8Nbc/uKcOJnv/hl+OGD68O7+w+E/T9/Pzz2xGz41ZH/LY6PDS12vR1OO/OccMppZ3SuBwAAAEyX4/bRjzS02PTci+Hwf/1P2Lb9teLnQ4/PFj/Xb36m+Pndf/5B2Pfz98Prb+1thBYnn/yZTr8AAADA9MriyzTT0GLz1pfC/K/+O+z5z58V4cSPXt0Z1m94onj9h3d+M7yz/xfha3/yjfD+oQ/DK2/sDes3P9vbJwAAADB9sggqUjG0eKYKLWZfeDl84y/+Kuw7cLAIJ+L3Wnzw4ZFw4P1D4e2974aZDVvCiz/eXXz0o68vAAAAYLpkF1SkTj/r3PDU1h8VocWON3aHN97aGzY99XzxWjgBAAAAJ56sg4rUqWecKZwAAACAE9zUBBUAAADAiU9QAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRj5YKKL9wbdh46Eo4cWXBo131hbd+5S3THln1Jf4fCru+t7T1vSRrj+5h9AQAAAMfEygYV+3eF+9bW+9aEe3ceCkf2z4Z17XOXKAYV+2fXla9v3xL2HUr7X5419z4VHl5XvS5Ci/1htn4NAAAAZOEYBhVRDCv2H/XqhUZQ8ak7wpb3VipcWMm+AAAAgJVyjIOKuJJhZ9hffwSk8fGLMiiIxw+lqy6SftKgotFPp68jjfMW+ouBRM/HPEaMFQAAADi+JhdUtI/Hj3IUgUJzdUMaSDS/oyJZAVGEFGkAkQYSC6s4misyauVHUrr7AQAAgONtIkHFnhgKxGBiGDpUqu+cWAgUYoiwZxhIdD/6UYURg752t76os7HioggyBv23vx+jE3AAAAAAOTnGQUUzXChXUKTHK/Wx1jntFRHD14sFFcV1W0HFiCAFAAAAyMcxDCrKsGD4J0rHrmYoV1L8eNfuxvGRKyo6fSXHRnz0444tzb4BAACA/KxsUJF8uWWUroYoxBUTyfFhiDEQV0Qcav350Rg0jOyv1ddCIDFoU6+kGAYaXy++lyLtK20DAAAA5GHlggoAAACAj0lQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGRDUAEAAABkQ1ABAAAAZENQAQAAAGTi0+H/AUcXyEwYZGzPAAAAAElFTkSuQmCC" title="Remote Desktop Client - Microsoft Dev Box" width="1066" height="159" class="img_ev3q"></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h4>
<p>We can configure a few extra things for the Azure DevBox environment.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="auto-stop">Auto-Stop<a href="#auto-stop" class="hash-link" aria-label="Direct link to Auto-Stop" title="Direct link to Auto-Stop">​</a></h5>
<p>As the Dev Box is Pay As You Go, you can ensure that a Dev Box is shut down after hours.</p>
<ol>
<li>Log in to the Microsoft <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Navigate to your <strong>Dev center</strong></li>
<li>Navigate to <strong>Projects</strong></li>
<li><strong>Navigate</strong> to <strong>the project</strong> you created earlier <em>(i.e. for me, its MobileGameDevelopment)</em></li>
<li>Click on the <strong>Dev box pools</strong></li>
<li>Click on <strong>Edit</strong> on your pools</li>
<li>Click <strong>Enable Auto-stop</strong></li>
<li>Select <strong>Yes</strong></li>
<li>Configure your <strong>Stop Time</strong> and <strong>time zone</strong></li>
</ol>
<p>You may also have multiple pools - selected with the exact Dev box image definition - if your project runs across various timezones, so you can schedule a 7 PM Shutdown in New Zealand and a 7 PM shutdown for those developers in the United States.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="delete-or-stop">Delete or Stop<a href="#delete-or-stop" class="hash-link" aria-label="Direct link to Delete or Stop" title="Direct link to Delete or Stop">​</a></h5>
<p>Not as much as a Configuration item, but more of a quick - howto! As a Dev Box user, you can shut down your Dev Box or delete it from the <a href="https://devbox.microsoft.com/" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box"><strong>Microsoft Dev Box portal</strong></a><strong>.</strong></p>
<p><img loading="lazy" alt="Azure Dev Box - Stop or Delete" src="/assets/images/azuredevbox-closedelete-7e8b6594a49018005fd9c888fb8c7fbf.png" title="Azure Dev Box - Stop or Delete" width="431" height="403" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources">​</a></h4>
<p>As Microsoft Dev Box is still in Public Preview - at the time of writing - the experience may change before its GA (Generally available).</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="documentation">Documentation<a href="#documentation" class="hash-link" aria-label="Direct link to Documentation" title="Direct link to Documentation">​</a></h5>
<p>Additional reading on Microsoft Dev Box can be found below:</p>
<ul>
<li><a href="https://azure.microsoft.com/products/dev-box/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box">Microsoft Dev Box</a></li>
<li><a href="https://azure.microsoft.com/pricing/details/dev-box/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Microsoft Dev Box PREVIEW pricing">Microsoft Dev Box pricing</a></li>
<li><a href="https://www.youtube.com/watch?v=kyeuSpR74W4" target="_blank" rel="noopener noreferrer">Build developer environments fast with Microsoft Dev Box - Youtube</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="azure-bicep">Azure Bicep<a href="#azure-bicep" class="hash-link" aria-label="Direct link to Azure Bicep" title="Direct link to Azure Bicep">​</a></h5>
<p>Below are some Azure Bicep samples for Azure Dev Box.</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="dev-center">Dev Center<a href="#dev-center" class="hash-link" aria-label="Direct link to Dev Center" title="Direct link to Dev Center">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">param name string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">param location string</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">param tags object</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource name_resource &#x27;Microsoft.DevCenter/devcenters@2022-08-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  tags: tags</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  identity: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    type: &#x27;none&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="devbox-host-pool">DevBox Host Pool<a href="#devbox-host-pool" class="hash-link" aria-label="Direct link to DevBox Host Pool" title="Direct link to DevBox Host Pool">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">param projects_MobileGameDevelopment_name string = &#x27;MobileGameDevelopment&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource projects_MobileGameDevelopment_name_MobleDevelopmentWin10Secure &#x27;Microsoft.DevCenter/projects/pools@2022-09-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: &#x27;${projects_MobileGameDevelopment_name}/MobleDevelopmentWin10Secure&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: &#x27;australiaeast&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    devBoxDefinitionName: &#x27;Win10-VS&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    networkConnectionName: &#x27;ProductionVNETAADJConnection&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    licenseType: &#x27;Windows_Client&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    localAdministrator: &#x27;Disabled&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource projects_MobileGameDevelopment_name_MobleDevelopmentWin10Secure_default &#x27;Microsoft.DevCenter/projects/pools/schedules@2022-09-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  parent: projects_MobileGameDevelopment_name_MobleDevelopmentWin10Secure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: &#x27;default&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    type: &#x27;StopDevBox&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    frequency: &#x27;Daily&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    time: &#x27;11:15&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    timeZone: &#x27;Pacific/Auckland&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    state: &#x27;Enabled&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Azure is a cloud computing platform that provides a wide range of services and capabilities for building and deploying applications and workloads in the cloud. In contrast, hosting your own datacenter involves setting up and managing a physical infrastructure, including servers, storage, networking, and other components, in a location controlled by the organization."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2022/12/05/hosting-your-workloads-in-azure-vs-on-premises/">Hosting your workloads in Azure vs On-premises</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-12-05T00:00:00.000Z" itemprop="datePublished">December 5, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Luke Murray</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://azure.microsoft.com/en-us/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Do more with less— On Azure">Azure</a> is a cloud computing platform that provides a wide range of services and capabilities for building and deploying applications and workloads in the cloud. In contrast, hosting your own datacenter involves setting up and managing a physical infrastructure, including servers, storage, networking, and other components, in a location controlled by the organization.</p>
<p>Azure and hosting your own datacenter are two different approaches for deploying and managing applications and workloads.</p>
<p>There are several key differences between Azure and hosting your own datacenter, including the following:</p>
<ul>
<li>Capital expenditure and operational costs: Azure is a pay-as-you-go service, with no upfront costs or long-term commitments, while hosting your own datacenter involves a significant capital expenditure, and ongoing costs for maintenance, support, and infrastructure upgrades.</li>
<li>Scalability and elasticity: Azure provides automatic scalability and elasticity, with the ability to scale up and down on demand, and pay only for the resources that are used, while hosting your own datacenter requires manual scaling and capacity planning, and may result in underutilized or overutilized resources.</li>
<li>Security and compliance: Azure provides built-in security and compliance features, with the ability to deploy and manage applications and workloads in a secure and compliant manner, while hosting your own datacenter requires the implementation and maintenance of security and compliance controls, and may expose the organization to security and compliance risks.</li>
<li>Integration and interoperability: Azure integrates well with other Azure services and technologies, as well as with on-premises environments, while hosting your own datacenter may require the use of complex integration and interoperability solutions, and may result in vendor lock-in and interoperability challenges.</li>
</ul>
<p>Overall, Azure and hosting your own datacenter are two different approaches, with different advantages and disadvantages. Azure can provide a more cost-effective, scalable, and secure solution, but may require the adoption of a different operating model and a learning curve, while hosting your own datacenter can provide more control and flexibility, but may require a larger investment and ongoing operational costs.</p>
<p>The <a href="https://azure.microsoft.com/pricing/tco/calculator/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Total Cost of Ownership (TCO) Calculator">total cost of ownership (TCO) of Azure</a> and on-premises can vary depending on several factors, including the specific services and resources that are used, the usage patterns and workloads, the pricing options and discounts, and the cost optimization strategies and techniques that are implemented.</p>
<p>In general, the TCO of Azure can be lower than the TCO of on-premises, for the following reasons:</p>
<ul>
<li>Azure provides a pay-as-you-go pricing model, with no upfront costs or long-term commitments, and the ability to scale up and down on demand, and pay only for the resources that are used. This can help to reduce the overall TCO, compared to the upfront capital expenditure and ongoing operational costs of on-premises infrastructure.</li>
<li>Azure provides built-in support and maintenance services, as part of the subscription fees, and the ability to choose from different support and maintenance plans, depending on the specific needs and requirements of the organization. This can help to reduce the TCO, compared to the costs of hiring and maintaining a dedicated IT staff for on-premises infrastructure.</li>
<li>Azure provides built-in security and compliance features, and the ability to deploy and manage applications and workloads in a secure and compliant manner. This can help to reduce the TCO, compared to the costs of implementing and maintaining security and compliance controls for on-premises infrastructure.</li>
</ul>
<p>Overall, the TCO of Azure can be lower than the TCO of on-premises, due to the pay-as-you-go pricing model, the built-in support and maintenance services, and the built-in security and compliance features. However, the actual TCO may vary depending on the specific needs and requirements of the organization, and on the implementation and cost optimization strategies that are used.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Azure Storage account SFTP functionality support for Azure Blob Storage&quot;) has now gone GA (Generally Available) across most regions as part of the GA release - SFTP support for Azure Storage accounts was free while it was in preview - but now that the service is GA - there is an additional charge for SFTP (Secure File Transfer)_ functionality."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/azure/disable-sftp-support-on-an-azure-storage-account-on-a-schedule/">Disable SFTP support on an Azure Storage account on a Schedule</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-11-16T00:00:00.000Z" itemprop="datePublished">November 16, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Luke Murray</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Azure Storage account <a href="https://learn.microsoft.com/en-us/azure/storage/blobs/secure-file-transfer-protocol-support?WT.mc_id=AZ-MVP-5004796#pricing-and-billing" target="_blank" rel="noopener noreferrer" title="SSH File Transfer Protocol (SFTP) support for Azure Blob Storage">SFTP functionality</a> has now gone GA <em>(Generally Available)</em> across most regions as part of the GA release - SFTP support for Azure Storage accounts was free while it was in preview - but now that the service is GA - there is an additional charge for SFTP <em>(Secure File Transfer)</em> functionality.</p>
<blockquote>
<p>Enabling the SFTP endpoint has a cost of $0.30 per hour. We will start applying this hourly cost on or after December 1, 2022.</p>
</blockquote>
<p>This service has worked for me without a hitch for months, but as with most resources in Microsoft Azure - you pay for what you use! Therefore, there may be instances where you do not need SFTP support 24 hours a day, seven days a week! This is where the following Azure Automation runbook can help.</p>
<p><em>Feel free to check out a</em> <a href="https://luke.geek.nz/azure/sftp-in-microsoft-azure-using-azure-blob-storage/" target="_blank" rel="noopener noreferrer" title="SFTP in Microsoft Azure using Azure Blob Storage "><em>previous article</em></a> <em>on setting up SFTP support for an Azure storage account.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h4>
<p>Using an <a href="https://learn.microsoft.com/en-us/azure/automation/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="What is Azure Automation?">Azure Automation</a> PowerShell runbook and Schedules <em>(as part of the Azure Automation account)</em>  - we can turn on the SFTP endpoint - when we need it and disable it - the rest of the time - which is excellent from a security and cost perspective.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h4>
<p>To do this, we will need an:</p>
<ul>
<li>Azure Automation Account</li>
<li>System Managed Identity set with Storage Account Contributor rights</li>
<li>PowerShell runbook <em>(supplied below)</em></li>
</ul>
<p>For this article, I will assume you already have an Azure Automation account - if you do not - then follow the Microsoft documentation: <a href="https://learn.microsoft.com/en-us/azure/automation/automation-create-standalone-account?tabs=azureportal&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Create a standalone Azure Automation account">Create a standalone Azure Automation account</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy--configure">Deploy &amp; Configure<a href="#deploy--configure" class="hash-link" aria-label="Direct link to Deploy &amp; Configure" title="Direct link to Deploy &amp; Configure">​</a></h4>
<p>Now that the Azure Automation account has been configured and set up - we need to add the Runbook, but before we can do that - there are some dependencies. For example, SFTP is a new service that the currently installed Az Modules in the Azure Automation don&#x27;t have visibility on - so to configure the SFTP service - we need to update 2 Modules to the most recent version.</p>
<p>These modules are:</p>
<ul>
<li>Az.Accounts <em>(≥ 2.10.3)</em></li>
<li>Az.Storage</li>
</ul>
<p>Az.Accounts are a dependent service of the latest Az.Storage account, so let us import that first.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="update-azaccounts-module">Update Az.Accounts module<a href="#update-azaccounts-module" class="hash-link" aria-label="Direct link to Update Az.Accounts module" title="Direct link to Update Az.Accounts module">​</a></h5>
<ol>
<li>In the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a>, navigate to <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts" target="_blank" rel="noopener noreferrer" title="Azure Automation Accounts"><strong>Azure Automation accounts</strong></a>.</li>
<li>Find your Azure Automation account and, click on it, navigate to <strong>Modules</strong> <em>(under Shared resources)</em>.</li>
<li>Select <strong>Browse Gallery</strong></li>
<li>Search for: <strong>Az.Accounts</strong></li>
<li><img loading="lazy" alt="Import Az.Accounts" src="/assets/images/azautomation_gallery_azaccounts-f483a10745c63bcf37e707d22aa94af1.png" title="Az.Accounts" width="1342" height="348" class="img_ev3q"></li>
<li>Click &#x27;<strong>Az.Accounts</strong>&#x27; and select <strong>Select.</strong></li>
<li>Set the <strong>runtime</strong> version to: <strong>5.1</strong> &amp; select impor<strong>t</strong></li>
<li>Wait for 5 minutes while the module imports.</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="update-azstorage-module">Update Az.Storage module<a href="#update-azstorage-module" class="hash-link" aria-label="Direct link to Update Az.Storage module" title="Direct link to Update Az.Storage module">​</a></h5>
<p><em>Note: the Az.The accounts module will need to finish its import before the Az.The storage module is updated.</em></p>
<ol>
<li>In the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a>, navigate to <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts" target="_blank" rel="noopener noreferrer" title="Azure Automation Accounts"><strong>Azure Automation accounts</strong></a>.</li>
<li>Find your Azure Automation account and, click on it, navigate to <strong>Modules</strong> <em>(under Shared resources)</em>.</li>
<li>Select <strong>Browse Gallery</strong></li>
<li>Search for: <strong>Az.Storage</strong></li>
<li><img loading="lazy" alt="Import  Az.Storage" src="/assets/images/azautomation_gallery_azstorage-81cd1f5ee075ba68a2cf723c327aa328.png" title=" Az.Storage" width="1331" height="323" class="img_ev3q"></li>
<li>Click &#x27;<strong>Az.Storage</strong>&#x27; and select <strong>Select.</strong></li>
<li>Set the <strong>runtime</strong> version to: <strong>5.1</strong> &amp; select impor<strong>t</strong></li>
<li>Wait for 5 minutes while the module imports.</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-system-managed-identity">Create System Managed Identity<a href="#create-system-managed-identity" class="hash-link" aria-label="Direct link to Create System Managed Identity" title="Direct link to Create System Managed Identity">​</a></h5>
<p>Now that the base Modules have been updated, we need to create a System Managed Identity - this Managed Identity will allow the Azure Automation runbook to authenticate to your Azure resources - and, in our example - make changes, such as Disabling or Enabling the SFTP service. This System Managed Identity will need Storage Account Contributor rights.</p>
<ol>
<li>In the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a>, navigate to <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts" target="_blank" rel="noopener noreferrer" title="Azure Automation Accounts"><strong>Azure Automation accounts</strong></a>.</li>
<li>Find your Azure Automation account and click on it; click on <strong>Identity</strong> <em>(under Account Settings)</em></li>
<li>Select Status to: <strong>On</strong> and select <strong>Save</strong></li>
<li>Click on: <strong>Azure role assignments</strong>
<ol>
<li>Select your <strong>Scope</strong> <em>(in our example, we will go with Storage - to limit what changes this Azure Automation account can make)</em></li>
<li>Select the <strong>Subscription</strong> and <strong>Storage account</strong> Resource on which you want to disable or enable the SFTP service.</li>
<li>For the role, select <strong>Storage Account Contributor</strong>.</li>
<li>Click <strong>Save</strong></li>
</ol>
</li>
</ol>
<p><em>You should now see the Azure automation account, listed as having Storage account contributor rights - under your Automation account&#x27;s Access Control (IAM) blade.</em></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="import-runbook---set-azstgftpps1">Import Runbook - Set-AzStgFTP.ps1<a href="#import-runbook---set-azstgftpps1" class="hash-link" aria-label="Direct link to Import Runbook - Set-AzStgFTP.ps1" title="Direct link to Import Runbook - Set-AzStgFTP.ps1">​</a></h5>
<p>Now that the AzAccounts, Az.Storage modules have been updated, and the Azure Automation account has been given permission - to enable and disable the SFTP service on the storage account- it&#x27;s time to import the Runbook that will make this happen.</p>
<ol>
<li>
<p>In the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Azure Portal</strong></a>, navigate to <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts" target="_blank" rel="noopener noreferrer" title="Azure Automation Accounts"><strong>Azure Automation accounts</strong></a>.</p>
</li>
<li>
<p>Find your Azure Automation account and, click on it, navigate to <strong>Runbooks</strong> <em>(under Process Automation)</em>.</p>
</li>
<li>
<p>Click <strong>+ Create a Runbook</strong></p>
</li>
<li>
<p>Enter your runbook <strong>name</strong> <em>(i.e. Set-AzSFTP)</em></p>
</li>
<li>
<p>Select the Runbook type as <strong>PowerShell</strong></p>
</li>
<li>
<p>Select the Runtime version as: <strong>5.1</strong></p>
</li>
<li>
<p>[Optional] Add a description of what this Runbook does and who to contact.</p>
</li>
<li>
<p>Click <strong>Create</strong></p>
</li>
<li>
<p>Open the newly created blank Runbook, and select <strong>Edit</strong></p>
</li>
<li>
<p><strong>Copy</strong> the following PowerShell <a href="https://github.com/lukemurraynz/Azure/blob/main/Azure%20Automation/Set-AzStgSFTP.ps1" target="_blank" rel="noopener noreferrer" title="Set-AzStgSFTP.ps1"><strong>script</strong></a> into the Edit pane:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> param</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [Parameter(Mandatory=$true,Position = 0, HelpMessage = &#x27;Enter the Azure Resource Group, that contains your Azure Storage account&#x27;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [string]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $resourceGroupName,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [Parameter(Position = 1, Mandatory = $true, HelpMessage = &#x27;Enter the Azure Storage account name&#x27;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [string]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $storageAccountName,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        [Parameter(Mandatory = $true, HelpMessage = &#x27;$True = Enable SFTP &amp; $False = Disable SFTP&#x27;)][ValidateSet(&#x27;False&#x27;,&#x27;True&#x27;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        $enableSftp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .SYNOPSIS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Disables or enables SFTP support on an Azure Storage Account.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .DESCRIPTION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Disables or enables SFTP support on an Azure Storage Account. The intention is for this script to be used in Azure Automation, alongside a Schedule to enable or disable SFTP support on an Azure Storage Account.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    .EXAMPLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Set-AzStgSFTP -resourceGroupName sftp_prod -storageAccountName sftpprod0 -EnableSFTP $true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  #&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # Ensures you do not inherit an AzContext in your runbook</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Disable-AzContextAutosave -Scope Process</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Import-Module -Name Az.Storage</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Connect to Azure with system-assigned managed identity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$AzureContext = (Connect-AzAccount -Identity).context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write-Output -InputObject $AzureContext</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write-Output -InputObject $AzureContext.Subscription</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write-Output -InputObject $resourceGroupName </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write-Output -InputObject $storageAccountName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write-Output -InputObject $EnableSFTP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># set and store context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$AzureContext = Set-AzContext -SubscriptionName $AzureContext.Subscription -DefaultProfile $AzureContext</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $SetSFTP = [System.Convert]::ToBoolean($enableSftp)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $SFTPStatusBefore = Get-AzStorageAccount -DefaultProfile $AzureContext -ResourceGroupName $resourceGroupName -Name $storageAccountName | Select-Object -ExpandProperty EnableSftp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $Status = $SFTPStatusBefore -replace &#x27;True&#x27;, &#x27;Enabled&#x27; -replace &#x27;False&#x27;, &#x27;Disabled&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Write-Output -InputObject (&#x27;SFTP for {0} currently has SFTP set to: {1} before update.&#x27; -f $storageAccountName, $Status)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Set-AzStorageAccount -DefaultProfile $AzureContext -ResourceGroupName $resourceGroupName -Name $storageAccountName -EnableSftp $SetSFTP </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $SFTPStatusAfter = Get-AzStorageAccount -DefaultProfile $AzureContext -ResourceGroupName $resourceGroupName -Name $storageAccountName | Select-Object -ExpandProperty EnableSftp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $Status = $SFTPStatusAfter -replace &#x27;True&#x27;, &#x27;Enabled&#x27; -replace &#x27;False&#x27;, &#x27;Disabled&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Write-Output -InputObject (&#x27;SFTP for {0} currently has SFTP set to: {1} after update.&#x27; -f $storageAccountName, $Status)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>Click <strong>Publish</strong></p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="run-runbook---set-azstgftp">Run Runbook - Set-AzStgFTP<a href="#run-runbook---set-azstgftp" class="hash-link" aria-label="Direct link to Run Runbook - Set-AzStgFTP" title="Direct link to Run Runbook - Set-AzStgFTP">​</a></h5>
<p>Now that the Runbook is imported, we need to run it.</p>
<p>The Runbook uses the following parameters:</p>





















<table><thead><tr><th>Parameters</th><th>Values</th></tr></thead><tbody><tr><td>resourceGroupName</td><td>Enter the name of the Azure Resource Group, that contains your Azure Storage account.</td></tr><tr><td>storageAccountName</td><td>Enter the name of your Azure Storage account.</td></tr><tr><td>enableSftp</td><td>The following boolean values are accepted: False (Disable SFTP) and True (Enable SFTP).</td></tr></tbody></table>
<ol>
<li>Next, find your Runbook, and select <strong>Start.</strong></li>
<li>Enter your parameters, <strong>Resource Group</strong>, <strong>Storage Account</strong> and <strong>Enable SFTP.</strong></li>
<li><img loading="lazy" alt="Start Azure Automation runbook" src="/assets/images/azautomation_runbook_runparameters-a4c30774df3fd5c9359ae510b8c63be7.png" title="Start Azure Automation runbook" width="414" height="828" class="img_ev3q"></li>
<li>Click <strong>Ok</strong></li>
<li>The Runbook will run, and as you can see - outputs its state Before the Runbook ran and after.</li>
<li><img loading="lazy" alt="Azure Automation - Run" src="/assets/images/azautomation_runbook_run-37c6379063b59d96f685b5a1bbb9feb9.png" title="Azure Automation - Run" width="1190" height="564" class="img_ev3q"></li>
</ol>
<p><strong>Once working correctly, you can set up an</strong> <a href="https://learn.microsoft.com/en-us/azure/automation/shared-resources/schedules?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Automation schedule"><strong>Azure Automation schedule</strong></a> <strong>to trigger the runbook to enable and disable the SFTP when needed only!</strong></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Azure-Firewall-mon is a near real-time Azure Firewall log viewer."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2022/11/14/deploy-azure-firewall-mon-to-a-static-web-app/">Deploy Azure-Firewall-mon to a Static Web App</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-11-14T00:00:00.000Z" itemprop="datePublished">November 14, 2022</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Luke Murray</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://github.com/nicolgit/azure-firewall-mon" target="_blank" rel="noopener noreferrer" title="Azure-Firewall-mon">Azure-Firewall-mon</a> is a near real-time <a href="https://learn.microsoft.com/en-us/azure/firewall/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="What is Azure Firewall?">Azure Firewall</a> log viewer.</p>
<blockquote>
<p>Azure-Firewall-mon provides an <em>alternative_and_opinable</em> 😊 way to access and inspect Azure Firewall logs. The recommended approach for analysing Azure Firewall logs is to set up a Log Analytics Workspace to collect all the data and use Kusto <em>(KQL)</em> queries to check what&#x27;s happening.</p>
<p>In Azure-Firewall-mon, the idea is to provide an approach much more like Sysinternals Process Monitor or Check Point&#x27;s SmartView, where there is no queries or dashboards that you need to implement first to get working. Still, all events are available as a log stream. In addition, a full-text search at the top of the page lets you quickly filter the content displayed on the screen, helping you understand what is happening right now (or close to present).</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>Azure-Firewall-mon <em>(AFM or Azure Firewall Monitor)</em> is a custom solution <em>(currently in a functional beta)</em> created by an Italian Microsoft Cloud Solution Architect called: <a href="https://nicolgit.github.io/" target="_blank" rel="noopener noreferrer" title="Nicola Delfino">Nicola Delfino</a>, its worth mentioning that although a Microsoft CSA makes AFM, <strong>IT IS NOT A SUPPORTED MICROSOFT PRODUCT</strong>.</p>
<p>Monitoring Azure Firewall can be a pain - with trawling through logs - using the <a href="https://learn.microsoft.com/en-us/azure/firewall/firewall-workbook?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Monitor logs using Azure Firewall Workbook">Azure Firewall Workbook</a> - helps fill in the gap - especially around the application and network rule traffic. Still, you may want something more straightforward and designed for real-time traffic to assist with in-the-moment troubleshooting.</p>
<p>Azure-Firewall-mon is an open-source, <a href="https://en.wikipedia.org/wiki/Single-page_application" target="_blank" rel="noopener noreferrer">single Page Application</a> written in <a href="https://angular.io/" target="_blank" rel="noopener noreferrer">Angular</a> and hosted on an <a href="https://az-firewall-mon.azurewebsites.net" target="_blank" rel="noopener noreferrer" title="az-firewall-mon">Azure WebApp</a> - so to use this, you don&#x27;t need to deploy to your environment.. add in an Event Hub connection string, and away you go <em>(there is also a demo mode - so you can see what the experience will be like)</em>!</p>
<p><img loading="lazy" alt="az-firewall-mon landing page" src="/assets/images/az-firewall-mon-5ee91a5e050fe29ab5cb0ab490d9f68a.png" title="az-firewall-mon" width="829" height="651" class="img_ev3q">
<img loading="lazy" alt="az-firewall-mon landing page" src="/assets/images/azfirewallmon-60df2768099b9ac2627a844cd78480bb.png" title="az-firewall-mon" width="1902" height="910" class="img_ev3q"></p>
<p><strong>We can deploy it to an Azure</strong> <a href="https://azure.microsoft.com/en-us/products/app-service/static/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" Static Web Apps"><strong>Static Web App</strong></a> <strong>for those who would instead host it in our environment.</strong></p>
<blockquote>
<p>&quot;Azure Static Web Apps is a service that automatically builds and deploys full-stack web apps to Azure from a code repository. When you create an Azure Static Web Apps resource, Azure interacts directly with GitHub or Azure DevOps to monitor a branch of your choice. Every time you push commits or accept pull requests into the watched branch, a build is automatically run and your app and API is deployed to Azure.&quot;</p>
</blockquote>
<p><img loading="lazy" alt="Azure Static WebApps - Overview" src="/assets/images/azure-static-web-apps-overview-db72be97bdda7bc3b20f59753dd62022.png" title="Azure Static WebApps - Overview" width="900" height="376" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h4>
<p>Today, we are going to deploy Azure-Firewall-mon into an Azure Static Web App - to do this; we will need the following prerequisites:</p>
<ul>
<li>A <a href="https://github.com/" target="_blank" rel="noopener noreferrer" title="GitHub">GitHub</a> account</li>
<li>An <a href="https://azure.microsoft.com/en-us/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Do more with less. On Azure.">Azure</a> subscription_(with permissions to deploy Event Hub, deploy an Azure Static WebApp, and configure Diagnostics on the Azure Firewall)_</li>
<li>Azure Firewall <em>(provisioned)</em></li>
</ul>
<p><em>Note: Also, ensure that your Event Hub is in the same region as your Azure Firewall so that you can use Diagnostics settings. Regarding the Azure Static WebApp - it doesn&#x27;t matter; this is a global service  - and you will be entering the Event Hub listener.</em></p>
<p>We will use the Azure Portal and a browser to provision the workflow <em>(however, I will have added Azure Bicep to the bottom of the article for reference)</em>.</p>
<p>This article - assumes you have basic knowledge of GitHub and Microsoft Azure.</p>
<p>For this demo, I am using a <a href="https://learn.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?tabs=cli&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Hub-spoke network topology in Azure">Hub &amp; Spoke Azure</a> topology.</p>
<p><img loading="lazy" alt="Azure Firewall Monitor - High Level Architecture" src="/assets/images/AzMonArchitecture-2a808a28e6a53d30a3d54b9efc5bfee0.png" title="Azure Firewall Monitor - High Level Architecture" width="462" height="96" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fork-the-github-repository">Fork the GitHub repository<a href="#fork-the-github-repository" class="hash-link" aria-label="Direct link to Fork the GitHub repository" title="Direct link to Fork the GitHub repository">​</a></h4>
<p>The first thing we need to do is clone the Azure-Firewall-mon repository; this repository holds the source control of Azure-Firewall-mon. First, however, we need a clone of it - to use in our Static Web App - this will also allow us to pull down and build the latest changes and updates of the Azure-Firewall-mon tool while having the stability of maintaining your version of the device.</p>
<ol>
<li>In your favourite browser of choice, navigate to: <a href="https://github.com/nicolgit/azure-firewall-mon" target="_blank" rel="noopener noreferrer" title="https://github.com/nicolgit/azure-firewall-mon">https://github.com/nicolgit/azure-firewall-mon</a>.</li>
<li>Click <strong>Fork</strong> <em>(top right of the repository)</em></li>
<li><img loading="lazy" alt="GitHub - Create a new fork" src="/assets/images/github_azfirewall_mon_createfork-a564e58393e28ac3483ef8936c00af4c.png" title="GitHub - Create a new fork" width="789" height="531" class="img_ev3q"></li>
<li>Click <strong>Create fork</strong></li>
<li>You have now created a fork of the &#x27;azure-firewall-mon&#x27; repository; when a new update of Azure-Firewall-mon comes out - you can also select &#x27;Sync fork&#x27; - to keep your fork up-to-date and trigger a new build.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-static-web-app-and-deploy-azure-firewall-mon">Create Static Web App and deploy azure-firewall-mon<a href="#create-static-web-app-and-deploy-azure-firewall-mon" class="hash-link" aria-label="Direct link to Create Static Web App and deploy azure-firewall-mon" title="Direct link to Create Static Web App and deploy azure-firewall-mon">​</a></h4>
<p>Now that you have created a fork, it&#x27;s time to make your Azure Static WebApp!</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></li>
<li>Click <strong>+ Create a resource</strong></li>
<li>Type in: <strong>Static Web App</strong></li>
<li>Select and click <strong>Create</strong></li>
<li>Create or <strong>select</strong> a <strong>Resource Group</strong></li>
<li><strong>Type</strong> in the <strong>name</strong> of your Static Web App</li>
<li>For the plan type, we will go with <strong>Free</strong></li>
<li>Please select your <strong>region</strong> <em>(this is the staging environment used to create your resource so the Azure Static Web App can then be replicated geographically)</em>.</li>
<li>Select <strong>Source</strong>, as <strong>GitHub</strong></li>
<li>Click <strong>Sign in</strong> with <strong>GitHub</strong> <em>(and sign in with an account with access to the GitHub Repository fork of azure-firewall-mon created earlier)</em>.</li>
<li><strong>Authorise</strong> the <strong>Azure Static Web Apps</strong> to have access to your repositories</li>
<li><strong>Select</strong> your <strong>organisation</strong> and the azure-firewall-mon <strong>repository</strong> you forked earlier.</li>
<li>Select &#x27;<strong>main</strong>&#x27; for the branch</li>
<li>Under Build Presents, select <strong>Angular</strong></li>
<li>For App location, enter &quot;<strong>/firewall-mon-app/</strong>&quot;</li>
<li>Leave the API location empty</li>
<li>For the Output location, enter: <strong>&quot;dist/firewall-mon-app&quot;</strong></li>
<li><img loading="lazy" alt="Azure Static WebApps - Angular Build" src="/assets/images/github_azfirewall_mon_createbuildangular-a12ee728543a0ee418ac652c833a6d1d.png" title="Azure Static WebApps - Angular Build" width="798" height="315" class="img_ev3q"></li>
<li>If you navigate to your own forked GitHub repository, you should see a new folder created under .github/workflows - and a new GitHub Actions workflow file!</li>
<li><img loading="lazy" alt="Create Azure Static WebApp - Angular - Azure Portal" src="/assets/images/create_azstaticwebapp_portal_azfw-mon-1f247c2b24ef6bdf6f4f84a02190df76.gif" title="Create Azure Static WebApp - Angular - Azure Portal" width="1300" height="873" class="img_ev3q"></li>
<li>If you select <strong>Actions</strong> in GitHub, you should see a deployment start.</li>
<li>After roughly 5 minutes, your <strong>Azure Static App - will have deployed azure-firewall-mon</strong>!</li>
<li><strong>Navigate</strong> to your newly created <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2FStaticSites" target="_blank" rel="noopener noreferrer" title="Static Web Apps"><strong>Azure Static App</strong></a> in the Azure Portal</li>
<li>Click <strong>Browse</strong></li>
<li>You should now see <strong>azure-firewall-mon</strong>!</li>
<li><img loading="lazy" alt="azure-firewall-mon" src="/assets/images/azure_azfirewall_mon_deployed-30347db0fe83fdfb7a9c45f5b210e0ca.png" title="azure-firewall-mon" width="1902" height="998" class="img_ev3q"></li>
</ol>
<p><em>Note: In GitHub, under Actions and the Build and Deploy Job, you may see a message about Note.js 12 actions being deprecated; you can set the node version to be higher.</em></p>
<p>Add the step to set the node version below submodules and above the Build and Deploy step:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - uses: actions/setup-node@v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        with:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          node-version: &quot;18.x&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Refer to a copy of my Github Actions file here: <a href="https://gist.github.com/lukemurraynz/3f300a5eb73b2693d3a9378261a023db" target="_blank" rel="noopener noreferrer" title="Azure Static Web Apps CI/CD">AzureStaticWebAppsCICD.yml</a> for a comparison of GitHub action - a setup-node step running on the latest version of 18.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-event-hub-namespace-and-shared-access-policy">Create Event Hub namespace and shared access policy<a href="#create-event-hub-namespace-and-shared-access-policy" class="hash-link" aria-label="Direct link to Create Event Hub namespace and shared access policy" title="Direct link to Create Event Hub namespace and shared access policy">​</a></h4>
<p>Even if you use the externally hosted version of <a href="https://az-firewall-mon.azurewebsites.net/" target="_blank" rel="noopener noreferrer">Azure Firewall Monitor</a>, you still need an Event Hub and Namespace to stream the events from our Azure Firewall to the Azure Firewall Monitor.</p>
<ol>
<li>
<p>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></p>
</li>
<li>
<p>Click <strong>+ Create a resource</strong></p>
</li>
<li>
<p>Type in: <strong>Event Hubs</strong></p>
</li>
<li>
<p>Select and click <strong>Create</strong></p>
</li>
<li>
<p>Select your subscription and <strong>Resource Group</strong>;</p>
</li>
<li>
<p>Type in the <strong>Namespace</strong> of the event hub <em>(i.e. AzureFirewallMonitor)</em></p>
</li>
<li>
<p>Select your <strong>location</strong> <em>(make sure this is the same region as your Azure Firewall)</em></p>
</li>
<li>
<p>Select your <strong>Pricing Tier</strong> <em>(in this example, I am going with Basic)</em></p>
</li>
<li>
<p>Click <strong>Review + create</strong></p>
</li>
<li>
<p>Once the Namespace has been created, it&#x27;s time to make our Event Hub; navigate to your newly created AzFirewallMonitor namespace.</p>
</li>
<li>
<p>Under <strong>Entitles</strong>, click <strong>+ Event Hub</strong></p>
</li>
<li>
<p>Under the name, enter the Event Hub name <em>(i.e. AzMonitorCapture)</em></p>
</li>
<li>
<p>Leave the defaults <em>(and Message retention to 1 day)</em></p>
</li>
<li>
<p>Click <strong>Review + Create</strong></p>
</li>
<li>
<p>Click <strong>Create</strong></p>
</li>
<li>
<p><img loading="lazy" alt="Create Azure Event Hub" src="/assets/images/azure_azfirewall_mon_createeventhub-5a668a3e7de5b9a898c12c041d87ac23.png" title="Create Azure Event Hub" width="837" height="350" class="img_ev3q"></p>
</li>
<li>
<p>Now that the Event Hub is created, we need to create a Shared access policy; in the Event Hub namespace, click on <strong>Shared access policies.</strong></p>
</li>
<li>
<p>Click <strong>+ Add</strong></p>
</li>
<li>
<p>Type in a <strong>Policy name</strong><em>(i.e. AzMonitorListener)</em></p>
</li>
<li>
<p>Select <strong>Send</strong></p>
</li>
<li>
<p>Click <strong>Create</strong></p>
</li>
<li>
<p><img loading="lazy" alt="Azure Event Hub - Create shared access policy" src="/assets/images/azure_azfirewall_mon_sharedaccesspolicy-f2f1f482b00b1f0b407b66e4ede00daa.png" title="Azure Event Hub - Create shared access policy" width="1633" height="317" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-azure-firewall-to-stream-to-event-hub-and-run-azure-firewall-monitor">Configure Azure Firewall to stream to Event Hub and run Azure Firewall monitor<a href="#configure-azure-firewall-to-stream-to-event-hub-and-run-azure-firewall-monitor" class="hash-link" aria-label="Direct link to Configure Azure Firewall to stream to Event Hub and run Azure Firewall monitor" title="Direct link to Configure Azure Firewall to stream to Event Hub and run Azure Firewall monitor">​</a></h4>
<p>Now that we have an Event Hub configured and a Shared access policy set to Listen - it&#x27;s time to configure the Azure Firewall to direct logs to the Namespace.</p>
</li>
<li>
<p>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Azure Portal"><strong>Azure Portal</strong></a></p>
</li>
<li>
<p>Navigate to your <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FazureFirewalls" target="_blank" rel="noopener noreferrer" title="Firewalls"><strong>Azure Firewall</strong></a></p>
</li>
<li>
<p>Select <strong>Diagnostic Settings</strong></p>
</li>
<li>
<p>Click <strong>+ Add diagnostic setting</strong></p>
</li>
<li>
<p><img loading="lazy" alt="Azure Firewall - Diagnostic Settings" src="/assets/images/azure_azfirewall_create_diagsettings-392fac216bbd70568dc3e5616013a2f4.png" title="Azure Firewall - Diagnostic Settings" width="1300" height="676" class="img_ev3q"></p>
</li>
<li>
<p>Type in a Diagnostic setting name <em>(i.e. AzureFirewallMonitor)</em></p>
</li>
<li>
<p>Select <strong>All Logs</strong></p>
</li>
<li>
<p>Select <strong>Stream to an event hub</strong></p>
</li>
<li>
<p>Select your subscription, event hub namespace, event hub and policy created earlier.</p>
</li>
<li>
<p><img loading="lazy" alt="Azure Firewall - Diagnostic setting" src="/assets/images/azure_azfirewall_configure_diagsettings-750b70e33b8cb744ffe625adc16a1793.png" title="Azure Firewall - Configure Diagnostic setting" width="1208" height="724" class="img_ev3q"></p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>Please navigate back to your <strong>Event Hub</strong> namespace and select your <strong>Event Hub entity</strong>; now, we need to create a Shared access policy to <strong>Listen</strong> <em>(for the entity, not the Namespace)</em></p>
</li>
<li>
<p>Click Shared access policies, and create a new Shared access policy with <strong>Listen.</strong></p>
</li>
<li>
<p>Copy the <strong>Connection string-primary key</strong></p>
</li>
<li>
<p><strong>Navigate</strong> to your newly created <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2FStaticSites" target="_blank" rel="noopener noreferrer" title="Static Web Apps"><strong>Azure Static App</strong></a> in the Azure Portal</p>
</li>
<li>
<p>Click <strong>Browse</strong></p>
</li>
<li>
<p>You should now see <strong>azure-firewall-mon</strong>, and enter in the <strong>Connection string-primary key copied</strong> earlier!</p>
</li>
<li>
<p><strong>Congratulations you have now set up Azure Firewall Monitor on an Azure Static Web App and can troubleshoot your Azure Firewall quickly in real-time!</strong></p>
</li>
<li>
<p><img loading="lazy" alt="Run Azure Firewall Monitor" src="/assets/images/run_azstaticwebapp_portal_azfw-mon-4fc7782c49343576059701ddcc7ee8e4.gif" title="Run Azure Firewall Monitor" width="1522" height="873" class="img_ev3q"></p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-github-action"><strong>References: GitHub Action</strong><a href="#references-github-action" class="hash-link" aria-label="Direct link to references-github-action" title="Direct link to references-github-action">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">name: Azure Static Web Apps CI/CD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">on:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  push:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    branches:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  pull_request:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    types: [opened, synchronize, reopened, closed]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    branches:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  build_and_deploy_job:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if: github.event_name == &#x27;push&#x27; || (github.event_name == &#x27;pull_request&#x27; &amp;&amp; github.event.action != &#x27;closed&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    runs-on: ubuntu-latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name: Build and Deploy Job</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    steps:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - uses: actions/checkout@v2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        with:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          submodules: true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - uses: actions/setup-node@v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        with:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          node-version: &quot;18.x&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - name: Build And Deploy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        id: builddeploy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        uses: Azure/static-web-apps-deploy@v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        with:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_POLITE_CLIFF_06D4C2810 }}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          repo_token: ${{ secrets.GITHUB_TOKEN }} # Used for Github integrations (i.e. PR comments)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          action: &quot;upload&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          ###### Repository/Build Configurations - These values can be configured to match your app requirements. ######</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          # For more information regarding Static Web App workflow configurations, please visit: https://aka.ms/swaworkflowconfig</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          app_location: &quot;/firewall-mon-app/&quot; # App source code path</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          api_location: &quot;&quot; # Api source code path - optional</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          output_location: &quot;dist/firewall-mon-app&quot; # Built app content directory - optional</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          ###### End of Repository/Build Configurations ######</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  close_pull_request_job:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if: github.event_name == &#x27;pull_request&#x27; &amp;&amp; github.event.action == &#x27;closed&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    runs-on: ubuntu-latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name: Close Pull Request Job</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    steps:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - name: Close Pull Request</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        id: closepullrequest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        uses: Azure/static-web-apps-deploy@v1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        with:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_POLITE_CLIFF_06D4C2810 }}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          action: &quot;close&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="references-azure-bicep"><strong>References: Azure Bicep</strong><a href="#references-azure-bicep" class="hash-link" aria-label="Direct link to references-azure-bicep" title="Direct link to references-azure-bicep">​</a></h4>
<p>Below are some Azure Bicep references:</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="azure-static-web-app">Azure Static Web App<a href="#azure-static-web-app" class="hash-link" aria-label="Direct link to Azure Static Web App" title="Direct link to Azure Static Web App">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">param staticSites_AzFw_Mon_name string = &#x27;AzFw-Mon&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource staticSites_AzFw_Mon_name_resource &#x27;Microsoft.Web/staticSites@2022-03-01&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: staticSites_AzFw_Mon_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: &#x27;Central US&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sku: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name: &#x27;Free&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tier: &#x27;Free&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    repositoryUrl: &#x27;https://github.com/lukemurraynz/azure-firewall-mon&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    branch: &#x27;main&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    stagingEnvironmentPolicy: &#x27;Enabled&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    allowConfigFileUpdates: true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    provider: &#x27;GitHub&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    enterpriseGradeCdnStatus: &#x27;Disabled&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="event-hub">Event Hub<a href="#event-hub" class="hash-link" aria-label="Direct link to Event Hub" title="Direct link to Event Hub">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">param namespaces_AzFirewallMonitor_name string = &#x27;AzFirewallMonitor&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">param location string = resourceGroup().location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource namespaces_AzFirewallMonitor_name_resource &#x27;Microsoft.EventHub/namespaces@2022-01-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: namespaces_AzFirewallMonitor_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: &#x27;Australia East&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sku: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name: &#x27;Basic&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tier: &#x27;Basic&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    capacity: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    minimumTlsVersion: &#x27;1.2&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    publicNetworkAccess: &#x27;Enabled&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    disableLocalAuth: false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    zoneRedundant: true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    isAutoInflateEnabled: false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    maximumThroughputUnits: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    kafkaEnabled: false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource namespaces_AzFirewallMonitor_name_AzMonitorListner &#x27;Microsoft.EventHub/namespaces/authorizationrules@2022-01-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  parent: namespaces_AzFirewallMonitor_name_resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: &#x27;AzMonitorListner&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rights: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;Listen&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;Send&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource namespaces_AzFirewallMonitor_name_azmonitorcapture &#x27;Microsoft.EventHub/namespaces/eventhubs@2022-01-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  parent: namespaces_AzFirewallMonitor_name_resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: &#x27;azmonitorcapture&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    messageRetentionInDays: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    partitionCount: 2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    status: &#x27;Active&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource namespaces_AzFirewallMonitor_name_default &#x27;Microsoft.EventHub/namespaces/networkRuleSets@2022-01-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  parent: namespaces_AzFirewallMonitor_name_resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: &#x27;default&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    publicNetworkAccess: &#x27;Enabled&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    defaultAction: &#x27;Allow&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    virtualNetworkRules: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ipRules: []</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource namespaces_AzFirewallMonitor_name_azmonitorcapture_AzMonitor &#x27;Microsoft.EventHub/namespaces/eventhubs/authorizationrules@2022-01-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  parent: namespaces_AzFirewallMonitor_name_azmonitorcapture</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: &#x27;AzMonitor&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rights: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &#x27;Listen&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dependsOn: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    namespaces_AzFirewallMonitor_name_resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource namespaces_AzFirewallMonitor_name_azmonitorcapture_Default &#x27;Microsoft.EventHub/namespaces/eventhubs/consumergroups@2022-01-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  parent: namespaces_AzFirewallMonitor_name_azmonitorcapture</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: &#x27;$Default&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  dependsOn: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    namespaces_AzFirewallMonitor_name_resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/page/8/"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/page/10/"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
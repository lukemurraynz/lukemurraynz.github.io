<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/page/23/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz"><meta data-rh="true" name="description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" property="og:description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/page/23/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/23/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/23/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://luke.geek.nz/page/23","mainEntityOfPage":"https://luke.geek.nz/page/23","headline":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!","description":"Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!","blogPost":[{"@type":"BlogPosting","@id":"https://luke.geek.nz/2022/08/17/connect-to-azure-sql-database-in-a-jupyter-notebook-using-python","mainEntityOfPage":"https://luke.geek.nz/2022/08/17/connect-to-azure-sql-database-in-a-jupyter-notebook-using-python","url":"https://luke.geek.nz/2022/08/17/connect-to-azure-sql-database-in-a-jupyter-notebook-using-python","headline":"Connect to Azure SQL Database in a Jupyter Notebook using Python","name":"Connect to Azure SQL Database in a Jupyter Notebook using Python","description":"Jupyter Notebooks, commonly used by Data Scientists and Students, allow you to run code, such as Python and PowerShell, inside a Notebook format and display the output inside the notebook; this is useful for teaching a subject or displaying up-to-date information.","datePublished":"2022-08-17T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2022/08/09/create-a-public-holidays-api-using-microsoft-azure","mainEntityOfPage":"https://luke.geek.nz/2022/08/09/create-a-public-holidays-api-using-microsoft-azure","url":"https://luke.geek.nz/2022/08/09/create-a-public-holidays-api-using-microsoft-azure","headline":"Create a Public Holidays API using Microsoft Azure","name":"Create a Public Holidays API using Microsoft Azure","description":"Using a previous blog post I did on using a third-party API (Application Programming Interface) to start a Virtual Machine when it wasn't a Public Holiday, I had a thought on what could be an option if I wanted an API only accessible on an internal network or if I wanted to include custom Holidays such as Star Wars day or company holidays? Could I create and query my API using Microsoft Azure services? You can!","datePublished":"2022-08-09T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/microsoft-azure-zonalallocationfailed","mainEntityOfPage":"https://luke.geek.nz/azure/microsoft-azure-zonalallocationfailed","url":"https://luke.geek.nz/azure/microsoft-azure-zonalallocationfailed","headline":"Microsoft Azure - ZonalAllocationFailed","name":"Microsoft Azure - ZonalAllocationFailed","description":"Error code: AllocationFailed or ZonalAllocationFailed","datePublished":"2022-07-27T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/azure-virtual-machine-and-mac-address-software-licensing","mainEntityOfPage":"https://luke.geek.nz/azure/azure-virtual-machine-and-mac-address-software-licensing","url":"https://luke.geek.nz/azure/azure-virtual-machine-and-mac-address-software-licensing","headline":"Azure Virtual Machine and a custom MAC address","name":"Azure Virtual Machine and a custom MAC address","description":"You may need an Azure Virtual Machine to install or license software bound to a media access control address (MAC address).","datePublished":"2022-07-19T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/deploy-azure-naming-tool-into-an-azure-webapp-as-a-container","mainEntityOfPage":"https://luke.geek.nz/azure/deploy-azure-naming-tool-into-an-azure-webapp-as-a-container","url":"https://luke.geek.nz/azure/deploy-azure-naming-tool-into-an-azure-webapp-as-a-container","headline":"Deploy Azure Naming Tool into an Azure WebApp as a container","name":"Deploy Azure Naming Tool into an Azure WebApp as a container","description":"Organising your cloud workloads to support governance, operational management, and accounting requirements can take a lot of effort before the first resource is created.","datePublished":"2022-07-11T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.a8967c60.css">
<script src="/assets/js/runtime~main.125db85c.js" defer="defer"></script>
<script src="/assets/js/main.3f806bba.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, make sure you sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/sftp-event-hub-function/">Processing SFTP Events with Azure Function and Event Hub</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/mcp-acs-email-integration/">Sending Emails with MCP and Azure Communication Services</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/business-critical-workloads/">Understanding Workload Criticality in the Cloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/github-codespaces-azure-devops-repo/">How to Use GitHub Codespaces with Azure DevOps Repositories</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azure-landing-zone-accelerator/">Deploying Azure Landing Zones with the Terraform Accelerator</a></li></ul></div></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2022/08/17/connect-to-azure-sql-database-in-a-jupyter-notebook-using-python/">Connect to Azure SQL Database in a Jupyter Notebook using Python</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-08-17T00:00:00.000Z">August 17, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p><a href="https://jupyter.org/" target="_blank" rel="noopener noreferrer" title="Jupyter">Jupyter</a> Notebooks, commonly used by Data Scientists and Students, allow you to run code, such as Python and PowerShell, inside a Notebook format and display the output inside the notebook; this is useful for teaching a subject or displaying up-to-date information.</p>
<p>I am not a python or Jupyter expert, so this article will be brief on how I was able to connect to an Azure SQL Database using Microsoft Entra ID authentication and run a query.</p>
<p>To run a Jupyter Notebook, you can install <a href="https://www.anaconda.com/products/distribution" target="_blank" rel="noopener noreferrer" title="Anaconda">Anaconda</a> and then use that to download Juypter to run the notebooks from a locally <em>(or server)</em> hosted web-based interface.</p>
<p>However, today I will be using Visual Studio Code with the <a href="https://code.visualstudio.com/docs/datascience/jupyter-notebooks" target="_blank" rel="noopener noreferrer" title=" Jupyter Notebooks in VS Code ">Jupyter extension</a> on a windows endpoint.</p>
<p>Make sure you install:</p>
<ul>
<li><a href="https://www.python.org/downloads/" target="_blank" rel="noopener noreferrer" title="Python">Python</a></li>
<li><a href="https://pypi.org/project/pyodbc/" target="_blank" rel="noopener noreferrer" title="pyodbc ">pyodbc</a> library</li>
<li><a href="https://learn.microsoft.com/en-us/sql/connect/odbc/microsoft-odbc-driver-for-sql-server" target="_blank" rel="noopener noreferrer" title="Microsoft ODBC Driver for SQL Server">Microsoft ODBC Driver for SQL Server</a> <em>(has to be v17 or newer to support Microsoft Entra ID authentication)</em>.</li>
<li><a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer" title="Visual Studio Code">Visual Studio Code</a> + <a href="https://code.visualstudio.com/docs/datascience/jupyter-notebooks" target="_blank" rel="noopener noreferrer" title=" Jupyter Notebooks in VS Code">Jupyter extension</a></li>
</ul>
<p><em>Note: Jupyter notebook extensions end in &#x27;*.ipynb&#x27;.</em></p>
<p>Once all the prerequisites are installed, it&#x27;s time to create the Notebook.</p>
<ol>
<li>
<p>Open <strong>Visual Studio Code</strong></p>
</li>
<li>
<p>Click <strong>File</strong>, <strong>New File</strong></p>
</li>
<li>
<p>Select <strong>Jupyter Notebook</strong></p>
</li>
<li>
<p>Press <strong>+ Code</strong> <em>(to add a Code snippet)</em></p>
</li>
<li>
<p>First, we need to import the pyodbc library:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Libraries</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import pyodbc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>Then we need to <strong>add the snippet to connect to the SQL database</strong> <em>(this can be in a separate Codeblock or the same code block, as long as the import is run before the SQL connection is made - <strong>make sure you update the server and database variables,</strong> to match your environment!)</em>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Connection to SQL database</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server = &#x27;tcp:SQLSERVER.database.windows.net&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">database = &#x27;DBNAME&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">username = &#x27;user@contoso.com&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">password = &#x27;password&#x27; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">connection = pyodbc.connect(&#x27;Driver={ODBC Driver 18 for SQL Server};Server=&#x27;+server+&#x27;,1433;Database=&#x27;+database+&#x27;;Uid=&#x27;+username+&#x27;;Pwd=&#x27;+password+&#x27;;Encrypt=yes;TrustServerCertificate=no;Connection Timeout=180;Authentication=ActiveDirectoryInteractive&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor = connection.cursor()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The &#x27;Authentication=ActiveDirectoryInteractive&#x27; parameter as part of the Connection string will prompt an interactive Microsoft Entra ID prompt to display and ask for credentials to be logged in; this includes MFA support. Using this method, the username and password variables are simply placeholders.</p>
<p>If you want to hardcode credentials into the Notebook <em>(not recommended)</em>, you can remove the &#x27;<em>Authentication=ActiveDirectoryInteractive</em>&#x27; section and enter the credentials into the username and password field.</p>
<p>Now that we have connected to the database, let us <strong>run a test query to obtain the SQL version</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Sample select query</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cursor.execute(&quot;SELECT @@version;&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">row = cursor.fetchone()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">while row:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">print(row[0])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">row = cursor.fetchone()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Jupyter python SQL connection" src="/assets/images/juptyer_notebook_query-2725747992751ea8ac1afcb105f1c3b1.png" width="1326" height="545" class="img_ev3q"></p>
<p>Congratulations, you have successfully connected to an Azure SQL database and ran a query against the database.</p>
<p>If the connection to SQL appears to be stalling, check to make sure the Azure authentication window, isn&#x27;t hidden behind another window.</p>
<p><em>A</em> <a href="https://gist.github.com/lukemurraynz/6636632309bc2bf2b1b37676ee0881ce" target="_blank" rel="noopener noreferrer" title="python.sqldb.text"><em>GIST</em></a> <em>has been created, with the code as well, in case issues are copied from the website.</em></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2022/08/09/create-a-public-holidays-api-using-microsoft-azure/">Create a Public Holidays API using Microsoft Azure</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-08-09T00:00:00.000Z">August 9, 2022</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Using a previous <a href="https://luke.geek.nz/azure/turn-on-a-azure-virtual-machine-using-azure-automation/" target="_blank" rel="noopener noreferrer" title="Turn on a Azure Virtual Machine using Azure Automation">blog post</a> I did on using a third-party API <em>(Application Programming Interface)</em> to start a Virtual Machine when it wasn&#x27;t a Public Holiday, I had a thought on what could be an option if I wanted an API only accessible on an internal network or if I wanted to include custom Holidays such as Star Wars day or company holidays? Could I create and query my API using Microsoft Azure services? You can!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<blockquote>
<p>Today we will create a base Public Holidays API using several Microsoft Azure serverless services, such as Azure Function, Azure Storage Account and API Management.</p>
</blockquote>
<p><em>Note: As this is a demonstration, I will be using a</em> <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-scale?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Functions hosting options"><em>Consumption-based Azure Function</em></a> <em>and Azure storage account, and although it is a good place to start - depending on your requirements, you may be better off with Azure Function Premium Plan to avoid cold-start times, and if you need a high amount of requests and writes (GET and POSTs) and resiliency, then replace the Storage account table with a</em> <a href="https://learn.microsoft.com/en-us/azure/cosmos-db/introduction?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Cosmos DB"><em>Cosmos DB</em></a><em>.</em></p>
<p>The solution will be made up of the following:</p>















































<table><thead><tr><th>Azure Service</th><th>Name</th><th>Plan</th><th>Note</th></tr></thead><tbody><tr><td>Application Insights</td><td>ai-nzPublicHolidays-prd-ae</td><td></td><td></td></tr><tr><td>Azure API Management</td><td>apims-publicholidays-prd-ae</td><td>Developer (No SLA)</td><td></td></tr><tr><td>Azure Function</td><td>func-nzpublicHolidays-prd-ae</td><td>Function App - Consumption</td><td></td></tr><tr><td>Azure Storage Account</td><td>funcnzpublicholidaystgac</td><td>StorageV2 (general purpose v2) - Locally-redundant storage (LRS)</td><td>Contains &#x27;PublicHolidays&#x27; table</td></tr><tr><td>Azure Storage Account</td><td>rgnzpublicholidayspb4ed</td><td>Storage (general purpose v1)  - Locally-redundant storage (LRS)</td><td>Contains Azure Functions App Files</td></tr><tr><td>Resource Group</td><td>rg-publicholidays-prd-ae</td><td></td><td>Resource Group - containing above resources.</td></tr></tbody></table>
<p><img decoding="async" loading="lazy" alt="Azure Resource Group - Diagram" src="/assets/images/api_resourcegroupazviz-6b750e49b76e6fbbc15caf8db97c3dac.png" title="Azure Resource Group - Diagram" width="2805" height="300" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites">Pre-requisites<a href="#pre-requisites" class="hash-link" aria-label="Direct link to Pre-requisites" title="Direct link to Pre-requisites">​</a></h4>
<ul>
<li>An Azure subscription <em>(with at least Contributor rights to a Resource Group)</em>.</li>
<li>Azure PowerShell modules <em>(</em><a href="https://learn.microsoft.com/en-us/powershell/module/az.accounts/?view=azps-8.2.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Az.Accounts"><em>Az.Accounts</em></a><em>,</em> <a href="https://learn.microsoft.com/en-us/powershell/module/az.storage/?view=azps-8.2.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Az.Storage"><em>Az.Storage</em></a> <em>&amp;</em> <a href="https://www.powershellgallery.com/packages/AzTable/" target="_blank" rel="noopener noreferrer" title="AzTable"><em>AzTables</em></a><em>)</em></li>
</ul>
<p><em>Note: AzTables is not part of the standard Az PowerShell module set and is a separate module you will need to install (Install-Module AzTables).</em></p>
<p>We will use a mix of the Azure Portal and PowerShell to deploy this solution from start to finish; you can find the source data and code directly in the GitHub repository here: <a href="https://github.com/lukemurraynz/PublicHoliday-API" target="_blank" rel="noopener noreferrer" title="PublicHoliday-API">lukemurraynz/PublicHoliday-API</a> for reference <em>(feel free to fork, raise pull requests etc.).</em> In this guide, I will try not to assume preexisting knowledge <em>(other than general Azure and PowerShell knowledge)</em>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h3>
<p>The deployment steps will be separated into different sections to help simplify implementation.</p>
<blockquote>
<p>First, make sure you adjust the names of your resources and locations to suit your naming conventions and regional locations <em>(such as Australia East or West Europe)</em>. Your deployments may fail if a name is already in use. See &quot;<a href="https://luke.geek.nz/azure/microsoft-azure-naming-conventions/" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Naming Conventions ">Microsoft Azure Naming Conventions</a>&quot; for more about Naming conventions.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-resource-group">Create Resource Group<a href="#create-resource-group" class="hash-link" aria-label="Direct link to Create Resource Group" title="Direct link to Create Resource Group">​</a></h4>
<p>The Resource Group will contain all resources related to the API that we will deploy today.</p>
<p><em>However, I recommend you consider what resources might be shared outside of this API - such as API Management, and put them in a separate Shared or Common Resource Group, to keep the li.e.ecycle of your resources together (ie API resources all in one place, so if it gets decommissioned, it is as easy a deleting the Resource Group).</em></p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click <strong>Click on the burger and click</strong> <a href="https://portal.azure.com/#view/HubsExtension/BrowseResourceGroups" target="_blank" rel="noopener noreferrer" title="Resource Groups"><strong>Resource groups</strong></a></li>
<li>Click <strong>+ Create</strong></li>
<li>Select your <strong>Subscription</strong></li>
<li>Type in a name for your <strong>Resource Group</strong> <em>(like &#x27;rg-publicholidays-prd-ae&#x27;)</em></li>
<li>Select your <strong>Region</strong> and click <strong>Next: Tags</strong></li>
<li>Enter in applicable <strong>tags</strong> <em>(i.e. Application: Public Holidays API)</em></li>
<li>Click <strong>Next: Review + create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create a resource group" src="/assets/images/azureportal_creatergapi-e4b9ec363fbcf561a94e95c818b36b5e.png" title="Create a resource group" width="736" height="374" class="img_ev3q"></p>
<p>If you prefer PowerShell, you can deploy a new Resource Group with the below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzResourceGroup -Name &#x27;rg-publicholidays-prd-ae&#x27; -Location &#x27;Australia East&#x27; -Tag @{Application=&quot;Public Holidays API&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-storage-account">Create Storage Account<a href="#create-storage-account" class="hash-link" aria-label="Direct link to Create Storage Account" title="Direct link to Create Storage Account">​</a></h4>
<p>Now that the Resource Group has been created, it&#x27;s time to import our Storage Account - which will hold our Table of data around Public Holidays.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click <strong>Click on the burger and click</strong> <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Storage%2FStorageAccounts" target="_blank" rel="noopener noreferrer" title="Storage accounts"><strong>Storage Accounts</strong></a></li>
<li>Click <strong>+ Create</strong></li>
<li>Select the <strong>Subscription</strong> and <strong>Resource Group</strong> you created earlier</li>
<li>Enter in a <strong>Name</strong> for your <strong>Storage Account</strong> (<em>like &#x27;funcnzpublicholidaystgac&#x27;)</em></li>
<li>Select your <strong>Region</strong> <em>(i.e. Australia East)</em></li>
<li>For <strong>Performance</strong>, I am going to select: <strong>Standard</strong></li>
<li>For <strong>Redundancy</strong>, as this is a demo, I will select <strong>Locally-redundant storage (LRS). However, if</strong> you plan on running this in production, you may consider ZRS for zone redundancy.</li>
<li>If you plan on locking down the Storage Account to your Virtual Network or specific IP addresses, continue to the Networking Tab; we can accept the defaults and click: <strong>Review</strong>.</li>
<li>Click <strong>Create</strong></li>
</ol>
<p>If you prefer PowerShell, you can deploy a new Storage account with the below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzStorageAccount -ResourceGroupName &#x27;rg-publicholidays-prd-ae&#x27; -Name &#x27;funcnzpublicholidaystgac&#x27; -Location &#x27;Australia East&#x27; -SkuName &#x27;Standard_LRS&#x27; -Kind StorageV2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="import-public-holiday-data">Import Public Holiday data<a href="#import-public-holiday-data" class="hash-link" aria-label="Direct link to Import Public Holiday data" title="Direct link to Import Public Holiday data">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-storage-account-table">Create Azure Storage Account Table<a href="#create-azure-storage-account-table" class="hash-link" aria-label="Direct link to Create Azure Storage Account Table" title="Direct link to Create Azure Storage Account Table">​</a></h5>
<p>Now that we have the Storage account that will hold our Public Holiday time to import the data.</p>
<p>Most of this task will be done with PowerShell, but first, we need to create the Table that will hold our Public Holidays.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click <strong>Click on the burger and click</strong> <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Storage%2FStorageAccounts" target="_blank" rel="noopener noreferrer" title="Storage accounts"><strong>Storage Accounts</strong></a></li>
<li><strong>Navigate</strong> to your created <strong>Storage</strong> account</li>
<li>In the Navigation blade, click <strong>Tables</strong></li>
<li>Click <strong>+ Table</strong></li>
<li>For a Table Name, I will go with <strong>PublicHolidays</strong></li>
<li>Click <strong>Ok</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create Azure Storage Account Table" src="/assets/images/azureportal_createpublicholidaystable-17900c7b03aa308022d2d7418c793f5a.png" title="Create Azure Storage Account Table" width="753" height="521" class="img_ev3q"></p>
<p>You can use PowerShell to create the Table below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageAccount = Get-AzStorageAccount -ResourceGroupName &#x27;rg-publicholidays-prd-ae&#x27; -Name &#x27;funcnzpublicholidaystgac&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageContext = $storageAccount.Context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzStorageTable -Name &#x27;PublicHolidays&#x27; -Context $storageContext</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="import-public-holiday-data-into-table">Import Public Holiday Data into Table<a href="#import-public-holiday-data-into-table" class="hash-link" aria-label="Direct link to Import Public Holiday Data into Table" title="Direct link to Import Public Holiday Data into Table">​</a></h5>
<p>Now that we have the Azure storage account and PublicHolidays table, it&#x27;s time to import the data.</p>
<p>If you want to do this manually, the Azure Table will have the following columns:</p>
<p>| Date | Country | Type | Name | Day | Year | Comments |</p>
<p>We could enter the data manually, but I will leverage the Nager API to download and parse a CSV file for a few countries. You can find the source data and code directly in the GitHub repository here: <a href="https://github.com/lukemurraynz/PublicHoliday-API" target="_blank" rel="noopener noreferrer" title="PublicHoliday-API">lukemurraynz/PublicHoliday-API</a> for reference.</p>
<p>To do this, we will need PowerShell, so assuming you have logged into PowerShell and set the context to your Azure subscription, let us continue.</p>
<p>I have created a CSV <em>(Comma-separated values)</em> file with a list of countries <em>(i.e. US, NZ, AU)</em> called &#x27;SourceTimeDate.CSV&#x27;, but you can adjust this to suit your requirements and place it in a folder on my C:\ drive called: Temp\API.</p>
<p>Open <strong>PowerShell</strong> and <strong>run</strong> the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Folder = &#x27;C:\Temp\API\&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Csv = Import-csv &quot;$Folder\DateTimeSource\SourceTimeDate.csv&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$CurrentYear = (Get-Date).Year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ForEach ($Country in $Csv)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$CountryCode = $Country.Country</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Invoke-WebRequest -Uri &quot;https://date.nager.at/PublicHoliday/Country/$CountryCode/$CurrentYear/CSV&quot; -OutFile &quot;$FolderAPI\DateTimeSource\Country$CountryCode$CurrentYear.csv&quot; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These cmdlets will download a bunch of CSV files into the API folder, with the Public Holidays for each Country for this year, and then you can adjust the $CurrentYear variable for future years <em>(i.e. 2025)</em>.</p>
<p>Once you have all the CSV files for your Public Holidays and before we import the data into the Azure storage table, now is the time to create a new Custom Holidays CSV; you can easily use an existing one to create a new CSV containing your company&#x27;s public holidays or other days that may be missing from the standard list, make sure it matches the correct format and save it into the same folder.</p>
<p><img decoding="async" loading="lazy" alt="Custom Public Holidays API" src="/assets/images/customholidays_api-e3feccfea6b230e5b5caea2b070d43e5.png" title="Custom Public Holidays API" width="723" height="159" class="img_ev3q"></p>
<p>Now that you have all your CSV files containing the Public Holidays in your Country or countries, it&#x27;s time to import them into the Azure Table. First, we import the data using a PowerShell session logged into Azure.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Imports Public Holiday into Azure Storage table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Requires AzTable Module (not part of the normal Az cmdlets)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Import-Module AzTable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Imports data from CSV files into $GLobalHolidays variable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$Folder = &#x27;C:\Temp\API\&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$GlobalHolidays = Get-ChildItem &quot;$Folder\DateTimeSource\*.csv&quot; | Foreach-Object {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $basename = $_.BaseName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  import-csv $_ </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Connect-AzAccount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Connects to Azure Storage Account</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageAccountName = &#x27;funcnzpublicholidaystgac&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$resourceGroupName = &#x27;rg-publicHolidays-prd-ae&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$tableName = &#x27;PublicHolidays&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageAccount = Get-AzStorageAccount -ResourceGroupName $resourceGroupName -Name $storageAccountName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageContext = $storageAccount.Context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$cloudTable = (Get-AzStorageTable -Name $tableName -Context $storageContext).CloudTable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Imports CSV data into Azure Table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$counter = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ForEach ($Holiday in $GlobalHolidays)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $Date = [DateTime]($Holiday.Date)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $Dayofweek = $Date.DayOfWeek | Out-String</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $Year = $Date.Year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $HolidayDate = Get-Date $Date -format &quot;dd-MM-yyyy&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Add-AzTableRow `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -table $cloudTable `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -partitionKey &#x27;1&#x27; `</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -rowKey ((++$counter)) -property @{&quot;Date&quot;=$HolidayDate;&quot;Country&quot;=$Holiday.CountryCode;&quot;Type&quot;=$Holiday.Type;&quot;Name&quot;=$Holiday.LocalName;&quot;Day&quot;=$Dayofweek;&quot;Year&quot;=$Year;&quot;Comments&quot;=$Holiday.Counties}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Validate the data in the Storage table</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-AzTableRow -table $cloudTable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Import CSV to Azure Storage Account" src="/assets/images/import-csvtoazuretables-8d10f55cd0b8a8e8297b959aa7ae3cd5.gif" title="Import CSV to Azure Storage Account" width="1203" height="361" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Validate Azure Storage Account Table" src="/assets/images/import-csvtoazuretablesvalidate-0615d15e07b7cab4343607aa29e118e6.gif" title="Validate Azure Storage Account Table" width="1203" height="361" class="img_ev3q"></p>
<p>Now the Public Holidays are imported into the Azure storage account table with additional information, such as the Day it falls, and the Date format has been changed to suit the NZ format <em>(DD-MM-YYYY)</em>.</p>
<p>If we log in to the Azure Portal, navigate to the Storage account and under Storage Browser, we can now see our Table is full of Public Holidays.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/azureportal_storagebrowser_api_table-4ed54d2629d3d74f3d5221901f6bd6d9.png" width="2109" height="965" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-api">Create API<a href="#create-api" class="hash-link" aria-label="Direct link to Create API" title="Direct link to Create API">​</a></h4>
<p>That we have our Table with Public Holiday data, it&#x27;s time to create our Azure Function to act as the API that will talk to the azure storage account!</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-function">Create Azure Function<a href="#create-azure-function" class="hash-link" aria-label="Direct link to Create Azure Function" title="Direct link to Create Azure Function">​</a></h5>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click <strong>Click on the burger and click</strong> <a href="https://portal.azure.com/#view/HubsExtension/BrowseResourceGroups" target="_blank" rel="noopener noreferrer" title="Resource groups"><strong>Resource groups</strong></a></li>
<li>Navigate to your <strong>resource group</strong> and click <strong>+ Create</strong></li>
<li>Search for: <strong>Function</strong></li>
<li>Select <strong>Function App</strong>, and click <strong>Create</strong></li>
<li>Enter your <strong>Function App Name</strong> <em>(i.e. &#x27;func-nzpublicHolidays-prd-ae&#x27;)</em></li>
<li>For Runtime Stack, select <strong>PowerShell Core</strong></li>
<li>Select the latest version (at this time, it&#x27;s <strong>7.2</strong>)</li>
<li>Select your <strong>Region</strong></li>
<li>Select <strong>Windows</strong></li>
<li>Set your <strong>Plan</strong> <em>(in my example, its Consumption (Serverless))</em></li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure Function - Create" src="/assets/images/azureportal_createazfunctionapiwin-ef7a4566a3c9cf027bafa17f95362cdb.png" title="Azure Function - Create" width="738" height="782" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-environment-variables">Configure Environment Variables<a href="#configure-environment-variables" class="hash-link" aria-label="Direct link to Configure Environment Variables" title="Direct link to Configure Environment Variables">​</a></h5>
<p>Now that the Function App has been created before creating the GetPublicHoliday function, we need to add a few environment variables that the Function will use; these variables will contain the ResourceGroup and Storage account name.</p>
<ol>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>Click <strong>Configuration</strong></li>
<li>Click <strong>+ New application setting</strong></li>
<li>Under the name, add: <strong>PublicHolidayRESOURCEGROUPNAME</strong></li>
<li>For value, type in the name of your resource group.</li>
<li>Add a second application setting named: <strong>PublicHolidaySTORAGEACCNAME</strong></li>
<li>For value, type in the name of your storage account that contains the Public Holiday table.</li>
<li>Click <strong>Save</strong> <em>(to save the variables)</em>.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure Function - Variables" src="/assets/images/azureportal_funcapp_api_variables-1cd7cf230579d1c83511b45531fa3f14.png" title="Azure Function - Variables" width="1318" height="672" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-managed-identity">Configure Managed Identity<a href="#configure-managed-identity" class="hash-link" aria-label="Direct link to Configure Managed Identity" title="Direct link to Configure Managed Identity">​</a></h5>
<p>Next, we need to give the Function App the ability to read the Azure storage account. To do this, we need to configure a System assigned managed identity.</p>
<ol>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>Click <strong>Identity</strong></li>
<li>Under the System assigned heading, toggle the status to <strong>On</strong></li>
<li>Click <strong>Save</strong></li>
<li>Select <strong>Yes</strong>, to enable the System assigned managed identity</li>
<li>Under Permissions, click <strong>Azure role assignments</strong></li>
<li>Click <strong>+ Add role assignment</strong></li>
<li>For Scope, select <strong>Storage</strong></li>
<li>Select your Subscription and storage account containing your Public Holiday data</li>
<li>For role, select <strong>Contributor</strong> <em>(Storage Table Data Reader is not enough).</em></li>
<li>Click <strong>Save</strong></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-requirements">Configure Requirements<a href="#configure-requirements" class="hash-link" aria-label="Direct link to Configure Requirements" title="Direct link to Configure Requirements">​</a></h5>
<p>The Azure function app will rely on a few PowerShell Modules; for the FunctionApp to load them, we need to add them to the requirements.psd1 file.</p>
<ol>
<li>
<p><strong>Navigate</strong> to your <strong>Azure Function</strong></p>
</li>
<li>
<p>Click <strong>App files</strong></p>
</li>
<li>
<p>Change the dropdown to <strong>requirements.psd1</strong></p>
</li>
<li>
<p>In the hash array, comment out the #Az module line <em>(as this will load the entire Az Module set, which will cause an increased delay in the startup as those extra modules aren&#x27;t needed)</em>, and add the following:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># This file enables modules to be automatically managed by the Functions service.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># See https://aka.ms/functionsmanageddependency for additional information.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # For latest supported version, go to &#x27;https://www.powershellgallery.com/packages/Az&#x27;. </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # To use the Az module in your function app, please uncomment the line below.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    #&#x27;Az&#x27; = &#x27;8.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;Az.Accounts&#x27;  = &#x27;2.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;Az.Storage&#x27;   = &#x27;4.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;Az.Resources&#x27; = &#x27;2.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;AzTable&#x27;      = &#x27;2.*&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-function-publicholidays">Create Function PublicHolidays<a href="#create-function-publicholidays" class="hash-link" aria-label="Direct link to Create Function PublicHolidays" title="Direct link to Create Function PublicHolidays">​</a></h5>
<p>Now that the Function App has been configured, it is time to create our Function.</p>
<ol>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>Click <strong>Functions</strong></li>
<li>Click <strong>+ Create</strong></li>
<li>Change Development environment to <strong>Develop in Portal</strong></li>
<li>Select Template, an <strong>HTTP trigger</strong></li>
<li>For the New Function name, I will go with <strong>GetPublicHoliday</strong></li>
<li>Change Authorization level to <strong>Anonymous</strong> <em>(if you aren&#x27;t going to implement API Management, select Function and look at whitelisting your IP only, we will be locking it down to API Management later)</em>.</li>
<li>Click <strong>Create</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create Azure Function App" src="/assets/images/azureportal_createfunctionpublicholidays-2673e41f9b6d67f4d37da55b13f9de6c.png" title="Create Azure Function App" width="840" height="829" class="img_ev3q"></p>
<ol>
<li>
<p>Click <strong>Code + Test</strong></p>
</li>
<li>
<p>Copy the following Code into the run.ps1 file, this code is core to the Function that will read the HTTP request and bring back a PowerShell object with the Public Holiday information as part of a GET request:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;# The code above does the following, explained in English:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. Read the query parameters from the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. Read the body of the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. Write to the Azure Functions log stream.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. Interact with query parameters or the body of the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5. Associate values to output bindings by calling &#x27;Push-OutputBinding&#x27;. </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://luke.geek.nz/ #&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using namespace System.Net</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Input bindings are passed in via param block.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">param([Parameter(Mandatory = $true)]$Request, [Parameter(Mandatory = $true)]$TriggerMetadata)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Write to the Azure Functions log stream.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Write-Host &#x27;GetPublicHoliday function processed a request.&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Interact with query parameters or the body of the request.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$date = $Request.Query.Date</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$country = $Request.Query.CountryCode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$resourceGroupName = $env:PublicHolidayRESOURCEGROUPNAME</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$storageAccountName = $env:PublicHolidaySTORAGEACCNAME</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$tableName = &#x27;PublicHolidays&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ClientIP = $Request.Headers.&quot;x-forwarded-for&quot;.Split(&quot;:&quot;)[0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">try {   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $storageAccount = Get-AzStorageAccount -ResourceGroupName $resourceGroupName -Name $storageAccountName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $storageContext = $storageAccount.Context</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $cloudTable = (Get-AzStorageTable -Name $tableName -Context $storageContext).CloudTable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Import-Module AzTable   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $Tables = Get-AzTableRow -table $cloudTable </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ForEach ($table in $Tables)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [string]$Filter1 = [Microsoft.Azure.Cosmos.Table.TableQuery]::GenerateFilterCondition(&quot;Country&quot;, [Microsoft.Azure.Cosmos.Table.QueryComparisons]::Equal, $country)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [string]$Filter2 = [Microsoft.Azure.Cosmos.Table.TableQuery]::GenerateFilterCondition(&quot;Date&quot;, [Microsoft.Azure.Cosmos.Table.QueryComparisons]::Equal, $date)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [string]$finalFilter = [Microsoft.Azure.Cosmos.Table.TableQuery]::CombineFilters($Filter1, &quot;and&quot;, $Filter2)     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $object = Get-AzTableRow -table $cloudTable -CustomFilter $finalFilter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $body = @()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $System = New-Object -TypeName PSObject</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name CountryCode -Value   $object.Country</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name HolidayDate -Value   $object.Date</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name HolidayYear -Value   $object.Year</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name HolidayName -Value   $object.Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name HolidayType -Value   $object.Type</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name Comments -Value      $object.Comments</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Add-Member -InputObject $System -MemberType NoteProperty -Name RequestedIP -Value   $ClientIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $body += $System</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $System = New-Object -TypeName PSObject</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    $status = [Net.HttpStatusCode]::OK</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">catch {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $body = &quot;Failure connecting to table for state data, $_&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  $status = [Net.HttpStatusCode]::BadRequest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#$body =  $TriggerMetadata</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Associate values to output bindings by calling Push-OutputBinding&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Push-OutputBinding -Name Response -Value ([HttpResponseContext]@{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    StatusCode = $status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Body       = $body</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="test-function---publicholidays">Test Function - PublicHolidays<a href="#test-function---publicholidays" class="hash-link" aria-label="Direct link to Test Function - PublicHolidays" title="Direct link to Test Function - PublicHolidays">​</a></h5>
<p>Before proceeding with the next step, it&#x27;s time to test the function.</p>
<ol>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>Click <strong>Functions</strong></li>
<li>Click <strong>GetPublicHoliday</strong></li>
<li>Click <strong>Code + Test</strong></li>
<li>Click <strong>Test/Run</strong></li>
<li>Change HTTP method to <strong>Get</strong></li>
<li>Under Query, add Country value and Date value.</li>
</ol>
<p>Note: Make sure the date and country formats match what is in the Azure storage account.</p>
<p>You can also Invoke the function app directly with PowerShell, with the Date and Country as Parameters at the end:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Invoke-RestMethod -URI &quot;https://func-nzpublicholidays-prd-ae.azurewebsites.net/api/GetPublicHoliday?Date=25-12-2023&amp;CountryCode=NZ&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Test Public Holiday API" src="/assets/images/testpublicholidayapi-3b124ddd861072dc80c53f1fee4ffb52.gif" title="Test Public Holiday API" width="1203" height="361" class="img_ev3q"></p>
<p>Congratulations! You have now created a Public Holiday API that you can call for automation! You can lock down the Function App to only certain IPs or proceed to configure Azure API Management.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-azure-api-management">Configure Azure API Management<a href="#configure-azure-api-management" class="hash-link" aria-label="Direct link to Configure Azure API Management" title="Direct link to Configure Azure API Management">​</a></h5>
<p>Now that the Function App responds to requests, we can expose the HTTP endpoint through <a href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Expose serverless APIs from HTTP endpoints using Azure API Management">Azure API Management</a>. Azure API Management will give greater flexibility and security over API endpoints, particularly when dealing with more than one API. Azure API Management also offers inbuilt shared cache functionality and integration into <a href="https://azure.microsoft.com/en-us/services/cache/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" Azure Cache for Redis®2">Azure Cache for Redis</a>.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Portal"><strong>Microsoft Azure Portal</strong></a></li>
<li><strong>Navigate</strong> to your <strong>Azure Function</strong></li>
<li>On the Navigation blade, select <strong>API Management</strong></li>
<li>Click <strong>Create New</strong></li>
<li>Select your subscription, <strong>Region</strong>, and organisation <strong>name</strong>.</li>
<li>Select a <a href="https://azure.microsoft.com/en-us/pricing/details/api-management/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" API Management pricing"><strong>Pricing Tier</strong></a></li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create Azure API Management" src="/assets/images/azureportal_createapimanagement-7cd983b8676b0d28c16984ab9db47cdc.png" width="802" height="790" class="img_ev3q"></p>
<ol>
<li>
<p>Wait for 10 minutes to half an hour for provisioning to take place, and Azure API Management will be in an activating state.</p>
</li>
<li>
<p>Once API Management has been provisioned, you can <strong>copy</strong> the <strong>Virtual IP (VIP)</strong> addresses of API Management and <strong>restrict</strong> your <strong>function</strong> app to <strong>only</strong> allow <strong>inbound</strong> access from that <strong>IP</strong>.</p>
</li>
<li>
<p>Once you have done that, add the GetPublicHoliday function app into Azure API Management, add the paths to add a version, and then, using the subscription key, you run the following command to pull data.</p>
<p>Invoke-RestMethod -uri &quot;<a href="https://apims-nzpublicholidays-prd-ae.azure-api.net/v1/GetPublicHoliday?Date=4/05/2022&amp;CountryCode=NZ&amp;Ocp-Apim-Subscription-Key=$KEY" target="_blank" rel="noopener noreferrer">https://apims-nzpublicholidays-prd-ae.azure-api.net/v1/GetPublicHoliday?Date=4/05/2022&amp;CountryCode=NZ&amp;Ocp-Apim-Subscription-Key=$KEY</a>&quot;</p>
</li>
</ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/microsoft-azure-zonalallocationfailed/">Microsoft Azure - ZonalAllocationFailed</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-27T00:00:00.000Z">July 27, 2022</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><blockquote>
<p><strong>Error code</strong>: AllocationFailed or ZonalAllocationFailed</p>
<p><strong>Error message</strong>: &quot;Allocation failed. We do not have sufficient capacity for the requested VM size in this region. Read more about improving likelihood of allocation success at <a href="https://aka.ms/allocation-guidance?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="https://aka.ms/allocation-guidance">https://aka.ms/allocation-guidance</a>&quot;</p>
</blockquote>
<p>When you create a virtual machine <em>(VM)</em>, start stopped <em>(deallocated)</em> VMs, or resize a VM, Microsoft Azure allocates compute resources to your subscription.</p>
<p><img decoding="async" loading="lazy" alt="ZonalAllocationFailed" src="/assets/images/zonalallocationfailed-d3444d5a5ebfba3d83efb1663e5ca216.png" title="ZonalAllocationFailed" width="831" height="122" class="img_ev3q"></p>
<p>Microsoft is continually investing in additional infrastructure and features to ensure that they always have all VM types available to support customer demand. However, you may occasionally experience resource allocation failures because of unprecedented growth in demand for Azure services in specific regions.</p>
<p>These tips, also apply to the &#x27;Following SKUs have failed for Capacity Restrictions&#x27; error.</p>
<p>This error could also be caused by a parameter issue with your Infrastructure as Code deployments, if you are to restrictive and it attempts to create a resource that isn&#x27;t supported - an example is a SKU that doesn&#x27;t support Accelerated Networking, or an attempt to deploy an Ultra SSD disk for a SKU that doesn&#x27;t deploy it.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="waiting-for-more-compute-to-be-added-to-the-azure-server-clusters-may-not-be-an-option-so-what-can-you-do"><strong>Waiting for more Compute to be added to the Azure server clusters may not be an option, so what can you do?</strong><a href="#waiting-for-more-compute-to-be-added-to-the-azure-server-clusters-may-not-be-an-option-so-what-can-you-do" class="hash-link" aria-label="Direct link to waiting-for-more-compute-to-be-added-to-the-azure-server-clusters-may-not-be-an-option-so-what-can-you-do" title="Direct link to waiting-for-more-compute-to-be-added-to-the-azure-server-clusters-may-not-be-an-option-so-what-can-you-do">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="raise-a-support-case">Raise a Support Case<a href="#raise-a-support-case" class="hash-link" aria-label="Direct link to Raise a Support Case" title="Direct link to Raise a Support Case">​</a></h5>
<ul>
<li>Take a screenshot of the error</li>
<li>Copy the Activity/Deployment ID</li>
<li>Take note of the Region</li>
<li>Take note of the Availability Zone.</li>
</ul>
<p>Let <a href="https://azure.microsoft.com/en-us/support/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" Azure Support">Azure Support</a> know; that Microsoft may already be aware, but raising a support request helps identify potentially impacted customers. If you know of other SKUs you need to deploy, you can let them know.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="purchase-on-demand-capacity-reservation">Purchase On-demand Capacity Reservation<a href="#purchase-on-demand-capacity-reservation" class="hash-link" aria-label="Direct link to Purchase On-demand Capacity Reservation" title="Direct link to Purchase On-demand Capacity Reservation">​</a></h5>
<p><a href="https://learn.microsoft.com/en-us/azure/virtual-machines/capacity-reservation-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="On-demand Capacity Reservation">On-demand Capacity Reservation</a> enables you to reserve Compute capacity in an Azure region or an Availability Zone for any duration of time.</p>
<p>Unlike <a href="https://azure.microsoft.com/en-us/pricing/reserved-vm-instances/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Reserved Instances">Reserved Instances</a>, you do not have to sign up for a 1-year or a 3-year term commitment.</p>
<p>Once the Capacity Reservation is created, the capacity is available immediately and is exclusively reserved for your use until the reservation is deleted.</p>
<p>Capacity Reservations are priced at the same rate as the underlying VM size.</p>
<p>For example, if you create a reservation for the D2s_v3 VMs, you will start getting billed for the D2s_v3 VMs, even if the reservation is not being used.</p>
<p>So why would you purchase On-demand Capacity reservations?</p>
<ul>
<li>You are operating Azure workloads that scale out and run off a fresh image, like a Citrix farm and want to ensure the capacity is available for the minimum workloads you need.</li>
<li>You have a project coming up where you need the capacity to be available.</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="redeploy-to-another-availability-zone">Redeploy to another Availability Zone<a href="#redeploy-to-another-availability-zone" class="hash-link" aria-label="Direct link to Redeploy to another Availability Zone" title="Direct link to Redeploy to another Availability Zone">​</a></h5>
<p>The server cluster that ARM (Azure Resource Manager) attempted to deploy your workload may not have the necessary capacity, but another Availability Zone <em>(datacenter)</em> might.</p>
<p>Make sure your Virtual Machine is not in a Proximtry or Avalibility Group and do the following.</p>
<ol>
<li><strong>Take note of the Availability Zone that your deployment failed</strong> <em>(i.e. Availability Zone 1)</em></li>
<li><strong>Remove any resources</strong> that may have been created as part of the original failed deployment.</li>
<li><strong>Redeploy</strong> your workload and <strong>select</strong> another Availability <strong>Zone</strong>, such as <em>(2 - if your failed deployment was in Zone 1)</em></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="change-the-virtual-machine-version">Change the Virtual Machine version<a href="#change-the-virtual-machine-version" class="hash-link" aria-label="Direct link to Change the Virtual Machine version" title="Direct link to Change the Virtual Machine version">​</a></h5>
<p>By version, I don&#x27;t mean <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/generation-2?WT.mc_id=AZ-MVP-5004796#features-and-capabilities" target="_blank" rel="noopener noreferrer" title="Generation 1 vs. generation 2 features">Generation 1 and Generation 2</a> Virtual Machines; I mean the version of underlying Compute; when you look at a VM SKU size, you will see:</p>
<blockquote>
<p>Standard_DC24s_<strong>v3</strong></p>
<p>[Family] + <em>[Sub-family]</em>* + [# of vCPUs] + <em>[Constrained vCPUs]</em>* + [Additive Features] + <em>[Accelerator Type]</em>* + <strong>[Version]</strong></p>
</blockquote>
<p>You can read more about Virtual Machine Naming conversions &quot;<a href="https://learn.microsoft.com/en-us/azure/virtual-machines/vm-naming-conventions?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure virtual machine sizes naming conventions">here</a>&quot;.</p>
<p>The version of the VM series links to the underlying hardware associated with the Virtual Machine series; with most new hardware releases, the version changes; an example is: from v3 to v4.</p>
<blockquote>
<p>#Tip: Microsoft may run a promotion on the pricing for early adopters from time to time, to move to the new version; they can be seen from the Azure Portal with &quot;Promo&quot; in the name.</p>
</blockquote>
<ol>
<li>You can <strong>change the version of the SKU</strong> by looking in the Azure Portal, <strong>Sizing</strong>, and you should be <strong>select</strong> different <strong>versions</strong> of the same SKU; <em>if you are at v5, try resizing to v4 - or the other way around</em>.</li>
</ol>
<p>Remember that changing the VM SKU will force the Virtual Machine to deallocate <em>(stop)</em>, as it triggers ARM to stand up the Virtual Machine on different server clusters/hardware.</p>
<p><em>I have found that there are no noticeable decreases in performance for most workloads, but keep in mind you may be returning on older hardware - but it should get you going, and then you can update the SKU to the latest version later.</em></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="increase-regional-vcpu-quotas">Increase regional vCPU quotas<a href="#increase-regional-vcpu-quotas" class="hash-link" aria-label="Direct link to Increase regional vCPU quotas" title="Direct link to Increase regional vCPU quotas">​</a></h5>
<p>Azure Resource Manager enforces two types of vCPU quotas for virtual machines:</p>
<ul>
<li>
<p>standard vCPU quotas</p>
</li>
<li>
<p>spot vCPU quotas
Standard vCPU quotas apply to pay-as-you-go VMs and reserved VM instances. They are enforced at two tiers, for each subscription, in each region:</p>
</li>
<li>
<p>The first tier is the total regional vCPU quota.</p>
</li>
<li>
<p>The second tier is the VM-family vCPU quota such as D-series vCPUs.</p>
</li>
</ul>
<p>Check your subscription quotas and if necessary, raise a request to increase them by following the guide here: [Increase regional vCPU quotas]{<a href="https://learn.microsoft.com/azure/quotas/regional-quota-requests?WT.mc_id=AZ-MVP-5004796%7D" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/azure/quotas/regional-quota-requests?WT.mc_id=AZ-MVP-5004796}</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-virtual-machine-and-mac-address-software-licensing/">Azure Virtual Machine and a custom MAC address</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-19T00:00:00.000Z">July 19, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>You may need an Azure Virtual Machine to install or license software bound to a media access control address <em>(MAC address)</em>.</p>
<p>In Microsoft Azure, you can make changes to the Primary Network interface; these changes include manually setting the IP settings to changing the MAC address - these settings are managed by the underlying Network Interface and Azure host.</p>
<blockquote>
<p><em>If you do inadvertently make changes to this, you will lose connection to the Azure Virtual Machine, however, don&#x27;t panic! Until its rebooted and the configuration is reset by the Azure fabric.</em></p>
</blockquote>
<p>This causes issues when the software is licensed to a specific MAC address; you could reissue the license to the new MAC address OR create a Secondary Interface in Microsoft Azure and update the MAC address on the secondary network interface.</p>
<p>You can easily <a href="https://learn.microsoft.com/en-us/azure/virtual-network/network-overview?WT.mc_id=AZ-MVP-5004796#network-interfaces" target="_blank" rel="noopener noreferrer" title="Network interfaces">create a new Network Interface</a> from the Azure Portal and then attach it to the Virtual Machine (<em>the virtual machine needs to be off to allow the NIC to be attached)</em>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="change-network-adapter-mac-using-powershell">Change Network Adapter MAC using PowerShell<a href="#change-network-adapter-mac-using-powershell" class="hash-link" aria-label="Direct link to Change Network Adapter MAC using PowerShell" title="Direct link to Change Network Adapter MAC using PowerShell">​</a></h5>
<p>Once the NIC is created and attached, run the following PowerShell command in the Azure Virtual Virtual machine <em>(assuming this is a Windows OS, but the same process should work for</em> <a href="https://www.linuxshelltips.com/change-mac-address-linux/" target="_blank" rel="noopener noreferrer" title="How to Change Network MAC Address in Linux"><em>Linux</em></a><em>)</em>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-NetAdapter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You want to make sure you are targeting the right Network Adapter; in my example, it is the Hyper-V Interface #2 <em>(with #1 being my Primary NIC)</em>.</p>
<p>Add the new MAC address into the $MACAddress variable, and make sure you update the InterfaceDescription to match the Network Adapter you are targeting <em>(note the wildcard before the #2, this targets any network adapter with #2 at the end)</em>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$MACAddress = &#x27;000000000000&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$NetAdapter = Get-NetAdapter -InterfaceDescription &quot;*#2&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Set-NetAdapter $NetAdapter.Name -MacAddress $MACAddress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="change-network-adapter-mac-using-device-manager">Change Network Adapter MAC using Device Manager<a href="#change-network-adapter-mac-using-device-manager" class="hash-link" aria-label="Direct link to Change Network Adapter MAC using Device Manager" title="Direct link to Change Network Adapter MAC using Device Manager">​</a></h5>
<p>You can also use Device Manager to check and update the MAC address:</p>
<ol>
<li>Open the Device Manager.</li>
<li>Expand the Network Adapters section.</li>
<li>Right-click on your adapter.</li>
<li>Click the Advanced tab.</li>
<li>Enter your new MAC address.</li>
<li>Reboot your computer to enable the changes.</li>
<li>Check that the changes took effect.</li>
</ol>
<blockquote>
<p>Finally - make sure you document this MAC address somewhere with the reasons WHY the change was made. You can also Tag the secondary MAC address in Azure with notes, such as the reason why it exists, who created it etc.</p>
</blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/deploy-azure-naming-tool-into-an-azure-webapp-as-a-container/">Deploy Azure Naming Tool into an Azure WebApp as a container</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-11T00:00:00.000Z">July 11, 2022</time> · <!-- -->14 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Organising your cloud workloads to support governance, operational management, and accounting requirements can take a lot of effort before the first resource is created.</p>
<p>Well-defined naming and metadata tagging conventions help to locate and manage resources quickly. These conventions also help associate cloud usage costs with business teams via chargeback and show-back accounting mechanisms, along with rapidly identifying what services are used across services.</p>
<p>A useful naming convention composes resource names from important information about each resource. A well-chosen name helps you quickly identify the resource&#x27;s type, associated workload, deployment environment, and the Azure region hosting it. Some resource names, such as PaaS services with public endpoints or virtual machine DNS labels, have global scopes, so they must be unique across the Azure platform.</p>
<p>There&#x27;s no one size fits Azure naming convention; it needs to suit your organisation. However, it is worth noting that there are limitations to naming rules for Azure resources.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Naming rules and restrictions for Azure resources">Naming rules and restrictions for Azure resources</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Define your naming convention">Define your naming convention</a></li>
</ul>
<p>With rules around naming resources that are Global, specific to Resource Groups or that have maximum character limits that can&#x27;t contain specific characters - it can become a project on its own, the world of Cloud where resources are treated as <a href="http://cloudscaling.com/blog/cloud-computing/the-history-of-pets-vs-cattle/" target="_blank" rel="noopener noreferrer" title="The History of Pets vs Cattle and How to Use the Analogy Properly">cattle and not pets</a> - the effort to develop a proper naming convention, used across teams or even companies can be quite complex.</p>
<p>This is where the Azure Naming Tool, as part of the Microsoft Cloud Adoption framework, comes into play.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<p>The Naming Tool <em>(v2 as of June 2022)</em> was developed using a naming pattern based on <a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging" target="_blank" rel="noopener noreferrer">Microsoft&#x27;s best practices</a>. Once the organisational components have been defined by an administrator, users can use the tool to generate a name for the desired Azure resource.</p>
<p><img decoding="async" loading="lazy" alt="Azure [naming-tool]" src="/assets/images/azurenamingtoollogo-988ade636a1de804bd46948462c4e980.png" title="Azure [naming-tool]" width="750" height="450" class="img_ev3q"></p>
<p>This tool sitting in the <a href="https://github.com/mspnp/AzureNamingTool" target="_blank" rel="noopener noreferrer">Azure Naming Tool</a> GitHub repository runs as a standalone Web <em>(.NET 6 Blazor application)</em> application using stateless JSON files for its Configuration and offers users the ability to generate and customise their own <a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Define your naming convention">Microsoft Azure Naming convention</a> taking all the restrictions into account. In addition, Azure Naming Tool - also provides a Swagger API that can be used in your Infrastructure as Code deployments to generate the names of resources on the fly.</p>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool - Reference" src="/assets/images/azurenamingtool_referencepage-dc8493e20132222dfd2979b14524233c.png" title="Azure Naming Tool - Reference" width="1383" height="935" class="img_ev3q"></p>
<p>This information is straight from the project README.md:</p>
<blockquote>
<p><strong>Project Components</strong></p>
<ul>
<li>UI/Admin</li>
<li>API</li>
<li>JSON configuration files</li>
<li>Dockerfile</li>
</ul>
<p><strong>Important Notes</strong></p>
<p>The following are important notes/aspects of the Azure Naming Tool:</p>
<ul>
<li>The application is designed to run as a stand-alone solution, with no internet/Azure connection.</li>
<li>The application can be run as a .NET 6 site, or as a Docker container.</li>
<li>The site can be hosted in any environment, including internal or in a public/private cloud.</li>
<li>The application uses local JSON files to store the configuration of the components.</li>
<li>The application requires persistent storage. If running as a container, a volume is required to store configuration files.</li>
<li>The application contains a <em>repository</em> folder, which contains the default component configuration JSON files. When deployed, these files are copied to the <em>settings</em> folder.</li>
<li>The Admin interface allows configurations to be &quot;reset&quot;, if needed. This process copies the configuration from the <em>repository</em> folder to the <em>settings</em> folder.</li>
<li>The API requires an API Key for all executions. A default API Key (guid) will be generated on first launch. This value can be updated in the Admin section.</li>
<li>On first launch, the application will prompt for the Admin password to be set.</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h4>
<p>Today, we will deploy the Azure Naming Tool into an Azure WebApp, running as a Container.<img decoding="async" loading="lazy" alt="Azure Naming Tool - High-Level Architecture" src="/assets/images/azurenamingtool_architecture-2c4f52c193efed8a8ec5ed9839fc8ebf.png" title="Azure Naming Tool - High-Level Architecture" width="1280" height="720" class="img_ev3q"></p>
<p>The Azure resources we will create are:</p>
<ul>
<li><a href="https://azure.microsoft.com/en-us/services/container-registry/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" Azure Container Registry">Azure Container Registry</a></li>
<li><a href="https://azure.microsoft.com/en-us/products/category/storage/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Storage">Azure Storage Account</a> <em>(with File Share - to store our persistent data and Configuration)</em></li>
<li><a href="https://azure.microsoft.com/en-us/services/app-service/containers/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title=" Web App for Containers">Azure App Service Plan and App Service for Containers</a> <em>(to run our Azure Naming Tool)</em></li>
</ul>
<p>You need Contributor rights in at least a Resource Group to deploy these Azure resources.</p>
<p>We will be using a mix of services such as:</p>
<ul>
<li><a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer" title="Docker">Docker</a></li>
<li><a href="https://learn.microsoft.com/en-us/powershell/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="PowerShell">PowerShell</a> &amp; <a href="https://learn.microsoft.com/en-us/cli/azure/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Command-Line Interface (CLI) documentation">Azure CLI</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Bicep documentation">Azure Bicep</a></li>
</ul>
<p>To reduce the need to set up these dependencies on individual workstations, we will use a mix of the Azure Cloud Shell and Azure Portal. If you haven&#x27;t set up your Azure Cloud Shell, you can refer to an article I wrote previously &quot;<a href="https://luke.geek.nz/2022/03/07/setup-azure-cloud-shell/" target="_blank" rel="noopener noreferrer" title="Setup Azure Cloud Shell ">here</a>&quot; for this remainder of this article I am going to assume you have it set up already.</p>
<p>Note: I will connect to the Cloud Shell using the <a href="https://learn.microsoft.com/en-us/shows/it-ops-talk/azure-cloud-shell-in-the-windows-terminal?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Cloud Shell in the Windows Terminal">Windows Terminal</a> so that any screenshots will be of the Terminal, but it&#x27;s the same behaviour if I used the browser experience.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="clone-the-git-repository">Clone the Git Repository<a href="#clone-the-git-repository" class="hash-link" aria-label="Direct link to Clone the Git Repository" title="Direct link to Clone the Git Repository">​</a></h4>
<p>Now is time to clone the git repository into our Cloud Shell so that we can build the docker image definition.</p>
<ol>
<li>
<p><strong>Log in</strong> to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure - Portal">Microsoft Azure Portal</a> and open up the <strong>Azure Cloud Shell</strong> <em>(make sure you are in PowerShell (not Bash)).</em></p>
</li>
<li>
<p><strong>Run</strong> the following <strong>commands</strong> and wait for the Repository to be cloned directly into the CloudShell virtual instance:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/mspnp/AzureNamingTool</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool - Clone Repo" src="/assets/images/AzNamingTool_RepoClone-68e4722fc50657400fdd18514494b8e0.gif" title="Azure Naming Tool - Clone Repo" width="944" height="430" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-resource-group--azure-container-registry">Create Resource Group &amp; Azure Container Registry<a href="#create-resource-group--azure-container-registry" class="hash-link" aria-label="Direct link to Create Resource Group &amp; Azure Container Registry" title="Direct link to Create Resource Group &amp; Azure Container Registry">​</a></h4>
<p>Now that we have our Repository, it&#x27;s time to create our Resource Group and Container Registry <em>(Public)</em>; we will use a few PowerShell cmdlets to develop the resources; make sure you change the name of your Container Registry and Resource Group to match your environment.</p>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure - Portal">Microsoft Azure Portal</a> and open up the <strong>Azure Cloud Shell</strong> <em>(make sure you are in PowerShell (not Bash)).</em></li>
<li><strong>Run</strong> the following <strong>commands</strong> to <strong>create</strong> the <strong>Resource Group</strong> and the <strong>Azure Container Registry</strong>:</li>
</ol>
<p><strong>Remember to change the name of the Container Registry - this is a globally unique resource, so if someone else has already created a registry with the same name, yours won&#x27;t deploy.</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">   $ResourceGroup = New-AzResourceGroup -Name &#x27;AzNamingTool-PROD-RG&#x27; -Location &#x27;Australia East&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   $registry = New-AzContainerRegistry -ResourceGroupName &#x27;AzNamingTool-PROD-RG&#x27; -Name &quot;ContainerRegistryAzNamingTool&quot; -EnableAdminUser -Sku Basic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Connect-AzContainerRegistry -Name $registry.Name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="AzureNaming Tool - Create Resource Group &amp;amp; Azure Container Registry" src="/assets/images/AzNamingTool_ContainerRegistryImageBuild-ac13d880a61c88e08ac26ead96d3b2f9.gif" title="AzureNaming Tool - Create Resource Group &amp;amp; Azure Container Registry" width="944" height="430" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="build-your-image-to-the-azure-container-registry">Build your image to the Azure Container Registry<a href="#build-your-image-to-the-azure-container-registry" class="hash-link" aria-label="Direct link to Build your image to the Azure Container Registry" title="Direct link to Build your image to the Azure Container Registry">​</a></h4>
<p>The Azure Container Registry will be stored to host and build your image definition, as Docker support is not native to the Azure Cloud Shell; now that we have created it is time to build the image and push it to the registry. Ensure you are in the AzNamingTool folder <em>(CloudAdoptionFramework/ready/AzNamingTool/)</em>.</p>
<ol>
<li>
<p><strong>Run</strong> the following <strong>Azure CLI</strong> command:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az acr build --image azurenamingtool:v1 --registry $registry.Name --file Dockerfile .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="AzureNaming Tool - Azure Container Registry" src="/assets/images/AzNamingTool_ContainerRegistryImageBuild-ac13d880a61c88e08ac26ead96d3b2f9.gif" title="AzureNaming Tool - Azure Container Registry" width="944" height="430" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-azure-app-service-and-webapp">Deploy Azure App Service and WebApp<a href="#deploy-azure-app-service-and-webapp" class="hash-link" aria-label="Direct link to Deploy Azure App Service and WebApp" title="Direct link to Deploy Azure App Service and WebApp">​</a></h4>
<p>For the following, we will use a mix of Azure Bicep and the Azure Portal <em>(I ran into an Access Key error and PowerShell</em> <a href="https://github.com/Azure/azure-powershell/issues/10645" target="_blank" rel="noopener noreferrer" title="webapp: New-AzWebApp does not set LinuxFxVersion from ContainerImageName"><em>issue</em></a> <em>when attempting to map the share using Bicep and PowerShell - if you managed to complete the setup feel free to add a comment in the comments below)</em>.</p>
<p>Azure Bicep will be used to create the App Service and Storage account + file share, and then we will use the Azure Portal to complete the setup <em>(Azure WebApp as a Container and mapping the persistent file share)</em>.</p>
<p>First, we need to install Azure Bicep and import the Bicep file into Cloud Shell; we could Upload the file straight from the Portal or clone a <a href="https://github.com/lukemurraynz/Azure-Bicep" target="_blank" rel="noopener noreferrer" title="Azure-Bicep">repo</a> with the file - but because I am using Azure Cloud Shell from the Terminal because Azure Cloud Shell runs on Linux - I am going to use &#x27;nano&#x27; to create the Bicep file manually - feel free to do any of the above options to get the Azure Bicep into Cloud Shell.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="install-azure-bicep">Install Azure Bicep<a href="#install-azure-bicep" class="hash-link" aria-label="Direct link to Install Azure Bicep" title="Direct link to Install Azure Bicep">​</a></h5>
<ol>
<li>
<p>To <strong>install</strong> Azure <strong>Bicep,</strong> run:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az bicep install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool - Install Azure Bicep" src="/assets/images/install_azbicep-790f8db24f67c1d4b39a8a6cd1a3522c.gif" title="Azure Naming Tool - Install Azure Bicep" width="944" height="430" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-bicep-file">Create Azure Bicep File<a href="#create-azure-bicep-file" class="hash-link" aria-label="Direct link to Create Azure Bicep File" title="Direct link to Create Azure Bicep File">​</a></h5>
<p>We will use Nano, copy the Azure Bicep file and Paste it into Nano, and make sure you adjust the parameters to suit your environment before deploying.</p>
<ol>
<li>
<p>In the <strong>Azure Cloud Shell</strong>, let us create the file by typing.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">nano AzNamingTool_main.bicep</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Paste</strong> the Azure <strong>Bicep file</strong> and do any final edits</p>
</li>
<li>
<p>Now we need to save the file; press <strong>Ctrl+X</strong> on your keyboard</p>
</li>
<li>
<p>Press <strong>Y</strong> to save the file</p>
</li>
<li>
<p>Verify the file name and press <strong>Enter</strong> to accept the filename.</p>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool - Create Bicep file" src="/assets/images/createazbicepfile-3f7df8734d575609ac0ae3b6cfb36a34.gif" title="Azure Naming Tool - Create Bicep file" width="944" height="430" class="img_ev3q"></p>
</li>
</ol>
<p><strong>Remember to edit the Azure Bicep parameters, the Resource Names need to be globally unique, so you may run into problems if someone has deployed using the same name!</strong></p>
<div class="language-bicep codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">AzNamingTool_main.bicep</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bicep codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">//Related to a Blog Article: https://luke.geek.nz for setting up Azure Naming Tool.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">///Parameter Setting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> location </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">resourceGroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Adjust Parameter values to match your naming conventions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> serverfarms_AzNamingTool_ASP_Prod_name </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AzNamingTool-ASP-Prod&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> storageAccounts_aznamingstgacc_name </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;aznaming&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// The following Parameters are used add Tags to your deployed resources. Adjust for your own needs.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> dateTime </span><span class="token datatype class-name">string</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">utcNow</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;d&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"> resourceTags </span><span class="token datatype class-name">object</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">Application</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Azure Naming Tool&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">Version</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;v2.0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">CostCenter</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Operational&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">CreationDate</span><span class="token operator">:</span><span class="token plain"> dateTime</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">Createdby</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Luke Murray (luke.geek.nz)&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">/// Deploys Resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Deploys Azure Storage Account for Azure File Share for AzNamingtool persistant data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> storageAccounts_aznamingstgacc_name_resource </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Storage/storageAccounts@2021-09-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token interpolated-string string" style="color:rgb(255, 121, 198)">&#x27;</span><span class="token interpolated-string interpolation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token interpolated-string interpolation expression">storageAccounts_aznamingstgacc_name</span><span class="token interpolated-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token interpolated-string interpolation punctuation" style="color:rgb(248, 248, 242)">${</span><span class="token interpolated-string interpolation expression function" style="color:rgb(80, 250, 123)">uniqueString</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token interpolated-string interpolation expression function" style="color:rgb(80, 250, 123)">resourceGroup</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token interpolated-string interpolation expression">id</span><span class="token interpolated-string interpolation expression punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token interpolated-string interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token interpolated-string string" style="color:rgb(255, 121, 198)">&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">location</span><span class="token operator">:</span><span class="token plain"> location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">tags</span><span class="token operator">:</span><span class="token plain"> resourceTags</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">sku</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Standard_LRS&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">kind</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;StorageV2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">dnsEndpointType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Standard&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">defaultToOAuthAuthentication</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">publicNetworkAccess</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Enabled&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">allowCrossTenantReplication</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">minimumTlsVersion</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;TLS1_2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">allowBlobPublicAccess</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">allowSharedKeyAccess</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">networkAcls</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">bypass</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;AzureServices&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">defaultAction</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Allow&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">supportsHttpsTrafficOnly</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">encryption</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">requireInfrastructureEncryption</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">services</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">file</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">keyType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Account&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">enabled</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">blob</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">keyType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Account&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">enabled</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">keySource</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Storage&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">accessTier</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Hot&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Deploys Azure File Share from the Storage Account above.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> Microsoft_Storage_storageAccounts_fileServices_storageAccounts_aznamingstgacc_name_default </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Storage/storageAccounts/fileServices@2021-09-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">parent</span><span class="token operator">:</span><span class="token plain"> storageAccounts_aznamingstgacc_name_resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;default&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">shareDeleteRetentionPolicy</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">enabled</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">days</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> storageAccounts_aznamingstgacc_name_default_aznamingtool </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Storage/storageAccounts/fileServices/shares@2021-09-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">parent</span><span class="token operator">:</span><span class="token plain"> Microsoft_Storage_storageAccounts_fileServices_storageAccounts_aznamingstgacc_name_default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;aznamingtool&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">accessTier</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;TransactionOptimized&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">shareQuota</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">enabledProtocols</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;SMB&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//Deploys the App Service PLan for AzNamingTool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">resource</span><span class="token plain"> serverfarms_AzNamingTool_ASP_Prod_name_resource </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Microsoft.Web/serverfarms@2021-03-01&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> serverfarms_AzNamingTool_ASP_Prod_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">tags</span><span class="token operator">:</span><span class="token plain"> resourceTags</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">location</span><span class="token operator">:</span><span class="token plain"> location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">sku</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;B1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">tier</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Basic&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">size</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;B1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">family</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;B&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">capacity</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">kind</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;linux&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">properties</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">perSiteScaling</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">elasticScaleEnabled</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">maximumElasticWorkerCount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">isSpot</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">reserved</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">isXenon</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">hyperV</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">targetWorkerCount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">targetWorkerSizeId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">zoneRedundant</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-azure-bicep">Deploy Azure Bicep<a href="#deploy-azure-bicep" class="hash-link" aria-label="Direct link to Deploy Azure Bicep" title="Direct link to Deploy Azure Bicep">​</a></h5>
<p>Now it&#x27;s time to create the Azure App Service Plan and Storage account <strong><em>(remove the -what if flag at the end, when you confirmed there are no errors)</em></strong>.</p>
<ol>
<li>
<p><strong>Run</strong> the following <strong>command</strong> to deploy the <strong>App Service and Storage</strong> account into your Resource Group:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzResourceGroupDeployment -Name &#x27;AzNamingTool-WebApp&#x27; -ResourceGroupName &#x27;AzNamingTool-PROD-RG&#x27; -TemplateFile .\AzNamingTool_main.bicep -WhatIf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool - Deploy Azure Bicep resources" src="/assets/images/deployaznamingtoolbicepresources-75e68304c5f028f73480b44d79d93809.gif" title="Azure Naming Tool - Deploy Azure Bicep resources" width="944" height="430" class="img_ev3q"></p>
<p>Your resources <em>(App Service, Storage account with File Share)</em> should now be deployed, and we can now close our trusty Cloud Shell.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-and-configure-webapp-as-a-container">Deploy and configure WebApp as a Container<a href="#deploy-and-configure-webapp-as-a-container" class="hash-link" aria-label="Direct link to Deploy and configure WebApp as a Container" title="Direct link to Deploy and configure WebApp as a Container">​</a></h5>
<ol>
<li>Log in to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure - Portal">Microsoft Azure Portal</a></li>
<li>Click <strong>+ Create a Resource</strong></li>
<li>Search for: Web App and click <strong>Create a Web App</strong></li>
<li>Select your <strong>Subscription</strong> and <strong>Resource Group</strong></li>
<li><strong>Select</strong> a <strong>name</strong> for your Web App <em>(AzNamingTool-AS-Prod)</em></li>
<li>In <strong>Publish</strong>, select <strong>Docker Container</strong></li>
<li>For Operating system: Select <strong>Linux</strong></li>
<li>Select the <strong>Region</strong> that your App Service plan was deployed to</li>
<li><strong>Select</strong> the App Service <strong>Plan</strong> created earlier, then Select <strong>Next: Docker</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Naming Tool - Web App Deployment" src="/assets/images/azure-naming-tool-webapp-deployment-general-2efaf0a927f6d4e52a240617c05c49a7.png" title="Azure Naming Tool - Web App Deployment" width="788" height="875" class="img_ev3q"></li>
<li>Under Options, select <strong>Single Container</strong></li>
<li>Change Image Source to <strong>Azure Container Registry</strong></li>
<li>Select your <strong>Registry</strong> and <strong>Azure Naming Too</strong>l image, then select <strong>Next: Networking</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Naming Tool - Registry" src="/assets/images/azure-naming-tool-webapp-deployment-docker-6c1b0bada73436093e4625edeabe18d7.png" title="Azure Naming Tool - Registry" width="783" height="387" class="img_ev3q"></li>
<li>If you want to enable Network injection, by placing it on your Virtual Network, you can configure this, and we are just going head to <strong>Monitoring.</strong></li>
<li>Application Insights isn&#x27;t required, but it is recommended <em>- even if it is just for Availability alerting)</em>; I always enable it, so select <strong>Yes</strong> and <strong>Next Tags.</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure App Deployment - Application Insights" src="/assets/images/azure-naming-tool-webapp-deployment-app-insights-0eaca9e11a11f6b0385fbc4eb8a82536.png" title="Azure App Deployment - Application Insights" width="750" height="395" class="img_ev3q"></li>
<li>Enter in any applicable <strong>Tags</strong> and finally click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
<li>Now that your container is running, we need to mount the Azure file share, so any persistent data is saved.</li>
<li><strong>Open</strong> your newly created <strong>App Service.</strong></li>
<li>Navigate to <strong>Configuration</strong>, under Settings in the navigation bar</li>
<li>Click on <strong>Path mappings</strong></li>
<li>Click <strong>+ New Azure Storage Mount</strong></li>
<li><strong>Give</strong> the <strong>mount</strong> a <strong>name</strong>: i.e. <em>a naming tool-stg-mnt</em></li>
<li>Select <strong>Basic Configuration</strong></li>
<li>Select the <strong>Storage account</strong> created earlier <em>(as part of the Bicep deployment)</em> and select <strong>Azure File share</strong></li>
<li>Select your Storage container and enter in**/app/settings** to the mount path and click <strong>Ok</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure App Service - Mount Azure File Share" src="/assets/images/azure-naming-tool-webapp-deployment-storage-mount-c9659fbe414e41ed92346cb6264c587d.png" title="Azure App Service - Mount Azure File Share" width="551" height="353" class="img_ev3q"></li>
<li>Then select Save to <strong>Save</strong> the Path Mappings</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="optional-azure-app-service-tweaks">Optional: Azure App Service Tweaks<a href="#optional-azure-app-service-tweaks" class="hash-link" aria-label="Direct link to Optional: Azure App Service Tweaks" title="Direct link to Optional: Azure App Service Tweaks">​</a></h5>
<p>By now, your Azure Naming Tool should be accessible,  you don&#x27;t need to do any of the following, but I recommend them at a bare minimum <em>(environment and use case depending)</em>.</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="enable-always-on">Enable <a href="https://learn.microsoft.com/en-us/azure/app-service/configure-common?tabs=portal&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Configure an App Service app"><strong>Always On</strong></a><a href="#enable-always-on" class="hash-link" aria-label="Direct link to enable-always-on" title="Direct link to enable-always-on">​</a></h6>
<ol>
<li>In your App Service, select <strong>Configuration</strong>, then <strong>General Settings</strong></li>
<li>Check <strong>&#x27;On</strong>&#x27; under &#x27;Always On&#x27;</li>
<li>Click <strong>Save</strong></li>
</ol>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="configure-firewall">Configure Firewall<a href="#configure-firewall" class="hash-link" aria-label="Direct link to Configure Firewall" title="Direct link to Configure Firewall">​</a></h6>
<p>Your App Service will be publically accessible by default, and although you may want to link it to your network via a Private Endpoint, locking down by Public IP may be suitable in some scenarios <em>(such as this demo environment)</em>.</p>
<ol>
<li>To lock it down to a specific Public IP, in your App Service, Select <strong>Networking</strong>, then <strong>Access restriction.</strong></li>
<li>Add in your <strong>Public IP</strong> to restrict it from being accessible from your network and click <strong>Ok.</strong></li>
<li>Make sure you select the scm instance and select: <strong>Same restrictions</strong> so that the SCM instance isn&#x27;t also publically accessible.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lets-take-a-look">Let&#x27;s take a look!<a href="#lets-take-a-look" class="hash-link" aria-label="Direct link to Let&#x27;s take a look!" title="Direct link to Let&#x27;s take a look!">​</a></h3>
<p>Now that you have successfully deployed the Azure Naming Tool let&#x27;s take a look.</p>
<p>To open your <strong>Azure Naming Tool</strong>, navigate to your <strong>App Service</strong> and select <strong>Browse</strong> (or copy the URL).</p>
<p>When you open it the first time, you will have the option to create an Admin password, set your Password and select Save; if the Azure File Share wasn&#x27;t mounted to the Web App - then your Password won&#x27;t be saved if the App Services crashes or gets reloaded to another node.</p>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool" src="/assets/images/azure-naming-tool-d0ef7ae8a0fb61a881cad9efd1b9a044.png" width="1575" height="1135" class="img_ev3q"></p>
<p>Click on <strong>Generate</strong></p>
<p>You can immediately generate a naming standard out of the box <em>(and it already contains the prefix for the NZ North Azure region!)</em>.</p>
<p><img decoding="async" loading="lazy" alt="Azure Naming Standard - Generate" src="/assets/images/azurenamingtool-generate-3277dbc7e7e7a6d451d4f00a738e56f0.png" title="Azure Naming Standard - Generate" width="1305" height="866" class="img_ev3q"></p>
<p>If you click <strong>Reference,</strong> you can see the reference criteria that Azure Naming Tool works with generating your Naming schema; for example, for ApiManagement APS, we can see that the short name is: API; it supports up to 256 characters but cannot have a &#x27;#&#x27;, and does not need a globally unique name.</p>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool - Reference API Management" src="/assets/images/azurenamingstandard-referenceapi-1e443d719366053b7216839f022882d4.png" title="Azure Naming Tool - Reference API Management" width="702" height="488" class="img_ev3q"></p>
<p>If you navigate to: <strong>Configuration</strong>, this is where you can specify any Custom changes to suit your Organisation or Organisations <em>(yes, you can use this as a Cloud Architect or Consultant to generate names of multiple organisations)</em>. If you don&#x27;t like the default prefixes for the Resources, Regions, Environment or even Delimiters, you can adjust them here.</p>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool - Configuration" src="/assets/images/azurenamingtool-configuration-a935d7024835213b2eaae6e06fdad93f.png" title="Azure Naming Tool - Configuration" width="1242" height="922" class="img_ev3q"></p>
<p>You can also <strong>Export</strong> and <strong>Import</strong> a configuration from a previous install on the Configuration pane.</p>
<p>There is also an Azure Naming Tool Swagger API that you can leverage <em>(the API key can be found under Admin)</em> in your Infrastructure as Code or script deployments.</p>
<p><img decoding="async" loading="lazy" alt="Azure Naming Tool - API" src="/assets/images/azurenamingtool-api-ea031a02190ed586181713bfca70048d.png" title="Azure Naming Tool - API" width="1461" height="1034" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/page/22/"><div class="pagination-nav__label">Newer entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/page/24/"><div class="pagination-nav__label">Older entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
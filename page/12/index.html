<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/page/12/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz"><meta data-rh="true" name="description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" property="og:description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/page/12/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/12/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/12/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://luke.geek.nz/page/12","mainEntityOfPage":"https://luke.geek.nz/page/12","headline":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!","description":"Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!","blogPost":[{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/azure-architecture-solution-requirement-consideration-checklist","mainEntityOfPage":"https://luke.geek.nz/azure/azure-architecture-solution-requirement-consideration-checklist","url":"https://luke.geek.nz/azure/azure-architecture-solution-requirement-consideration-checklist","headline":"Azure Architecture - Solution Requirement Consideration Checklist","name":"Azure Architecture - Solution Requirement Consideration Checklist","description":"Building a cloud solution on Azure can be an exciting yet daunting task.","datePublished":"2023-02-14T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/azure-deployment-cleanup-with-azure-devops","mainEntityOfPage":"https://luke.geek.nz/azure/azure-deployment-cleanup-with-azure-devops","url":"https://luke.geek.nz/azure/azure-deployment-cleanup-with-azure-devops","headline":"Azure Deployment history cleanup with Azure DevOps","name":"Azure Deployment history cleanup with Azure DevOps","description":"Microsoft Azure has a limit of 800 deployments per resource group. This means that a single resource group can only contain 800 historical deployments at most.","datePublished":"2023-02-03T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2023/01/18/you-can-t-touch-this-how-to-make-your-azure-backup-immutable-and-secure","mainEntityOfPage":"https://luke.geek.nz/2023/01/18/you-can-t-touch-this-how-to-make-your-azure-backup-immutable-and-secure","url":"https://luke.geek.nz/2023/01/18/you-can-t-touch-this-how-to-make-your-azure-backup-immutable-and-secure","headline":"You Can't Touch This: How to Make Your Azure Backup Immutable and Secure","name":"You Can't Touch This: How to Make Your Azure Backup Immutable and Secure","description":"With immutable vaults, Azure Backup ensures that recovery points that are once created cannot be deleted before their intended expiry time. Azure Backup does this by preventing any operations which could lead to the loss of backup data.","datePublished":"2023-01-18T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/2023/01/09/export-icons-to-svg-from-the-microsoft-azure-portal-using-amazing-icon-downloader","mainEntityOfPage":"https://luke.geek.nz/2023/01/09/export-icons-to-svg-from-the-microsoft-azure-portal-using-amazing-icon-downloader","url":"https://luke.geek.nz/2023/01/09/export-icons-to-svg-from-the-microsoft-azure-portal-using-amazing-icon-downloader","headline":"Export icons to SVG from the Microsoft Azure Portal using Amazing Icon Downloader","name":"Export icons to SVG from the Microsoft Azure Portal using Amazing Icon Downloader","description":"Have you ever wanted to export an icon from the Microsoft Azure Portal but found yourself having to screenshot the icon at a low definition to include in your documentation or presentations?","datePublished":"2023-01-09T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/create-azure-ip-groups-based-on-the-ip-address-ranges-of-countries","mainEntityOfPage":"https://luke.geek.nz/azure/create-azure-ip-groups-based-on-the-ip-address-ranges-of-countries","url":"https://luke.geek.nz/azure/create-azure-ip-groups-based-on-the-ip-address-ranges-of-countries","headline":"Create Azure IP Groups based on the IP address ranges of countries","name":"Create Azure IP Groups based on the IP address ranges of countries","description":"An IP Group in Microsoft Azure is a logical container of IP address ranges for private and public addresses.","datePublished":"2023-01-02T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.28b9be22.css">
<script src="/assets/js/runtime~main.b61e1eaa.js" defer="defer"></script>
<script src="/assets/js/main.737284cc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/cloud-design-patterns/">Cloud Design Patterns</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/export-azure-devops-repos-azure-storage-account/">Export Azure DevOps Repositories to Azure Storage Account</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/run-local-llm-aks/">Deploying Large Language Models on AKS with Kaito</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/authorization-permission-mismatch-error-azure-storage/">Authorization Permission Mismatch error with Azure Storage</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/federated-credentials-aks/">Federated Credentials to AKS Managed Identity</a></li></ul></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-architecture-solution-requirement-consideration-checklist/">Azure Architecture - Solution Requirement Consideration Checklist</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-02-14T00:00:00.000Z">February 14, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Building a cloud solution on Azure can be an exciting yet daunting task.</p>
<p>The key to a successful implementation is carefully planning and considering solution requirements using the guidance of the <a href="https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Microsoft Cloud Adoption Framework for Azure">Microsoft Cloud Adoption</a> and <a href="https://learn.microsoft.com/en-us/azure/architecture/framework/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Microsoft Azure Well-Architected Framework">Well Architecture frameworks</a>.</p>
<p>But knowing what questions to ask and data to capture to give you the bigger picture - to not only consider the solution for the short term and long term, can be difficult. This is where the <a href="https://github.com/lukemurraynz/Azure_Checklists" target="_blank" rel="noopener noreferrer">Azure architecture solution requirements checklist</a> comes in.</p>
<p>Leaning on the great frameworks already in place to assist with the Cloud Adoption and Azure Well Architecture frameworks, the solution requirements checklist is intended to act as a way of asking and capturing the requirements of your solutions. It can be a great reminder to discover some of those requirements <em>(whether functional or non-functional)</em> that you may have forgotten about!</p>
<p>I am using the <a href="https://github.com/Azure/review-checklists" target="_blank" rel="noopener noreferrer" title="Azure/review-checklists">Azure Review Checklist</a> - as a building block! I created a custom checklist intended to work alongside the review checklists - but aimed more at the discovery and requirements-gathering stage to assist with designing the proper outcomes for the business.</p>
<p>At the time of this article, there are 8 main categories, and various sub categories:</p>
<ul>
<li>AI</li>
<li>Business</li>
<li>Data</li>
<li>Governance</li>
<li>Infrastructure</li>
<li>Microservices</li>
<li>Observability</li>
<li>Resiliency</li>
</ul>
<p>Examples of some questions are:</p>

































































<table><thead><tr><th>Main Area</th><th>Sub Area</th><th>Checklist item</th><th>Description (optional)</th></tr></thead><tbody><tr><td>Business</td><td>Goals</td><td>Why are we moving the solution to Azure?</td><td>Understand the reasoning behind the decision to move to a cloud platform like Azure. Helps to validate the end result reaches this goal.</td></tr><tr><td>Business</td><td>Goals</td><td>What are the business objectives or quantifiable business goals?</td><td>What is the business objectives (ie Increased sales revenue, cost reduction, customer satisaction, employee productivity</td></tr><tr><td>Business</td><td>Goals</td><td>What outcomes will you achieve for customer?</td><td>What is the  objectives for the customer? What do they want to achieve using this solution</td></tr><tr><td>Business</td><td>Goals</td><td>Is there a timeline for building the solution Azure?</td><td>Asking about the timeline for building a solution in Azure is important to determine resource allocation, budgeting, prioritization, and setting stakeholder expectations.</td></tr><tr><td>Business</td><td>Goals</td><td>How many people will be accessing the solution?</td><td>Asking about the number of people accessing the solution helps to determine the necessary resources and scalability required to accommodate the expected traffic and usage.</td></tr><tr><td>Business</td><td>Goals</td><td>Is there a targeted event or date for an announcement about the solution&#x27;s availability on Azure?</td><td>Timeline for architecture, deployment, testing can help determine what risks, resource requirements and cost and the delivery of solution.</td></tr><tr><td>Business</td><td>Goals</td><td>Does the solution impact a Team, Department or organization?</td><td>Impact on a team, department, or organization helps determine the scope and potential consequences of the solution, ensuring that all relevant stakeholders are considered and accounted for in the decision-making process.</td></tr><tr><td>Business</td><td>Customers</td><td>What are the customer expecations?</td><td>Customer expectations helps ensure that the solution meets the needs and desires of the end-users, and make sure business outcomes match customer expectations.</td></tr><tr><td>Business</td><td>Customers</td><td>Is there a deal or customer opportunity associated with having the solution in Azure?</td><td>Any associated deals or customer opportunities helps to understand the potential financial benefits, vendor offerings and growth opportunities of using Azure as a platform for the solution.</td></tr></tbody></table>
<p><img decoding="async" loading="lazy" alt="Azure Architecture - Solution requirement considerations" src="/assets/images/azurearchitecture_considerations-59f14cd058806ef5868281140ebad379.png" title="Azure Architecture - Solution requirement considerations" width="1820" height="330" class="img_ev3q"></p>
<blockquote>
<p>The Azure Architecture - Solution Requirement Consideration checklist, is intended to be a living resource, I am not an expert in all fields so there may be gaps or questions you feel is relevant or missing! Feel free to open a Pull Request to contribute! This is for you!</p>
<p>You can find the <strong>latest version of the checklis</strong>t on GitHub here: <a href="https://github.com/lukemurraynz/Azure_Checklists" target="_blank" rel="noopener noreferrer" title="lukemurraynz/Azure_Checklists">lukemurraynz/<strong>Azure_Checklists</strong></a></p>
</blockquote>
<p>Using this is simple!</p>
<ol>
<li><strong>Download</strong> the <a href="https://github.com/Azure/review-checklists/releases/latest/download/review_checklist.xlsm" target="_blank" rel="noopener noreferrer" title="Azure Review Checklists">latest version of the excel</a> spreadsheet from: <a href="https://github.com/Azure/review-checklists" target="_blank" rel="noopener noreferrer" title="Azure Review Checklists">Azure/review-checklists</a>.</li>
<li><strong>Download</strong> the latest version of the <a href="https://github.com/lukemurraynz/Azure_Checklists/tree/main" target="_blank" rel="noopener noreferrer" title="azure_architecture_checklist.en.json"><strong>Azure Architecture checklist</strong></a><strong>.</strong></li>
<li>Open up the review_checklist excel document and click <strong>Import checklist from JSON</strong></li>
<li><img decoding="async" loading="lazy" alt="Import checklist from file" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAScAAAAmCAYAAACGcV1QAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAS4SURBVHhe7ZbNUeVIEIRxhcAUDjiAB3DBDI4YQQQ3XOCOAziAD3igjY8ld3NqS4Q086TWzmRGZKhfdf211JXxzqYgCIIDIuIUBMEhEXEKguCQiDgFQXBIHEacnp+fp6urq69fP4I9uAfu7u6m9/f3r19BEIzCYcQJYYo4BUEgbCZOZ2dnLTsgBoiCixA2xWjv4uLicw8gZNjk8/Dw8I8dP2zKRbz8AD6sJYaeZ4k4yTcMw395amwqTkuBOEBEQYKBSLy+vn6uJUQIEDaJmUPCRV32lQt/91UtoHwueooPgmA5fltx0j8ZsYqPBAUhQVBcpBQjgZG4AYkavgKxXot9r8U64hQE68AsnRrDxWlOiBAWiQT72AB2+Vch8idgXf85Sdgc/s+JdcQpCNbhtxQnxELCI0ggyAERGfnon5PW8pn75wQQJ/kBfPWbOuTWb2IiTkGwDpqtU2K4OAVB8P9HxCkIgtW4vb39Wm2HiNNKfHx8hOEfzaenp4hTRcQpDMcz4tQg4hSG4xlxahBxCsPxjDg1iDiF4XhGnBpEnMJwPCNODSJOH9Pj4+N0c3PT7h2Bb29v0/n5ebu3lC8vL9Pl5eV/7OQlP/s/W4O83KOt3yH5+VaseVKzqys79DMpRjmg5xzJiFODLZpdi+5j7Uku597idH9//8lur3IPcar2yu+G+Fd7W0rvgXurvv3bdeKjc2OnV+/3u3PtyYhTg4jTj+Ik0eC96KLrn4EuOUPBWnaoXIiAbG7HlxrYrq+vWx/R6xMncVI9Hy6vx/5cDhcn9rQmF/lVo+akZ/UNvTaUHaqG/DX0xMhHtiXvuZK8isdP4iQqh9ugfNknBz7K4zlHMuLUYItm16L7WHtSl5a1Boa1hlSXlyHDxkXHzho7scSxxq6hcRHgqRraU4xTuTub+vDhcrEgH/Yuh4SDffUEiccfKhf7Ops4N8QeB+s5/d2oL57Y1OPce1YO0XvgScySd6rzEIM/a/XsOUcy4tRgi2bXovtYe1KXlrVf8Dp4usjVzmXXAPjgu18d+LlB8l7EWk+x5OP7OdVjzSFf7w+Sl/xeg9z4YpOf8uq3WHur51T+uu/nrznmanV2bOrVczpV098LNv3uau3NiFODLZpdi+5j7Um/tEuGptq5+BoAnrK7n/a1NzdI3otY6ym21hO7HPKFXpe85K81tKc8OrvvwxpXz6n8dd/PX3PM1frOTq7u3JA7ztP3VXMu596MODWIOP2cOPHeNITYiZGdp3Ipbx1ar+PER8Mk1j4UW+uJXQ5s9MDaYyQetQZ029wQ17h6Tn7rnPiqLz9/zTFXy9+/3iukRvddFCNffDyONf5drb0ZcWqwRbNr0X2sPemXdsnQyM5Q8P7ch31s1V6HVoMEZRM1NJC42of36PWgBq3mcHFijZ01ecnvNXjWfIrxPmDtrZ4TKhfU3pL3rN9+RveRjbXs5JId6syQPJ2v1xrFiFODLZpdi+5jHZl1mMLwVxlxahBxWs+IU3hqRpwaRJzCcDwjTg0iTmE4nhGnBhGnMBzPiFODiFMYjmfEqcERxIkPE4Z/OiNOBaPFiQ8ShuHf3BoRpyAIDomIUxAEh0TEKQiCQ+L08z5NfwH8HO+H8AJYIwAAAABJRU5ErkJggg==" title="Import checklist from file" width="295" height="38" class="img_ev3q"></li>
<li><img decoding="async" loading="lazy" alt="Import checklist from file" src="data:image/png;base64,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" title="Import checklist from file" width="464" height="61" class="img_ev3q"></li>
<li>Select the downloaded: azure_architecture_checklist.en.json</li>
</ol>
<p>Once imported, you can now save the excel document, and start adjusting the <strong>Severity</strong>, <strong>Status</strong> and add <strong>Comments</strong> - to capture the information, to then use to architect your solutions!</p>
<blockquote>
<p><strong>Note: I do not create, edit or modify the Excel spreadsheet, created by for the Azure Reviews - I simply use it to run my custom checklist. Make sure to check out the</strong> <a href="https://github.com/Azure/review-checklists" target="_blank" rel="noopener noreferrer" title="Azure Review Checklists"><strong>Azure Review Checklists</strong></a><strong>!</strong></p>
</blockquote>
<p>There are some settings that you might need to change in your system to run <strong>macro-enabled Excel spreadsheet</strong>s. When initially opening the file you may see the following error, which prevents Excel from loading:</p>
<blockquote>
<p>Excel cannot open the file &#x27;review_checklist.xlsm&#x27; because the file format or file extension is not valid. Verify that the file has not been corrupted and that the file extension matches the format of the file.</p>
</blockquote>
<p>In other cases the file opens with the following message, which prevents you from being able to load the checklist items:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unblock-file-or-add-an-exception-to-windows-security">Unblock file or add an exception to Windows Security<a href="#unblock-file-or-add-an-exception-to-windows-security" class="hash-link" aria-label="Direct link to Unblock file or add an exception to Windows Security" title="Direct link to Unblock file or add an exception to Windows Security">​</a></h3>
<ol>
<li>You might need to unblock the file from the file properties in the Windows File Explorer, so that you can use the macros required to import the checklist content from github.com:</li>
<li>Additionally, you might want to add the folder where you cloned this repo to the list of exceptions in Windows Security (in the Virus &amp; Threat Protection section):</li>
</ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/azure-deployment-cleanup-with-azure-devops/">Azure Deployment history cleanup with Azure DevOps</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-02-03T00:00:00.000Z">February 3, 2023</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Microsoft Azure has a limit of <a href="https://learn.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits?WT.mc_id=AZ-MVP-5004796#resource-group-limits" target="_blank" rel="noopener noreferrer" title="Resource group limits">800 deployments per resource group</a>. This means that a single resource group can only contain 800 historical deployments at most.</p>
<blockquote>
<p>A deployment in Azure refers to the process of creating or updating resources in a resource group.</p>
</blockquote>
<p>When deploying resources in Azure, it is essential to keep track of the number of <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/deployment-history?tabs=azure-portal&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="View deployment history with Azure Resource Manager">historic deployments</a> in a resource group to ensure that the limit is not exceeded. This is because new deployments will fail if the limit is exceeded, and creating or updating resources in that resource group will not be possible.</p>
<p>If you have CI/CD <em>(Continuous Integration and Continuous Deployment)</em> set up to deploy or change your infrastructure or services with code, it can be easy to reach this limit. <a href="https://learn.microsoft.com/azure/azure-resource-manager/troubleshooting/deployment-quota-exceeded?tabs=azure-cli&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Resolve error when deployment count exceeds 800">Azure will attempt to do this automatically</a> when reaching your limit. Still, you may want to pre-empt any problems if you make many deployments and the system hasn&#x27;t had time to prune automatically, or this is <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/deployment-history-deletions?WT.mc_id=AZ-MVP-5004796&amp;tabs=azure-powershell" target="_blank" rel="noopener noreferrer">disabed</a>.</p>
<p>This came up in conversations on Microsoft Q&amp;A, so I thought I would dig into it and put together a possible option.</p>
<p>To avoid exceeding the deployment limit, it may be necessary to clean up old deployments.</p>
<p>This can be done by using a script to remove deployments that are no longer needed.</p>
<p>So let&#x27;s build an Azure DevOps pipeline that runs weekly to connect to our Microsoft Azure environment and clean up historical deployments.</p>
<p><img decoding="async" loading="lazy" alt="Microsoft Azure Deployment History Cleanup with Azure DevOps" src="/assets/images/azdeploycleanupazdevopsheader-a7837813d2c9d39f1e3b2642b6c8c8c0.png" title="Microsoft Azure Deployment History Cleanup with Azure DevOps" width="1080" height="1080" class="img_ev3q"></p>
<p>For this article, I will assume you have an Azure DevOps repository setup and the permissions <em>(Owner)</em> to make the necessary privileged actions to the Microsoft Azure environment to do the design.</p>
<blockquote>
<p>Note: Scripts and pipeline are &quot;<a href="https://github.com/lukemurraynz/AzDeploymeantCleanup" target="_blank" rel="noopener noreferrer" title="lukemurraynz / AzDeploymeantCleanup">here</a>&quot;.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-and-configure">Deploy and Configure<a href="#deploy-and-configure" class="hash-link" aria-label="Direct link to Deploy and Configure" title="Direct link to Deploy and Configure">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-service-prinicipal">Create Service Prinicipal<a href="#create-service-prinicipal" class="hash-link" aria-label="Direct link to Create Service Prinicipal" title="Direct link to Create Service Prinicipal">​</a></h5>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure"><strong>Microsoft Azure Portal</strong></a></li>
<li>Click on <a href="https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/Overview" target="_blank" rel="noopener noreferrer" title="Microsoft Entra ID"><strong>Microsoft Entra ID</strong></a></li>
<li>Click on <a href="https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps" target="_blank" rel="noopener noreferrer" title="Azure App Registrations"><strong>App Registrations</strong></a></li>
<li>Click on: <strong>+ New Registration</strong></li>
<li>Enter the following information:
<ul>
<li><strong>Name</strong> (i.e. SPN.AzDeploymentCleanup)</li>
</ul>
</li>
<li>Click <strong>Register</strong></li>
<li>Copy the following for later when we add the SPN to Azure DevOps.
<ul>
<li>Application (client) ID</li>
<li>Directory (tenant ID)</li>
</ul>
</li>
<li>Click on <strong>Certificates &amp; Secrets</strong></li>
<li>Press <strong>+ New Client Secret</strong></li>
<li>Enter a relevant description and expiry date and click Add</li>
<li><strong>Copy</strong> the <strong>value</strong> of the new secret (this is essentially your password), and you won&#x27;t be able to see the matter again.</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-custom-role--assign-permissions">Create Custom Role &amp; Assign permissions<a href="#create-custom-role--assign-permissions" class="hash-link" aria-label="Direct link to Create Custom Role &amp; Assign permissions" title="Direct link to Create Custom Role &amp; Assign permissions">​</a></h5>
<p>Now that your service principal has been created, it is time to assign permissions because this script targets all subscriptions under a management group; we are going to set the permissions to that management group so that it flows to all subscriptions underneath it - and in the view of least privileged we will create a Custom Role to apply to our Service Principal.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="create-custom-role">Create Custom Role<a href="#create-custom-role" class="hash-link" aria-label="Direct link to Create Custom Role" title="Direct link to Create Custom Role">​</a></h5>
<p>For the deployment history to be completed, we will need the following permissions:</p>
<ul>
<li>Microsoft.Resources/deployments/delete</li>
<li>Microsoft.Resources/subscriptions/resourceGroups/read</li>
<li>Microsoft.Management/managementGroups/read</li>
<li>Microsoft.Resources/subscriptions/read</li>
<li>Microsoft.Management/managementGroups/descendants/read</li>
<li>Microsoft.Management/managementGroups/subscriptions/read</li>
<li>Microsoft.Resources/subscriptions/resourcegroups/deployments/operations/read</li>
<li>Microsoft.Resources/subscriptions/resourcegroups/deployments/read</li>
<li>Microsoft.Resources/subscriptions/resourcegroups/deployments/write</li>
<li>Microsoft.Resources/deployments/read</li>
</ul>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure"><strong>Microsoft Azure Portal</strong></a></li>
<li>In the search bar above, type in and navigate to <a href="https://portal.azure.com/#view/Microsoft_Azure_ManagementGroups/ManagementGroupBrowseBlade/~/MGBrowse_overview" target="_blank" rel="noopener noreferrer" title="Management Groups"><strong>Management Groups</strong></a></li>
<li>Click a management group, click on <strong>Access Control (IAM)</strong></li>
<li>Click <strong>+ Add</strong></li>
<li>Click <strong>Add Custom Role</strong></li>
<li>Type in a role name <em>(an example is: AzDeploymentHistoryCleanup)</em></li>
<li>Check Start from <strong>Scratch</strong> and next click</li>
<li>Click <strong>+ Add permissions</strong> and the permissions above <em>(you can search for them)</em>. Feel free to import the role from a JSON file &quot;<a href="https://github.com/lukemurraynz/AzDeploymeantCleanup" target="_blank" rel="noopener noreferrer" title="AzDeploymeantCleanup">here</a>&quot;.</li>
<li>Click <strong>Next</strong></li>
<li>Add <strong>Assignable Scopes</strong> <em>(this is the scope you can use to assign a role to - this won&#x27;t give it to the Service Principal; it will only open it up so we can post it)</em>. Make sure you set it at the management group level you are targetting.</li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="assign-permissions">Assign Permissions<a href="#assign-permissions" class="hash-link" aria-label="Direct link to Assign Permissions" title="Direct link to Assign Permissions">​</a></h5>
<p>Now that the custom role has been created, it is time to assign it to the service principal we made earlier.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer" title="Microsoft Azure"><strong>Microsoft Azure Portal</strong></a></li>
<li>In the search bar above, type in and navigate to <a href="https://portal.azure.com/#view/Microsoft_Azure_ManagementGroups/ManagementGroupBrowseBlade/~/MGBrowse_overview" target="_blank" rel="noopener noreferrer" title="Management Groups"><strong>Management Groups</strong></a></li>
<li>Click on the management group you want to manage and click on <strong>Access Control (IAM)</strong></li>
<li>Click <strong>Add</strong></li>
<li>Click <strong>Add Role Assignment</strong></li>
<li>Select your custom role <em>(you can toggle the type column, so CustomRoles are first in the list)</em></li>
<li><img decoding="async" loading="lazy" alt="Microsoft Azure - add role assignments" src="/assets/images/microsoft-azure-add-roleassignments-44ba3750dba22a07e84fe886d31b0ed5.png" title="Microsoft Azure - add role assignments" width="1268" height="301" class="img_ev3q"></li>
<li>Click <strong>Members</strong></li>
<li>Make sure &#x27;<em>User, group or service principal</em>&#x27; is selected and click <strong>+ Select Members</strong></li>
<li><img decoding="async" loading="lazy" alt="Microsoft Azure - Add Roles" src="/assets/images/azdeploycleanupaddrolemembers-eefe616f23e9b8893322680e54162f08.png" title="Microsoft Azure - Add Roles" width="1460" height="363" class="img_ev3q">.</li>
<li>Select your Service Principal created earlier <em>(i.e. SPN.AzDeploymentCleanup)</em></li>
<li>Click <strong>Select</strong></li>
<li>Click <strong>Review + assign</strong> to assign the role.</li>
</ol>
<p>Note: Copy the Management Group ID and name, as we will need the information, along with the Service Principal and tenant IDs from earlier, in the next step of setting up Azure DevOps.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-azure-devops-service-endpoint">Configure Azure DevOps Service Endpoint<a href="#configure-azure-devops-service-endpoint" class="hash-link" aria-label="Direct link to Configure Azure DevOps Service Endpoint" title="Direct link to Configure Azure DevOps Service Endpoint">​</a></h5>
<p>Now that the Service Principal and permissions have been assigned in Azure, it&#x27;s time to create the service connection endpoint that will allow Azure DevOps to connect to Azure.</p>
<ol>
<li>Navigate to your <a href="http://dev.azure.com/" target="_blank" rel="noopener noreferrer" title="Azure DevOps"><strong>Azure DevOps</strong></a> organisation.</li>
<li>Create a <strong>Project</strong>, if you haven&#x27;t already</li>
<li>Click on <strong>Project Settings</strong></li>
<li>Navigate to <strong>Service Connection</strong></li>
<li>Click on <strong>New service connection</strong></li>
<li>Select <strong>Azure Resource Manager</strong></li>
<li>Click <strong>Next</strong></li>
<li>Select <strong>Service principal (manual)</strong></li>
<li>Click <strong>Next</strong></li>
<li>For the scope, choose Group Management</li>
<li>Enter the <strong>Management Group ID</strong>, the <strong>Management Group Name</strong></li>
<li>Time to enter in the Service Principal details copied earlier, for the Service Principal Id paste in the Application ID.</li>
<li>The Service Principal key, enter the secret client value and select the Tenant ID</li>
<li>Click <strong>Verify</strong> - to verify the connectivity to the azure platform from Azure DevOps</li>
<li>Select <strong>Grant access permission to all pipelines</strong> and click <strong>Verify and save</strong></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="configure-script-and-pipeline">Configure script and pipeline<a href="#configure-script-and-pipeline" class="hash-link" aria-label="Direct link to Configure script and pipeline" title="Direct link to Configure script and pipeline">​</a></h5>
<p>Now that we have our:</p>
<ul>
<li>Azure Service Principal</li>
<li>Custom role and assignment</li>
<li>Service connection</li>
</ul>
<p>We now need to import the script and pipeline.</p>
<p>If you haven&#x27;t already done - <a href="https://learn.microsoft.com/azure/devops/repos/git/create-new-repo?view=azure-devops&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Create a new Git repo in your project">create a Repo</a> for the AzHistoryCleanup writing.</p>
<p>You can clone <em>(or copy)</em> the files in the <a href="https://github.com/lukemurraynz/AzDeploymeantCleanup" target="_blank" rel="noopener noreferrer" title="AzDeploymeantCleanup"><strong>AzDeploymentCleanup</strong></a> Repo to your own.</p>
<p>First, we need to copy the name of the Service Principal.</p>
<ol>
<li>Click <strong>Project settings</strong></li>
<li>Click <strong>Service Connections</strong></li>
<li>Click on your <strong>Service Connection</strong> and copy the <strong>name</strong> <em>(i.e. SC.AzDeploymentCleanup)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure DevOps Service Principal" src="/assets/images/azuredevops_spn-03e00cb34617a4158450359ebc328f09.png" title="Azure DevOps Service Principal" width="531" height="316" class="img_ev3q"></li>
<li>Navigate back to your Repo, and click on <strong>AzDeploymentCleanup.yml</strong> (this will become your pipeline)</li>
<li>Click <strong>Edit</strong></li>
<li><img decoding="async" loading="lazy" alt="Edit AzDeploymentCleanup YML" src="/assets/images/select-azure-devops-edityaml-babd1138d1d5b1045dabc98350278290.png" title="Edit AzDeploymentCleanup YML" width="735" height="491" class="img_ev3q"></li>
<li>Update the variable for <strong>ConnectedServiceNameARM</strong> to the name of your service connection</li>
<li>Here you can also edit the <strong>Script Arguments</strong> - for example, in my demo, I am targeting the <strong>ManagementGroup</strong> named: mg-landing zones and keeping the latest five <strong>deployments</strong>.</li>
<li>By default, I also have a <a href="https://learn.microsoft.com/azure/devops/pipelines/process/scheduled-triggers?view=azure-devops&amp;tabs=yaml&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Configure schedules for pipelines">cron job</a> to schedule this pipeline at 6 AM UTC every Sunday, and you can remove or edit this.</li>
<li>Once your changes are made, click <strong>Commit.</strong></li>
<li>Now that your pipeline has been updated, its time to create it - click on <strong>Pipelines.</strong></li>
<li>Click <strong>New Pipeline</strong></li>
<li>Select <strong>Azure Repos Git (YAML)</strong></li>
<li>Select your <strong>Repo</strong></li>
<li><img decoding="async" loading="lazy" alt="Select Azure DevOps repo" src="data:image/png;base64,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" title="Select Azure DevOps repo" width="433" height="148" class="img_ev3q"></li>
<li>Select <strong>Existing Azure Pipelines YAML file</strong></li>
<li><img decoding="async" loading="lazy" alt="Select YAML" src="/assets/images/azdeploycleanupazdevopsselectyaml-b81c2ec52cb0c709c4b5163611d359d7.png" title="Select YAML" width="467" height="277" class="img_ev3q"></li>
<li>Select your Pipeline YAML file and click <strong>Continue</strong></li>
<li>Click <strong>Save</strong> to create the pipeline</li>
<li>Now it&#x27;s time to run the pipeline! Click <strong>Run pipeline</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure DevOps - Pipeline run" src="/assets/images/azdeploycleanupazdevopsscriptrun-83226c31820ad48c32426c9b7155444d.png" title="Azure DevOps - Pipeline run" width="1316" height="889" class="img_ev3q"></li>
<li>If successful, <strong>your script will trigger and clean up the oldest deployment history</strong>! This can take several minutes to run if you have a lot of deployments.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure Deployments - Cleanup - Comparison 1" src="/assets/images/azdeploycleanupazdevopsheader_compare1-e2fc4f6edd527019091df53bb0878edd.png" title="Azure Deployments - Cleanup - Comparison 1" width="1080" height="1080" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Azure Deployments - Cleanup - Comparison 2" src="/assets/images/azdeploycleanupazdevopsheader_compare2-c920b63e53f72ef81341ff1785d0d56f.png" title="Azure Deployments - Cleanup - Comparison 2" width="1080" height="1080" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2023/01/18/you-can-t-touch-this-how-to-make-your-azure-backup-immutable-and-secure/">You Can&#x27;t Touch This: How to Make Your Azure Backup Immutable and Secure</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-01-18T00:00:00.000Z">January 18, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>With <a href="https://learn.microsoft.com/en-us/azure/backup/backup-azure-immutable-vault-concept?tabs=recovery-services-vault&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Immutable vault for Azure Backup">immutable vaults</a>, Azure Backup ensures that recovery points that are once created cannot be deleted before their intended expiry time. Azure Backup does this by preventing any operations which could lead to the loss of backup data.</p>
<p>Hence, this helps you protect your backups against ransomware attacks and malicious actors by disallowing operations such as deleting backups or reducing retention in backup policies.</p>
<blockquote>
<p><a href="https://azure.microsoft.com/en-us/updates/azure-backup-immutable-vaults-ga?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Generally available: Immutable vaults for Azure Backup">Immutable vaults is now Generally available</a> in all regions (March 13th 2023).</p>
</blockquote>
<p>An immutable vault can assist in safeguarding your backup data by prohibiting any actions that might result in the loss of recovery points.</p>
<p><img decoding="async" loading="lazy" alt="Can&amp;#39;t touch this" src="/assets/images/can-ttouchthis_immutability-e90cae5473642f8a860a8e602f7a242f.png" width="4000" height="2250" class="img_ev3q"></p>
<p>By securing the immutable vault setting, it can be made irreversible, which can prevent any unauthorized individuals from disabling the immutability feature and erasing the backups.</p>
<p>The Immutable vault configuration supports both Recovery Services vaults and Backup vaults.</p>
<blockquote>
<p>While Azure Backup stores data in isolation from production workloads, it allows performing management operations to help you manage your backups, including those operations that allow you to delete recovery points. However, in certain scenarios, you may want to make the backup data immutable by preventing any such operations that, if used by malicious actors, could lead to the loss of backups. The Immutable vault setting on your vault enables you to block such operations to ensure that your backup data is protected, even if any malicious actors try to delete them to affect the recoverability of data.</p>
</blockquote>
<p>Enabling immutability for the vault is a reversible operation. However, you can make it irreversible to prevent any malicious actors from disabling it <em>(after disabling it, they can perform destructive functions)</em>.</p>
<p>The type of operations enabling immutability on the Azure Backup vault can prevent and safeguard from is.</p>

























<table><thead><tr><th>System</th><th>Operation type</th><th>Description</th></tr></thead><tbody><tr><td>Recovery Services Vault &amp; Backup Vault</td><td>Stop protection with delete data</td><td>A protected item can&#x27;t have its recovery points deleted before their respective expiry date. However, you can still stop protection of the instances while retaining data forever or until their expiry.</td></tr><tr><td>Recovery Services Vault</td><td>Modify backup policy to reduce retention</td><td>Any actions that reduce the retention period in a backup policy are disallowed on Immutable vault. However, you can make policy changes that result in the increase of retention. You can also make changes to the schedule of a backup policy.</td></tr><tr><td>Recovery Services Vault</td><td>Change backup policy to reduce retention</td><td>Any attempt to replace a backup policy associated with a backup item with another policy with retention lower than the existing one is blocked. However, you can replace a policy with the one that has higher retention.</td></tr></tbody></table>
<p>There are three current states for the immutability of the Backup and Recovery Services Vault:</p>
<ul>
<li>Disabled</li>
<li>Enabled <em>(soft immutability)</em></li>
<li>Enabled and locked <em>(hard immutability)</em></li>
</ul>





















<table><thead><tr><th>State of Immutable vault setting</th><th>Description</th></tr></thead><tbody><tr><td>Disabled</td><td>The vault doesn&#x27;t have immutability enabled and no operations are blocked.</td></tr><tr><td>Enabled</td><td>The vault has immutability enabled and doesn&#x27;t allow operations that could result in loss of backups. However, the setting can be disabled.</td></tr><tr><td>Enabled and locked</td><td>The vault has immutability enabled and doesn&#x27;t allow operations that could result in loss of backups. As the Immutable vault setting is now locked, it can&#x27;t be disabled. Note that immutability locking is irreversible, so ensure that you take a well-informed decision when opting to lock.</td></tr></tbody></table>
<p>Immutable vaults and <a href="https://learn.microsoft.com/en-us/azure/backup/multi-user-authorization-concept?tabs=recovery-services-vault&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Multi-user authorization using Resource Guard">multi-user authorization</a> can safeguard your backups from various human and technological accidents or disruptions.</p>
<p>Immutable vaults will not affect live or hot backups, such as snapshots.</p>
<p>Using the Azure Portal, let us configure immutability on your Azure Backup Vault.</p>
<ol>
<li>Navigate to your <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.RecoveryServices%2Fvaults" target="_blank" rel="noopener noreferrer" title="Recovery Services vaults"><strong>Recovery Services Vault</strong></a></li>
<li>Navigate to <strong>Properties</strong> <em>(under Settings)</em></li>
<li><img decoding="async" loading="lazy" alt="Recovery Services Vault - Immutability" src="/assets/images/azureportal_rsv_configureimmutable-642b78d9ede47e527e1161e3edd4e6e1.png" title="Recovery Services Vault - Immutability" width="1000" height="444" class="img_ev3q"></li>
<li>Under Immutable vault, select <strong>Settings</strong></li>
<li>Click the <strong>box</strong> to enable vault immutability</li>
<li><img decoding="async" loading="lazy" alt="Enable vault immutability" src="/assets/images/azureportal_rsv_configureimmutablecheck-a714aaaa5b57281c441aa4607fba379e.png" title="Enable vault immutability" width="587" height="382" class="img_ev3q"></li>
<li>Click <strong>Apply</strong></li>
<li>The Recovery Services vault will be adjusted, and the status has changed to <strong>Enabled but not locked</strong>; this means that your vault is now immutable and won&#x27;t allow operations that will result in the loss of backups; however, you can reverse the change by unticking vault immutability.</li>
<li><img decoding="async" loading="lazy" alt="Immutable vault - soft" src="data:image/png;base64,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" title="Immutable vault - soft" width="184" height="76" class="img_ev3q"></li>
<li>To hard lock, your vault, navigate back into the Immutable vault settings, toggle Locked, and Apply. <strong>This cannot be undone, so make this decision thought out, as it will stop the ability to reduce retention policies that will cause the deletion of recovery points, which could lead to increased costs in the longer term.</strong></li>
</ol>
<p>The Azure Backup vault immutability can also be adjusted using Azure Bicep, reference below.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">param vaults_name string = &#x27;rsv&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource vaults_name_resource &#x27;Microsoft.RecoveryServices/vaults@2022-09-10&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: vaults_rsv_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: &#x27;australiaeast&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sku: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    name: &#x27;RS0&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    tier: &#x27;Standard&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    securitySettings: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      immutabilitySettings: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        state: &#x27;Unlocked&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The immutabilitySettings states are:</p>





















<table><thead><tr><th>State</th><th>Actions</th></tr></thead><tbody><tr><td>Disabled</td><td>Immutability is Disabled</td></tr><tr><td>Locked</td><td>Enabled but locked</td></tr><tr><td>Unlocked</td><td>Enabled but unlocked</td></tr></tbody></table>
<p><em>Note: I was able to delete a Recovery Vault, with locked Immutability successfully, that didn&#x27;t have any Recovery points.</em></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/2023/01/09/export-icons-to-svg-from-the-microsoft-azure-portal-using-amazing-icon-downloader/">Export icons to SVG from the Microsoft Azure Portal using Amazing Icon Downloader</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-01-09T00:00:00.000Z">January 9, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>Have you ever wanted to export an icon from the Microsoft Azure Portal but found yourself having to screenshot the icon at a low definition to include in your documentation or presentations?</p>
<p>Well - using the <a href="https://github.com/mattl-msft/Amazing-Icon-Downloader" target="_blank" rel="noopener noreferrer" title="logo Amazing Icon Downloader">Amazing Icon Downloader browser</a> plugin, you can export a single or all icons on a specific page in high definition as an SVG (Scalable Vector Graphics) file.</p>
<blockquote>
<p>Easily view all icons on a page, works with:</p>
<ul>
<li>portal.azure.com</li>
<li>endpoint.microsoft.com</li>
<li>Search to filter down long lists of icons</li>
<li>Rename and download any single icon</li>
<li>Bulk download all icons as a .zip file</li>
<li>Works with either Chrome or Edge</li>
</ul>
</blockquote>
<p>The plugin is available on <a href="https://chrome.google.com/webstore/detail/amazing-icon-downloader/kllljifcjfleikiipbkdcgllbllahaob" target="_blank" rel="noopener noreferrer" title="Amazing Icon Downloader">Chrome</a> or <a href="https://microsoftedge.microsoft.com/addons/detail/amazing-icon-downloader/goanjjfecbakkdmbchgoooajnbiafong" target="_blank" rel="noopener noreferrer" title="Amazing Icon Downloader">Edge</a> browser stores and is intuitive.</p>
<p>Once you install it, it is a matter of browsing the page you want and clicking the extension to export.</p>
<p><img decoding="async" loading="lazy" alt="Azure Icon Downloader" src="/assets/images/azure-icon-downloader-f95fe40326a420875b9ecaaf09659234.png" title="Azure Icon Downloader" width="417" height="600" class="img_ev3q"></p>
<p>If you are after Visio stencils and other files, make sure you also check out <a href="https://github.com/David-Summers/Azure-Design" target="_blank" rel="noopener noreferrer" title="David-Summers / Azure-Design">David Summers Azure Stencil collection</a>.</p>
<p>You may run into an issue where a new feature or icon is released, and the stencil collection hasn&#x27;t been updated yet - which is where the Amazing Icon Downloader can come in handy.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/create-azure-ip-groups-based-on-the-ip-address-ranges-of-countries/">Create Azure IP Groups based on the IP address ranges of countries</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-01-02T00:00:00.000Z">January 2, 2023</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div class="markdown"><p>An <a href="https://learn.microsoft.com/azure/firewall/ip-groups?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="IP Groups in Azure Firewall">IP Group</a> in Microsoft Azure is a logical container of IP address ranges for private and public addresses.</p>
<blockquote>
<p>IP Groups allow you to group and manage IP addresses for Azure Firewall rules in the following ways:</p>
<ul>
<li>As a source address in DNAT rules</li>
<li>As a source or destination address in network rules</li>
<li>As a source address in application rules</li>
</ul>
<p>An IP Group can have a single IP address, multiple IP addresses, one or more IP address ranges or addresses and ranges in combination.</p>
</blockquote>
<p>The IP Group allows you to define an IP address that can be used in conjunction with Azure Firewall, to allow or deny internal or external traffic from a perspective set of IP addresses.</p>
<blockquote>
<p>The following IPv4 address format examples are valid to use in IP Groups:</p>
<ul>
<li>Single address: 10.0.0.0</li>
<li>CIDR notation: 10.1.0.0/32</li>
<li>Address range: 10.2.0.0-10.2.0.31</li>
</ul>
</blockquote>
<p>By default, the Azure Firewall blocks outbound and inbound traffic; however, you may want to enable <em>(or block)</em> traffic to and from specific countries - there is no built-in geo-filtering with Azure Firewall, as you can use other services, such as the Web Application Gateway and with the <a href="https://learn.microsoft.com/azure/application-gateway/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="What is Azure Application Gateway?">Application Gateway</a> and <a href="https://learn.microsoft.com/azure/web-application-firewall/afds/waf-front-door-geo-filtering?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="What is geo-filtering on a domain for Azure Front Door Service?">Azure Front Door</a> to block and allow access, and other third party services such as Cloudflare. This script can be adapted for any list of IP ranges; it doesn&#x27;t need to be country IP addresses.</p>
<p>However, you may want to control access to and from specific countries <em>(or other services)</em> with Azure Firewall - this is where the IP Groups can be effective, and because we won&#x27;t be editing the Firewall directly - we won&#x27;t run into issues with delays without having to wait for the Azure Firewall policies to be updated.</p>
<p>To solve the issue of creating the IP groups and finding and keeping the IP groups up-to-date with various countries&#x27; IP ranges - I have created a PowerShell function to retrieve supported <a href="https://www.ipdeny.com/ipblocks/data/aggregated/" target="_blank" rel="noopener noreferrer" title="IP Deny aggregated list">countries</a>&#x27; IP CIDR ranges and create the relevant IP groups.</p>
<p><img decoding="async" loading="lazy" alt="Azure IP Group - Country IP ranges" src="/assets/images/azureipgroupscript-721e9086bd746513f1e421a89e749679.png" title="Azure IP Group - Country IP ranges" width="4000" height="2250" class="img_ev3q"></p>
<p>With IP Groups, there are a few things to keep in mind:</p>
<ul>
<li>You can have 200 IP Groups per firewall with a maximum of <strong>5000 individual IP addresses or prefixes per each IP Group</strong>.</li>
</ul>
<p>For a country like New Zealand, the 5000 limit for the address ranges is acceptable - but for other countries, like the United States or United Kingdom, this can be an issue, where the total IP ranges can grow to over 20k - to deal with this, the script will create multiple IP Groups, and append a number to the end.</p>
<p>Suppose IPs are manually added to the groups. In that case, they won&#x27;t be added - the script will add in any different or new IP ranges, ignoring any current IP ranges (<em>this means it won&#x27;t delete any IP ranges that are removed from the source IP list from IPDeny)</em>; however, I recommend that anything added outside of this script is kept in a separate IP group.</p>
<p><em>As with any script, I recommend this is tested in a test environment first.</em></p>
<p>Before we run it, we need a few prerequisites.</p>
<ul>
<li>At least <a href="https://learn.microsoft.com/powershell/scripting/install/installing-powershell?view=powershell-7.3&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Install PowerShell on Windows, Linux, and macOS">PowerShell 3.0+</a></li>
<li>Azure <a href="https://learn.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-9.2.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Introducing the Azure Az PowerShell module">Az PowerShell Modules</a><em>(specifically Az.Network, Az.Resources)</em></li>
</ul>
<p>The function assumes you have <a href="https://luke.geek.nz/azure/powershell/Using-PowerShell-to-connect-to-Azure/" target="_blank" rel="noopener noreferrer" title="Using PowerShell to connect to Microsoft Azure">connected to Microsoft Azure and your relevant subscription</a>.</p>
<p>Before we import the function, I am going to check if any IP groups already exist quickly <em>(this isn&#x27;t required) -</em> but it&#x27;s a good opportunity to check that you are connected to your Azure subscription and that the AzIPGroup cmdlets exist -  and whether you have any IP groups already existing.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-AzIpGroup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Get-AzIpGroup" src="/assets/images/checkexistingipgroups_empty-e5de11bd4a5063cc4f5e4819d81e9a74.gif" title="Get-AzIpGroup" width="996" height="466" class="img_ev3q"></p>
<p>I have received no errors or existing IP groups in my subscription, so I will continue importing my function.</p>
<p>The function can be found here:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">New-AzCountryIPGroup.p1</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzCountryIPGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.SYNOPSIS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">Creates an Azure IP group, with the IP address ranges for various countrues.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">The code does the following:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">1. It downloads the IP address ranges for the country specified.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">2. It checks if the IP Group already exists, if it does, it adds the IP addresses to the existing IP Group.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">3. If the total number of IP addresses is less than 5000, it will add the IP addresses to the existing IP Group.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">4. If the total number of IP addresses is over 5000, it will create a new IP Group, with the same name as the existing IP Group, and it will add the IP addresses to the new IP Group.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">5. If the new IP Group is over 5000, it will create a new IP Group, with the same name as the existing IP Group, and it will add the IP addresses to the new IP Group.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">6. It will continue to create new IP Groups until all of the IP addresses are added.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">The code can be used to create IP Groups for multiple countries, and if the number of IP addresses is over 5000, it will create multiple IP Groups, with the same name, but with a counter after the name, so that it will be unique.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.EXAMPLE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">New-AzCountryIPGroup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">New-AzCountryIPGroup -CountryCode NZ -IPGroupName IP -IPGroupRGName NetworkRG -IPGroupLocation AustraliaEast</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">.AUTHOR</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">Luke Murray - https://luke.geek.nz/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    #&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token namespace">[CmdletBinding()]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">param</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Parameter(Mandatory = $true, Position = 0)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[System.String]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Parameter(Mandatory = $true, Position = 1)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Object]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Parameter(Mandatory = $true, Position = 2)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[System.String]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[Parameter(Mandatory = $true, Position = 3)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token namespace">[System.String]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPBlocks</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Invoke-WebRequest</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Uri </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;https://www.ipdeny.com/ipblocks/data/aggregated/{0}-aggregated.zone&#x27;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">f </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ToLower</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#Exports the IPBlock content from the HTML request, into a String</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPBlock</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPBlocks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Content </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#Spilts each IP block, into a seperate object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPBlock</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">split </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\s+&#x27;</span><span class="token plain"> </span><span class="token operator">-replace</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\r?\n\r?&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$_</span><span class="token plain"> </span><span class="token operator">-ne</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Length </span><span class="token operator">-lt</span><span class="token plain"> 5000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">If</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Group doesn&#x27;t exist, creating a new IP Group called </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)"> in the following Azure Resource Group </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token string" style="color:rgb(255, 121, 198)"> and location </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">Country = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">If</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzResourceGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">Country = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">Country = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">IpAddresses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Adding </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token string" style="color:rgb(255, 121, 198)"> to </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)">.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzIPGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Group already exists called:</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)"> in the following Azure Resource Group </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token string" style="color:rgb(255, 121, 198)"> and location </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token string" style="color:rgb(255, 121, 198)">. Adding IPs to the group... Please note that this script doesn&#x27;t check already existing IP addresses, if identical IP addresses exist, it will overrite it, if IP addresses outside of the Country List exist, it will remain in the IP Group - but there is no checking, if there is pre-equisting IP addresses in the IP Group that will raise the Group Limit above 5000. I recommend keeping the Country IP group seperate.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">IpAddresses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Adding </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token string" style="color:rgb(255, 121, 198)"> to </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Group</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzIPGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Azure IP Groups only support IPAddresses of up-to 5000 (the country you have specified is: &quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Length</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;), also please make sure the country code matches https://www.ipdeny.com/ipblocks/data/aggregated/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token plain"> = </span><span class="token namespace">[pscustomobject]</span><span class="token plain"> @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> Value = 0 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$groupSize</span><span class="token plain"> = 5000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$groups</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipaddressranges</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Group-Object</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Property </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token namespace">[math]</span><span class="token plain">::Floor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Value+</span><span class="token operator">+</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$groupSize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token plain"> = 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$group</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$groups</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">Get-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">If</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$null</span><span class="token plain"> </span><span class="token operator">-eq</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token string" style="color:rgb(255, 121, 198)"> doesn&#x27;t exist. Creating... </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token string" style="color:rgb(255, 121, 198)"> in the following Resource Group </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token string" style="color:rgb(255, 121, 198)"> and location </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token string" style="color:rgb(255, 121, 198)">.&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token plain"> = </span><span class="token function" style="color:rgb(80, 250, 123)">New-AzIpGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Name </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$countup</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">ResourceGroupName </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupRGName</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Location </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupLocation</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Tag @</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">Country = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CountryCode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose </span><span class="token operator">-</span><span class="token plain">Force</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipgroup</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IP</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">IpAddresses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Adding </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token string" style="color:rgb(255, 121, 198)"> to </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzIPGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipgroup</span><span class="token plain"> = </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$group</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ForEach</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IP</span><span class="token plain"> in </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$ipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">IpAddresses</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    </span><span class="token function" style="color:rgb(80, 250, 123)">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Adding </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$ip</span><span class="token string" style="color:rgb(255, 121, 198)"> to </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$IPGroupName</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$azipgroup</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Set-AzIPGroup</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">Verbose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$counter</span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Note: Make sure your country matches the supported country shortcodes found here:</strong> <a href="https://www.ipdeny.com/ipblocks/data/aggregated/" target="_blank" rel="noopener noreferrer" title="Index of /ipblocks/data/aggregated/"><strong>IPBlock Aggregated</strong></a><strong>. IPDeny is the source for the IP address list.</strong></p>
<p>Once saved to your computer, it&#x27;s time to import it into your active PowerShell terminal and run it <em>(after you have verified you have connected to the correct Azure subscription)</em>.</p>
<p>So I will navigate to the script and import it:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd D:\git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">. .\New-AzCountryIPGroup.ps1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzCountryIPGroup</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Import New-AzCountryIPGroup.ps1" src="/assets/images/import_countryipgrpfunction-696bc2348102c3247c9d087e27e45ba0.gif" title="Import New-AzCountryIPGroup.ps1" width="996" height="466" class="img_ev3q"></p>
<p>The &#x27;New-AzCountryIPGroup&#x27; Azure function relies on 4 parameters:</p>

























<table><thead><tr><th>Parameters</th><th>Values</th></tr></thead><tbody><tr><td>CountryCode</td><td>NZ</td></tr><tr><td>IPGroupName</td><td>IPGrpNZ</td></tr><tr><td>IPGroupRGName</td><td>NetworkRG</td></tr><tr><td>IPGroupLocation</td><td>AustraliaEast</td></tr></tbody></table>
<p>Make sure that the values change to your environment; in my example, I am specifying an IP Group and Resource Group that doesn&#x27;t exist so that the script will create it for me - and the location I will be deploying to will be the Australia East region.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzCountryIPGroup -CountryCode NZ -IPGroupName IPGrpNZ -IPGroupRGName NetworkRG -IPGroupLocation AustraliaEast</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="New-AzCountryIPGroup" src="/assets/images/run_countryipgrpfunctionnz-09be99efe4949ca31baac8d37dac4d6f.gif" title="New-AzCountryIPGroup" width="996" height="466" class="img_ev3q"></p>
<p>As you can see, the script created an Azure Resource Group and imported the New Zealand IP ranges to a new IP Group...</p>
<p>Not required - but if I rerun it, it will simply override any IP addresses that are the same and add any new addresses to the same IP Group that already exists, as below:</p>
<p><img decoding="async" loading="lazy" alt="Rerun New-AzCountryIPGroup" src="/assets/images/rerun_countryipgrpfunctionnz-1c5f53e13bef98c2865c57107f76918e.gif" title="Rerun New-AzCountryIPGroup" width="996" height="466" class="img_ev3q"></p>
<p>The Azure IP Group is visible in the Azure Portal as below:</p>
<p><img decoding="async" loading="lazy" alt="Azure Portal - Azure IP Group " src="/assets/images/azureportal_ipgrpnz-077757e739b3adc55761e2d499b3defb.png" title="Azure Portal - Azure IP Group " width="1660" height="766" class="img_ev3q"></p>
<p>And a Tag was added to include the country:</p>
<p><img decoding="async" loading="lazy" alt="Azure IP Group - Tag" src="/assets/images/azureportal_ipgrpnztag-9c6ec05a965b9d151fdad26326748305.png" title="Azure IP Group - Tag" width="1682" height="310" class="img_ev3q"></p>
<p>As New Zealand was under the 5000 limit, only one IP Group was needed, but if we change the Country Code to the US...</p>
<p><img decoding="async" loading="lazy" alt="Run New-AzCountryIPGroup - US" src="/assets/images/run_countryipgrpfunctionus-5ea57e5b4664923ffabc2c62e26058eb.gif" title="Run New-AzCountryIPGroup - US" width="996" height="469" class="img_ev3q"></p>
<p>It created 5 IP groups, each containing 5000 CIDR IP ranges, with the last containing the remaining IP address ranges.</p>
<p>As you can see, it&#x27;s reasonably easy to create IP Groups containing a list of IP ranges for multiple countries quickly:</p>
<p><img decoding="async" loading="lazy" alt="Azure Portal - Azure IP Groups" src="/assets/images/azureportal_ipgrps-e3190807a83060430e7663c1536f7b9d.png" title="Azure Portal - Azure IP Groups" width="1070" height="434" class="img_ev3q"></p>
<p>Note: The script can also be found in my Public Git Repo <a href="https://github.com/lukemurraynz/Azure" target="_blank" rel="noopener noreferrer">here</a>, feel free to recommend pull requests if you have anything to add or change.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/page/11/"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/page/13/"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/page/12/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Lukes Tech Blog - Unleashing the power of the cloud and other technologies! | luke.geek.nz"><meta data-rh="true" name="description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" property="og:description" content="Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/page/12/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/12/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/page/12/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","@id":"https://luke.geek.nz/page/12","mainEntityOfPage":"https://luke.geek.nz/page/12","headline":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!","description":"Embark on a tech journey with Luke, a Microsoft Azure MVP, as he delves into the cutting-edge realm of Microsoft and Azure Cloud technologies. Explore, learn, and stay ahead in the dynamic world of cloud computing!","blogPost":[{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Changing-default-management-group-for-azure","mainEntityOfPage":"https://luke.geek.nz/azure/Changing-default-management-group-for-azure","url":"https://luke.geek.nz/azure/Changing-default-management-group-for-azure","headline":"Changing the default Management Group in Azure","name":"Changing the default Management Group in Azure","description":"By default, when a Management Group gets created, it goes under the Root Management Group, the same is true for Subscriptions.","datePublished":"2023-07-17T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Access-denied-aztfexport","mainEntityOfPage":"https://luke.geek.nz/azure/Access-denied-aztfexport","url":"https://luke.geek.nz/azure/Access-denied-aztfexport","headline":"Access denied on Azure VM when using aztfexport","name":"Access denied on Azure VM when using aztfexport","description":"When attempting to use aztfexport, a tool designed to export currently deployed Azure resources into HashiCorp Configuration Language (HCL) for use with Terraform, you may get: Access denied.","datePublished":"2023-07-10T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Azure-OpenAI-error-log-summarization","mainEntityOfPage":"https://luke.geek.nz/azure/Azure-OpenAI-error-log-summarization","url":"https://luke.geek.nz/azure/Azure-OpenAI-error-log-summarization","headline":"Azure OpenAI error log summarization with completion","name":"Azure OpenAI error log summarization with completion","description":"I was assisting a user on Microsoft Q&A with an issue, that involved looking over some event logs.","datePublished":"2023-07-10T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Bring-Your-Data-to-Life-with-Azure-OpenAI","mainEntityOfPage":"https://luke.geek.nz/azure/Bring-Your-Data-to-Life-with-Azure-OpenAI","url":"https://luke.geek.nz/azure/Bring-Your-Data-to-Life-with-Azure-OpenAI","headline":"Bring Your Data to Life with Azure OpenAI","name":"Bring Your Data to Life with Azure OpenAI","description":"Today, we will look at using Azure OpenAI and 'Bring Your Data' to allow recent documentation to be referenced and bring life (and relevance) to your data.","datePublished":"2023-07-04T15:15:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]},{"@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Call-to-LLM-failed","mainEntityOfPage":"https://luke.geek.nz/azure/Call-to-LLM-failed","url":"https://luke.geek.nz/azure/Call-to-LLM-failed","headline":"Azure OpenAI - Call to LLM failed","name":"Azure OpenAI - Call to LLM failed","description":"I recently, ran into an error  when attempting to use Azure OpenAI and custom data, in the Chat Playground.","datePublished":"2023-07-04T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[]}]}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.dcdba76e.css">
<script src="/assets/js/runtime~main.192c0a85.js" defer="defer"></script>
<script src="/assets/js/main.1dc10faa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/openai-adoption-challenges-solutions/">Common Challenges and Solutions for Azure OpenAI Adoption</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/policy-deny-creation-azure-openai-studio/">Azure Policy - Deny the creation of Azure OpenAI Studio</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/cloudcloak/">Cloudcloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/storage-queue-triggers-system-managed-identity-powershell/">System Managed Identity in Storage Queue PowerShell Azure Functions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/using-communication-services-and-powershell-to-send-emails/">Azure Communication Services and PowerShell for Email</a></li></ul></div></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Changing-default-management-group-for-azure/">Changing the default Management Group in Azure</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-17T00:00:00.000Z">July 17, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>By default, when a <a href="https://learn.microsoft.com/azure/governance/management-groups/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Management Group</a> gets created, it goes under the Root Management Group, the same is true for <a href="https://learn.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Subscriptions</a>.</p>
<p>This works fine, when you have a simple Microsoft Azure environment, but as soon as you start expanding into areas such as <a href="https://learn.microsoft.com/azure/architecture/landing-zones/subscription-vending?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Subscription vending</a> or limited access to who can see the Root Management Group and start to look into Visual Studio Enterprise subscriptions, you may want to consider moving new subscriptions, under its own Management Group, away from any policies or RBAC controls, essentially into a Management Group that acts as a shopping cart, to then be picked up and moved later.</p>
<p>If we refer to a <a href="https://learn.microsoft.com/azure/cloud-adoption-framework/ready/landing-zone/design-area/resource-org-management-groups?WT.mc_id=AZ-MVP-5004796#management-group-recommendations" target="_blank" rel="noopener noreferrer">recommendation</a> on the Microsoft Cloud Adoption Framework:</p>
<blockquote>
<p>Configure a default, dedicated management group for new subscriptions. This group ensures that no subscriptions are placed under the root management group. This group is especially important if there are users eligible for Microsoft Developer Network (MSDN) or Visual Studio benefits and subscriptions. A good candidate for this type of management group is a <a href="https://learn.microsoft.com/azure/cloud-adoption-framework/ready/considerations/sandbox-environments?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">sandbox</a> management group.</p>
</blockquote>
<p>So, how can we change the default Management Group, that new Subscriptions go into?</p>
<p>Lets take a look at the different ways we could use to update the default management group, that new subscriptions go into.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-using-azure-portal">Configure using Azure Portal<a href="#configure-using-azure-portal" class="hash-link" aria-label="Direct link to Configure using Azure Portal" title="Direct link to Configure using Azure Portal">​</a></h3>
<ol>
<li>Use the search bar to search for and select &#x27;Management groups&#x27;.</li>
<li>On the root management group, select details next to the name of the management group.</li>
<li>Under Settings, select Hierarchy settings.</li>
<li>Select the Change default management group button.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-using-bicep">Configuring using Bicep<a href="#configuring-using-bicep" class="hash-link" aria-label="Direct link to Configuring using Bicep" title="Direct link to Configuring using Bicep">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource symbolicname &#x27;Microsoft.Management/managementGroups/settings@2021-04-01&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">name: &#x27;default&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">parent: resourceSymbolicName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">defaultManagementGroup: &#x27;string&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">requireAuthorizationForGroupCreation: bool</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Reference: <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.management/managementgroups/settings?pivots=deployment-language-bicep&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Microsoft.Management managementGroups/settings</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-using-rest-api-using-powershell">Configure using REST API using PowerShell<a href="#configure-using-rest-api-using-powershell" class="hash-link" aria-label="Direct link to Configure using REST API using PowerShell" title="Direct link to Configure using REST API using PowerShell">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$root_management_group_id = &quot;Enter the ID of root management group&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$default_management_group_id = &quot;Enter the ID of default management group (or use the same ID of the root management group)&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$body = &#x27;{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> &quot;properties&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;defaultManagementGroup&quot;: &quot;/providers/Microsoft.Management/managementGroups/&#x27; + $default_management_group_id + &#x27;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &quot;requireAuthorizationForGroupCreation&quot;: true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$token = (Get-AzAccessToken).Token</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$headers = @{&quot;Authorization&quot;= &quot;Bearer $token&quot;; &quot;Content-Type&quot;= &quot;application/json&quot;}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$uri = &quot;https://management.azure.com/providers/Microsoft.Management/managementGroups/$root_management_group_id/settings/default?api-version=2021-04-01&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Invoke-RestMethod -Method PUT -Uri $uri -Headers $headers -Body $body</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-using-terraform">Configure using Terraform<a href="#configure-using-terraform" class="hash-link" aria-label="Direct link to Configure using Terraform" title="Direct link to Configure using Terraform">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">resource &quot;azurerm_management_group_subscription_association&quot; &quot;example&quot; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">management_group_id = data.azurerm_management_group.example.id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">subscription_id     = data.azurerm_subscription.example.id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note: Not quite the same, as configuring the default setting as above - but you can specify the Managament Group association for subscriptions using Terraform.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Access-denied-aztfexport/">Access denied on Azure VM when using aztfexport</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-10T00:00:00.000Z">July 10, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>When attempting to use <a href="https://github.com/Azure/aztfexport" target="_blank" rel="noopener noreferrer">aztfexport</a>, a tool designed to export currently deployed Azure resources into HashiCorp Configuration Language (HCL) for use with Terraform, you may get: Access denied.</p>
<p>When using aztfexport, the first thing you need to do is make sure you have the <a href="https://learn.microsoft.com/cli/azure/install-azure-cli?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure CLI</a> installed, and run an:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az login</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After logging in, you need to verify you are on the right subscription, by running:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az account show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you are on the right subscription, you don&#x27;t need to do anything. If you are in the wrong subscription then run:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az account list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Find the susbcription ID then use:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az account set --subscription &lt;name or id&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>You only need Reader rights to be able to export the Terraform configuration.</strong></p>
<p>If you find you are still running into access denied issues, such as below:</p>
<p><img decoding="async" loading="lazy" alt="aztfexport - Access denied" src="/assets/images/aztfexport_access_denied-8ef0fba28e1aa69827b029bd565978e3.png" title="aztfexport - Access denied" width="1172" height="458" class="img_ev3q"></p>
<p>And you are running the aztfexport program on an Azure Virtual Machine, such as Azure Virtual Desktop or Devbox, what is happening is the <a href="https://learn.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Managed Identity</a> permissions of your Azure Virtual Machine is overriding your own permissions you used to login to Azure using the CLI.</p>
<p>To get around this, you either have to run aztfexport locally, on a device thats not an Azure Virtual Machine, or supply the Managed Identity of the Virtual Machine, Reader rights to the subscription you wish to do the export from.</p>
<p>You can do this, by navigating to your Azure Virtual Machine, in the Azure Portal, click on the Virtual Machine, select Identity, select Azure role assignments and grant it Reader rights to the Resource Group or Subscription you are targeting.</p>
<p>You could try Disabling the System Assigned Managed Identity as well, which appeared to work for me.</p>
<p>For more information about this error, please refer to the following Github issue: <a href="https://github.com/Azure/aztfexport/issues/380" target="_blank" rel="noopener noreferrer">Access Denied during xport on Azure Virtual Desktop</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Azure-OpenAI-error-log-summarization/">Azure OpenAI error log summarization with completion</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-10T00:00:00.000Z">July 10, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>I was assisting a user on <a href="https://learn.microsoft.com/en-us/answers/questions/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Microsoft Q&amp;A</a> with an issue, that involved looking over some event logs.</p>
<p>The issue itself was related to the Nested Virtualization, with the user unable to install Hyper-V or WSL (Windows Subsystem for Linux), it turned out to be <a href="https://learn.microsoft.com/azure/virtual-machines/trusted-launch?WT.c_id=AZ-MVP-5004796#unsupported-features" target="_blank" rel="noopener noreferrer">incompatilibies with the SKU size and Secure boot</a>.</p>
<p>But as part of troubleshooting this issue, I recreated the Azure compute environment, this user had and started to delve into the Windows logs.</p>
<p>However, in this case I did something a bit different, I exported the logs as text file and opened up <a href="https://learn.microsoft.com/azure/cognitive-services/openai/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure OpenAI</a>, then navigated to Azure OpenAI Studio, clicked on Completion and used the summarization powers of the GPT 3.5 Large language model, to delve into the logs for me:</p>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Summarize Error Log" src="/assets/images/AzureOpenAI_Completion_ErrorLog-7fdb686bacc40f441b9f02ee88ee4925.png" title="Azure OpenAI - Summarize Error Log" width="1541" height="922" class="img_ev3q"></p>
<p>Copying, the Log into the Completion pane of Azure OpenAI</p>
<p>And using  the Prompt of:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Summarize all the errors and warnings from above and sort by potential cause of the issues, with the most likely cause first. Format as a table.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Azure OpenAI was able to use the reasoning ability of the GPT 3.5 LLM (Large language Model) to sort through 115 lines of Logs, and work out the probability of what could be causing the root cause of the issue.</p>
<p>As you can see, Azure OpenAI and the LLMs can not just be used as an assistant in writing, studying it can be learned to assist in Incident and root-cause resolution.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Bring-Your-Data-to-Life-with-Azure-OpenAI/">Bring Your Data to Life with Azure OpenAI</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-04T15:15:00.000Z">July 4, 2023</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Today, we will look at using Azure OpenAI and &#x27;Bring Your Data&#x27; to allow recent documentation to be referenced and bring life (and relevance) to your data.</p>
<p><img decoding="async" loading="lazy" alt="Bring Your Data to Life with Azure OpenAI" src="/assets/images/Header-BringYourDatatoLifewithAzureOpenAI-14aa9bf07355be2435698babf4f6e779.gif" title="Bring Your Data to Life with Azure OpenAI" width="1200" height="628" class="img_ev3q"></p>
<p>The example we are going to use today is the Microsoft Learn documentation for <a href="https://learn.microsoft.com/azure/?product=popular&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Microsoft Azure</a>.</p>
<p>Our scenario is this:</p>
<ul>
<li>We would like to use ChatGPT functionality to query up-to-date information on Microsoft Azure; in this example, we will look for information on Azure Elastic SAN (which was added in late 2022).</li>
</ul>
<p>When querying ChatGPT for Azure Elastic SAN, we get the following:</p>
<p><img decoding="async" loading="lazy" alt="ChatGPT - Azure Elastic SAN Query" src="/assets/images/ChatGPT_Query_AzureElasticSAN-37dd8b8b9753c89bbeda35390dbf8174.png" title="ChatGPT - Azure Elastic SAN Query" width="808" height="338" class="img_ev3q"></p>
<p>Just like the prompt states, ChatGPT only has data up to September 2021 and isn&#x27;t aware of Elastic SAN <em>(or any other changes/updates or new (or retired) services after this date)</em>.</p>
<p>So let us use the Azure OpenAI and bring in outside data <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/chatgpt?pivots=programming-language-chat-completions&amp;WT.mc_id=AZ-MVP-5004796#using-data-for-grounding" target="_blank" rel="noopener noreferrer">(ground data)</a>, in this case, the Azure document library, to overlay on top of the GPT models, giving the illusion the model is aware of the data.</p>
<p>To do this, we will leverage native &#x27;<a href="https://learn.microsoft.com/azure/cognitive-services/openai/use-your-data-quickstart?tabs=command-line&amp;pivots=programming-language-studio&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Bring Your Own Data</a>&#x27; functionality, now in Azure OpenAI - <strong>this is in Public Preview as of 04/07/2023</strong>.</p>
<p><strong>To be clear, I don&#x27;t expect you to start downloading from GitHub; this is just an example I have used to add your data. The ability to bring in updated data on Azure, specifically, will be solved by <a href="https://techcommunity.microsoft.com/t5/ai-cognitive-services-blog/generative-ai-for-developers-exploring-new-tools-and-apis-in/ba-p/3817003?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Plugins</a>, such as Bing Search.</strong></p>
<p>To do this, we will need to provision a few Microsoft Azure services, such as:</p>
<ol>
<li><a href="https://learn.microsoft.com/azure/storage/common/storage-account-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Storage Account</a> <em>(this will hold the Azure document library (markdown files) in a blob container)</em></li>
<li><a href="https://learn.microsoft.com/azure/search/search-what-is-azure-search?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Cognitive Search</a> <em>(this search functionality, is the glue that will hold this solution together, by breaking down and indexing the documents in the Azure blob store)</em></li>
<li><a href="https://learn.microsoft.com/azure/cognitive-services/openai/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure OpenAI</a> <em>(to do this, we will need GPT3.5 turbo or GPT4 models deployed)</em></li>
<li>Optional - <a href="https://learn.microsoft.com/azure/app-service/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Web App</a> <em>(this can be created by the Azure OpenAI service, to give users access to your custom data)</em></li>
</ol>
<p><em><a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/use-your-data-quickstart?tabs=command-line&amp;pivots=programming-language-studio&amp;WT.mc_id=AZ-MVP-5004796#prerequisites" target="_blank" rel="noopener noreferrer">Make sure you have Azure OpenAI approved for your subscription</a></em></p>
<p>We will use the following tools to provision and configure our services:</p>
<ol>
<li>Azure Portal</li>
<li>PowerShell <a href="https://learn.microsoft.com/powershell/azure/install-azure-powershell?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">(Az Modules)</a></li>
<li><a href="https://learn.microsoft.com/azure/storage/common/storage-use-azcopy-v10?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">AzCopy</a></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="download-azure-documents">Download Azure Documents<a href="#download-azure-documents" class="hash-link" aria-label="Direct link to Download Azure Documents" title="Direct link to Download Azure Documents">​</a></h3>
<p>First, we will need the Azure documents to add to our blob storage.</p>
<p>The Microsoft Learn documentation is open-sourced and constantly updated using a git repository hosted on GitHub. We will download and extract the document repository locally <em>(roughly 6 GB)</em>. To do this, we will use a PowerShell script:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $gitRepoUrl = &quot;https://github.com/MicrosoftDocs/azure-docs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $localPath = &quot;C:\temp\azuredocs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $zipPath = &quot;C:\temp\azurdocs.zip&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     #Download the Git repository and extract</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Invoke-WebRequest -Uri &quot;$gitRepoUrl/archive/master.zip&quot; -OutFile $zipPath</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Expand-Archive -Path $zipPath -DestinationPath $localPath</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-storage-account">Create Azure Storage Account<a href="#create-azure-storage-account" class="hash-link" aria-label="Direct link to Create Azure Storage Account" title="Direct link to Create Azure Storage Account">​</a></h3>
<p>Now that we have a copy of the Azure document repository, it&#x27;s time to create an Azure Storage account to copy the data into. To create this storage account, we will use PowerShell.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Login to Azure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Connect-AzAccount</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Set variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $resourceGroupName = &quot;azuredocs-ai-rg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $location = &quot;eastus&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $uniqueId = [guid]::NewGuid().ToString().Substring(0,4)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $storageAccountName = &quot;myaistgacc$uniqueId&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $containerName = &quot;azuredocs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Create a new resource group</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     New-AzResourceGroup -Name $resourceGroupName -Location $location</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Create a new storage account</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     New-AzStorageAccount -ResourceGroupName $resourceGroupName -Name $storageAccountName -Location $location -SkuName Standard_LRS -AllowBlobPublicAccess $false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Create a new blob container</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     New-AzStorageContainer -Name $containerName -Context (New-AzStorageContext -StorageAccountName $storageAccountName -StorageAccountKey (Get-AzStorageAccountKey -ResourceGroupName $resourceGroupName -Name $storageAccountName).Value[0])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We have created our Resource Group and Storage account to hold our Azure documentation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upload-microsoft-learn-documentation-to-an-azure-blob-container">Upload Microsoft Learn documentation to an Azure blob container<a href="#upload-microsoft-learn-documentation-to-an-azure-blob-container" class="hash-link" aria-label="Direct link to Upload Microsoft Learn documentation to an Azure blob container" title="Direct link to Upload Microsoft Learn documentation to an Azure blob container">​</a></h3>
<p>Now that we have the Azure docs repo downloaded and extracted and an Azure Storage account to hold the documents, it&#x27;s time to use AzCopy to copy the documentation to the Azure storage account.
We will use PowerShell to create a SAS token (open for a day) and use that with AzCopy to copy the Azure repo into our newly created container.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Set variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $resourceGroupName = &quot;azuredocs-ai-rg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $storageAccountName = &quot;myaistgacc958b&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $containerName = &quot;azuredocs&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $storageAccountKey = (Get-AzStorageAccountKey -ResourceGroupName $resourceGroupName -Name $storageAccountName).Value[0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $localPath = &quot;C:\Temp\azuredocs\azure-docs-main&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $azCopyPath = &quot;C:\tools\azcopy_windows_amd64_10.19.0\AzCopy.exe&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Construct SAS URL for destination container</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $sasToken = (New-AzStorageContainerSASToken -Name $containerName -Context (New-AzStorageContext -StorageAccountName $storageAccountName -StorageAccountKey $storageAccountKey) -Permission rwdl -ExpiryTime (Get-Date).AddDays(1)).TrimStart(&quot;?&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $destinationUrl = &quot;https://$storageAccountName.blob.core.windows.net/$containerName/?$sasToken&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Run AzCopy command as command line</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $command = &quot;&amp; `&quot;$azCopyPath`&quot; copy `&quot;$localPath`&quot; `&quot;$destinationUrl`&quot; --recursive=true&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Invoke-Expression $command</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Note: I took roughly 6 minutes to copy the Azure docs repo from my local computer (in New Zealand) into a blob storage account in East US, so roughly a gigabyte a minute.</em></p>
<p><img decoding="async" loading="lazy" alt="Azure Storage Account - Microsoft Learn Docs" src="/assets/images/AzureStorage_AzureDocs_UploadedAzCopy-3168f472dca978e719a4ad6d500f63e0.png" title="Azure Storage Account - Microsoft Learn Docs" width="1122" height="635" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-cognitive-search">Create Cognitive Search<a href="#create-cognitive-search" class="hash-link" aria-label="Direct link to Create Cognitive Search" title="Direct link to Create Cognitive Search">​</a></h3>
<p>Now that we have our Azure Blob storage accounts, it&#x27;s time to create our Cognitive Search.
We will need to create a Cognitive Search, with an SKU of Standard, to support the 6GBs of Azure documents that must be indexed. Please check your costs; this is roughly NZ$377.96 a month to run; you can reduce this cost by limiting the amount of data you need to index (i.e., only certain documents, not an entire large repository of markdown files). Make sure you refer to the <a href="https://azure.microsoft.com/pricing/details/search/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Pricing Calculator</a>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Set variables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $resourceGroupName = &quot;azuredocs-ai-rg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $searchServiceName = &quot;azuredocssearchservice&quot; #Cognitive Service name needs to be lowercase.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     # Create a search service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     Install-Module Az.Search</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     $searchService = New-AzSearchService -ResourceGroupName $resourceGroupName -Name $searchServiceName -Location &quot;eastus&quot; -Sku Standard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now that the cognitive search has been created, we need to create the index, and indexers, which will index our Azure documents to be used by Azure OpenAI by creating the index and linking it to the Azuredocs blob container, we created earlier.</p>
<p><em>Note: There is no PowerShell cmdlet support for Azure Cognitive Search indexes; you can create using the <a href="https://learn.microsoft.com/azure/search/search-get-started-powershell?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">RestAPI</a> - but we will do this in the Azure Portal as part of the next step.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-cognitive-search-index">Create Azure Cognitive Search Index<a href="#create-azure-cognitive-search-index" class="hash-link" aria-label="Direct link to Create Azure Cognitive Search Index" title="Direct link to Create Azure Cognitive Search Index">​</a></h3>
<p>It&#x27;s time to time to create the Cognitive Search Index, an indexer that will index the content.</p>
<p>We will move away from PowerShell and into the Microsoft Azure Portal to do this.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Microsoft Azure Portal</a></li>
<li>In the top center search bar, type in Cognitive Search</li>
<li>Click on <a href="https://portal.azure.com/#view/Microsoft_Azure_ProjectOxford/AppliedAIHub/~/CognitiveSearch" target="_blank" rel="noopener noreferrer">Cognitive Search</a></li>
<li>Click on your newly created Cognitive Search
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search" src="/assets/images/AzurePortal_CognitiveSearch_Resource-ff7e924354830c860b415f6a7c7413cd.png" title="Azure Portal - Cognitive Search" width="1422" height="446" class="img_ev3q"></li>
<li>Select Import Data</li>
<li>Select Azure Blob Storage
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Add Azure Blob Storage" src="/assets/images/AzurePortal_CognitiveSearch_AddDataStorage-42bb4d887f49d5e20ede9be7fe5a61e0.png" title="Azure Portal - Cognitive Search" width="671" height="551" class="img_ev3q"></li>
<li>Type in your data source name <em>(i.e., azuredocs)</em></li>
<li>For the Connection string, select Choose an existing connection</li>
<li>Select your Azure Storage account and a container containing the Azure document repository uploaded earlier.</li>
<li>Click Select
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Add Azure Blob Storage" src="/assets/images/AzurePortal_CognitiveSearch_ConnectBlobStorage-0bdd08ffb60559a9fc83270b829cd18d.png" title="Azure Portal - Cognitive Search - Add Azure Blob Storage" width="1429" height="674" class="img_ev3q"></li>
<li>Click Next: Add cognitive skills (Optional)</li>
<li>Here, you can Enrich your data, such as enabling OCR (extracting text from images automatically) or extracting people&#x27;s names, and translating text from one language to another; these enrichments are billed separately, and we won&#x27;t be using any enrichments so we will select Skip to: Customize target index.</li>
<li>Here is the index mapping that was done by Cognitive Search automatically by scanning the schema of the documents. You can bring in additional data about your documents if you want, but I am happy with the defaults, so I click: Next: Create an indexer
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Search Index" src="/assets/images/AzurePortal_CognitiveSearch_SearchIndex-3f2984b586dd5bb7b55d604ac60b0670.png" title="Azure Portal - Cognitive Search - Search Index" width="1210" height="748" class="img_ev3q"></li>
<li>The indexer is what is going to create your index, which will be referenced by Azure OpenAI later; you can schedule an indexer to run hourly, if new data is being added to the Azure blob container where your source files are sitting, for my purposes I am going leave the Schedule as: Once</li>
<li>Uncollapse Advanced Options and scroll down a bit</li>
<li>Here, we can select to only index certain files; for our purposes, we are going to exclude png files, the Azure document repository contains png images files that aren&#x27;t able to be indexed (we aren&#x27;t using OCR), so I am going to optimize the indexing time slightly by excluding them. You can also exclude gif/jpg image files.
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Create Search Indexer" src="/assets/images/AzurePortal_CognitiveSearch_CreateIndexer-80f63d0ec6de7263802dbaf82dd6bdeb.png" title="Azure Portal - Cognitive Search - Create Search Indexer" width="935" height="728" class="img_ev3q"></li>
<li>Finally, hit Submit to start the indexing process. <em>This could take a while, depending on the amount of data</em></li>
<li>Leave this running in the background and navigate to the Cognitive Search resource, Overview pane to see the status.
<img decoding="async" loading="lazy" alt="Azure Portal - Cognitive Search - Indexer" src="/assets/images/AzurePortal_CognitiveSearch_OverviewIndexer.png-e5694fe64cf12b0a6fee286d9bc033d6.png" title="Azure Portal - Cognitive Search - Indexer" width="1751" height="525" class="img_ev3q"></li>
</ol>
<p><em>Note: You can also run the Import Data in Azure OpenAI Studio, which will trigger an index - but you need to keep your browser open and responsive. Depending on how much data you are indexing, doing it manually through this process could be preferred to avoid browser timeout. You also get more options around the index.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-azure-openai">Create Azure OpenAI<a href="#create-azure-openai" class="hash-link" aria-label="Direct link to Create Azure OpenAI" title="Direct link to Create Azure OpenAI">​</a></h3>
<p>Now that we have our base Azure resources, it&#x27;s time to create Azure OpenAI.
Make sure your region and subscription have been approved for Azure OpenAI.</p>
<p>Run the following PowerShell cmdlets to create the Azure OpenAI service:</p>
<p>To create the Azure OpenAI service, we will be using the Azure Portal.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Microsoft Azure Portal</a></li>
<li>In the top center search bar, type in Azure OpenAI</li>
<li>In the Cognitive Services, <a href="https://portal.azure.com/#view/Microsoft_Azure_ProjectOxford/CognitiveServicesHub/~/OpenAI" target="_blank" rel="noopener noreferrer">Azure OpenAI</a> section, click + Create</li>
<li>Select your subscription, region, name, and pricing tier of your Azure OpenAI service (remember certain <a href="https://learn.microsoft.com/azure/cognitive-services/openai/concepts/models?WT.mc_id=AZ-MVP-5004796#model-summary-table-and-region-availability" target="_blank" rel="noopener noreferrer">models</a> are only available in specific regions - we need GPT 3.5+), then select Next
<img decoding="async" loading="lazy" alt="Azure OpenAI - Create Resource" src="/assets/images/AzurePortal_AzureOpenAI_Create-65d3f0e2fed89c4f7923782be9dfae31.png" title="Azure OpenAI - Create Resource" width="718" height="775" class="img_ev3q"></li>
<li>Update your Network Configuration; for this demo, we will select &#x27;All Networks&#x27; - but the best practice is to restrict it. Click Next
<img decoding="async" loading="lazy" alt="Azure OpenAI - Create Resource" src="/assets/images/AzurePortal_AzureOpenAI_CreateSelectNetwork-394a9438b78ff10f3764624e8a5bd091.png" title="Azure OpenAI - Create Resource" width="717" height="843" class="img_ev3q"></li>
<li>If you have any Tags, enter them, then click Next</li>
<li>The Azure platform will now validate your deployment (an example is ensuring that the Azure OpenAI has a unique name). Review the configuration, then click Create to create your resource.
<img decoding="async" loading="lazy" alt="Azure OpenAI - Create Resource" src="/assets/images/AzurePortal_AzureOpenAI_CreateReview-154a2f415ff6929acff748aae408786b.png" title="Azure OpenAI - Create Resource" width="733" height="835" class="img_ev3q"></li>
</ol>
<p>Now that the Azure OpenAI service has been created, you should now have the following:</p>
<ul>
<li>An Azure OpenAI service</li>
<li>A Storage account</li>
<li>A Cognitive Search service</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - RAG Deployed Resources" src="data:image/png;base64,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" title="Azure OpenAI - RAG Deployed Resources" width="1094" height="149" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-model">Deploy Model<a href="#deploy-model" class="hash-link" aria-label="Direct link to Deploy Model" title="Direct link to Deploy Model">​</a></h3>
<p>Now that we have our Azure OpenAI instance, it&#x27;s time to deploy our Chat model.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Microsoft Azure Portal</a></li>
<li>In the top center search bar, type in Azure OpenAI</li>
<li>Open your Azure OpenAI instance to the Overview page, and click: Go to Azure OpenAI Studio</li>
<li>Click on Models, and verify that you have gpt models <em>(ie, gpt-36-turbo, or gpt-4)</em>. If you don&#x27;t, then make sure you have been <a href="https://azure.microsoft.com/en-us/products/cognitive-services/openai-service?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">onboarded</a>.</li>
<li>Once verified, click on Deployments</li>
<li>Click on + Create new deployment</li>
<li>Select your model (I am going to go with gpt-35-turbo), type in a deployment name, and then click Create</li>
<li>Once deployment has been completed, you may have to wait up to 5 minutes for the Chat API to be aware of your new deployment.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Deploy Model" src="/assets/images/Create_AzureOpenAI_GPT3.5_Deployment-420c2e49212da761ab2891b3d7f07009.gif" title="Azure OpenAI - Deploy Model" width="1859" height="924" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-chat-against-your-data">Run Chat against your data<a href="#run-chat-against-your-data" class="hash-link" aria-label="Direct link to Run Chat against your data" title="Direct link to Run Chat against your data">​</a></h3>
<p>Finally, it&#x27;s time to query and work with our Azure documents.</p>
<p>We can do this using the Chat Playground, a feature of Azure OpenAI that allows us to work with our Chat models and adjust <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/concepts/advanced-prompt-engineering?pivots=programming-language-chat-completions&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">prompts</a>.</p>
<p>We will not change the System Prompt (although to get the most out of your own data, I recommend giving it ago); the System Prompt will remain as: You are an AI assistant that helps people find information.</p>
<ol>
<li>Navigate to the <a href="https://portal.azure.com/#home" target="_blank" rel="noopener noreferrer">Microsoft Azure Portal</a></li>
<li>In the top center search bar, type in Azure OpenAI</li>
<li>Open your Azure OpenAI instance to the Overview page, and click: Go to Azure OpenAI Studio</li>
<li>Click Chat</li>
<li>Click Add your data (preview) - if this doesn&#x27;t show, ensure you have deployed a GPT model as part of the previous steps.</li>
<li>Click on + Add a data source</li>
<li>Select the dropdown list in the Select data source pane and select Azure Cognitive Search</li>
<li>Select your Cognitive Search service, created earlier</li>
<li>Select your Index</li>
<li>Check, I acknowledge that connecting to an Azure Cognitive Search account will incur usage to my account. <a href="https://azure.microsoft.com/en-us/pricing/details/search/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">View Pricing</a></li>
<li>Click Next</li>
<li>It should bring in the index metadata; for example - our content data is mapped to content - so I will leave this as is; click Next</li>
<li>I am not utilizing Semantic search, so I click Next</li>
<li>Finally, review my settings and click Save and Close</li>
<li>Now we can verify our own data is getting checked by leaving the: Limit responses to your own data content checked</li>
<li>Then, in the Chat session, in the User message, I type: Tell me about Azure Elastic SAN?</li>
<li>It will now reference the Cognitive Search and bring in the data from the index, including references to the location where it found the data!</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Chat Playground" src="/assets/images/Query_AzureOpenAI_ChatPlayground_AzureDocs-32466787de94187804d0b5195479240b.gif" title="Azure OpenAI -Chat Playground" width="1859" height="924" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional---deploy-to-an-azure-webapp">Optional - Deploy to an Azure WebApp<a href="#optional---deploy-to-an-azure-webapp" class="hash-link" aria-label="Direct link to Optional - Deploy to an Azure WebApp" title="Direct link to Optional - Deploy to an Azure WebApp">​</a></h3>
<p>Interacting with our data in the Chat playground can be an enlightening experience, but we can go a step further and leverage the native tools to a chat interface - straight to an Azure web app.</p>
<p>To do this, we need to navigate back to the Chat playground, ensure you have added your own cognitive search, and can successfully retrieve data from your index.</p>
<ol>
<li>Click on Deploy to</li>
<li>Select A new web app...</li>
<li>If you have an existing WebApp, you can update it with an updated System Message or Search Index from the Chat playground settings, but we will: Create a new web app</li>
<li>Enter a suitable name (i.e., AI-WebApp-Tst - this needs to be unique)</li>
<li>Select the Subscription and Resource Group and location to deploy to. I had issues accessing my custom data, when deployed to Australia East (as AI services are in East US), so I will deploy in the same region as my OpenAI and Cognitive Search service - i.e., East US.</li>
<li>Specify a plan (i.e., Standard (S1))</li>
<li>Click Deploy</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Deploy" src="/assets/images/Deploy_AzureOpenAI_ChatPlayground_WebApp-6edc6b90559c3ffcc0bb7d508724da0c.gif" title="Azure OpenAI -Chat Playground" width="1859" height="924" class="img_ev3q"></p>
<p>Note: Deployment may take up to 10 minutes to deploy; you can navigate to the Resource Group you are deploying to, select Deployments, and monitor the deployment. Once deployed, it can take another 10 minutes for authentication to be configured.</p>
<p>Note: By default, the Azure WebApp is restricted to only be accessible by yourself; you can expand this out by adjusting the <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/use-your-data-quickstart?tabs=command-line&amp;pivots=programming-language-studio&amp;WT.mc_id=AZ-MVP-5004796#important-considerations" target="_blank" rel="noopener noreferrer">authentication</a>.</p>
<p>Once it is deployed, you can access the Chat interface, directly from an Azure WebApp!</p>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Run Azure WebApp" src="/assets/images/Run_AzureOpenAI_ChatPlayground_WebApp-a4d3f087ecc69ddc57fc841e18bcb155.gif" title="Azure OpenAI - Run Azure WebApp" width="1859" height="924" class="img_ev3q"></p>
<p>If you navigate to the WebApp resource in the Azure Portal, and look at the Configuration and Application Settings of your WebApp, you can see variables used as part of the deployment. You can adjust these, but be wary as it could break the WebApp, I would recommend redeploying/updating the WebApp for major changes, from Azure OpenAI studio.
<img decoding="async" loading="lazy" alt="Azure OpenAI - App Service - App Settings" src="/assets/images/AzureOpenAI_AzureAppService_Deployment_AppSettings-eb1fe14d2986e66a4d3e6de2ec0fb234.png" title="Azure OpenAI - App Service - App Settings" width="1179" height="871" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/azure/Call-to-LLM-failed/">Azure OpenAI - Call to LLM failed</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-07-04T00:00:00.000Z">July 4, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>I recently, ran into an error  when attempting to use Azure OpenAI and custom data, in the Chat Playground.
The error I was getting was:</p>
<blockquote>
<p>Error
Cannot connect to host aidocsopenaiaccount.openai.azure.com:443 ssl:default [Name of Service not known]
Call to LLM failed.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Call to LLM failed." src="/assets/images/CalltoLLMFailed_AzureOpenAIError-fe264731a2c2aad7624f785539e26360.png" title="Azure OpenAI - Call to LLM failed." width="793" height="197" class="img_ev3q"></p>
<p>As I was calling data, that was indexed by Azure Cognitive Search, I thought the index was corrupted or invalid, but after mulitple index attempts, continuted to have the same error, all other prompts (not using my custom data) succeeded.</p>
<p>I recreated the Azure OpenAI service, and was able to succesffuly call the custom data, so started to look at the comparisons between the Azure OpenAI instance, that was working and the Azure OpenAI instance that wasn&#x27;t.</p>
<p>I did this by taking a look at the JSON of each Azure OpenAI instance, then did a comparison, and discovered a major difference.</p>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - Diff" src="/assets/images/AzureOpenAI_CalltoLLMFailed_ErrorJSON-4c12966d3fbea4cc1bbdaa92759e2964.png" title="Azure OpenAI - Diff" width="1579" height="327" class="img_ev3q"></p>
<p><em>Note: The one on the left is the working one, the one of the right is the failed one.</em></p>
<p>The version that was working, had an endpoint of https://*.openai.azure.com , and the version that didn&#x27;t work, had a different endpoint: eastus.api.cognitive.microsoft.com.</p>
<p>You can check the JSON output of a resource, by navigating to it on the Azure Portal, in the Overview Pane, clicking JSON view.</p>
<p><img decoding="async" loading="lazy" alt="Azure OpenAI - JSON View" src="/assets/images/CalltoLLMFailed_AzureOpenAI_JSON_View-435e94acdc9925408a6e615449de2e77.png" title="Azure OpenAI - JSON View" width="1843" height="306" class="img_ev3q"></p>
<p>So why would this have been the case?</p>
<p>When I originally created the Azure OpenAI instance that had this issue, I used PowerShell to create the instance:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$skuName = &quot;S0&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$kind = &quot;OpenAI&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Create Cognitive Services resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New-AzCognitiveServicesAccount -ResourceGroupName $resourceGroupName -Name $accountName -Location $location -SkuName $skuName -Kind $kind</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This seemed to call an older API or different schema.</p>
<p>The version that worked, I created using the Azure Portal - which was correct.</p>
<p><strong>If you run into the same problem, then recreate your Azure OpenAI instance using the Azure Portal, or one of the currently supported methods: <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/create-resource?pivots=web-portal&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Create a resource and deploy a model using Azure OpenAI</a>, currently (as of the 4th of July 2023) PowerShell is not a supported method of creating an Azure OpenAI instance, until the cmdlets have been updated.</strong></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/page/11/"><div class="pagination-nav__label">Newer entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/page/13/"><div class="pagination-nav__label">Older entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
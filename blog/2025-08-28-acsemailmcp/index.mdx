---
title:
metaDescription:
tags:
  - Azure
categories:
  - Azure
authors:
  - Luke
slug: azure/
keywords:
  - Azure
description:
date:
---

[Azure Communication Services](https://learn.microsoft.com/azure/communication-services/overview?WT.mc_id=AZ-MVP-5004796) can be used to add voice, video, chat, and SMS and email capabilities to applications. It is a fully managed communication platform that enables developers to build rich communication experiences. Today, we will explore the email capability through an MCP (Model Context Protocol) server hosted on Azure Functions, enabling us to send emails from any MCP client.

{/* truncate */}

We will go through 2 scenarios:

1. Direct MCP Connection to the Function App using the FunctionApp key in our client
2. MCP connection through Azure API Management, authenticating with Entra ID.

![ACS](images/mcp-acs-scenarios.jpg)

The Azure resources used for this are:

- [Azure Functions (.NET)](https://learn.microsoft.com/azure/azure-functions/functions-overview?WT.mc_id=AZ-MVP-5004796)
- [Azure Communication Services](https://learn.microsoft.com/azure/communication-services/overview?WT.mc_id=AZ-MVP-5004796)
- [Email Communication Service](https://learn.microsoft.com/azure/communication-services/concepts/email/email-overview?WT.mc_id=AZ-MVP-5004796)
- [Email Communication Services Domain](https://learn.microsoft.com/azure/communication-services/concepts/email/email-domain-and-sender-authentication?WT.mc_id=AZ-MVP-5004796)
- [User-assigned managed identity](https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/how-manage-user-assigned-managed-identities?pivots=identity-mi-methods-azp&WT.mc_id=AZ-MVP-5004796)
- [Azure API Management](https://learn.microsoft.com/azure/api-management/api-management-key-concepts?WT.mc_id=AZ-MVP-5004796)

![ACS Architecture](images/mcp-acs-email-architecture.jpg)

The Function App is a C# .NET 8 MCP (Model Context Protocol) server; it provides advanced email automation tools using Azure Communication Services (ACS), with support for templates, attachments, and robust error handling.

:::info
I based the Function App on the [Azure-Samples/mcp-sdk-functions-hosting-dotnet](https://github.com/Azure-Samples/mcp-sdk-functions-hosting-dotnet) sample.

![Functions MCP extension](images/mcp-functionapp-architecture-diagram.png)

This sample runs the MCP tools by utilising a custom handler.
:::

5 tools can be accessed from this server:

- SendEmail: Send an email with options (HTML/plain text, attachments, sender/recipient names).
- SendSimpleEmail: Send a plain-text email with minimal parameters.
- SendEmailWithMultipleAttachments: Send an email with multiple attachments.
- SendIncidentEmail: Use a predefined incident template for outage notifications.
- ListEmailTemplates: List available templates and required variables.

To deploy this, we will use [Azure Developer CLI](https://learn.microsoft.com/azure/developer/azure-developer-cli/overview?tabs=windows&WT.mc_id=AZ-MVP-5004796) to deploy the Azure resources and the function app code directly to our Azure environment.

> You can find the code here: [lukemurraynz/acs-email-mcp-server](https://github.com/lukemurraynz/acs-email-mcp-server).
> I will be running this from the devcontainer, which contains the Azure Developer CLI that I will use to deploy.

First, we will `azd auth login` to log in to Azure with credentials that can
Then `azd up` to start the deployment.

![Azure Communication Services](images/mcp-acs-azd-deploy.gif)

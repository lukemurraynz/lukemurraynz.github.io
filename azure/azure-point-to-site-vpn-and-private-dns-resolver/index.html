<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Azure Private DNS Resolver and Azure Point to Site VPN | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/azure/azure-point-to-site-vpn-and-private-dns-resolver/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Azure Private DNS Resolver and Azure Point to Site VPN | luke.geek.nz"><meta data-rh="true" name="description" content="You might access resources such as Azure SQL databases or Azure Storage accounts if you&#x27;re connecting to a Microsoft Azure network externally (from a non-Azure VM or VPN); mainly if you operate Cloud-only services and don&#x27;t have an external DNS provider, such as Active Directory - connecting to private link resources, you may have to edit your local host&#x27;s file and override local DNS to point to the IP of the private endpoint for each service."><meta data-rh="true" property="og:description" content="You might access resources such as Azure SQL databases or Azure Storage accounts if you&#x27;re connecting to a Microsoft Azure network externally (from a non-Azure VM or VPN); mainly if you operate Cloud-only services and don&#x27;t have an external DNS provider, such as Active Directory - connecting to private link resources, you may have to edit your local host&#x27;s file and override local DNS to point to the IP of the private endpoint for each service."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-09-02T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/azure/azure-point-to-site-vpn-and-private-dns-resolver/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/azure-point-to-site-vpn-and-private-dns-resolver/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/azure-point-to-site-vpn-and-private-dns-resolver/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://luke.geek.nz/azure/azure-point-to-site-vpn-and-private-dns-resolver","mainEntityOfPage":"https://luke.geek.nz/azure/azure-point-to-site-vpn-and-private-dns-resolver","url":"https://luke.geek.nz/azure/azure-point-to-site-vpn-and-private-dns-resolver","headline":"Azure Private DNS Resolver and Azure Point to Site VPN","name":"Azure Private DNS Resolver and Azure Point to Site VPN","description":"You might access resources such as Azure SQL databases or Azure Storage accounts if you're connecting to a Microsoft Azure network externally (from a non-Azure VM or VPN); mainly if you operate Cloud-only services and don't have an external DNS provider, such as Active Directory - connecting to private link resources, you may have to edit your local host's file and override local DNS to point to the IP of the private endpoint for each service.","datePublished":"2022-09-02T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://luke.geek.nz/","name":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.dcdba76e.css">
<script src="/assets/js/runtime~main.8bd63cd5.js" defer="defer"></script>
<script src="/assets/js/main.1dc10faa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/openai-adoption-challenges-solutions/">Common Challenges and Solutions for Azure OpenAI Adoption</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/policy-deny-creation-azure-openai-studio/">Azure Policy - Deny the creation of Azure OpenAI Studio</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/cloudcloak/">Cloudcloak</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/storage-queue-triggers-system-managed-identity-powershell/">System Managed Identity in Storage Queue PowerShell Azure Functions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/using-communication-services-and-powershell-to-send-emails/">Azure Communication Services and PowerShell for Email</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Azure Private DNS Resolver and Azure Point to Site VPN</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-09-02T00:00:00.000Z">September 2, 2022</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>You might access resources such as <a href="https://azure.microsoft.com/products/azure-sql/database/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure SQL Database">Azure SQL databases</a> or <a href="https://learn.microsoft.com/azure/storage/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Storage documentation">Azure Storage accounts</a> if you&#x27;re connecting to a Microsoft Azure network externally <em>(</em><a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances?WT.mc_id=AZ-MVP-5004796#azure-provided-name-resolution" target="_blank" rel="noopener noreferrer" title="Name resolution for resources in Azure virtual networks"><em>from a non-Azure VM</em></a> <em>or VPN)</em>; mainly if you operate Cloud-only services and don&#x27;t have an external DNS provider, such as Active Directory - connecting to <a href="https://azure.microsoft.com/services/private-link/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Private Link">private link</a> resources, you may have to edit your local host&#x27;s file and override local DNS to point to the IP of the <a href="https://learn.microsoft.com/en-us/azure/private-link/private-endpoint-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">private endpoint</a> for each service.</p>
<p>This is not sustainable, not scalable, and you might end up throwing your hands in the air and switching back to public-facing services and just whitelisting other users&#x27; Public IPs to gain access to Azure resources - which can lead to its own set of issues, such as unmanaged IPs left with access to resources after contractors or users leave or have finished their work, IP address changes if not managed correctly can allow any user or company to have a direct line of sight to your company resources.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h3>
<blockquote>
<p>Today we will concentrate on DNS resolution of Private Endpoints, using <a href="https://learn.microsoft.com/azure/dns/dns-private-resolver-overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="What is Azure DNS Private Resolver?">Azure DNS Private Resolver</a> as a DNS proxy when connecting to Azure using a <a href="https://learn.microsoft.com/azure/vpn-gateway/point-to-site-about?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="About Point-to-Site VPN">Point to Site VPN</a>.</p>
</blockquote>
<p>For this article, I assume you have an Azure Point to Site already set up; if you don&#x27;t, you can refer to a previous article I wrote for <a href="https://luke.geek.nz/azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication/" target="_blank" rel="noopener noreferrer" title="Create Azure Point to Site VPN using Microsoft Entra ID authentication">Creating an Azure Point to Site VPN using Microsoft Entra ID authentication</a>.</p>
<p><em>Disclaimer: Azure Private DNS Resolver is still in Public Preview at the time of this article (02/09/2022). If you aim to use this in a Production scenario, functionality and services may change. This also means there are current</em> <a href="https://learn.microsoft.com/en-us/azure/dns/dns-private-resolver-overview?WT.mc_id=AZ-MVP-5004796#regional-availability" target="_blank" rel="noopener noreferrer" title="Regional availability"><em>regional restrictions</em></a><em>, and Azure Private DNS Resolver is not currently available in all regions. Also bear in mind the <a href="https://azure.microsoft.com/en-us/pricing/details/dns/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">cost</a> of this service.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="so-what-is-azure-dns-resolver">So what is Azure DNS Resolver?<a href="#so-what-is-azure-dns-resolver" class="hash-link" aria-label="Direct link to So what is Azure DNS Resolver?" title="Direct link to So what is Azure DNS Resolver?">​</a></h4>
<blockquote>
<p>Azure DNS private resolver is a cloud-native, highly available, and DevOps-friendly service. It provides a simple, zero-maintenance, reliable, and secure Domain Name System (DNS) service to resolve and conditionally forward DNS queries from a virtual network, on-premises, and to other target DNS servers without the need to create and manage a custom DNS solution. Resolve DNS names hosted in Azure Private DNS Zones from on-premises networks as well as DNS queries for your own domain names. This will make your DNS infrastructure work privately and seamlessly across on-premises networks and enable key hybrid networking scenarios.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Azure Private DNS Resolver" src="/assets/images/azureprivatednsresolver-4c404d86c4b02c7983291a85be0c88ab.png" title="Azure Private DNS Resolver" width="1024" height="359" class="img_ev3q"></p>
<p>Customers will no longer need to provision IaaS-based solutions on their virtual networks to resolve names registered on Azure Private DNS Zones and can do conditional forwarding of domains back to on-premises, across multi-cloud providers, and public DNS servers.</p>
<p>This solution can work with your Azure ExpressRoute, Azure VPN, or Azure Bastion setup.</p>
<p><img decoding="async" loading="lazy" alt="Azure Private DNS Resolver" src="/assets/images/dns-private-resolver-dcfc200b42cb3204440b0a61fa7696c7.png" title="Azure Private DNS Resolver" width="996" height="761" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="inbound-or-outbound">Inbound or Outbound?<a href="#inbound-or-outbound" class="hash-link" aria-label="Direct link to Inbound or Outbound?" title="Direct link to Inbound or Outbound?">​</a></h4>
<p>Name resolution queries for Azure workloads from the on-premises network are conditionally forwarded to the Azure DNS private resolver inbound endpoint, which enables you to perform name resolution of workloads registered on Azure Private DNS Zones from on-premises.</p>

















<table><thead><tr><th>Endpoint</th><th>Blurb</th></tr></thead><tbody><tr><td>Inbound Endpoint</td><td>Azure DNS private resolver inbound endpoint that receives the name resolution request from Azure &amp; on-premises network and resolve names.</td></tr><tr><td>Outbound Endpoint</td><td>Azure DNS private resolver outbound endpoint conditionally forwards the request to on-premises or other target DNS servers.</td></tr></tbody></table>
<p>The Azure DNS private resolver inbound endpoint has a private IP that is part of a subnet where the endpoint has been created. The IP address of the DNS private resolver inbound endpoint is then set as a DNS server on the on-premises network.</p>
<p>Azure DNS private resolver outbound endpoint conditionally forwards the request to on-premises or other target DNS servers.</p>
<p><strong>Today, we will connect to private endpoints to concentrate on the Inbound functionality of Azure Private DNS Resolver.</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h3>
<p>To deploy Azure Private DNS Resolver, we will need a few things.</p>
<ul>
<li>A Virtual Network</li>
<li>A <a href="https://learn.microsoft.com/en-us/azure/dns/dns-private-resolver-overview#subnet-restrictions" target="_blank" rel="noopener noreferrer" title="Subnet restrictions">subnet</a> dedicated to resolving DNS queries <em>(/28)</em></li>
<li>A private endpoint <em>(i.e. Storage Account, SQL Database)</em> is linked to the virtual network.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-dns-private-resolver">Deploy DNS Private Resolver<a href="#deploy-dns-private-resolver" class="hash-link" aria-label="Direct link to Deploy DNS Private Resolver" title="Direct link to Deploy DNS Private Resolver">​</a></h4>
<p><em>I assume you already have a Virtual Network tied to your Virtual Network gateway as part of the &#x27;</em><a href="https://luke.geek.nz/azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication/" target="_blank" rel="noopener noreferrer" title="Create Azure Point to Site VPN using Microsoft Entra ID authentication "><em>Point to Site VPN</em></a><em>&#x27; setup.</em></p>
<ol>
<li>Open the <strong>Azure Portal</strong></li>
<li>Click on <strong>+ Create a resource</strong></li>
<li>Type in: <strong>DNS Private Resolver</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure DNS Private Resolver" src="/assets/images/azureportal_creatednsprivateresolver-33c258ace55eb68526f3922fee2af519.png" title="Azure DNS Private Resolver" width="720" height="406" class="img_ev3q"></li>
<li>Click <strong>Create</strong></li>
<li>Select your <strong>Subscription</strong></li>
<li>Select your <strong>Resource Group</strong> <em>(I recommend placing the DNS Private Resolver in the same resource group as your Virtual Network - but place this service in a Resource Group that makes sense for your environment, i.e. shared services or a specific network team resource group)</em></li>
<li>Type in a <strong>name</strong> for your DNS Private Resolver <em>(this is a regional service, but the name does not need a globally unique )</em></li>
<li><strong>Select</strong> your <strong>region</strong> <em>(this needs to be the same region as the Virtual Network)</em></li>
<li>Select your <strong>Virtual Network</strong> <em>(the same Virtual Network that has your Virtual Network Gateway for the Point to Site VPN and your Private endpoints)</em></li>
<li><img decoding="async" loading="lazy" alt="Create Azure Private DNS Resolver" src="/assets/images/azureportal_creatednsprivateresolverinitialpane-906b5f61558a146df1026d883cf8c346.png" title="Create Azure Private DNS Resolver" width="1111" height="952" class="img_ev3q"></li>
<li>Click <strong>Next: Inbound Endpoints &gt;</strong></li>
<li>Now its time to add our Inbound Endpoint and create the Private DNS Resolver Subnet, click <strong>+ Add an endpoint</strong></li>
<li>Type in your <strong>endpoint name</strong> (<em>for example, InboundEndpoint)</em></li>
<li>If you have already created a subnet, select it - else, click <strong>Create New</strong></li>
<li>Enter in your subnet name and address range</li>
<li>Click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Private DNS Resolver create subnet" src="/assets/images/azureportal_creatednsprivateresolversubnet-c5317b1ede5669a85b8fec9e0128e0bc.png" title="Private DNS Resolver create subnet" width="869" height="820" class="img_ev3q"></li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="adjust-point-to-site-dns">Adjust Point to Site DNS<a href="#adjust-point-to-site-dns" class="hash-link" aria-label="Direct link to Adjust Point to Site DNS" title="Direct link to Adjust Point to Site DNS">​</a></h4>
<p>Now that the DNS Resolver has been created, with an inbound endpoint, allowing the lookup of private endpoints, we need to add the Private Resolver DNS relay to our point-to-site VPN configuration; first, we need the newly created private IP of the inbound endpoint.</p>
<ol>
<li>
<p>Navigate to the <a href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FdnsResolvers" target="_blank" rel="noopener noreferrer" title="DNS Private Resolvers"><strong>DNS Private Resolver</strong></a> in the Azure Portal</p>
</li>
<li>
<p><strong>Open</strong> your DNS Private <strong>Resolver service</strong></p>
</li>
<li>
<p>Click on <strong>Inbound Endpoints</strong></p>
</li>
<li>
<p>Make a note of the <strong>private IP</strong> of your inbound endpoint.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Private DNS Resolver" src="/assets/images/azureportal_creatednsprivateresolverinboundendpointip-74c4c2319aca5b4e08d6bf74830e94a9.png" title="Private DNS Resolver" width="1344" height="608" class="img_ev3q"></p>
</li>
<li>
<p>Now that the Private Inbound resolver has been configured, we need to add the DNS relay into our Azure VPN configuration so that our DNS queries will respond with a private endpoint; you will need to modify the &#x27;<a href="https://learn.microsoft.com/en-us/azure/vpn-gateway/about-vpn-profile-download?WT.mc_id=AZ-MVP-5004796#generate" target="_blank" rel="noopener noreferrer" title="Generate profile files">azurevpnconfig.xml</a>&#x27; file and reimport the VPN.</p>
</li>
<li>
<p>Right-click &#x27;azurevpnconfig.xml&#x27; and edit in Notepad or Visual Studio Code</p>
</li>
<li>
<p>Under: </p>
</li>
<li>
<p><strong>Add</strong> <em>(replace the IP listed below with the IP of your Inbound endpoint copied earlier)</em>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;clientconfig&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;dnsservers&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;dnsserver&gt;10.0.18.4&lt;/dnsserver&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/dnsservers&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/clientconfig&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Save</strong> and <strong>reimport</strong> to the Azure VPN Client</p>
</li>
<li>
<p>Once connected, ping a resource behind a private endpoint, and you should get the private IP of that resource back and should be able to connect to that resource privately.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="Azure Private DNS Resolver ping" src="/assets/images/azurevpn_testprivateendpoint-792e91e84c0ad7f88d37f63e460edfdb.png" title="Azure Private DNS Resolver ping" width="1625" height="212" class="img_ev3q"></p>
</li>
</ol>
<p>Any future or current private endpoints linked to the same Virtual Network will instantly be accessible without additional changes on the Azure VPN client.
If you have a Hub &amp; Spoke topology, then you may place the DNS Private Resolver in the HUB, then use <a href="https://learn.microsoft.com/en-us/azure/dns/dns-private-resolver-get-started-portal?WT.mc_id=AZ-MVP-5004796#link-your-forwarding-ruleset-to-the-second-virtual-network" target="_blank" rel="noopener noreferrer">forwarding rules</a> to link to other peered VNETs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-resources">Additional resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional resources" title="Direct link to Additional resources">​</a></h3>
<p>The third-party resources below include reading and learning about the Azure Private DNS Resolver.</p>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/dns/dns-private-resolver-get-started-portal?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Quickstart: Create an Azure private DNS Resolver using the Azure portal">Quickstart: Create an Azure private DNS Resolver using the Azure portal</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/learn/modules/intro-to-azure-dns-private-resolver/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Intro to Azure DNS Private Resolver">Intro to Azure DNS Private Resolver</a></p>
</li>
<li>
<p><a href="https://github.com/dawlysd/azure-dns-private-resolver-microhack" target="_blank" rel="noopener noreferrer" title="Azure DNS Private Resolver - MicroHack">Azure DNS Private Resolver - MicroHack</a></p>
</li>
<li>
<p>My Azure Private DNS Resolver Bicep export for reference:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  param dnsResolvers_PrivateDNSResolver_name string = &#x27;PrivateDNSResolver&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  param virtualNetworks_vnettest_externalid string = &#x27;/subscriptions/57627713-eff2-44fa-a546-a2c8fde3c6e3/resourceGroups/pointtositetest/providers/Microsoft.Network/virtualNetworks/vnettest&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  resource dnsResolvers_PrivateDNSResolver_name_resource &#x27;Microsoft.Network/dnsResolvers@2020-04-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  name: dnsResolvers_PrivateDNSResolver_name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location: &#x27;australiaeast&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  properties: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  virtualNetwork: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    id: virtualNetworks_vnettest_externalid</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          resource dnsResolvers_PrivateDNSResolver_name_InboundEndpoint &#x27;Microsoft.Network/dnsResolvers/inboundEndpoints@2020-04-01-preview&#x27; = {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">parent: dnsResolvers_PrivateDNSResolver_name_resource</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">name: &#x27;InboundEndpoint&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">location: &#x27;australiaeast&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/azure/internalservererror-when-deploying-azure-firewall/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">InternalServerError when deploying Azure Firewall</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/ims-payroll-not-opening-as-a-published-application-in-azure-virtual-desktop/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">IMS Payroll not opening as a published application in Azure Virtual Desktop</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#so-what-is-azure-dns-resolver" class="table-of-contents__link toc-highlight">So what is Azure DNS Resolver?</a></li><li><a href="#inbound-or-outbound" class="table-of-contents__link toc-highlight">Inbound or Outbound?</a></li></ul></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a><ul><li><a href="#deploy-dns-private-resolver" class="table-of-contents__link toc-highlight">Deploy DNS Private Resolver</a></li><li><a href="#adjust-point-to-site-dns" class="table-of-contents__link toc-highlight">Adjust Point to Site DNS</a></li></ul></li><li><a href="#additional-resources" class="table-of-contents__link toc-highlight">Additional resources</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
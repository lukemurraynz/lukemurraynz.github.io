<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Monitor your Azure Landing Zone with Baseline Alerts | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/azure/Monitor-Azure-LandingZones-with-AMBA/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Monitor your Azure Landing Zone with Baseline Alerts | luke.geek.nz"><meta data-rh="true" name="description" content="Monitor your Azure Landing Zone with Azure Monitor Baseline Alerts (AMBA)."><meta data-rh="true" property="og:description" content="Monitor your Azure Landing Zone with Azure Monitor Baseline Alerts (AMBA)."><meta data-rh="true" name="keywords" content="azure,monitor,landing zones"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-10-21T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/azure/Monitor-Azure-LandingZones-with-AMBA/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/Monitor-Azure-LandingZones-with-AMBA/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/Monitor-Azure-LandingZones-with-AMBA/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.4a383e58.css">
<script src="/assets/js/runtime~main.3ebc29d6.js" defer="defer"></script>
<script src="/assets/js/main.4f3380ca.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Happy New Year! This is a redesign of my website, hopefully you like it!</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog Archive</a></div><div class="navbar__items navbar__items--right"><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/microsoft-copilot-azure-preview/">Microsoft Copilot for Azure - Preview</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/Azure-DevTest-Subscription-Considerations/">Azure Dev/Test Subscription considerations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/Azure-Image-Builder-Build-Pipeline-with-Azure-DevOps/">Azure Image Builder Image Build with Bicep and Azure DevOps</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/misc/Book-Review-Azure-architecture-explained/">Book Review Azure Architecture Explained</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/Working-with-CIDR-Azure-Bicep/">Mastering CIDRs With Azure Bicep</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Monitor your Azure Landing Zone with Azure Monitor Baseline Alerts (AMBA)."><meta itemprop="keywords" content="azure,monitor,landing zones"><header><h1 class="title_f1Hy" itemprop="headline">Monitor your Azure Landing Zone with Baseline Alerts</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-10-21T00:00:00.000Z" itemprop="datePublished">October 21, 2023</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Luke Murray</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><blockquote>
<p>When deploying Azure resources, it is crucial to configure alerts to ensure your resources&#x27; health, performance, and security.</p>
</blockquote>
<p>By setting up alerts, you can proactively monitor your resources and take timely actions to address any issues that may arise.
Here are the key reasons why configuring alerts is essential:</p>
<ul>
<li>Early detection of issues: Alerts enable you to identify potential problems or anomalies in your Azure resources at an early stage. By monitoring key metrics and logs, you can detect high CPU usage, low memory, network connectivity problems, or security breaches. This allows you to take immediate action and prevent any negative impact on your applications or services.</li>
<li>Reduced downtime: By configuring alerts, you can minimise downtime by being notified of critical events or failures in real time. This allows you to quickly investigate and resolve issues before they escalate, ensuring the availability and reliability of your applications.</li>
<li>Optimized resource utilisation: Alerts help you optimise resource utilization by providing insights into resource usage patterns and trends. By monitoring metrics such as CPU utilisation, memory consumption, or storage capacity, you can identify opportunities for optimisation and cost savings.</li>
<li>Compliance and security: Configuring alerts is essential for maintaining compliance with regulatory requirements and ensuring the security of your Azure resources. By monitoring security logs and detecting suspicious activities or unauthorised access attempts, you can immediately mitigate potential risks and protect your data.</li>
<li>Proactive capacity planning: Alerts provide valuable information for capacity planning and scaling your resources. By monitoring resource utilisation trends over time, you can identify patterns and forecast future resource requirements. This helps you avoid performance bottlenecks and ensure a smooth user experience.&quot;</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p><a href="https://azure.github.io/azure-monitor-baseline-alerts/welcome/" target="_blank" rel="noopener noreferrer">Azure Monitor Baseline Alerts (AMBA)</a> exists to help you get started with proactive and reactive monitoring straight out of the bat, focused on standard scenarios for your platform and application Landing Zone that are not industry or application-specific.</p>
<p>Previously under the azure/alz-monitor repository, it is now generally available under the <a href="https://github.com/Azure/azure-monitor-baseline-alerts" target="_blank" rel="noopener noreferrer">Azure/azure-monitor-baseline-alerts</a> GitHub repository.</p>
<p>The objectives of AMBA are to:</p>
<ul>
<li>Help simplify onboarding to Azure Monitor through a scalable and consistent approach.</li>
<li>Reduce time to identify failure within Azure tenants and platforms (i.e., outages).</li>
</ul>
<p>More documentation can be found on the official Microsoft Learn documentation page: <a href="https://learn.microsoft.com/azure/cloud-adoption-framework/ready/landing-zone/design-area/management-monitor?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Monitor Azure platform landing zone components</a>.</p>
<p><img loading="lazy" alt="Monitor your Azure Landing Zone with Azure Monitor Baseline Alerts" src="/assets/images/BlogHeading_AMBA-4541fb6c736b8f04e653ed4bfa7018fb.gif" width="1200" height="628" class="img_ev3q"></p>
<blockquote>
<p>&quot;AMBA Provides best practice guidance around creating and configuring Azure Monitor Alerts for Azure services and workload pattern/scenarios).&quot;</p>
</blockquote>
<p>One of the ways that makes Azure Monitor Baseline Alerts (AMBA) so useful is the details around the Alerts.</p>
<p>Reference: <a href="https://azure.github.io/azure-monitor-baseline-alerts/patterns/alz/Alerts-Details/" target="_blank" rel="noopener noreferrer">Alerts Details</a></p>
<p>Out-of-the-box alerts that are part of the base AMBA solution include (but are not limited to) alerts such as:</p>









































































































































<table><thead><tr><th><strong>Resource Type</strong></th><th><strong>Name</strong></th><th><strong>Description</strong></th><th><strong>metricName</strong></th></tr></thead><tbody><tr><td>automationAccounts</td><td>TotalJob</td><td>The total number of jobs</td><td>TotalJob</td></tr><tr><td>storageAccounts</td><td>Availability</td><td>The percentage of availability for the storage service or the specified API operation. Availability is calculated by taking the TotalBillableRequests value and dividing it by the number of applicable requests, including those that produced unexpected errors. All unexpected errors result in reduced availability for the storage service or the specified API operation.</td><td>Availability</td></tr><tr><td>virtualMachines</td><td>Available Memory Bytes (MBytes)</td><td>Amount of physical memory, in bytes, immediately available for allocation to a process or for system use in the Virtual Machine</td><td>Available Memory Bytes</td></tr><tr><td>virtualMachineScaleSets</td><td>Percentage CPU</td><td>The percentage of allocated compute units that are currently in use by the Virtual Machine(s)</td><td>Percentage CPU</td></tr><tr><td>virtualMachineScaleSets</td><td>OS Disk IOPS Consumed Percentage</td><td>Percentage of operating system disk I/Os consumed per minute</td><td>OS Disk IOPS Consumed Percentage</td></tr><tr><td>virtualMachineScaleSets</td><td>Data Disk IOPS Consumed Percentage</td><td>Percentage of data disk I/Os consumed per minute</td><td>Data Disk IOPS Consumed Percentage</td></tr><tr><td>virtualMachineScaleSets</td><td>Outbound Flows</td><td>Outbound Flows are number of current flows in the outbound direction (traffic going out of the VM)</td><td>Outbound Flows</td></tr><tr><td>virtualMachineScaleSets</td><td>Inbound Flows</td><td>Inbound Flows are number of current flows in the inbound direction (traffic going into the VM)</td><td>Inbound Flows</td></tr><tr><td>virtualMachineScaleSets</td><td>Available Memory Bytes</td><td>Amount of physical memory, in bytes, immediately available for allocation to a process or for system use in the Virtual Machine</td><td>Available Memory Bytes</td></tr><tr><td>virtualMachineScaleSets</td><td>Network In Total</td><td>The number of bytes received on all network interfaces by the Virtual Machine(s) (Incoming Traffic)</td><td>Network In Total</td></tr><tr><td>virtualMachineScaleSets</td><td>Network Out Total</td><td>The number of bytes out on all network interfaces by the Virtual Machine(s) (Outgoing Traffic)</td><td>Network Out Total</td></tr><tr><td>virtualMachineScaleSets</td><td>VmAvailabilityMetric</td><td>Measure of Availability of Virtual machines over time.</td><td>VmAvailabilityMetric</td></tr><tr><td>virtualMachineScaleSets</td><td>Disk Read Operations/Sec</td><td>Disk Read IOPS</td><td>Disk Read Operations/Sec</td></tr><tr><td>virtualMachineScaleSets</td><td>Disk Write Operations/Sec</td><td>Disk Write IOPS</td><td>Disk Write Operations/Sec</td></tr><tr><td>virtualNetworks</td><td>If Under DDoS Attack</td><td>Metric Alert for VNet DDOS Attack</td><td>ifunderddosattack</td></tr><tr><td>publicIPAddresses</td><td>Bytes In DDoS</td><td>Metric Alert for Public IP Address Bytes IN DDOS</td><td>bytesinddos</td></tr><tr><td>publicIPAddresses</td><td>If Under DDoS Attack</td><td>Metric Alert for Public IP Address Under Attack</td><td>ifunderddosattack</td></tr><tr><td>publicIPAddresses</td><td>Packets In DDoS</td><td>Inbound packets DDoS</td><td>PacketsInDDoS</td></tr><tr><td>publicIPAddresses</td><td>VIP Availability</td><td>Average IP Address availability per time duration</td><td>VipAvailability</td></tr><tr><td>expressRouteCircuits</td><td>ARP Availability</td><td>ARP Availability from MSEE towards all peers.</td><td>ArpAvailability</td></tr><tr><td>expressRouteCircuits</td><td>BGP Availability</td><td>BGP Availability from MSEE towards all peers.</td><td>BgpAvailability</td></tr></tbody></table>
<p>For:</p>
<ul>
<li>Metric Alerts</li>
<li>Log Alerts</li>
<li>Activity Logs</li>
<li>Service health alerts</li>
</ul>
<p><img loading="lazy" alt="Graph 1" src="/assets/images/AMBA_Graph1-f30bccd2d6df4eab870db69e9e353897.png" width="601" height="402" class="img_ev3q"></p>
<p><img loading="lazy" alt="Graph 2" src="/assets/images/AMBA_Graph1-f30bccd2d6df4eab870db69e9e353897.png" width="601" height="402" class="img_ev3q"></p>
<p><img loading="lazy" alt="Monitoring Management Resource Group" src="/assets/images/AMBA_MangementRG-903b2179cc0ace1ffb95df070e136ec1.png" width="903" height="567" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h2>
<p>The Azure Monitor Baseline Alerts are deployed using Azure Policy <em>(DINE – Deploy If Not Exist)</em> and are included in the <a href="https://github.com/Azure/Enterprise-Scale" target="_blank" rel="noopener noreferrer">Azure Enterprise-Scale landing zone accelerator</a>.</p>
<p>Deployment is currently done via an Azure Resource Manager (ARM) template and can be deployed with the following:</p>
<ul>
<li>PowerShell</li>
<li>Azure CLI</li>
<li>GitHub Actions
DevOps</li>
</ul>
<p>Because the Azure Monitor Baseline alerts are intended to follow the Azure Landing Zone framework, in accordance with the Ready phase of the Cloud Adoption Framework, the deployment can be scaled across multiple Management groups, such as:</p>
<ul>
<li>Connectivity</li>
<li>Identity</li>
<li>Management</li>
<li>Service Health</li>
<li>Landing Zone (i.e., Application)</li>
</ul>
<p>Or a single management group/subscription consisting of all features, with Alert processing rules sending relevant subscription alerts to an Action group that will notify by email if an alert is raised.</p>
<p>For my own Azure environment, I only have 2 Subscriptions that sit under the following Management Group hierarchy:</p>
<p><img loading="lazy" alt="Management Group structure" src="/assets/images/AMBA_LukeGeekNZMG-e1e01c737a3d7e5424f03b226e4325b6.png" width="503" height="346" class="img_ev3q"></p>
<p>We will deploy these initiatives to the MG Management Group, which allows us to then Assign those initiatives to anything beneath it, in our case, the mg-landingzones and trey-platform management groups.</p>
<p>As part of the deployment, we will adjust the following parameters to match our environment:</p>
<ul>
<li>Management groups</li>
<li>Assignment of PolicySetDefinitions</li>
<li>Resource Group Name and Tags</li>
<li>Location</li>
<li>Action group emails</li>
</ul>
<p>We can adjust the alert rule parameters, such as the severity, and change their effect, whether they automitigate or adjust the MonitorDisable tag, which can be used to exclude from alert monitoring; we will leave these to the default.</p>
<p>Make sure you review and test these policies first! Before proceeding to Production.</p>
<p>We will deploy the ARM template using the <a href="https://learn.microsoft.com/azure/cloud-shell/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Cloud Shell</a>.</p>
<ol>
<li>
<p>Login to the Azure Portal</p>
</li>
<li>
<p>Click on Cloud Shell <em>(top right)</em></p>
</li>
<li>
<p>Select your subscription and create a Storage account to host your Cloud Shell drives <em>(if it hasn&#x27;t already been done)</em></p>
</li>
<li>
<p>I&#x27;m going to adjust the parameters to match my environment by changing the following (these will need to be tuned to your specific environment):.</p>
</li>
<li>
<p>Type in:</p>
<p>git clone <a href="https://github.com/Azure/azure-monitor-baseline-alerts" target="_blank" rel="noopener noreferrer">https://github.com/Azure/azure-monitor-baseline-alerts</a></p>
</li>
</ol>
<p>Type in:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd azure-monitor-baseline-alerts\patterns\alz\</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Type in:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">nano alzArm.param.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I&#x27;m going to adjust the parameters to match my environment by changing the following <em>(these will need to be tuned to your specific environment)</em>:</p>













































<table><thead><tr><th>Parameters</th><th>Values</th></tr></thead><tbody><tr><td>enterpriseScaleCompanyPrefix</td><td>lukegeeknz</td></tr><tr><td>platformManagementGroup</td><td>trey-platform</td></tr><tr><td>IdentityManagementGroup</td><td>mg-landingzones</td></tr><tr><td>managementManagementGroup</td><td>trey-platform</td></tr><tr><td>connectivityManagementGroup</td><td>trey-platform</td></tr><tr><td>LandingZoneManagementGroup</td><td>mg-landingzones</td></tr><tr><td>ALZMonitorResourceGroupName</td><td>rg-management-monitoring-001</td></tr><tr><td>ALZMonitorResourceGroupLocation</td><td>australiaeast</td></tr><tr><td>ALZMonitorActionGroupEmail</td><td><a href="mailto:email@luke.geek.nz" target="_blank" rel="noopener noreferrer">email@luke.geek.nz</a></td></tr></tbody></table>
<blockquote>
<p>If you want the alerts to go to more than one email address, add them as comma-separated (i.e. &quot;<a href="mailto:email1@contos.com" target="_blank" rel="noopener noreferrer">email1@contos.com</a>, <a href="mailto:email2@contoso.com" target="_blank" rel="noopener noreferrer">email2@contoso.com</a>, <a href="mailto:email3@contoso.com" target="_blank" rel="noopener noreferrer">email3@contoso.com</a>&quot;)</p>
</blockquote>
<ol start="8">
<li>
<p>Press Ctrl+X</p>
</li>
<li>
<p>Press Y to save buffer</p>
</li>
<li>
<p>Press Enter to overwrite the parameter json file.</p>
</li>
<li>
<p>Before proceeding to the next step, you can cat the file <em>(cat ./alzArm.param.json)</em> to view it and make sure the parameters are correct and nothing else needs changing.</p>
</li>
<li>
<p>Now that the parameters are sorted, it is time to deploy:</p>
<p>$location = &#x27;AustraliaEast&#x27;
$psedudoRootManagementGroup = &quot;mg&quot;
New-AzManagementGroupDeployment -ManagementGroupId $psedudoRootManagementGroup -Location $location -TemplateUri  &#x27;<a href="https://raw.githubusercontent.com/Azure/azure-monitor-baseline/alerts/main/patterns/alz/alzArm.json" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/Azure/azure-monitor-baseline/alerts/main/patterns/alz/alzArm.json</a>&#x27; -TemplateParameterFile  &#x27;alzArm.param.json&#x27;</p>
</li>
</ol>
<blockquote>
<p>The ARM template location needs to be internet accessible due to links in the ARM template to dependent resources, although the parameter file can be sourced locally.
Error: Code=InvalidTemplate; Message=Deployment template validation failed: &#x27;The template variable &#x27;deploymentUris&#x27; is not valid: The language expression property &#x27;templateLink&#x27; doesn&#x27;t exist, available properties are &#x27;template, templateHash, parameters, mode, provisioningState&#x27;.. Please see <a href="https://learn.microsoft.com/azure/azure-resource-manager/templates/template-functions?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">https://aka.ms/arm-functions</a> for usage details.&#x27;</p>
</blockquote>
<p>All going well after a few minutes – your initiatives and policies have been deployed.</p>
<p><img loading="lazy" alt="Deploy - AMBA" src="/assets/images/AzureCloudShell_DeployAMBA-b737333825ebf74620bdddf4105c3588.gif" width="1911" height="1004" class="img_ev3q"></p>
<p><img loading="lazy" alt="AMBA - Policy Definition" src="/assets/images/AMBA_PolicyDefinitions-2e4f93fa6cf7999fddaa91476403efda.png" width="601" height="170" class="img_ev3q"></p>
<p><img loading="lazy" alt="AMBA - Policy Assignments" src="/assets/images/AMBA_PolicyAssignments-2706da3e9a0ed0b2c419b846a0ace244.png" width="601" height="199" class="img_ev3q"></p>
<p>If you have already existing Azure resources, you can remediate the policies, forcing them to create the Resource Group, Alerts and action groups by running the following PowerShell commands:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd scripts</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$pseudoRootManagementGroup = &quot;mg&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$identityManagementGroup = &quot;mg-landingzones&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$managementManagementGroup = &quot;trey-platform&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$connectivityManagementGroup = &quot;trey-platform&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$LZManagementGroup= &quot;mg-landingzones&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Run the following commands to initiate remediation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.\\Start-AMBARemediation.ps1 -managementGroupName $managementManagementGroup -policyName Alerting-Management</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.\Start-AMBARemediation.ps1 -managementGroupName $connectivityManagementGroup -policyName Alerting-Connectivity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.\Start-AMBARemediation.ps1 -managementGroupName $identityManagementGroup -policyName Alerting-Identity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.\Start-AMBARemediation.ps1 -managementGroupName $LZManagementGroup -policyName Alerting-LandingZone</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.\Start-AMBARemediation.ps1 -managementGroupName $pseudoRootManagementGroup -policyName Alerting-ServiceHealth</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can check the Alert rules in Azure Monitor:</p>
<p><img loading="lazy" alt="AMBA - Alert Rules" src="/assets/images/AMBA_AlertRules-ec20907d6410a8a8054ce07039e29a07.png" width="601" height="225" class="img_ev3q"></p>
<blockquote>
<p>It won&#x27;t deploy all alert rules unless you have the resources; an example is the Deploy VNetG Tunnel Bandwidth alert; the policy rule will only deploy if it matches:
The existence of a Virtual Network Gateway, with a VPN Gateway type, doesn&#x27;t include the MonitorDisable tag; if I were to deploy a VPN Gateway, it would create the alert rule for me.</p>
</blockquote>
<p>Finally, if you want to clean up <em>(delete the resources)</em>, you can leverage the Start-AMBACleanup.ps1 script; it will leave the Resource Group, Alert processing rules and action group.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/azure/powershell/azure-management-powershell/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Microsoft Azure Management with PowerShell - Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/private-endpoint-traffic-not-appearing-azure-firewall/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Private Endpoint traffic not appearing in Azure Firewall</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by a lot of coffee and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
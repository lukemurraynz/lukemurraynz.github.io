<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Azure Virtual Desktop Optimisations | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="Azure, Azure, Microsoft, Cloud Computing, Technical Blog"><meta data-rh="true" name="author" content="Luke Murray"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations"><meta data-rh="true" name="twitter:title" content="Azure Virtual Desktop Optimisations"><meta data-rh="true" name="twitter:description" content="If you are running Azure Virtual Desktop, you want to get the most performance and stability out of them as possible, to reduce cost and increase user e..."><meta data-rh="true" property="og:title" content="Azure Virtual Desktop Optimisations | luke.geek.nz"><meta data-rh="true" name="description" content="If you are running Azure Virtual Desktop, you want to get the most performance and stability out of them as possible, to reduce cost and increase user e..."><meta data-rh="true" property="og:description" content="If you are running Azure Virtual Desktop, you want to get the most performance and stability out of them as possible, to reduce cost and increase user e..."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-07-01T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations/" hreflang="x-default"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Azure Virtual Desktop Optimisations","description":"If you are running Azure Virtual Desktop, you want to get the most performance and stability out of them as possible, to reduce cost and increase user e...","url":"https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations","datePublished":"2021-07-01T00:00:00.000Z","dateModified":"2021-07-01T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","url":"https://luke.geek.nz/about"},"publisher":{"@type":"Organization","name":"luke.geek.nz","logo":{"@type":"ImageObject","url":"https://luke.geek.nz/img/logo.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations"},"keywords":"Azure, Azure, Microsoft, Cloud Computing, Technical Blog","articleSection":"Technology","inLanguage":"en-US","image":{"@type":"ImageObject","url":"https://luke.geek.nz/uploads/avddesktopfull.png","width":1200,"height":630}}</script><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations","mainEntityOfPage":"https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations","url":"https://luke.geek.nz/azure/Azure-Virtual-Desktop-Optimisations","headline":"Azure Virtual Desktop Optimisations","name":"Azure Virtual Desktop Optimisations","description":"If you are running Azure Virtual Desktop, you want to get the most performance and stability out of them as possible, to reduce cost and increase user e...","datePublished":"2021-07-01T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://luke.geek.nz/","name":"Luke's Tech Blog - Unleashing the power of the cloud and other technologies!"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script>






<meta property="og:type" content="website">
<meta property="og:site_name" content="luke.geek.nz">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@lukemurraynz">
<meta name="twitter:creator" content="@lukemurraynz">
<meta name="author" content="Luke Murray">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"luke.geek.nz","description":"Microsoft MVP - Microsoft Azure ☁, Technical Consultant, Azure Solutions Architect Expert, Technologist and a drinker of coffee.","url":"https://luke.geek.nz","author":{"@type":"Person","name":"Luke Murray","url":"https://luke.geek.nz/about","sameAs":["https://twitter.com/lukemurraynz","https://www.linkedin.com/in/ljmurray/","https://aus.social/@lukemurray","https://bsky.app/profile/lukemurraynz.bsky.social"]},"publisher":{"@type":"Person","name":"Luke Murray"},"potentialAction":{"@type":"SearchAction","target":"https://luke.geek.nz/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script><link rel="stylesheet" href="/assets/css/styles.89c47968.css">
<script src="/assets/js/runtime~main.87f6983a.js" defer="defer"></script>
<script src="/assets/js/main.64aebb0c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/tags/">Tags</a><a class="navbar__item navbar__link" href="/archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/learn-mcp-server-semantic-kernel/">Integrating Microsoft Learn MCP Server with Semantic Kernel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/umispn/">User-Assigned Managed Identity vs Service Principal (WIF)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/communication-services-mcp-email-server/">MCP Server with Azure Functions &amp; Communication Services</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/function-app-host-runtime/">Azure Function App Host Runtime Error</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/sire/">Secure Isolated Recovery Environment in Azure</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Azure Virtual Desktop Optimisations</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-07-01T00:00:00.000Z">July 1, 2021</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>If you are running Azure Virtual Desktop, you want to get the most performance and stability out of them as possible, to reduce cost and increase user experience.</p>
<p>These are a few recommended policies and optimisations to apply to your Azure Virtual Desktop setup. These are in no particular order; they are just recommendations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-timezone-redirection">Configure Timezone Redirection<a href="#configure-timezone-redirection" class="hash-link" aria-label="Direct link to Configure Timezone Redirection" title="Direct link to Configure Timezone Redirection" translate="no">​</a></h3>
<p>Timezone redirection will allow you to pass through the time from the local device to the Azure Virtual Desktop host. This is useful to keep the consistent time between the device you are connecting from and the session host, and by default, the timezone in Azure is UTC.</p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to Computer Configuration</strong> &gt; <strong>Policies</strong> &gt; <strong>Administrative Templates</strong> &gt; <strong>Windows Components</strong> &gt; <strong>Remote Desktop Services</strong> &gt; <strong>Remote Desktop Session Host</strong> &gt; <strong>Device</strong> <strong>and Resource Redirection</strong>.</li>
<li><strong>Enable</strong> the setting <strong>Allow time zone redirection</strong>.</li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>; as this is a Computer-based policy, it may take up to 90 minutes to take effect unless the session hosts are restarted to force it to pick up the policy sooner.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-session-time-limit-policies">Configure Session Time Limit Policies<a href="#configure-session-time-limit-policies" class="hash-link" aria-label="Direct link to Configure Session Time Limit Policies" title="Direct link to Configure Session Time Limit Policies" translate="no">​</a></h3>
<p>You can use this policy to specify the maximum amount of time that a disconnected session remains active on the server. By default, Remote Desktop Services allows users to disconnect from a Remote Desktop Services session without logging off and ending the session. Unfortunately, this means that sessions users sessions may remain open for an extended period of time, taking up usable resources.</p>
<p>When configuring these, take into consideration a users normal work time, the time they have for lunch etc., the sweet spot to disconnect their session is not during their lunch break, but after they have finished for the day, usually 8-12 hours is recommended, but is dependant on how Azure Virtual Desktop is used.</p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to Computer Configuration</strong> &gt; <strong>Policies</strong> &gt; <strong>Administrative Templates</strong> &gt; <strong>Windows Components</strong> &gt; <strong>Remote Desktop Services</strong> &gt; <strong>Remote Desktop Session Host</strong> &gt; <strong>Session Time Limits</strong>.</li>
<li>Configure the below settings per your organisation policies:</li>
</ol>
<ul>
<li><strong>Set time limit for active but idle Remote Desktop Services sessions</strong></li>
<li><em>This policy allows you to specify the maximum amount of time that an active Remote Desktop Services session can be idle (without user input) before it is automatically disconnected.</em></li>
<li><strong>Set time limit for active Remote Desktop Services sessions</strong></li>
<li><em>This policy allows you to specify the maximum amount of time that a Remote Desktop Services session can be active before it is automatically disconnected.</em></li>
<li><strong>Set time limit for disconnected sessions</strong></li>
<li><em>This policy allows you to configure a time limit for disconnected Terminal Services sessions.</em></li>
<li><strong>End session when time limits are reached</strong></li>
<li><em>This policy allows you to specify whether to terminate a timed-out Terminal Services session instead of disconnecting it.</em></li>
<li><strong>Set a time limit for log off of RemoteApp sessions</strong></li>
<li><em>This policy allows you to specify how long a user&#x27;s RemoteApp session will remain in a disconnected state after closing all RemoteApp programs before the session is logged off from the RD Session Host server.</em></li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>; as this is a Computer-based policy, it may take up to 90 minutes to take effect unless the session hosts are restarted to force it to pick up the policy sooner.</li>
</ul>
<p><em>Reference: Taken from:</em> <a href="https://kb.parallels.com/en/123638" target="_blank" rel="noopener noreferrer" title="https://kb.parallels.com/en/123638"><em>https://kb.parallels.com/en/123638</em></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deleteuserappcontainersonlogoff">DeleteUserAppContainersOnLogoff<a href="#deleteuserappcontainersonlogoff" class="hash-link" aria-label="Direct link to DeleteUserAppContainersOnLogoff" title="Direct link to DeleteUserAppContainersOnLogoff" translate="no">​</a></h3>
<p>Back in March 2019, there were issues with slow server performance caused by numerous Windows Firewall Rules getting created on user login. A patch was released; however, to enable this &#x27;<em>fix</em>&#x27;, a registry key needs to be set. You could eventually run into host performance/hang issues if this key is not configured. See: <a href="https://support.microsoft.com/en-us/help/4490481" target="_blank" rel="noopener noreferrer" title="https://support.microsoft.com/en-us/help/4490481">https://support.microsoft.com/en-us/help/4490481</a></p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to Computer Configuration</strong> &gt; <strong>Preferences</strong>&gt; <strong>Windows Settings</strong> &gt; <strong>Registry</strong>.</li>
<li>Right-click in the window and select <strong>New</strong>, <strong>Registry Item</strong></li>
<li>Select <strong>Update</strong> as the Action</li>
<li>Make sure <strong>HKEY_LOCAL_MACHINE</strong> is set to <strong>Hive</strong></li>
<li>Enter in the following for the Key Path: <strong>SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy</strong></li>
<li>For the Value name type: <strong>DeleteUserAppContainersOnLogoff</strong></li>
<li>Change the Value type to <strong>REG_DWORD</strong></li>
<li>Put: &#x27;<strong>1</strong>&#x27; to enable the option and click <strong>Apply</strong></li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>. As this is a Computer-based policy, it may take up to 90 minutes to take effect unless the session hosts are restarted to force it to pick up the policy sooner.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Delete user Apps" src="/assets/images/deleteuserapp-a0c4502573171f9f13ca6e1aafa9e644.png" width="396" height="452" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-rdp-shortpath">Configure RDP Shortpath<a href="#configure-rdp-shortpath" class="hash-link" aria-label="Direct link to Configure RDP Shortpath" title="Direct link to Configure RDP Shortpath" translate="no">​</a></h3>
<p>RDP Shortpath is a feature of Azure Virtual Desktop that establishes a direct UDP-based transport between Remote Desktop Client and Session host. RDP uses this transport to deliver Remote Desktop and RemoteApp while offering better reliability and consistent latency. RDP Shortpath establishes the direct connectivity between Remote Desktop client and Session Host. Direct connectivity reduces the dependency on the Azure Virtual Desktop gateways, improves the connection&#x27;s reliability, and increases the bandwidth available for each user session. You can read more about it here: <a href="https://learn.microsoft.com/en-us/azure/virtual-desktop/shortpath?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="Azure Virtual Desktop RDP Shortpath">Azure Virtual Desktop RDP Shortpath</a>.</p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to Computer Configuration</strong> &gt; <strong>Preferences</strong>&gt; <strong>Windows Settings</strong> &gt; <strong>Registry</strong>.</li>
<li>Right-click in the window and select <strong>New</strong>, <strong>Registry Item</strong></li>
<li>Select <strong>Update</strong> as the Action</li>
<li>Make sure <strong>HKEY_LOCAL_MACHINE</strong> is set to <strong>Hive</strong></li>
<li>Enter in the following for the Key Path: <strong>SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations</strong></li>
<li>For the Value name type: <strong>fUseUdpPortRedirector</strong></li>
<li>Change the Value type to <strong>REG_DWORD</strong></li>
<li>Put: &#x27;<strong>1</strong>&#x27; to enable the option and click <strong>Apply</strong></li>
<li>Right-click in the window and select <strong>New</strong>, <strong>Registry Item</strong></li>
<li>Select <strong>Update</strong> as the Action</li>
<li>Make sure <strong>HKEY_LOCAL_MACHINE</strong> is set to <strong>Hive</strong></li>
<li>Enter in the following for the Key Path: <strong>SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations</strong></li>
<li>For the Value name type: <strong>UdpPortNumber</strong></li>
<li>Change the Value type to <strong>REG_DWORD</strong></li>
<li>Put: &#x27;<strong>3390</strong>&#x27; as the UDP report and click <strong>Apply</strong></li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>. Restart the session hosts.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-desktop-optimization-tool">Virtual-Desktop-Optimization-Tool<a href="#virtual-desktop-optimization-tool" class="hash-link" aria-label="Direct link to Virtual-Desktop-Optimization-Tool" title="Direct link to Virtual-Desktop-Optimization-Tool" translate="no">​</a></h3>
<p>Automatically apply a range of optimisations for pooled and personal Azure Desktop hosts, this is a good resource to add to your initial image creation builds.</p>
<p><a href="https://github.com/The-Virtual-Desktop-Team/Virtual-Desktop-Optimization-Tool" target="_blank" rel="noopener noreferrer" title="Virtual-Desktop-Optimization-Tool">Virtual-Desktop-Optimization-Tool</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implement-windows-defender-fslogix-exclusions">Implement Windows Defender FSLogix exclusions<a href="#implement-windows-defender-fslogix-exclusions" class="hash-link" aria-label="Direct link to Implement Windows Defender FSLogix exclusions" title="Direct link to Implement Windows Defender FSLogix exclusions" translate="no">​</a></h3>
<p>Make sure to configure antivirus exclusions for FSLogix Profiles.</p>
<p>For a list of exclusions, along with a PowerShell script to implement them, please refer to the following Microsoft documentation: <a href="https://learn.microsoft.com/en-us/azure/architecture/example-scenario/wvd/windows-virtual-desktop-fslogix?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="FSLogix for the enterprise">FSLogix for the enterprise</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implement-fslogix-profile-exclusions">Implement FSLogix Profile Exclusions<a href="#implement-fslogix-profile-exclusions" class="hash-link" aria-label="Direct link to Implement FSLogix Profile Exclusions" title="Direct link to Implement FSLogix Profile Exclusions" translate="no">​</a></h3>
<p>By default, FSLogix will capture a lot of user profile data, including Teams Cache, Chrome cache and save it to the profile VHD/VHDX; this causes profile size bloat and can decrease the performance of your applications.</p>
<p>It is recommended to implement exclusions to reduce storing user profile data that you don&#x27;t need.</p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to Computer Configuration</strong> &gt; <strong>Policies</strong> &gt; <strong>Administrative Templates</strong> &gt; <strong>FSLogix</strong> &gt; <strong>Profile Containers</strong> &gt; <strong>Advanced</strong></li>
<li><strong>Enable</strong> the setting <strong>Provide RedirXML file to customize directions</strong>.</li>
<li>Point the path to a <strong>UNC path</strong> that is <strong>accessible</strong> to all session hosts that <strong>contains</strong> are &#x27;<strong>redirections.xml</strong>&#x27; file. This just needs the folder; it will automatically pick up the redirections.xml file.</li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>. As this is a Computer-based policy, it may take up to 90 minutes to take effect unless the session hosts are restarted to force it to pick up the policy sooner.</li>
</ol>
<p>An example redirections.xml can be found here:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_OeMC">redirections.xml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token prolog" style="color:rgb(189, 147, 249)">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">FrxProfileFolderRedirection</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">ExcludeCommonFolders</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">0</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Excludes</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Local\Google\Chrome\User Data\Default\Cache\</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Local\Google\Chrome\User Data\Default\Cached Theme Images\</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Roaming\Google\Chrome\UserData\Default\Code Cache\js</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Local\Google\Chrome\UserData\Default\Code Cache\js</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Local\Mozilla\Firefox</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">Copy</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">0</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Local\Microsoft\Terminal Server Client</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">Copy</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">0</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Local\Microsoft\Edge SxS\User Data\Default\Cache</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Roaming\Adobe\Flash Player\AssetCache</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Roaming\Adobe\Flash Player\NativeCache</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Roaming\Microsoft\Teams\Cache</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Roaming\Microsoft\Teams\Service Worker\CacheStorage</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Desktop</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Documents</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Downloads</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Musics</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Pictures</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Videos</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Exclude</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Excludes</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Includes</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Include</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">Copy</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">3</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\LocalLow\Sun\Java\Deployment\security</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Include</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">Include</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">AppData\Roaming\Google\Chrome\User Data\Default\Extensions</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Include</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">Includes</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">FrxProfileFolderRedirection</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><em>Note: Make sure you test and adjust this for your own environment. The Desktop/Documents have been excluded as the assumption is these are redirected or covered by OneDrive.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deleteuserappcontainersonlogoff-1">DeleteUserAppContainersOnLogoff<a href="#deleteuserappcontainersonlogoff-1" class="hash-link" aria-label="Direct link to DeleteUserAppContainersOnLogoff" title="Direct link to DeleteUserAppContainersOnLogoff" translate="no">​</a></h3>
<p>Back in March 2019, there were issues with slow server performance caused by numerous Windows Firewall Rules getting created on user login. A patch was released; however, to enable this &#x27;<em>fix</em>&#x27;, a registry key needs to be set. You could eventually run into host performance/hang issues if this key is not configured. See: <a href="https://support.microsoft.com/en-us/help/4490481" target="_blank" rel="noopener noreferrer" title="https://support.microsoft.com/en-us/help/4490481">https://support.microsoft.com/en-us/help/4490481</a></p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="implement-storage-sense">Implement Storage Sense<a href="#implement-storage-sense" class="hash-link" aria-label="Direct link to Implement Storage Sense" title="Direct link to Implement Storage Sense" translate="no">​</a></h3>
<p>On Windows 10, Storage sense is a built-in tool designed to free up space automatically. When it&#x27;s enabled, the feature monitors your device. When it&#x27;s running low on space, it deletes temporary files, empties the Recycle Bin, cleans up the Downloads folder, removes previous installation files, and more to make space to install new updates or store more important data. Storage Sense can also help dehydrate files that are available locally and do not need to be stored locally anymore, helping to reduce profile space and OneDrive processing.</p>
<p><em>Note: If you find that Storage Sense is missing, it is because it is mainly a client setting and may be missing from the Windows Server; you can copy the PolicyDefinitions folder from an Azure Virtual Desktop host to your domains Central Store, i.e. in my case \\luke.geek.nz\SYSVOL\luke.geek.nz\Policies\PolicyDefinitions. Or just look for StorageSense.admx and StorageSense.adml and copy it (the ADML goes in the language directory, i.e. en-US).</em></p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to Computer Configuration</strong> &gt; <strong>Policies</strong> &gt; <strong>Administrative Templates</strong> &gt; <strong>System</strong> &gt; <strong>Storage Sense</strong>.</li>
<li><strong>Enable</strong> the setting <strong>Allow Storage Sense</strong>.</li>
<li><strong>Enable</strong> the setting <strong>Configure Storage Sense Cloud Content dehydration threshold</strong></li>
<li>Now we can provide the minimum number of days a cloud-backed file can remain unopened before Storage Sense dehydrates it back to Files on Demand, for example, <strong>30</strong> days since it was last accessed.</li>
<li><strong>Enable</strong> the setting <strong>Configure Storage Storage Downloads cleanup threshold</strong></li>
<li><strong>Type</strong> in a minimum number of <strong>days</strong>, that files sit in the Downloads before before Storage sense will delete it.</li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>. As this is a Computer-based policy, it may take up to 90 minutes to take effect unless the session hosts are restarted to force it to pick up the policy sooner.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Storage Sense - Group Policy" src="/assets/images/storagesense_gpo-d9f1fe1587d3ad83fec68b801a49673d.png" title="Storage Sense - Group Policy" width="1534" height="901" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-microsoft-teams-optimisations">Configure Microsoft Teams Optimisations<a href="#configure-microsoft-teams-optimisations" class="hash-link" aria-label="Direct link to Configure Microsoft Teams Optimisations" title="Direct link to Configure Microsoft Teams Optimisations" translate="no">​</a></h3>
<p>You can run Microsoft Teams in Azure Virtual Desktop. To do so, you need to install as a Machine installer and set the WVD environment variable.</p>
<p><strong>Install as Machine:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">msiexec /i Teams_windows_x64 /l*v teams_install.log ALLUSER=1</span><br></span></code></pre></div></div>
<p><strong>Set IsWVDEnvironment key</strong>:</p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to Computer Configuration</strong> &gt; <strong>Preferences</strong>&gt; <strong>Windows Settings</strong> &gt; <strong>Registry</strong>.</li>
<li>Right-click in the window and select <strong>New</strong>, <strong>Registry Item</strong></li>
<li>Select <strong>Update</strong> as the Action</li>
<li>Make sure <strong>HKEY_LOCAL_MACHINE</strong> is set to <strong>Hive</strong></li>
<li>Enter in the following for the Key Path: <strong>SOFTWARE\Microsoft\Teams</strong></li>
<li>For the Value name type: <strong>IsWVDEnvironment</strong></li>
<li>Change the Value type to <strong>REG_DWORD</strong></li>
<li>Put: &#x27;<strong>1</strong>&#x27; to enable the option and click <strong>Apply</strong></li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>. Restart the session hosts.</li>
</ol>
<p><strong>Install the Remote Desktop WebRTC Redirector</strong></p>
<ol>
<li>The Remote Desktop WebRTC Redirector onto the Sessions Hosts: <a href="https://learn.microsoft.com/en-us/azure/virtual-desktop/teams-on-AVD#install-the-teams-websocket-service" target="_blank" rel="noopener noreferrer" title="hhttps://learn.microsoft.com/en-us/azure/virtual-desktop/teams-on-AVD?WT.mc_id=AZ-MVP-5004796#install-the-teams-websocket-service">https://learn.microsoft.com/en-us/azure/virtual-desktop/teams-on-AVD#install-the-teams-websocket-service</a></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-auto-close-apps-on-logoff">Configure Auto Close Apps on Logoff<a href="#configure-auto-close-apps-on-logoff" class="hash-link" aria-label="Direct link to Configure Auto Close Apps on Logoff" title="Direct link to Configure Auto Close Apps on Logoff" translate="no">​</a></h3>
<p>When users may go to logoff, open applications may halt or prolong the logoff process and prompts for users to close applications, this can leave to sessions being left connected, if a user hits logoff or shutdown and walks away. To stop the prompt about open Applications we need to set a registry key - this is not an &#x27;optimisation&#x27; to be treated lightly, as it won&#x27;t ask users to double check some of the apps they have open, as soon as they hit the logoff button - that it is, any open apps will be closed!</p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to User Configuration</strong> &gt; <strong>Preferences</strong>&gt; <strong>Windows Settings</strong> &gt; <strong>Registry</strong>.</li>
<li>Right-click in the window and select <strong>New</strong>, <strong>Registry Item</strong></li>
<li>Select <strong>Update</strong> as the Action</li>
<li>Make sure <strong>HKEY_CURRENT_USER</strong> is set to <strong>Hive</strong></li>
<li>Enter in the following for the Key Path: <strong>Control Panel\Desktop</strong></li>
<li>For the Value name type: <strong>AutoEndTasks</strong></li>
<li>Change the Value type to <strong>REG_SZ</strong></li>
<li>Put: &#x27;<strong>1</strong>&#x27; to enable the option and click <strong>Apply</strong></li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>. Restart the session hosts.</li>
</ol>
<p>This is a user-based policy, so will take effect on next logon.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hide-the-shutdown-button">Hide the Shutdown button<a href="#hide-the-shutdown-button" class="hash-link" aria-label="Direct link to Hide the Shutdown button" title="Direct link to Hide the Shutdown button" translate="no">​</a></h3>
<p>This is not so much of an optimization, but it is one of my favourite group policy configurations, something I implement in server base policies; it prevents that &quot;Oops!&quot; moment when someone clicks Shutdown on a server, especially with multi-session VDI machines, this just removes the shortcuts to shutdown and restart the server from the Start Menu.</p>
<p><em>Note: You can still restart and shut down the server from the Command Prompt with the &#x27;shutdown&#x27; command.</em></p>
<ol>
<li>On a server with the Group Policy Management Console is installed for managing your Azure Virtual Desktop farm, <strong>open</strong> the <strong>Group Policy Management Console</strong>.</li>
<li><strong>Expand</strong> your <strong>domain</strong> and <strong>Group Policy Objects</strong>.</li>
<li><strong>Right</strong>-<strong>click</strong> the <strong>GPO</strong> that you created for the group policy settings and select <strong>Edit</strong>.</li>
<li>In the Group Policy Management Editor, <strong>navigate to User Configuration</strong> &gt; <strong>Policies</strong> &gt; <strong>Administrative Templates</strong> &gt; <strong>Start Menu and Taskbar</strong></li>
<li><strong>Enable</strong> the setting <strong>Remove and prevent access to Shut Down, Restart, Sleep, and Hibernate commands.</strong></li>
<li><strong>Close</strong> the <strong>Group Policy Management console</strong>; as this is a User-based policy, it should take effect on the next user login.</li>
</ol></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/2021/07/03/start-vm-on-connect-for-azure-virtual-desktop/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Start VM on Connect for Azure Virtual Desktop</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">How to setup FSLogix profiles for Azure Virtual Desktop</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configure-timezone-redirection" class="table-of-contents__link toc-highlight">Configure Timezone Redirection</a></li><li><a href="#configure-session-time-limit-policies" class="table-of-contents__link toc-highlight">Configure Session Time Limit Policies</a></li><li><a href="#deleteuserappcontainersonlogoff" class="table-of-contents__link toc-highlight">DeleteUserAppContainersOnLogoff</a></li><li><a href="#configure-rdp-shortpath" class="table-of-contents__link toc-highlight">Configure RDP Shortpath</a></li><li><a href="#virtual-desktop-optimization-tool" class="table-of-contents__link toc-highlight">Virtual-Desktop-Optimization-Tool</a></li><li><a href="#implement-windows-defender-fslogix-exclusions" class="table-of-contents__link toc-highlight">Implement Windows Defender FSLogix exclusions</a></li><li><a href="#implement-fslogix-profile-exclusions" class="table-of-contents__link toc-highlight">Implement FSLogix Profile Exclusions</a></li><li><a href="#deleteuserappcontainersonlogoff-1" class="table-of-contents__link toc-highlight">DeleteUserAppContainersOnLogoff</a></li><li><a href="#implement-storage-sense" class="table-of-contents__link toc-highlight">Implement Storage Sense</a></li><li><a href="#configure-microsoft-teams-optimisations" class="table-of-contents__link toc-highlight">Configure Microsoft Teams Optimisations</a></li><li><a href="#configure-auto-close-apps-on-logoff" class="table-of-contents__link toc-highlight">Configure Auto Close Apps on Logoff</a></li><li><a href="#hide-the-shutdown-button" class="table-of-contents__link toc-highlight">Hide the Shutdown button</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">How to setup FSLogix profiles for Azure Virtual Desktop | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="How to setup FSLogix profiles for Azure Virtual Desktop | luke.geek.nz"><meta data-rh="true" name="description" content="If you have a few Azure Virtual Desktop machines, you need some way to keep user persistence&#x27;s and application customisations, which would usually be stored in the user profile locally across multiple machines (or even the same machine if using Ephemeral OS), this is where FSLogix Profile Containers can assist."><meta data-rh="true" property="og:description" content="If you have a few Azure Virtual Desktop machines, you need some way to keep user persistence&#x27;s and application customisations, which would usually be stored in the user profile locally across multiple machines (or even the same machine if using Ephemeral OS), this is where FSLogix Profile Containers can assist."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-06-29T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://luke.geek.nz/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop","mainEntityOfPage":"https://luke.geek.nz/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop","url":"https://luke.geek.nz/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop","headline":"How to setup FSLogix profiles for Azure Virtual Desktop","name":"How to setup FSLogix profiles for Azure Virtual Desktop","description":"If you have a few Azure Virtual Desktop machines, you need some way to keep user persistence's and application customisations, which would usually be stored in the user profile locally across multiple machines (or even the same machine if using Ephemeral OS), this is where FSLogix Profile Containers can assist.","datePublished":"2021-06-29T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://luke.geek.nz/","name":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.a8967c60.css">
<script src="/assets/js/runtime~main.d7486988.js" defer="defer"></script>
<script src="/assets/js/main.36483617.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, make sure you sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azure-landing-zone-accelerator/">Deploying Azure Landing Zones with the Terraform Accelerator</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azure-developer-cli/">Getting Started with Azure Developer CLI (azd)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/azure-platform-release-process/">How Microsoft Releases Changes to Azure - Safe Deployment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/staticwebapp-azd-environment-variables/">Managing Environment Variables in Azure Static Web Apps with Azure Developer CLI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/powershell-terraform-bootstrap/">PowerShell based Terraform Bootstrap Script</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">How to setup FSLogix profiles for Azure Virtual Desktop</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-06-29T00:00:00.000Z">June 29, 2021</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>If you have a few Azure Virtual Desktop machines, you need some way to keep user persistence&#x27;s and application customisations, which would usually be stored in the user profile locally across multiple machines <em>(or even the same machine if using Ephemeral OS)</em>, this is where FSLogix Profile Containers can assist.</p>
<p>We are going to implement FSLogix using an Azure File Share, to store the profiles.</p>
<p>I am going to assume you already have an Azure Virtual Desktop farm <em>(and Azure ADDS)</em>, if not you can check out my guide <a href="https://luke.geek.nz/azure/create-a-azure-virtual-desktop-farm/" target="_blank" rel="noopener noreferrer" title="How to create a Azure Virtual Desktop farm ">here</a>.</p>
<p>This article will be based on the Azure Virtual Desktop farm created in a previous article, however, you can just still along and replace the resource names and groups with your own.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-storage-account">Setup Storage Account<a href="#setup-storage-account" class="hash-link" aria-label="Direct link to Setup Storage Account" title="Direct link to Setup Storage Account">​</a></h3>
<ol>
<li>Log in to the <strong>Azure Portal</strong></li>
<li>Click on <strong>Create a resource</strong></li>
<li>Type in <strong>Storage Account</strong> and press Enter to search</li>
<li>Select Storage account</li>
<li><img decoding="async" loading="lazy" alt="FSLogix - Azure Storage Account" src="/assets/images/storageaccount-2801dccd641138f94c83c89ae389a5c5.png" title="FSLogix - Azure Storage Account" width="998" height="360" class="img_ev3q"></li>
<li>Click <strong>Create</strong></li>
<li>If you already have a Resource Group, then <strong>select</strong> it, if not you can create a new <strong>resource group</strong>. I am going to put my resources user profiles in the same resource group as my utility server: aad_infra <em>(this is just personal preference, keeping the session hosts in their own resource groups)</em>.</li>
<li><strong>Type in</strong> a Storage <strong>Account Name</strong> <em>(the name needs to be globally unique across all of Azure, the field can contain only lowercase letters and numbers. Name must be between 3 and 24 characters.)</em>, in my case I have gone with: fslogixprofileslgnz.</li>
<li><strong>Select</strong> your <strong>Region</strong> <em>(the same region you have your Azure Virtual Desktop session hosts and Virtual Network)</em></li>
<li><strong>Select</strong> Standard <strong>performance</strong> <em>(Microsoft have recommendations, based on users on what Tier to select -</em> <a href="https://learn.microsoft.com/en-us/azure/virtual-desktop/store-fslogix-profile?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="https://learn.microsoft.com/en-us/azure/virtual-desktop/store-fslogix-profile?WT.mc_id=AZ-MVP-5004796"><em>https://learn.microsoft.com/en-us/azure/virtual-desktop/store-fslogix-profile</em></a><em>)</em></li>
<li>For Redundancy, I am going to <strong>select LRS</strong> storage <em>(I haven&#x27;t built have any redundancy in my Azure Virtual Desktop farm)</em>.</li>
<li><em>Note: Just a heads up, don&#x27;t select Geo-Redundant if you are looking to create File Shares on this Storage account over 100TiB, it is only supported in LRS. If you do need this kind of large file size, I recommend using a completely different storage account from the one you are using for user profiles. My screenshot below has GRS, just ignore it!</em></li>
<li><img decoding="async" loading="lazy" alt="FSLogix - Azure Storage Account" src="/assets/images/storageaccount_projectdetails-839ccecc467cdf1704c728f298727e9a.png" title="FSLogix - Azure Storage Account" width="769" height="552" class="img_ev3q"></li>
<li>Click <strong>Next: Advanced</strong></li>
<li>Leave everything as default and <strong>select Next: Networking</strong></li>
<li>Now we need to configure a Private Endpoint for the Azure storage account to add onto the Virtual Network directly.</li>
<li>Select <strong>Private endpoint</strong> and click <strong>+ Add Private endpoint</strong></li>
<li><strong>Verify</strong> that your <strong>Location</strong> is <strong>correct</strong> and <strong>type</strong> in a <strong>Name for</strong> your <strong>Private Endpoint</strong> service, in my case: fslogixprofileslgnzPE</li>
<li><strong>Select</strong> the drop-down for <strong>Storage sub-resource</strong> and select <strong>file</strong></li>
<li><strong>Select</strong> your <strong>Virtual Network</strong> and <strong>subnet</strong> <em>(I will be selecting my main resource subnet of aadds-subnet, where the Azure Virtual Desktop hosts are)</em></li>
<li>Click <strong>Ok</strong></li>
<li><img decoding="async" loading="lazy" alt="FSLogix - Azure Storage Account" src="/assets/images/storageaccount_privateendpoint-57650fe4060dc07aa1150353bed7248f.png" title="FSLogix - Azure Storage Account" width="1671" height="717" class="img_ev3q"></li>
<li>Select <strong>Next: Data Protection</strong></li>
<li><strong>Untick</strong> the <strong>Enable soft delete for Blogs and Container&#x27;s</strong> <em>(we will only be using Azure Files in this storage account)</em></li>
<li>Soft delete allows you to quickly recover a deleted file-share, even though we can backup the Azure Fileshare, my recommendation would be to leave this on for additional protection and &#x27;7&#x27; days is enough for me.</li>
<li><img decoding="async" loading="lazy" alt="FSLogix - Azure Storage Account" src="/assets/images/storageaccount_softdelete-f99ec396a4d126592b3bdd9cce89eedb.png" title="FSLogix - Azure Storage Account" width="753" height="689" class="img_ev3q"></li>
<li>Select <strong>Review + Create</strong></li>
<li><strong>Validate</strong> your <strong>configuration</strong> and select <strong>Create</strong></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-storage-account">Configure Storage Account<a href="#configure-storage-account" class="hash-link" aria-label="Direct link to Configure Storage Account" title="Direct link to Configure Storage Account">​</a></h3>
<ol>
<li>
<p>Once your storage account has been created, go to it.</p>
</li>
<li>
<p>Navigate down the left-hand side Blade and select: <strong>Networking</strong></p>
<p>Make sure: Selected networks are selected and the Private Endpoint connection is displaying.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - Azure Storage Account" src="/assets/images/storageaccount_firewalls-dd944f693e41a8503e0566839495faad.png" title="FSLogix - Azure Storage Account" width="653" height="310" class="img_ev3q"></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - Azure Storage Account" src="/assets/images/storageaccount_peapproved-6debcc29f48cc0a69fc6c792153764e8.png" title="FSLogix - Azure Storage Account" width="974" height="191" class="img_ev3q"></p>
</li>
<li>
<p>Now its time to join the Storage account to Microsoft Entra ID Domain Services, on the left-hand side Blade, click on <strong>Configuration</strong> <em>(under Settings)</em></p>
</li>
<li>
<p>Navigate to: <strong>Identity-based access for file shares</strong></p>
</li>
<li>
<p>Select <strong>Enabled</strong></p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - Azure Storage Account" src="/assets/images/storageaccount_adds_identity-fe967979aade968af246f28cd5978a5d.png" title="FSLogix - Azure Storage Account" width="632" height="612" class="img_ev3q"></p>
</li>
<li>
<p>Now its time to create the File Share, On the left-hand side Blade, navigate to <strong>File Shares</strong> (under Data Storage)</p>
</li>
<li>
<p>Select <strong>+ File Share</strong></p>
</li>
<li>
<p>Give this <strong>File share</strong> a <strong>name</strong>: fslogixprofiles</p>
</li>
<li>
<p>Even though you don&#x27;t need to have a Quota <em>(the Fileshare will grow)</em>, I will add one in stop any surprises and make sure that I have an ongoing task to review and optimize the profiles</p>
</li>
<li>
<p>Because user profiles are generally a lot of read/write activity, select <strong>Transaction Optimized</strong> <em>(take a look at the</em> <a href="https://azure.microsoft.com/en-us/pricing/details/storage/files/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="https://azure.microsoft.com/en-us/pricing/details/storage/files/?WT.mc_id=AZ-MVP-5004796"><em>https://azure.microsoft.com/en-us/pricing/details/storage/files/</em></a> <em>)</em></p>
</li>
<li>
<p>Click <strong>Create</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - File Share" src="/assets/images/storageaccount_newfileshare-95f161154ef1674774aa4a9c41b98da5.png" title="FSLogix - File Share" width="295" height="373" class="img_ev3q"></p>
</li>
<li>
<p>One last thing we can do on the Storage Account is <strong>enable backups</strong> for your <strong>Azure File Share</strong> - <a href="https://learn.microsoft.com/en-us/azure/backup/backup-afs?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer" title="https://learn.microsoft.com/en-us/azure/backup/backup-afs?WT.mc_id=AZ-MVP-5004796">https://learn.microsoft.com/en-us/azure/backup/backup-afs?WT.mc_id=AZ-MVP-5004796</a></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-file-share">Configure File Share<a href="#configure-file-share" class="hash-link" aria-label="Direct link to Configure File Share" title="Direct link to Configure File Share">​</a></h3>
<p>Now that the Microsoft Entra ID rights have been assigned and the File Share has been created, we now need to set up the NTFS permissions on the FSLogix share.</p>
<ol>
<li>
<p>Navigate to <strong>File Shares</strong> <em>(under Data Storage)</em></p>
</li>
<li>
<p><strong>Click</strong> on <strong>your</strong> file-<strong>share</strong></p>
</li>
<li>
<p>Click on <strong>Properties</strong></p>
</li>
<li>
<p><strong>Copy</strong> the <strong>URL</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - File Share" src="/assets/images/storageaccount_fslogixprofiles-6e8f1169f72bacd246c5a3edf61c6729.png" title="FSLogix - File Share" width="761" height="578" class="img_ev3q"></p>
</li>
<li>
<p><strong>Remove http</strong> and replace the forward slashes with backslashes so it looks like this: \\fslogixprofileslgnz.file.core.windows.net\fslogixprofiles</p>
</li>
<li>
<p><strong>Using</strong> a <strong>user</strong> that is a <strong>member of</strong> the &#x27;<strong>AVD Admins&#x27;</strong> group and can <strong>log into</strong> the <strong>Azure Virtual Desktop</strong> farm <em>(it’s a good chance to test connectivity to the Storage account through the private endpoint from your Azure Virtual Desktop session host)</em></p>
</li>
<li>
<p>Open <strong>Computer</strong></p>
</li>
<li>
<p>Select the Computer Tab and select <strong>Map network drive</strong></p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - Mapped Drive" src="/assets/images/computermappeddrive-b6d4b059bbc60cae71cf413c53ed4a8b.png" title="FSLogix - Mapped Drive" width="420" height="184" class="img_ev3q"></p>
</li>
<li>
<p><strong>Select a drive letter</strong> that isn&#x27;t in use and paste in the <strong>UNC path</strong> created earlier <em>(step 6)</em>.</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - Mapped Drive" src="/assets/images/computermappingdrive-643b7416f45e128e07e11d1d71ea851d.png" title="FSLogix - Mapped Drive" width="522" height="264" class="img_ev3q"></p>
</li>
<li>
<p>Hopefully, you should <strong>successfully</strong> have <strong>mapped</strong> a <strong>drive</strong>!</p>
</li>
<li>
<p>Once the drive is mapped, <strong>open</strong> up a <strong>Command Prompt</strong></p>
<p><em>Note: Don&#x27;t run the Command Prompt as Administrator, as this runs in a separate context and doesn&#x27;t have permissions to the mapped drive.</em></p>
</li>
<li>
<p><strong>Run</strong> the <strong>following command</strong> to <strong>set</strong> the necessary <strong>NTFS permissions</strong> <em>(change the Drive mapping and AVD Users group to your own group)</em>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">icacls z: /grant &quot;AVD Users&quot;:(M)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">icacls z: /grant &quot;Creator Owner&quot;:(OI)(CI)(IO)(M)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">icacls z: /remove &quot;Authenticated Users&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">icacls z: /remove &quot;Builtin\Users&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - Security Permissions" src="/assets/images/setfslogixpermissions-68547b485f7bc90692b642b71edbde17.png" title="FSLogix - Security Permissions" width="932" height="473" class="img_ev3q"></p>
</li>
<li>
<p>The permissions should look similar to:</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="FSLogix - Security Permissions" src="/assets/images/setfslogixpermissions2-f5d2a6470c03a6dc2c1fc2b73bd03eef.png" title="FSLogix - Security Permissions" width="729" height="218" class="img_ev3q"></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-fslogix-policies">Configure FSLogix policies<a href="#configure-fslogix-policies" class="hash-link" aria-label="Direct link to Configure FSLogix policies" title="Direct link to Configure FSLogix policies">​</a></h3>
<p>Now that you have successfully created a Storage Account and granted it the proper permissions, we now need to configure Group Policy for FSLogix.</p>
<ol>
<li><strong>Connect to</strong> your Microsoft Entra ID <strong>Utility server</strong>, that has <strong>Group Policy management</strong> installed using an account in the: AAD DC Administrators group</li>
<li><strong>Download</strong> the latest <strong>FSLogix Agent</strong> - <a href="https://aka.ms/fslogix_download" target="_blank" rel="noopener noreferrer" title="https://aka.ms/fslogix_download?WT.mc_id=AZ-MVP-5004796">https://aka.ms/fslogix_download</a> onto the Utility server</li>
<li><strong>Extract</strong> the FSLogix agent <strong>zip</strong> file to a folder</li>
<li>Now we will <strong>create</strong> a <strong>Central Store</strong> to manage the Group Policy consistently</li>
<li>On your Utility server, browse to <strong>C:\Windows</strong> <em>(If you are primarily using Azure Virtual Desktop, it may be best to copy the PolicyDefinitions folder from an Azure Virtual Desktop session host to make sure you can edit all the latest Windows 10 policies)</em></li>
<li><strong>Copy</strong> the <strong>PolicyDefinitions</strong> folder</li>
<li>Copy <strong>the PolicyDefinitions</strong> folder to your <strong>Policies</strong> folder on your <strong>domain</strong>: \luke.geek.nz\SYSVOL\luke.geek.nz\Policies<br>
<em>(replace luke.geek.nz, with your ADDS DNS name)</em></li>
<li><img decoding="async" loading="lazy" alt="FSLogix - Group Policy" src="/assets/images/sysvolpolicies-f5f02ecdb5e5547339c11eb39f2021b8.png" title="FSLogix - Group Policy" width="554" height="230" class="img_ev3q"></li>
<li><strong>Go to</strong> your <strong>extracted</strong> FSLogix <strong>folder</strong> and <strong>copy</strong>:
<ul>
<li>fslogix.admx to: \luke.geek.nz\SYSVOL\luke.geek.nz\Policies\PolicyDefinitions\</li>
<li>fslogix.adml to: \luke.geek.nz\SYSVOL\luke.geek.nz\Policies\PolicyDefinitions\en-US\</li>
</ul>
</li>
<li>This will allow us to use Group Policy to manage FSLogix using Group Policy, <strong>Open Group Policy Management</strong></li>
<li><strong>Navigate</strong> to your <strong>Hosts OU</strong></li>
<li>Right-click the OU and select: <strong>Create a GPO in this domain, and Link it here…</strong></li>
<li>Name it according to your naming standards (this is a Computer-based policy) - in my example, I am using: AVD_ComputerPolicy</li>
<li>Click <strong>Ok</strong></li>
<li><img decoding="async" loading="lazy" alt="FSLogix - Group Policy" src="/assets/images/gpo_management_createpolicy-7658db17732ed0748448c741dcba3244.png" title="FSLogix - Group Policy" width="580" height="355" class="img_ev3q"></li>
<li>Right-click the GPO you have just created and select <strong>Edit…</strong></li>
<li>Because this is a Computer-based policy, to speed up processing, <strong>right-click</strong> the <strong>Policy heading</strong> and select <strong>Properties</strong></li>
<li>Tick: <strong>Disable User Configuration Settings</strong></li>
<li>Confirm that you want to do it and select <strong>Yes</strong></li>
<li>Click <strong>Apply</strong></li>
<li>While you have the screen open, <strong>click on</strong> <strong>Comment</strong>, and <strong>add</strong> in some <strong>details</strong> about the GPO for future reference then click <strong>Apply</strong> and <strong>Ok</strong></li>
<li><img decoding="async" loading="lazy" alt="FSLogix - Group Policy" src="/assets/images/gpo_avd_computerpolicy-013e44a036919779c77128f2dd3be4be.png" title="FSLogix - Group Policy" width="799" height="563" class="img_ev3q"></li>
<li>Now it&#x27;s time to actually configure the FSLogix Group Policy settings.</li>
<li><strong>Navigate</strong> to: Computer Configuration\Policies\Administrative Templates\FSLogix\<strong>Profile Containers</strong></li>
<li>Open up <strong>Enabled</strong> and select: <strong>Enabled</strong> and <strong>Apply</strong></li>
<li>Open: <strong>VHD Location</strong> and <strong>copy</strong> in your Profiles <strong>UNC share</strong> <em>(for example, mine is:</em> [<em>\\fslogixprofileslgnz.file.core.windows.net\fslogixprofiles)</em> click <strong>Ok</strong></li>
<li>Select: <strong>Delete local profile when FSLofix profile should apply</strong>, click <strong>Enabled</strong> and check to <strong>Delete local profile when FSLogix Profile should apply</strong> <em>(don&#x27;t blindly follow this, I am making the assumption this is a new farm, with no user-based profile stored on it. You may need to create a separate GPO to test this setting on, or you could lose valuable data)</em>.</li>
<li>Open: <strong>Set Outlook cached mode on successful container attach</strong> to <strong>Enabled</strong>.</li>
<li>Now in Group Policy Management console, click on <strong>Container and Directory Naming</strong> and select <strong>Virtual Disk type</strong></li>
<li>Click <strong>Enabled</strong> and change the Option to <strong>VHDX</strong>, click <strong>Ok</strong></li>
<li>Click on: <strong>Swap directory name components setting</strong> and click <strong>Enabled</strong>, <strong>check</strong> the s<strong>wap directory name components</strong> and click <strong>Apply</strong></li>
<li><strong>Restart</strong> the Azure Virtual Desktop <strong>session hosts</strong> to pick up the new policies.</li>
<li><strong>You have now set up FSLogix profiles! If you map the drive you should see your user profile folders!</strong></li>
<li><img decoding="async" loading="lazy" alt="FSLogix - Mapped Profiles" src="/assets/images/computermappingdrivelast-295af306bce86bb195f492335abb6f73.png" title="FSLogix - Mapped Profiles" width="753" height="346" class="img_ev3q"></li>
</ol></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/azure/Azure-Virtual-Desktop-Optimisations/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Azure Virtual Desktop Optimisations</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/no-available-resources-error-when-connecting-to-azure-virtual-desktop/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">No Available Resources Error when attempting to connect to Azure Virtual Desktop</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup-storage-account" class="table-of-contents__link toc-highlight">Setup Storage Account</a></li><li><a href="#configure-storage-account" class="table-of-contents__link toc-highlight">Configure Storage Account</a></li><li><a href="#configure-file-share" class="table-of-contents__link toc-highlight">Configure File Share</a></li><li><a href="#configure-fslogix-policies" class="table-of-contents__link toc-highlight">Configure FSLogix policies</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
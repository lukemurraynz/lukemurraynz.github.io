<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Azure Container Registry Continuous Patching for Security | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="author" content="Luke Murray"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/azure/acr-continuous-patching-security"><meta data-rh="true" name="twitter:title" content="Azure Container Registry Continuous Patching for Security"><meta data-rh="true" name="twitter:description" content="Learn how to use Azure Container Registry&#x27;s Continuous Patching to detect and fix vulnerabilities in container images with Trivy and Copa."><meta data-rh="true" property="og:title" content="Azure Container Registry Continuous Patching for Security | luke.geek.nz"><meta data-rh="true" name="description" content="Learn how to use Azure Container Registry&#x27;s Continuous Patching to detect and fix vulnerabilities in container images with Trivy and Copa."><meta data-rh="true" property="og:description" content="Learn how to use Azure Container Registry&#x27;s Continuous Patching to detect and fix vulnerabilities in container images with Trivy and Copa."><meta data-rh="true" name="keywords" content="Azure,Container Registry,ACR,Continuous Patching,Container Security,Trivy,Copa,Vulnerability Scanning,DevSecOps"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-04-25T05:16:22.619Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/acr-continuous-patching-security/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/acr-continuous-patching-security/" hreflang="x-default"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/azure/acr-continuous-patching-security"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Azure Container Registry Continuous Patching for Security","description":"Learn how to use Azure Container Registry's Continuous Patching to detect and fix vulnerabilities in container images with Trivy and Copa.","url":"https://luke.geek.nz/azure/acr-continuous-patching-security","datePublished":"2025-04-25T05:16:22.619Z","dateModified":"2025-04-25T05:16:22.619Z","author":{"@type":"Person","name":"Luke Murray","url":"https://luke.geek.nz/about"},"publisher":{"@type":"Organization","name":"luke.geek.nz","logo":{"@type":"ImageObject","url":"https://luke.geek.nz/img/logo.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://luke.geek.nz/azure/acr-continuous-patching-security"},"keywords":"Azure, Container Registry, ACR, Continuous Patching, Container Security, Trivy, Copa, Vulnerability Scanning, DevSecOps, Azure, Azure, Microsoft, Cloud Computing, Technical Blog","articleSection":"Technology","inLanguage":"en-US"}</script><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://luke.geek.nz/azure/acr-continuous-patching-security","mainEntityOfPage":"https://luke.geek.nz/azure/acr-continuous-patching-security","url":"https://luke.geek.nz/azure/acr-continuous-patching-security","headline":"Azure Container Registry Continuous Patching for Security","name":"Azure Container Registry Continuous Patching for Security","description":"Learn how to use Azure Container Registry's Continuous Patching to detect and fix vulnerabilities in container images with Trivy and Copa.","datePublished":"2025-04-25T05:16:22.619Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":["Azure","Container Registry","ACR","Continuous Patching","Container Security","Trivy","Copa","Vulnerability Scanning","DevSecOps"],"isPartOf":{"@type":"Blog","@id":"https://luke.geek.nz/","name":"Luke's Tech Blog - Unleashing the power of the cloud and other technologies!"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script>






<meta property="og:type" content="website">
<meta property="og:site_name" content="luke.geek.nz">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@lukemurraynz">
<meta name="twitter:creator" content="@lukemurraynz">
<meta name="author" content="Luke Murray">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"luke.geek.nz","description":"Microsoft MVP - Microsoft Azure ‚òÅ, Technical Consultant, Azure Solutions Architect Expert, Technologist and a drinker of coffee.","url":"https://luke.geek.nz","author":{"@type":"Person","name":"Luke Murray","url":"https://luke.geek.nz/about","sameAs":["https://twitter.com/lukemurraynz","https://www.linkedin.com/in/ljmurray/","https://aus.social/@lukemurray","https://bsky.app/profile/lukemurraynz.bsky.social"]},"publisher":{"@type":"Person","name":"Luke Murray"},"potentialAction":{"@type":"SearchAction","target":"https://luke.geek.nz/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script><link rel="stylesheet" href="/assets/css/styles.dd27eb3d.css">
<script src="/assets/js/runtime~main.5ff826bc.js" defer="defer"></script>
<script src="/assets/js/main.6c7dbedd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/tags/">Tags</a><a class="navbar__item navbar__link" href="/archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/communication-services-mcp-email-server/">MCP Server with Azure Functions &amp; Communication Services</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/function-app-host-runtime/">Azure Function App Host Runtime Error</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/sire/">Secure Isolated Recovery Environment in Azure</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/akahu-mcp-apim/">Expose Akahu APIs via Azure API Management MCP Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/container-apps-vnc-dosbox/">Azure Container Apps with VNC and DOSBox</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Azure Container Registry Continuous Patching for Security</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-04-25T05:16:22.619Z">April 25, 2025</time> ¬∑ <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Last year, I blogged about <a href="https://luke.geek.nz/azure/automate-container-patching-with-trivy-copacetic-azure-devops/" target="_blank" rel="noopener noreferrer">Container Patching with Azure DevOps, Trivy and Copacetic</a>, and how to use Azure DevOps to automate the patching of your container images using Trivy and Copacetic. This was a great solution, but it required a lot of manual work to set up and maintain. Today, I am going to take a look at Continuous Patching with Azure Container Registry (ACR) and how to use it to automate the patching of your container images.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-what-is-acr-continuous-patching">üõ°Ô∏è What is ACR Continuous Patching?<a href="#Ô∏è-what-is-acr-continuous-patching" class="hash-link" aria-label="Direct link to üõ°Ô∏è What is ACR Continuous Patching?" title="Direct link to üõ°Ô∏è What is ACR Continuous Patching?">‚Äã</a></h2>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>At the time of writing, this is a <strong>Preview feature</strong>, so the experience we run through today may change in the future or the feature may be removed entirely.</p><p>The following limitations apply:</p><ul>
<li>Windows-based container images aren&#x27;t supported.</li>
<li>Only &quot;OS-level&quot; vulnerabilities that originate from system packages will be patched. This includes system packages in the container image managed by an OS package manager such as &quot;apt‚Äù and &quot;yum‚Äù. Vulnerabilities that originate from application packages, such as packages used by programming languages like Go, Python, and NodeJS, cannot be patched.</li>
<li>End of Service Life (EOSL) images are not supported by Continuous Patching. EOSL images refer to images where updates, security patches, or technical support are no longer available for the underlying operating system. Examples include images based on older operating system versions, such as Debian 8 and Fedora 28. EOSL images will be skipped from the patch, despite having vulnerabilities. The recommended approach is to upgrade the underlying operating system of your image to a supported version.</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><a href="https://learn.microsoft.com/azure/container-registry/container-registry-intro?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Container Registry</a>&#x27;s Continuous Patching feature automates the detection and remediation of operating system(OS) level vulnerabilities in container images. By scheduling regular scans with <a href="https://trivy.dev/" target="_blank" rel="noopener noreferrer">Trivy</a> and applying security fixes using <a href="https://project-copacetic.github.io/copacetic/website/" target="_blank" rel="noopener noreferrer">Copa</a>, you can maintain secure, up-to-date images in your registry, without requiring access to source code or build pipelines. Simply customize the schedule and target images to keep your Azure Container Registry(ACR) environment safe and compliant.</p><p>Here are a few scenarios to use Continuous Patching:</p><ul>
<li>Enforcing container security and hygiene: Continuous Patching enables users to quickly fix OS container CVEs without the need to rebuild from upstream fully.</li>
<li>Speed of Use: Continuous Patching eliminates the dependency on upstream updates for specific images by automatically updating packages. Vulnerabilities can appear every day, while popular image publishers may only release new content once a month. With Continuous Patching, you can ensure that container images within your registry are patched as soon as the latest set of OS vulnerabilities is detected.</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-test-environment-setup">üß™ Test Environment Setup<a href="#-test-environment-setup" class="hash-link" aria-label="Direct link to üß™ Test Environment Setup" title="Direct link to üß™ Test Environment Setup">‚Äã</a></h2>
<p>In my testing, I am going to use the <a href="https://hub.docker.com/_/api-firewall" target="_blank" rel="noopener noreferrer">api-firewall</a> image, version <a href="https://hub.docker.com/layers/library/api-firewall/0.6.16/images/sha256-d6538706176b7c481355abb46dbeb25afcb272647e37dc2521e2a40db55a046c" target="_blank" rel="noopener noreferrer">0.6.16</a> that I have pushed to my Azure Container Registry.</p>
<p><img decoding="async" loading="lazy" alt="Image - Azure Container Registry" src="/assets/images/ContinuousPatching_ACR_APIFirewallImageBefore-dce33642a27641f40c03cfa5f94d07d0.jpg" width="1534" height="739" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-how-continuous-patching-works">‚öôÔ∏è How Continuous Patching Works<a href="#Ô∏è-how-continuous-patching-works" class="hash-link" aria-label="Direct link to ‚öôÔ∏è How Continuous Patching Works" title="Direct link to ‚öôÔ∏è How Continuous Patching Works">‚Äã</a></h2>
<p>Let&#x27;s take a look at how this will work.</p>
<p>Continuous Patching in ACR creates a new image per patch. ACR relies on a tag convention to version and identify patched images. The two main approaches are incremental and floating.</p>
<table><thead><tr><th>Feature</th><th>Incremental Tagging</th><th>Floating Tagging</th></tr></thead><tbody><tr><td><strong>How It Works</strong></td><td>Adds numerical suffix (-1, -2, etc.) to original tag</td><td>Uses single mutable tag &quot;-patched&quot; that always points to latest version</td></tr><tr><td><strong>Example</strong></td><td>If base is python:3.11:- First patch: python:3.11-1- Second patch: python:3.11-2</td><td>If base is python:3.11:- All patches use: python:3.11-patched</td></tr><tr><td><strong>Special Rules</strong></td><td>- Tags -1 to -999 are considered patch tags- Tags with -x where x &gt; 999 are treated as original tags- Avoid pushing your tags ending with -1 to --999- Errors if -999 versions are reached</td><td>Tag automatically updates with each new patch</td></tr><tr><td><strong>Version History</strong></td><td>Preserved (each patch gets unique tag)</td><td>Not preserved (single tag is updated)</td></tr></tbody></table>
<p><img decoding="async" loading="lazy" alt="Image - Azure Container Registry" src="/assets/images/patching_timeline_example1-5a26b93211e3b33dae083218aa7fdef9.png" width="1312" height="868" class="img_ev3q"></p>
<p>Incremental (default) is ideal for environments where auditability and rollbacks are crucial, as a unique tag identifies each new patch.</p>
<p>Floating is ideal if you prefer a single pointer to the latest patch for your CI/CD pipelines. Reduces complexity by eliminating the need to update references in downstream applications with each patch, but sacrifices strict versioning, making it challenging to roll back.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-getting-started-with-continuous-patching">üöÄ Getting Started with Continuous Patching<a href="#-getting-started-with-continuous-patching" class="hash-link" aria-label="Direct link to üöÄ Getting Started with Continuous Patching" title="Direct link to üöÄ Getting Started with Continuous Patching">‚Äã</a></h2>
<p>So let us get started. To begin, I will utilize my <a href="https://github.com/lukemurraynz/Codespace_IaC_Coding" target="_blank" rel="noopener noreferrer">Codespace_IaC_Coding</a> Codespace configuration, which already meets the prerequisites I need, specifically <a href="https://learn.microsoft.com/cli/azure/what-is-azure-cli?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure CLI</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-installing-the-required-extension">üì¶ Installing the Required Extension<a href="#-installing-the-required-extension" class="hash-link" aria-label="Direct link to üì¶ Installing the Required Extension" title="Direct link to üì¶ Installing the Required Extension">‚Äã</a></h3>
<p>To start, we need to install the CLI extension for ACR Continuous Patching:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az extension </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-n</span><span class="token plain"> acrcssc</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="Install Custom extension" src="/assets/images/ACR_ContinuousPatching_InstallExtension-57e1b5c89e8cd11fb261b36e76a0a9f8.gif" width="1567" height="312" class="img_ev3q"></p>
<p>Then we need to log in to our Azure Container Registry:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az login</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">az acr login </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-n</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">myRegistry</span><span class="token operator">&gt;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="Login to ACR" src="/assets/images/ACR_ContinuousPatching_LoginAzureACR-07600f44193d9ee82b6cf85a33b4c2ea.gif" width="1567" height="312" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-configuring-the-continuous-patching-schema">üìù Configuring the Continuous Patching Schema<a href="#-configuring-the-continuous-patching-schema" class="hash-link" aria-label="Direct link to üìù Configuring the Continuous Patching Schema" title="Direct link to üìù Configuring the Continuous Patching Schema">‚Äã</a></h3>
<p>Now we need to prepare the JSON schema that we will use to configure our Continuous Patching.</p>
<p>This schema defines which repositories and tags to patch, when to patch them, and how to tag the patched images.</p>
<p>The schema includes these key components:</p>
<ul>
<li><code>version</code> - Used by the ACR team to track schema versions. Don&#x27;t modify this unless instructed.</li>
<li><code>tag-convention</code> - Optional field that specifies the tagging method. Values can be &quot;incremental&quot; (default) or &quot;floating&quot;.</li>
<li><code>repositories</code> - An array of objects containing:<!-- -->
<ul>
<li><code>repository</code> - The name of the repository to patch</li>
<li><code>tags</code> - Array of specific tags to patch (use wildcard <code>*</code> to include all tags)</li>
<li><code>enabled</code> - Boolean (true/false) to enable or disable patching for this repository</li>
</ul>
</li>
</ul>
<p>For example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;v1&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;tag-convention&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;incremental&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;repositories&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;repository&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;api-firewall&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;tags&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0.6.7&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;latest&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;enabled&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>So let us create the file as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">cat</span><span class="token plain"> </span><span class="token operator">&lt;&lt;</span><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> </span><span class="token string bash punctuation operator" style="color:rgb(248, 248, 242)">&gt;</span><span class="token string bash punctuation" style="color:rgb(248, 248, 242)"> continuouspatching.json</span><span class="token string" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;version&quot;: &quot;v1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;tag-convention&quot;: &quot;incremental&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  &quot;repositories&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      &quot;repository&quot;: &quot;api-firewall&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      &quot;tags&quot;: [&quot;0.6.7&quot;, &quot;latest&quot;],</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">      &quot;enabled&quot;: true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">EOF</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-running-a-dry-run">üßê Running a Dry Run<a href="#-running-a-dry-run" class="hash-link" aria-label="Direct link to üßê Running a Dry Run" title="Direct link to üßê Running a Dry Run">‚Äã</a></h3>
<p>Next, we can run a dry run of the supply-chain workflow to validate that our repository and tags are correct:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az acr supply-chain workflow create </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token plain"> myRegistry </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-g</span><span class="token plain"> myResourceGroup </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-t</span><span class="token plain"> continuouspatchv1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--config</span><span class="token plain"> ./continuouspatching.json </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--schedule</span><span class="token plain"> 1d --dry-run</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="Image - ACR Continuous Patching" src="/assets/images/ACR_ContinuousPatching_DryRun_SupplyChain-603d2d21a835ab6c96ae67d3420dd5c4.gif" width="1567" height="312" class="img_ev3q"></p>
<p>You can also view the run in the Azure Portal, and see it pull the CSSC <em>(Microsoft&#x27;s Containers Secure Supply Chain (CSSC) framework)</em> image to run the workflow.</p>
<p><img decoding="async" loading="lazy" alt="Image - ACR Continuous Patching" src="/assets/images/ContinuousPatching_ACR_DryRun_AzurePortal-1939ee81d3ed66fc00641542c76b360f.jpg" width="1427" height="904" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can use the <code>az acr supply-chain workflow update</code> command to update the workflow configuration, if needed, at a later stage.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-understanding-the-scheduling-system">üìÖ Understanding the Scheduling System<a href="#-understanding-the-scheduling-system" class="hash-link" aria-label="Direct link to üìÖ Understanding the Scheduling System" title="Direct link to üìÖ Understanding the Scheduling System">‚Äã</a></h2>
<p>Before we do, let&#x27;s understand how scheduling works in ACR Continuous Patching.</p>
<blockquote>
<p>The scheduling system works like a calendar with fixed dates each month, not like a countdown timer!</p>
</blockquote>
<p>The <code>--schedule</code> parameter sets how many days between patch runs, but these always align to fixed days counting from the 1st of each month. Think of it like marking specific dates on a calendar.</p>
<p>For example, if you choose <code>--schedule 7d</code>, patching will run on the 1st, 8th, 15th, 22nd, and 29th of each month (every 7 days from the 1st).</p>
<p>Here&#x27;s what happens with different schedule values:</p>
<table><thead><tr><th>Schedule</th><th>Runs on these days each month</th><th>Example</th></tr></thead><tbody><tr><td><code>1d</code></td><td>Every day</td><td>Patches run daily</td></tr><tr><td><code>3d</code></td><td>1st, 4th, 7th, 10th, 13th, 16th, 19th, 22nd, 25th, 28th, 31st</td><td>If today is the 5th, next run is on the 7th</td></tr><tr><td><code>7d</code></td><td>1st, 8th, 15th, 22nd, 29th</td><td>If today is the 10th, next run is on the 15th</td></tr><tr><td><code>14d</code></td><td>1st, 15th, 29th</td><td>If today is the 20th, next run is on the 29th</td></tr><tr><td><code>30d</code></td><td>1st, 31st (if month has 31 days)</td><td>Runs at the beginning and end of the month</td></tr></tbody></table>
<p>When you add the <code>--run-immediately</code> flag, a patch happens right away, and then the next one follows the regular schedule.</p>
<p>Remember: The schedule always resets at the beginning of each month. So if your last patch in January was on the 29th with a <code>7d</code> schedule, the next one will be on February 1st, not February 5th.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-executing-the-workflow">‚ñ∂Ô∏è Executing the Workflow<a href="#Ô∏è-executing-the-workflow" class="hash-link" aria-label="Direct link to ‚ñ∂Ô∏è Executing the Workflow" title="Direct link to ‚ñ∂Ô∏è Executing the Workflow">‚Äã</a></h3>
<p>Now let&#x27;s run the workflow:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az acr supply-chain workflow create </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token plain"> myRegistry </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-g</span><span class="token plain"> myResourceGroup </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-t</span><span class="token plain"> continuouspatchv1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--config</span><span class="token plain"> ./continuouspatching.json </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--schedule</span><span class="token plain"> 14d --run-immediately </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--verbose</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>If you get the following warning:</p><p><code>Failed to validate and deploy template: (DeploymentFailed) At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details. Code: DeploymentFailed Message: At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details. Target: /subscriptions/11b74992-d520-46e1-a9e9-b55c57d2e890/resourceGroups/acrcontinuouspatchingtest/providers/Microsoft.Resources/deployments/continuouspatchingdeployment Exception Details:      (RoleAssignmentUpdateNotPermitted) Tenant ID, application ID, principal ID, and scope are not allowed to be updated.         Code: RoleAssignmentUpdateNotPermitted         Message: Tenant ID, application ID, principal ID, and scope are not allowed to be updated.      (RoleAssignmentUpdateNotPermitted) Tenant ID, application ID, principal ID, and scope are not allowed to be updated.</code></p><p>It may mean that the Tasks have existed before, but if the Tasks were deleted in the portal, then it won&#x27;t have removed the permission assignments.</p><p>You can check the permissions in the Access control (IAM) portal, and if they exist, you can delete them manually from the portal.</p><p>If you run the following workflow delete command <em>(preferred)</em>, it will delete the assigned RBAC permissions as well:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az acr supply-chain workflow delete </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token plain"> myRegistry </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-g</span><span class="token plain"> myResourceGroup </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-t</span><span class="token plain"> continuouspatchv1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--yes</span><br></span></code></pre></div></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can add the <code>--verbose</code> flag to the command to get more detailed output during the workflow creation process and the <code>--debug</code> flag to get even more detailed output, including the HTTP requests and responses sent to Azure.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-reviewing-the-created-tasks">üîß Reviewing the Created Tasks<a href="#-reviewing-the-created-tasks" class="hash-link" aria-label="Direct link to üîß Reviewing the Created Tasks" title="Direct link to üîß Reviewing the Created Tasks">‚Äã</a></h2>
<p>Now that the Tasks have been created, you can see them in the Azure Portal.</p>
<p><img decoding="async" loading="lazy" alt="Image - ACR Continuous Patching" src="/assets/images/ContinuousPatching_ACR_Run_TasksAzurePortal-26db6c4b7b7ae19c124e940bed4da868.jpg" width="1355" height="389" class="img_ev3q"></p>
<p>You can also run the following command to see the state of the workflows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az acr supply-chain workflow show </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-r</span><span class="token plain"> myRegistry </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-g</span><span class="token plain"> myResourceGroup </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-t</span><span class="token plain"> Continuouspatchv1  </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-o</span><span class="token plain"> table</span><br></span></code></pre></div></div>
<p>The workflow creates three tasks in your Azure Container Registry:</p>
<table><thead><tr><th>Task Name</th><th>Description</th><th>Purpose</th></tr></thead><tbody><tr><td><strong>cssc-trigger-workflow</strong></td><td>Triggers the continuous patching workflow based on your configured schedule</td><td>This is the main scheduler that runs on your defined schedule (every 14 days in our example). It checks which repositories match your configuration and initiates the scanning process.</td></tr><tr><td><strong>cssc-scan-image</strong></td><td>Performs vulnerability scanning using Trivy</td><td>This task scans your container images for OS-level vulnerabilities. If vulnerabilities are found, it automatically triggers the patching task.</td></tr><tr><td><strong>cssc-patch-image</strong></td><td>Applies security patches using Copacetic</td><td>This task does the actual patching work, fixing OS vulnerabilities in your container images without needing to rebuild them from source.</td></tr></tbody></table>
<p>These three tasks work together to form a complete patching pipeline: the trigger starts on schedule, the scanner identifies vulnerabilities, and the patcher automatically fixes them.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-monitoring-task-execution">üìä Monitoring Task Execution<a href="#-monitoring-task-execution" class="hash-link" aria-label="Direct link to üìä Monitoring Task Execution" title="Direct link to üìä Monitoring Task Execution">‚Äã</a></h3>
<p>You can check the logs of the run by looking up the recent Runs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">az acr task logs </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--registry</span><span class="token plain"> myRegistry</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="Image - ACR Continuous Patching" src="/assets/images/ContinuousPatching_ACR_Logs-90da0d0534e4ad212fd5f823d9960350.jpg" width="1424" height="697" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-viewing-the-results">üéØ Viewing the Results<a href="#-viewing-the-results" class="hash-link" aria-label="Direct link to üéØ Viewing the Results" title="Direct link to üéØ Viewing the Results">‚Äã</a></h2>
<p>Now, if we go into the repositories in the Azure Portal, we can see that the image has been patched with the incremental tag.</p>
<p><img decoding="async" loading="lazy" alt="Image - Azure Container Registry" src="/assets/images/ContinuousPatching_ACR_Patched-648c61e407761be61dcff3dc5dc424fe.jpg" width="979" height="410" class="img_ev3q"></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/misc/codespace-secrets/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">GitHub Codespace Secrets</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/sftp-event-hub-function/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Processing SFTP Events with Azure Function and Event Hub</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#Ô∏è-what-is-acr-continuous-patching" class="table-of-contents__link toc-highlight">üõ°Ô∏è What is ACR Continuous Patching?</a></li><li><a href="#-test-environment-setup" class="table-of-contents__link toc-highlight">üß™ Test Environment Setup</a></li><li><a href="#Ô∏è-how-continuous-patching-works" class="table-of-contents__link toc-highlight">‚öôÔ∏è How Continuous Patching Works</a></li><li><a href="#-getting-started-with-continuous-patching" class="table-of-contents__link toc-highlight">üöÄ Getting Started with Continuous Patching</a><ul><li><a href="#-installing-the-required-extension" class="table-of-contents__link toc-highlight">üì¶ Installing the Required Extension</a></li><li><a href="#-configuring-the-continuous-patching-schema" class="table-of-contents__link toc-highlight">üìù Configuring the Continuous Patching Schema</a></li><li><a href="#-running-a-dry-run" class="table-of-contents__link toc-highlight">üßê Running a Dry Run</a></li></ul></li><li><a href="#-understanding-the-scheduling-system" class="table-of-contents__link toc-highlight">üìÖ Understanding the Scheduling System</a><ul><li><a href="#Ô∏è-executing-the-workflow" class="table-of-contents__link toc-highlight">‚ñ∂Ô∏è Executing the Workflow</a></li></ul></li><li><a href="#-reviewing-the-created-tasks" class="table-of-contents__link toc-highlight">üîß Reviewing the Created Tasks</a><ul><li><a href="#-monitoring-task-execution" class="table-of-contents__link toc-highlight">üìä Monitoring Task Execution</a></li></ul></li><li><a href="#-viewing-the-results" class="table-of-contents__link toc-highlight">üéØ Viewing the Results</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Controlled Chaos in Azure using Chaos Studio | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/azure/controlled-chaos-in-azure-using-chaos-studio/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Controlled Chaos in Azure using Chaos Studio | luke.geek.nz"><meta data-rh="true" name="description" content="Chaos engineering has been around for a while; Netflix runs their own famous Chaos Monkey, supposedly running 24/7, taking down their resources and pushing them to the limit continuously; it almost sounds counter-intuitive ‚Äì but it&#x27;s not."><meta data-rh="true" property="og:description" content="Chaos engineering has been around for a while; Netflix runs their own famous Chaos Monkey, supposedly running 24/7, taking down their resources and pushing them to the limit continuously; it almost sounds counter-intuitive ‚Äì but it&#x27;s not."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-01-06T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/azure/controlled-chaos-in-azure-using-chaos-studio/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/controlled-chaos-in-azure-using-chaos-studio/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/controlled-chaos-in-azure-using-chaos-studio/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://luke.geek.nz/azure/controlled-chaos-in-azure-using-chaos-studio","mainEntityOfPage":"https://luke.geek.nz/azure/controlled-chaos-in-azure-using-chaos-studio","url":"https://luke.geek.nz/azure/controlled-chaos-in-azure-using-chaos-studio","headline":"Controlled Chaos in Azure using Chaos Studio","name":"Controlled Chaos in Azure using Chaos Studio","description":"Chaos engineering has been around for a while; Netflix runs their own famous Chaos Monkey, supposedly running 24/7, taking down their resources and pushing them to the limit continuously; it almost sounds counter-intuitive ‚Äì but it's not.","datePublished":"2022-01-06T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://luke.geek.nz/","name":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.28b9be22.css">
<script src="/assets/js/runtime~main.ccd67ab6.js" defer="defer"></script>
<script src="/assets/js/main.d332b255.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/implementing-ai-gateway-in-api-management/">Implementing AI Gateway capabilities in API Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/secure-container-supply-chain/">Securing Container Supply Chains with CSSC Framework</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/api-management-overview/">Features and Benefits of Azure API Management</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/hackathon-vending-project/">Azure Hackathon Vending with Terraform</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/automate-container-patching-with-trivy-copacetic-azure-devops/">Container Patching with Azure DevOps, Trivy and Copacetic</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Controlled Chaos in Azure using Chaos Studio</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-01-06T00:00:00.000Z">January 6, 2022</time> ¬∑ <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span>Luke Murray</span></a></div><small class="avatar__subtitle">Author</small></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Chaos engineering has been around for a while; Netflix runs their own famous <a href="https://netflix.github.io/chaosmonkey/" target="_blank" rel="noopener noreferrer">Chaos Monkey</a>, supposedly running 24/7, taking down their resources and pushing them to the limit continuously; it almost sounds counter-intuitive ‚Äì but it&#x27;s not.</p>
<blockquote>
<p>Chaos engineering is defined as ‚Äúthe discipline of experimenting on a system in order to build confidence in the system‚Äôs capability to withstand turbulent conditions in production‚Äù (Principles of Chaos Engineering, <a href="http://principlesofchaos.org/" target="_blank" rel="noopener noreferrer" title="http://principlesofchaos.org/">http://principlesofchaos.org/</a>). In other words, it‚Äôs a software testing method focusing on finding evidence of problems before they are experienced by users.</p>
<p>Chaos engineering is a methodology that helps developers attain consistent reliability by hardening services against failures in production. Another way to think about chaos engineering is that it&#x27;s about embracing the inherent chaos in complex systems and, through experimentation, growing confidence in your solution&#x27;s ability to handle it.</p>
<p>A common way to introduce chaos is to deliberately inject faults that cause system components to fail. The goal is to observe, monitor, respond to, and improve your system&#x27;s reliability under adverse circumstances. For example, taking dependencies offline (stopping API apps, shutting down VMs, etc.), restricting access (enabling firewall rules, changing connection strings, etc.), or forcing failover (database level, Front Door, etc.), is a good way to validate that the application is able to handle faults gracefully.</p>
</blockquote>
<p>Introducing controlled Chaos tools such as Chaos Monkey and now ‚Äì <a href="https://azure.microsoft.com/en-us/services/chaos-studio/?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure Chaos Studio</a> allows you to put pressure and, in some cases, take down your services to teach you how your services will react under strain and identity areas of improvement as resiliency and scalability to improve your systems.</p>
<p><img decoding="async" loading="lazy" alt="Chaos" src="/assets/images/chaosengineering-banner-0929ef3aa12bf5e4832160ff75a00b4b.png" title="Chaos" width="2400" height="700" class="img_ev3q"></p>
<p>Azure Chaos Studio <em>(currently in Preview and only supported in several</em> <a href="https://azure.microsoft.com/en-us/global-infrastructure/services/?products=chaos-studio&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer"><em>regions</em></a><em>now)</em> is an enabler for &#x27;controlled Chaos&#x27; in the Microsoft Azure ecosystem. Using that same tool that Microsoft uses to test and improve their services ‚Äì you can as well!</p>
<p>Chaos Studio works by creating Experiments <em>(i.e., Faults/Capabilities)</em> that run against Targets <em>(your resources, whether they are agent or service-based)</em>.</p>
<p>There are two types of methods you can use to target your resources:</p>
<ul>
<li>Service-direct</li>
<li>Agent-based</li>
</ul>
<p>Service-direct is tied into the Azure fabric and puts pressure on your resources from outside them <em>(i.e., supported on most resources that don&#x27;t need agent-based, PaaS resources, such as Network Security Groups).</em> For example, a service-direct capability may be to add or remove a security rule from your network security group for faulty findings.</p>
<p>Agent-based relies on an agent installed; these are targeted at resources such as Virtual Machine and Virtual Machine scale sets; agent-based targets use a user-assigned managed identity to manage an agent on your virtual machines and wreak havoc by running capabilities such as stopping services and putting memory and disk pressure on your workloads.</p>
<p>Just a word of warning, before you proceed to allow Chaos to reign in your environment, make sure it is done out of hours or, better yet ‚Äì against development or test resources, also make sure that any resources that support autoscaling are disabled ‚Äì or you might suddenly find ten more instances of that resource you were running <em>(unless of course you&#x27;re testing that autoscaling is working)</em>! üòä</p>
<p>In my test setup, I have the following already pre-created that I will be running my experiments against:</p>
<ul>
<li>Virtual Machine Scale set <em>(running Windows with two instances)</em></li>
<li>Single Virtual Machine <em>(running Windows)</em> to test shutdown against</li>
</ul>
<p>The currently supported resource types of Azure Chaos Studio can be found &#x27;<a href="https://learn.microsoft.com/en-us/azure/chaos-studio/chaos-studio-fault-providers?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">here</a>&#x27;.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-azure-chaos-studio">Setup Azure Chaos Studio<a href="#setup-azure-chaos-studio" class="hash-link" aria-label="Direct link to Setup Azure Chaos Studio" title="Direct link to Setup Azure Chaos Studio">‚Äã</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-managed-identity">Create Managed Identity<a href="#create-managed-identity" class="hash-link" aria-label="Direct link to Create Managed Identity" title="Direct link to Create Managed Identity">‚Äã</a></h4>
<p>Because we will use Agent-based capabilities to generate our Faults, I needed to create a Managed Identity to give Chaos Studio the ability to wreak havoc on my resources!</p>
<ol>
<li>In the <strong>Azure Portal,</strong> search for <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.ManagedIdentity%2FuserAssignedIdentities" target="_blank" rel="noopener noreferrer"><strong>Managed Identities</strong></a></li>
<li>Click on <strong>Create</strong></li>
<li><strong>Select</strong> the <strong>subscrSubscription</strong>ng the resources that you want to test against</li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to place the managed identity in (<em>I suggest creating a new Resource Group, as your Chaos experiments may have a different lifecycle than your resources, but it&#x27;s just a preference, I will be placing mine in the Chaos Studio resource group so I can quickly delete it later)</em>.</li>
<li><strong>Select</strong> the <strong>RegionRegion</strong>ur resources</li>
<li>Type in a <strong>name</strong> (<em>this will be the identity that you will see in logs running these experiments, so make sure its something you can identify with)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Create User Management Identity" src="/assets/images/azure_userassignedmanageidentity-8f2cdc8b86ee1f35091c9270a3061f5a.png" title="Azure Portal - Create User Management Identity" width="602" height="347" class="img_ev3q"></li>
<li>Click <strong>Next: Tags</strong></li>
<li>Make sure you enter appropriate tags to make sure that the resource can be identified and tracked, and click <strong>Review + Create</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Portal Tags" src="/assets/images/azuretags_chaos-3882e50f463cdfc7bb84fb50a0845993.png" title="Azure Portal Tags" width="602" height="238" class="img_ev3q"></li>
<li>Verify that everything looks good and click <strong>Create</strong> to create your User Assigned Managed identity.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-application-insights">Create Application Insights<a href="#create-application-insights" class="hash-link" aria-label="Direct link to Create Application Insights" title="Direct link to Create Application Insights">‚Äã</a></h4>
<p>Now, it&#x27;s time to create an Application Insights resource. Applications Insights is for the logs of the experiments to go into, so you can see the faults and their behaviours.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, search for <a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.insights%2Fcomponents" target="_blank" rel="noopener noreferrer"><strong>Application Insights</strong></a></li>
<li>Click on <strong>Create</strong></li>
<li><strong>Select</strong> the <strong>Subscription</strong> the resources that you want to test against</li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to place the Application Insights resource into (<em>I suggest creating a new Resource Group, as your Chaos experiments may have a different lifecycle than your resources, but it&#x27;s just a preference, I will be placing mine in the Chaos Studio resource group so I can easily delete it later)</em>.</li>
<li><strong>Select</strong> the <strong>Region</strong> the resources are in</li>
<li>Type in a <strong>name</strong></li>
<li><strong>Select</strong> your <strong>Log Analytics workspace</strong> you want to link Application Insights to <em>(if you don&#x27;t have a Log Analytics workspace, you can create one &#x27;</em><a href="https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.OperationalInsights%2Fworkspaces" target="_blank" rel="noopener noreferrer"><em>here</em></a><em>&#x27;)</em>.</li>
<li><img decoding="async" loading="lazy" alt="Azure Portal - Application Insights" src="/assets/images/azure_applicationinsights-c4676bae524a9a2cafbeaa8ed778cc01.png" title="Azure Portal - Application Insightsv" width="602" height="520" class="img_ev3q"></li>
<li>Click <strong>Tags</strong></li>
<li>Make sure you <strong>enter appropriate tags</strong> to make sure that the resource can be identified and tracked, and click <strong>Review + Create</strong></li>
<li>Verify that everything looks good and click <strong>Create</strong> to create your Application Insights.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-chaos-studio-targets">Setup Chaos Studio Targets<a href="#setup-chaos-studio-targets" class="hash-link" aria-label="Direct link to Setup Chaos Studio Targets" title="Direct link to Setup Chaos Studio Targets">‚Äã</a></h4>
<p>It is now time to add the resources targets to Chaos Studio</p>
<ol>
<li>In the <strong>Azure Portal</strong>, search for <a href="https://portal.azure.com/#blade/Microsoft_Azure_Chaos/ChaosStudioMenuBlade/overview" target="_blank" rel="noopener noreferrer"><strong>Chaos Studio</strong></a></li>
<li>On the left band side Blade, select <strong>Targets</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio" src="/assets/images/azure_chaosstudio_targets-989d1638d9ab55b2a648197eb570d72f.png" title="Azure Chaos Studio" width="602" height="125" class="img_ev3q"></li>
<li>As you can see, I have a Virtual Machine Scale Set and a front-end Network Security Group.</li>
<li><strong>Select</strong> the <strong>checkbox</strong> next to Name to <strong>select all</strong> the Resources</li>
<li>Select <strong>Enable Targets</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio" src="/assets/images/azure_chaosstudio_targets2-52ce0a064e8a54465447a2997047630b.png" title="Azure Chaos Studio" width="602" height="106" class="img_ev3q"></li>
<li>Select <strong>Enable service-direct targets (All resources)</strong></li>
<li>Enabling the service-direct targets will then add the capabilities supported by Service-direct targets into Chaos Studio for you to use.</li>
<li>Once completed, I will <strong>select</strong> the scale set and click <strong>Enable Target</strong></li>
<li>Then finally, <strong>Enable agent-based targets (VM, VMSS)</strong></li>
<li>This is where you link the user-managed identity, and Application Insights created earlier</li>
<li><strong>Select</strong> your <strong>Subscription</strong></li>
<li>Select your <strong>managed identity</strong></li>
<li>Select Enabled for Application Insights and select your Application Insights account. The instrumentation key should be selected manually.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio - Enable targets" src="/assets/images/azure_chaosstudio_enableagenttargets-620b1ddfd69c44193fff354eaca7ceb8.png" title="Azure Chaos Studio - Enable targets" width="602" height="584" class="img_ev3q"></li>
<li><em>If your instrumentation key isn&#x27;t filled in, you can find it on the Overview pane of the Application Insights resource.</em></li>
<li>Click <strong>Review + Enable</strong></li>
<li><strong>Review</strong> the <strong>resources</strong> you want to enable Chaos Studio to target and select <strong>Enable</strong></li>
<li>Finally, you should now be back at the Targets pane make sure you select Manage actions and make sure that all actions are ticked and click <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio Capabilities" src="/assets/images/azurechaosactions-1af7db09581d9982ae10818aa1075db4.png" title="Azure Chaos Studio Capabilities" width="829" height="679" class="img_ev3q"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-and-run-azure-chaos-studio">Configure and run Azure Chaos Studio<a href="#configure-and-run-azure-chaos-studio" class="hash-link" aria-label="Direct link to Configure and run Azure Chaos Studio" title="Direct link to Configure and run Azure Chaos Studio">‚Äã</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="action-exclusions">Action exclusions<a href="#action-exclusions" class="hash-link" aria-label="Direct link to Action exclusions" title="Direct link to Action exclusions">‚Äã</a></h4>
<p>There may be actions that you don&#x27;t want to be run against specific resources; an example might be you don&#x27;t want anyone to kill any processes on a Virtual Machine.</p>
<ol>
<li>In the Target pane of Chaos Studio, select <strong>Actions</strong> next to the resource</li>
<li><strong>Unselect</strong> the <strong>capability</strong> you don&#x27;t want to run on that resource</li>
<li>Select <strong>Save</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio Actions" src="/assets/images/azure_chaosstudio_manageactions-5786b1de8eca578ccac4c06c5e680398.png" title="Azure Chaos Studio - Enable targets" width="602" height="641" class="img_ev3q"></li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configure-experiments">Configure Experiments<a href="#configure-experiments" class="hash-link" aria-label="Direct link to Configure Experiments" title="Direct link to Configure Experiments">‚Äã</a></h4>
<p>An experiment is a collection of capabilities to create faults, put pressure on your resources, and cause Chaos that will run against your target resources. These experiments are saved so you can run them multiple times and edit them later, although currently, you cannot reassign the same experiments to other resources.</p>
<p>Note: If you name an Experiment the same as another experiment, it will replace the older Experiment with your new one and retain the previous history.</p>
<ol>
<li>In the <strong>Azure Portal,</strong> search for <a href="https://portal.azure.com/#blade/Microsoft_Azure_Chaos/ChaosStudioMenuBlade/overview" target="_blank" rel="noopener noreferrer"><strong>Chaos Studio</strong></a>.</li>
<li>On the left band side Blade, select <strong>Experiments</strong></li>
<li>Click <strong>+ Create</strong></li>
<li><strong>Select</strong> your <strong>Subscription</strong></li>
<li><strong>Select</strong> your <strong>Resource Group</strong> to save the Experiment into</li>
<li><strong>Type</strong> in a <strong>name</strong> for your <strong>Experiment</strong> that makes sense; in this case, we will put some Memory pressure on the VM scale set.</li>
<li><strong>Select</strong> your <strong>Region</strong></li>
<li>Click <strong>Next: Experiment Designer</strong></li>
<li><strong>Using</strong> Experiment <strong>Designer</strong>, you can <strong>design</strong> your <strong>Faults</strong>; you can have multiple capabilities hit a resource with expected delays, <em>i.e., you can have Memory pressure on a VM for 10 minutes, then CPU pressure, then shutdown.</em></li>
<li>We are going to select <strong>Add Action</strong></li>
<li>Then <strong>Add Fault</strong></li>
<li>I am going to select <strong>Physical Memory</strong> pressure</li>
<li>Leave the duration to <strong>10 minutes</strong></li>
<li>Because this will go against my VM scale set, I will add in the instances I want to target <em>(if you aren&#x27;t targeting a VM Scale set, you can leave this blank, you can find the instance ID by going to your VM Scale set click on Instances, click on the VM instance you want to target and you should see the Instance ID in the Overview pane)</em></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio - Add fault" src="/assets/images/azure_chaosstudio_createexperimentaddfault-f6ff8fd1cfc8dab21fb1bcb99813e20d.png" title="Azure Chaos Studio - Add fault" width="602" height="441" class="img_ev3q"></li>
<li>Select <strong>Next: Target resources</strong></li>
<li><strong>Select</strong> your <strong>resources</strong> <em>(you will notice as this is an Agent-based capability, only agent supported resources are listed)</em></li>
<li>Select <strong>Add</strong></li>
<li>I am then going to <strong>Add delay for 5 Minutes</strong></li>
<li>Then add an <strong>abrupt VM shutdown</strong> for 10 minutes <em>(Chaos Studio will automatically restart the VM after the 10-minute duration)</em>.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos Studio create experiment" src="/assets/images/azure_chaosstudio_createexperimentaddfault2-ab12282d4c3801eb941de223ee7bc627.png" title="Azure Chaos Studio create experiment" width="602" height="266" class="img_ev3q"></li>
<li>As you can see with the Branches <em>(items that will run in parallel)</em> and actions, you can have multiple faults running at once in parallel by using branches or one after the other sequentially.</li>
<li>Now that we are ready with our faulty, we are going to click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong></li>
</ol>
<p><em>Note: I had an API error; after some investigation, I found it was having problems with the &#x27;?&#x27; in my experiment name, so I removed it and continued to create the Experiment.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="assign-permissions-for-the-experiments">Assign permissions for the Experiments<a href="#assign-permissions-for-the-experiments" class="hash-link" aria-label="Direct link to Assign permissions for the Experiments" title="Direct link to Assign permissions for the Experiments">‚Äã</a></h4>
<p>Now that the Experiment has been created, we need to give rights to the Managed User account created earlier <em>(and/or the System managed identity that was created when the Experiment was created for service-direct experiments)</em>.</p>
<p>I will assign permissions to the Resource Group that the VM Scale set exists in, but you might be better off applying the rights to the individual resource for more granular control. You can see suggested roles to give resources: <a href="https://learn.microsoft.com/en-us/azure/chaos-studio/chaos-studio-fault-providers?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Supported resource types and role assignments for the Chaos Studio</a> Microsoft page.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, click on the <strong>Resource Group</strong> containing the resources you want to run the Experiment against</li>
<li>Select <strong>Access control (IAM)</strong></li>
<li>Click <strong>+ Add</strong></li>
<li>Click <strong>Add Role Assignment</strong></li>
<li>Click <strong>Reader</strong></li>
<li>Click <strong>Next</strong></li>
<li>Select <strong>Assign access to Managed identity</strong></li>
<li>Click on <strong>+ Select Members</strong></li>
<li><strong>Select</strong> the <strong>User</strong> assigned <strong>management identity</strong></li>
<li>Click <strong>Review</strong> and <strong>assign</strong>.</li>
<li>Because the shutdown is a service-direct, <strong>go back and give the experiment system managed identity Virtual Machine Contributor rights</strong>, so it has access to shutdown the VM.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="run-experiments">Run Experiments<a href="#run-experiments" class="hash-link" aria-label="Direct link to Run Experiments" title="Direct link to Run Experiments">‚Äã</a></h4>
<p>Now that the Experiment has been created, it should appear as a resource in the resource group you selected earlier; if you open it, you can see the Experiment&#x27;s History, Start, and Edit buttons.</p>
<ol>
<li>Click <strong>Start</strong></li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos studio - Run experiment" src="/assets/images/azure_chaosstudio_whatmemory-09151c403439e67c1de46401589b3418.png" title="Azure Chaos studio - Run experiment" width="602" height="145" class="img_ev3q"></li>
<li>Click <strong>Ok</strong> to <strong>start</strong> the <strong>Experiment</strong> <em>(and place it into the queue)</em></li>
<li><strong>Click</strong> on <strong>Details</strong> to see the <strong>experiment progress</strong> <em>(and any errors)</em>, and if it fails one part, it may move to the next step depending on the fault.</li>
<li><img decoding="async" loading="lazy" alt="Azure Chaos studio - Run experiment" src="/assets/images/azure_chaosstudio_whatmemoryrun-1bac1d245af3399c523a6792dea66041.png" title="Azure Chaos studio - Run experiment" width="602" height="346" class="img_ev3q"></li>
<li><strong>Azure Chaos studio should now run rampant and do best ‚Äì cause Chaos</strong>!</li>
</ol>
<p>This service is still currently in Preview. If you have any issues, take a look at the: <a href="https://learn.microsoft.com/en-us/azure/chaos-studio/troubleshooting" target="_blank" rel="noopener noreferrer">Troubleshoot issues with Azure Chaos Studio</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-and-auditing-of-azure-chaos-studio">Monitor and Auditing of Azure Chaos Studio<a href="#monitor-and-auditing-of-azure-chaos-studio" class="hash-link" aria-label="Direct link to Monitor and Auditing of Azure Chaos Studio" title="Direct link to Monitor and Auditing of Azure Chaos Studio">‚Äã</a></h3>
<p>Now that Azure Chaos Studio is in use by your organization, you may want to know what auditing is available, along with reporting to Application Insights.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="azure-activity-log">Azure Activity Log<a href="#azure-activity-log" class="hash-link" aria-label="Direct link to Azure Activity Log" title="Direct link to Azure Activity Log">‚Äã</a></h4>
<p>When an Azure Chaos Studio experiment has touched a resource, there will be an audit trail in the Azure activity log of that resource; here, you can see that &#x27;WhatMemory&#x27;, which is the Name of my Chaos Experiment, has successfully powered off and on my VM.</p>
<p><img decoding="async" loading="lazy" alt="Azure Activity Log - Azure Chaos Studio" src="/assets/images/azure_chaosstudio_activitylog-27476f7626f821f811db0174c941c034.png" title="Azure Activity Log - Azure Chaos Studio" width="602" height="56" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="azure-alerts">Azure Alerts<a href="#azure-alerts" class="hash-link" aria-label="Direct link to Azure Alerts" title="Direct link to Azure Alerts">‚Äã</a></h4>
<p>It is easy to set up alerts when a Chaos experiment kicks off; to create an Azure, do the following.</p>
<ol>
<li>In the <strong>Azure Portal</strong>, click on <strong>Azure Monito</strong>r</li>
<li>Click on <strong>Alerts</strong></li>
<li>Click <strong>+ Create</strong></li>
<li>Select <strong>Alert Rule</strong></li>
<li>Click <strong>Create resource</strong></li>
<li><strong>Filter</strong> your resource <strong>type</strong> to <strong>Chaos Experiments</strong></li>
<li><strong>Filter</strong> your <strong>alert</strong> to <strong>Subscription</strong> and click <strong>Done</strong></li>
<li>Click <strong>Add Condition</strong></li>
<li>Select: <strong>Starts a Chaos Experiment</strong></li>
<li>Make sure that: *<em>Event initiated by is set to (All services and users)</em></li>
<li>Click <strong>Done</strong></li>
<li>Click <strong>Add Action Group</strong></li>
<li>If you have one, <strong>assign</strong> an <strong>action group</strong> <em>(these are who and how the alerts will get to you)</em>. If you don&#x27;t have one, click: <strong>+ Create an action group</strong>.</li>
<li><strong>Specify</strong> a resource <strong>group</strong> to hold your action groups <em>(usually a monitor or management resource group)</em></li>
<li>Type the <strong>Action Group name</strong></li>
<li>Type the <strong>Action group Display name</strong></li>
<li>Click <strong>Next: Notifications</strong></li>
<li>Select <strong>Notification Type</strong></li>
<li>Select <strong>email</strong></li>
<li>Select <strong>Email</strong></li>
<li><strong>Type</strong> in your <strong>email</strong> address to be notified</li>
<li>Click <strong>ok</strong></li>
<li><strong>Type</strong> in the <strong>Name</strong> of the <strong>mail</strong> to be a reference in the future <em>(i.e. Help Desk)</em></li>
<li>Click <strong>Review + Create</strong></li>
<li>Click <strong>Create</strong> to create your Action group</li>
<li>Type in your <strong>rule name</strong> <em>(i.e. Alert ‚Äì Chaos Experiment ‚Äì Started)</em></li>
<li>Type in a <strong>description</strong></li>
<li><strong>Specify</strong> the <strong>resource group</strong> to place the alert in <em>(again, usually a monitor or management resource group)</em></li>
<li>Check <strong>Enable alert rule on creation</strong></li>
<li>Click <strong>Create alert rule</strong></li>
</ol>
<p><em>Note: Activity Log alerts are hidden types; they are not shown in the resource group by default, but if you check the: Show hidden types box, they will appear.</em></p>
<p><img decoding="async" loading="lazy" alt="Azure Activity Log - Azure Chaos Studio" src="/assets/images/azure_chaosstudio_alert-9d90704feb648ce05039987b32de9c97.png" title="Azure Activity Log - Azure Chaos Studio" width="602" height="48" class="img_ev3q"></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/azure/azure-public-dns-as-code/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Azure Public DNS as Code</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/azure-active-directory-application-proxy-implementation/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Microsoft Entra ID Application Proxy Implementation</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup-azure-chaos-studio" class="table-of-contents__link toc-highlight">Setup Azure Chaos Studio</a><ul><li><a href="#create-managed-identity" class="table-of-contents__link toc-highlight">Create Managed Identity</a></li><li><a href="#create-application-insights" class="table-of-contents__link toc-highlight">Create Application Insights</a></li><li><a href="#setup-chaos-studio-targets" class="table-of-contents__link toc-highlight">Setup Chaos Studio Targets</a></li></ul></li><li><a href="#configure-and-run-azure-chaos-studio" class="table-of-contents__link toc-highlight">Configure and run Azure Chaos Studio</a><ul><li><a href="#action-exclusions" class="table-of-contents__link toc-highlight">Action exclusions</a></li><li><a href="#configure-experiments" class="table-of-contents__link toc-highlight">Configure Experiments</a></li><li><a href="#assign-permissions-for-the-experiments" class="table-of-contents__link toc-highlight">Assign permissions for the Experiments</a></li><li><a href="#run-experiments" class="table-of-contents__link toc-highlight">Run Experiments</a></li></ul></li><li><a href="#monitor-and-auditing-of-azure-chaos-studio" class="table-of-contents__link toc-highlight">Monitor and Auditing of Azure Chaos Studio</a><ul><li><a href="#azure-activity-log" class="table-of-contents__link toc-highlight">Azure Activity Log</a></li><li><a href="#azure-alerts" class="table-of-contents__link toc-highlight">Azure Alerts</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Enterprise Policy as Code with Azure DevOps | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/azure/enterprise-policy-code-azure-devops/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Enterprise Policy as Code with Azure DevOps | luke.geek.nz"><meta data-rh="true" name="description" content="Enterprise Azure Policy as Code, or EPAC for short, comprises a number of scripts which can be used in a CI/CD-based system or a semi-automated use to deploy Policies, Policy Sets, Assignments, Policy Exemptions and Role Assignments. Let us take a look at its use."><meta data-rh="true" property="og:description" content="Enterprise Azure Policy as Code, or EPAC for short, comprises a number of scripts which can be used in a CI/CD-based system or a semi-automated use to deploy Policies, Policy Sets, Assignments, Policy Exemptions and Role Assignments. Let us take a look at its use."><meta data-rh="true" name="keywords" content="azure,policy,azurepolicy,security,iac"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-02-18T23:25:11.692Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/azure/enterprise-policy-code-azure-devops/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/enterprise-policy-code-azure-devops/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/enterprise-policy-code-azure-devops/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://luke.geek.nz/azure/enterprise-policy-code-azure-devops","mainEntityOfPage":"https://luke.geek.nz/azure/enterprise-policy-code-azure-devops","url":"https://luke.geek.nz/azure/enterprise-policy-code-azure-devops","headline":"Enterprise Policy as Code with Azure DevOps","name":"Enterprise Policy as Code with Azure DevOps","description":"Enterprise Azure Policy as Code, or EPAC for short, comprises a number of scripts which can be used in a CI/CD-based system or a semi-automated use to deploy Policies, Policy Sets, Assignments, Policy Exemptions and Role Assignments. Let us take a look at its use.","datePublished":"2024-02-18T23:25:11.692Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":["azure","policy","azurepolicy","security","iac"],"isPartOf":{"@type":"Blog","@id":"https://luke.geek.nz/","name":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.dcdba76e.css">
<script src="/assets/js/runtime~main.09dcb24e.js" defer="defer"></script>
<script src="/assets/js/main.c4f5d207.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already make sure you sign up for my Weekly Azure Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/openai-request-badly-formatted/">Request is badly formatted Error with Azure OpenAI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/deploy-streamlit-to-container-apps/">Deploying a Streamlit App to Azure Container Apps</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/nz-north-latency-testing/">New Zealand North Latency Testing and Results</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/enhancing-github-copilot-with-custom-instructions/">Enhancing GitHub Copilot with Custom Instructions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/change-analysis/">Azure Resource - Change Analysis</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Enterprise Policy as Code with Azure DevOps</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-02-18T23:25:11.692Z">February 18, 2024</time> · <!-- -->19 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Enterprise Azure Policy as Code (EPAC) comprises a number of scripts which can be used in a CI/CD-based system or a semi-automated use to deploy Azure Policies, Policy Sets, Assignments, Policy Exemptions and Role Assignments! This is a great way to ensure that your Azure environment complies with your company&#x27;s policies and standards, so let us look at it!</p>
<p><img decoding="async" loading="lazy" alt="Blog Heading - EPAC ADO" src="/assets/images/BlogHeading_EPAC_ADO-a41d97fd00f51d878eaeb05f1062f2f0.png" width="1200" height="628" class="img_ev3q"></p>
<!-- -->
<p><a href="https://azure.github.io/enterprise-azure-policy-as-code/" target="_blank" rel="noopener noreferrer">Enterprise Azure Policy as Code (EPAC)</a> allows you to define and deploy your Azure policies and exemptions as code. This is a great way to ensure consistency of one or more Azure environments, including managing your exemptions in a way that is auditable and a way that can be integrated into CI/CD pull request approval processes.</p>
<p>So, let&#x27;s delve a little further into it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-enterprise-azure-policy-as-code">What is Enterprise Azure Policy as Code?<a href="#what-is-enterprise-azure-policy-as-code" class="hash-link" aria-label="Direct link to What is Enterprise Azure Policy as Code?" title="Direct link to What is Enterprise Azure Policy as Code?">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Enterprise Azure Policy as Code, or EPAC for short, comprises a number of scripts which can be used in a CI/CD-based system or a semi-automated use to deploy Policies, Policy Sets, Assignments, Policy Exceptions and Role Assignments.</p><p>Main features include:</p><ul>
<li>Multi-tenant/environment policy deployment</li>
<li>Easy CI/CD Integration</li>
<li>Extract existing policy objects from an environment</li>
<li>Support JSON and CSV inputs for large, complex policies</li>
<li>PowerShell Module</li>
<li>Integration with Azure Landing Zone recommended policies</li>
<li>Starter Kit with examples</li>
<li>Schema to provide Intellisense for VS Code development</li>
</ul></div></div>
<p>Enterprise Policy as Code, runs primarily on PowerShell scripts, at the time of writing, there is 114 PowerShell scripts that make up this solution <em>(not all are in use for day-to-day operations)</em>, from the actual deployment to the plan, importing existing policies and initiatives, creating GitHub or Azure DevOps issues, for policy remediation tasks and even importing Azure Landing Zone policies into the solution, this solution is jam-packed with an ever-expanding toolset.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It is worth noting that although this solution was designed and implemented by Microsoft employees, this is an <a href="https://opensource.microsoft.com/codeofconduct/" target="_blank" rel="noopener noreferrer">Open Source initiative</a> and is not officially supported by Microsoft, but the community is very active, and the solution is constantly being updated and improved upon. All <a href="https://github.com/Azure/enterprise-azure-policy-as-code/issues" target="_blank" rel="noopener noreferrer">Issues</a> can be raised directly on GitHub, and if you have any queries, concerns or issues, I suggest you look here first.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-would-you-use-enterprise-azure-policy-as-code">Why would you use Enterprise Azure Policy as Code?<a href="#why-would-you-use-enterprise-azure-policy-as-code" class="hash-link" aria-label="Direct link to Why would you use Enterprise Azure Policy as Code?" title="Direct link to Why would you use Enterprise Azure Policy as Code?">​</a></h2>
<p>So, why would you use EPAC? Before we go into that - let&#x27;s go back to basics - Azure Policy.</p>
<p><img decoding="async" loading="lazy" alt="What is Azure Policy" src="/assets/images/WhatIsAzurePolicy-b02306db2a09442ad39eab10756720af.png" width="1680" height="945" class="img_ev3q"></p>
<p><a href="https://learn.microsoft.com/azure/governance/policy/overview?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure policies</a> are essential to Azure governance; they are the &#x27;make it so&#x27; of the Azure environment <em>(and beyond)</em>.</p>
<p>The policies exist to help across areas such as:</p>
<ul>
<li>Maintain regulatory compliance with industry standards</li>
<li>Security and performance consistencies</li>
<li>Enterprise-wide design principles</li>
<li>Controlling cost</li>
</ul>
<p>But how do they do that? Let us take a look at the definitions that make them sing!</p>
<p>For this, we are to look at some of the key components of a definition for the &#x27;Function apps should authenticate to Azure Container Registry using a managed identity&#x27; policy.</p>
<p><img decoding="async" loading="lazy" alt="Azure Policy definition" src="/assets/images/PolicyDefinition-abd0e9ab78b3adc92f5a82019c89215b.png" width="1680" height="945" class="img_ev3q"></p>
<ul>
<li>Metadata</li>
<li>Parameters</li>
<li>Rules</li>
</ul>
<p>Metadata includes items such as: DisplayName, Mode <em>(Indexed vs All)</em>, version and categories.
Parameters give you the flexibility to adjust your policy to your environment, in this case, the policy is looking for a specific Azure Container Registry, but you could have a parameter for the resource group, the subscription, or even the identity that it uses, which can be adjusted to be unique between environments.
Rules are the actual policy; in this case, the policy is looking for a specific identity to be used to authenticate to the Azure Container Registry but will contain the type of resources that the policy will affect, the aliases or resource properties that it needs to look for to evaluate against, and even change.</p>
<p>So, why would you use EPAC? Imagine you have a large number of policies, a large number of environments, or even a large number of policy exemptions, managing your policies as code is a great way to manage them all in a consistent and auditable way, especially when you are working with different versions of policies, and policies deployed to different scopes as well.</p>
<p><img decoding="async" loading="lazy" alt="Azure Policy Scopes" src="/assets/images/EnterprisePolicyAsCode_PolicyAssignmentScope-7d18c856613c5eb49fafde315dae583b.png" width="1680" height="945" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-you-use-enterprise-azure-policy-as-code">How do you use Enterprise Azure Policy as Code?<a href="#how-do-you-use-enterprise-azure-policy-as-code" class="hash-link" aria-label="Direct link to How do you use Enterprise Azure Policy as Code?" title="Direct link to How do you use Enterprise Azure Policy as Code?">​</a></h2>
<p>Now that we have looked into some of the complexity of Azure policies, especially at scale. Let us take a look into how we can get going with <a href="https://azure.github.io/enterprise-azure-policy-as-code/" target="_blank" rel="noopener noreferrer">Enterprise Policy as Code</a>.</p>
<p>In this article, I am going to assume a few things:</p>
<ol>
<li>You have permission to deploy policies and policy assignments in your Azure environment</li>
<li>You have an Azure DevOps environment (we will use Azure DevOps pipelines in this article, however there is also GitHub action workflows that can be used if you are using GitHub as well) and <a href="https://azure.github.io/enterprise-azure-policy-as-code/ci-cd-app-registrations/" target="_blank" rel="noopener noreferrer">Service Connection configured</a>.</li>
</ol>
<p>We are going to leverage the EPAC <a href="https://github.com/Azure/enterprise-azure-policy-as-code/tree/main/StarterKit" target="_blank" rel="noopener noreferrer">StarterKit</a>, for the pipelines and scripts.</p>
<p>Before we get CI/CD pipelines set up, we need to do a few things locally first.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-import-existing-policies">Step 1: Import existing policies<a href="#step-1-import-existing-policies" class="hash-link" aria-label="Direct link to Step 1: Import existing policies" title="Direct link to Step 1: Import existing policies">​</a></h3>
<p>So, let&#x27;s import our existing policies and set up our environment! I highly recommend importing your existing environment first, as this will give you a good starting point for your policies, policy sets and exemptions.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This requires a computer running: <a href="https://learn.microsoft.com/powershell/scripting/install/installing-powershell-on-windows?view=powershell-7.4&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">PowerShell</a> 7.3.1 or later, 7.3.4 <em>(latest)</em> recommended, and the <a href="https://learn.microsoft.com/powershell/azure/install-azure-powershell?view=azps-11.3.0&amp;WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure PowerShell</a> module installed (Az required 9.3.0 or later).</p></div></div>
<p>In my environment, I have a range of Custom and Builtin policies and initiatives, that are mostly deployed to at the top level, including Sandbox policies, and am I also running an NZISM 3.5 initiative, which is a builtin iniative but not the most up-to-date, so as part of the EPAC implementation, I want to replace the policy assignment with 3.6 custom and assign my Sandbox policies to the Sandbox Management Group.</p>
<p>So let us get cracking!</p>
<ol>
<li>First, we need to install the EPAC PowerShell module and the Az module and connect to our Azure environment.</li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Install-Module</span><span class="token plain"> EnterprisePolicyAsCode </span><span class="token operator">-</span><span class="token plain">Scope CurrentUser</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Install-Module</span><span class="token plain"> Az </span><span class="token operator">-</span><span class="token plain">Scope CurrentUser</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">Connect-AzAccount</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Install PowerShell modules" src="/assets/images/EPAC_InstallPowerShellModules-254029f276bc1c4a575625334538f865.gif" width="1427" height="430" class="img_ev3q"></p>
<ol start="2">
<li>Once that&#x27;s installed and you are connected to the Azure environment that you want to export your policies from, now we can do the export. To do the export, you have to generate a BuildDefinition folder to contain your policies, assignments and exemptions.</li>
</ol>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">New-EPACDefinitionFolder</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">DefinitionsRootFolder Definitions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Create Definitions folder" src="/assets/images/EPAC_CreateDefinitionsFolder-0c8ac69994b2446e31f8d70ee41b5b70.gif" width="1427" height="430" class="img_ev3q"></p>
<p>That will create the following folders and files, giving us the base scaffolding for Enterprise Policy as Code:</p>
<table><thead><tr><th>Folder &amp; Files</th><th>Type</th><th>Notes</th></tr></thead><tbody><tr><td>policyAssignments</td><td>Folder</td><td>Contains your Assignments (for both Policy and Initiatives)</td></tr><tr><td>policyDefinitions</td><td>Folder</td><td>Contains your Policy Definitions</td></tr><tr><td>policyDocumentations</td><td>Folder</td><td>Contains documentation about your policies</td></tr><tr><td>policySetDefinitions</td><td>Folder</td><td>Contains the definitions for your initiatives (or PolicySets)</td></tr><tr><td>global-settings.jsonc</td><td>File</td><td>Main configuration file, containing your environments and deployment paths</td></tr></tbody></table>
<ol start="3">
<li>Now that we have our base, scaffold - before we can import our existing Definitions and Assignments, we need to edit the &#x27;global-settings.jsonc&#x27; file, to add in environment context.</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The file is a JSONC file, which is a JSON file with comments, so you can add comments to the file, which is great for documentation. The same jsonc format is also used for PolicyDefinitions and assignments, allowing you to add more context and notes to your policies and assignments! I encourage you to use this functionality to add notes and comments to your assignments!</p></div></div>
<p>So open the global-settings.jsonc file, and paste the following example:</p>
<div class="language-jsonc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsonc codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/Azure/enterprise-azure-policy-as-code/main/Schemas/global-settings-schema.json&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;pacOwnerId&quot;: &quot;f2ce1aea-944e-4517-94fb-edada00633ae&quot;, // Generate a guid using New-Guid and place it here</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;managedIdentityLocations&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;*&quot;: &quot;australiaeast&quot; // Update the default location for managed identities</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;globalNotScopes&quot;: {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;*&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;/resourceGroupPatterns/excluded-rg*&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &quot;pacEnvironments&quot;: [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;pacSelector&quot;: &quot;quick-start&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;cloud&quot;: &quot;AzureCloud&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;tenantId&quot;: &quot;bdb8ea1c-17da-4423-8895-6b79af002b4e&quot;, // Replace this with your tenant Id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &quot;deploymentRootScope&quot;: &quot;/providers/Microsoft.Management/managementGroups/root&quot; // Replace this with a management group that represents the functional root in your environment. </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Create global-settings.jsconc" src="/assets/images/EPAC_Create-global-settings.jsconc-112062cb27d7038ca537f96c06032d52.gif" width="1651" height="912" class="img_ev3q"></p>
<p><strong>Reference: <a href="https://azure.github.io/enterprise-azure-policy-as-code/quick-start/" target="_blank" rel="noopener noreferrer">EPAC Quick Start</a></strong></p>
<p>We now need to define our overall environment, and we can start by using PowerShell to generate our own unique pacOwnerId.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">New-Guid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The pacOwner helps to identify who or what owns an Assignment or Policy definition deployment and needs to be unique to your EPAC environment. The pacOwnerId is used to identity policy resources that are deployed by your EPAC repository, or another EPAC isntance, legacy or another solution entirely.</p>
<p>Another thing you may need to adjust is the managedIdentityLocations, this is the default location for managed identities that are used for policies that are DeployIfNotExist and Modify. This is the location that the managed identity will be created in, if it does not exist. I will keep this as the example, AustraliaEast which is the primary region that my resources are deployed into.</p>
<p>If you run multiple regions, you can remove the wildcard and replace it with the pacEnvironments name that represents your other regions.</p>
<p>Although you can add exclusions to your individual Policy and PolicySetAssignments, the globalNotScopes is a way to exclude resources from all Policy and PolicySetAssignments, without having to add it to every single assignment, in this case, the example excludes all resources that are in a resource group that starts with &#x27;excluded-rg&#x27;. You can exclude resources at different scopes, ie Resource Group, Subscriptions, Resouce Groups.</p>
<p>Now, lets take a look at pacEnvironments. pacEnvironments is a way to define your environments, and the deploymentRootScope is the scope that represents the functional root in your environment. This is the top scope that all your Policy and PolicySetAssignments will be deployed to, and is the scope that you will be deploying your policies definitions to.</p>
<p>The pacSelector will be used in your assignments to select what environment and scope you are deploying to, as you can have multiple environments, so give it a name that you can understand - ie &#x27;epac-prod&#x27;, &#x27;epac-dev&#x27;, &#x27;epac-qa&#x27; etc. This will be reused in your assignments and pipelines.</p>
<p>Make sure the tenantId matches your Entra ID and the deploymentRootScope is the top-level scope that you want to deploy your policies to.</p>
<p>Save the file.</p>
<ol start="4">
<li>The next step is to import your existing policies and assignments, the commands will use the information you just defined in the &#x27;global-settings.jsonc&#x27; file, to review of the scope and the environment of the export.</li>
</ol>
<p>To do that, we will go back to PowerShell:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">Export-AzPolicyResources</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">DefinitionsRootFolder </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">\Definitions </span><span class="token operator">-</span><span class="token plain">OutputFolder Output</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="Export-AzPolicyResources.gif" src="/assets/images/Export-AzPolicyResources-274a0a1cef4a119017c2e35e0303f775.gif" width="1425" height="442" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you want to target a specific environment, ie you have a Management Group, where you want to deploy your policies and test using the Azure Portal first <strong>(this can be useful for quickly importing assignments and policies in a format that&#x27;s ready to go by EPAC)</strong>, then you can add the &#x27;-InputPacSelector&#x27; parameter and target a specific environment for export, else it will do all environments listed in the global-settings.</p></div></div>
<p>Depending on the complexity of your environment, it could take a while, but once it is done, you will have a new folder called &#x27;Output&#x27;, which will contain an export of your policy-ownerships, definitions, assignments and exemptions in an Enterprise Policy as Code useable format <em>(JSON)</em>.</p>
<p>Your Output folder will contain the policy exemptions, assignments, and definitions of your existing environment.</p>
<p>You can copy the files and folders from the Output folder, into the original Definitions folder, originally created, to bring in your existing policies and assignments into your EPAC environment.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Now is a great time to look at those exemptions and policy assignments and see if they are still relevant, and if they are, add comments to the files to give context to the assignments and exemptions and to help with the deployment of the policies and assignments in the future.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-configure-azure-devops">Step 2: Configure Azure DevOps<a href="#step-2-configure-azure-devops" class="hash-link" aria-label="Direct link to Step 2: Configure Azure DevOps" title="Direct link to Step 2: Configure Azure DevOps">​</a></h3>
<p>Now that we have our policies and assignments imported, we can now configure our Azure DevOps environment, to automatically deploy them. I am going to go through the process from the beginning but feel free to skip to the relevant sections if you already have a project and repository setup.</p>
<ol>
<li>Login to Azure DevOps</li>
<li>Create a new project</li>
<li>Give the project a name, and a description, and select the visibility of the project <strong>(ie Private)</strong></li>
<li>Click &#x27;Create&#x27;</li>
<li>Navigate to Repos</li>
<li>Click on Files</li>
<li>Initialize the repository with a README or add a new file</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create EPAC ADO Project" src="/assets/images/Create-ADO_EPACProject-35acaa80d23ed95c3393478b99d48bc6.gif" width="1905" height="964" class="img_ev3q"></p>
<p>Now that the repository has been initialized. We can now add the files from the EPAC StarterKit to the repository.</p>
<p>Clone the repository to your local computer copy the Definitions folder to the repository and commit.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>You can Clone the Git repository using <a href="https://azuredevopslabs.com/labs/azuredevops/git/?T.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Visual Studio Code</a>, or Git CLI or even <a href="https://luke.geek.nz/2021/12/30/git-using-github-desktop-on-windows-for-sysadmins/" target="_blank" rel="noopener noreferrer">GitHub Desktop</a>.</p></div></div>
<p>Once cloned, copy the Definitions folder from the Output folder, into the repository, and commit the changes.</p>
<p>Now that we have our repository setup, we can now create a pipeline to deploy our policies and assignments, to get started we will grab the Azure Pipelines from the <a href="https://github.com/Azure/enterprise-azure-policy-as-code/tree/main/StarterKit/Pipelines" target="_blank" rel="noopener noreferrer">StarterKit</a> folder, and copy them into the repository, along with the Scripts folder.</p>
<p>For this article, we will use the single-tenant-pipeline.yml file, as we are only deploying to a single environment, but if you are deploying to multiple environments, you can use the multi-tenant-pipeline.yml file.</p>
<p><img decoding="async" loading="lazy" alt="Create ADO Pipeline" src="/assets/images/Create_ADO-PipelineTemplate-131d7d4064333057e45023afd10bc612.gif" width="1905" height="964" class="img_ev3q"></p>
<p>Once downloaded, make sure you commit it to your repository. We will have to edit the pipeline, but before we do that - we need a Service Connection for Azure DevOps to connect to Azure to deploy the policies and assignments.</p>
<ol>
<li>Open your EPAC Azure DevOps project</li>
<li>Click on Project Settings</li>
<li>Select Service Connections</li>
<li>Click on Create Service Connection</li>
<li>Click Azure Resource Manager</li>
<li>Click Next</li>
<li>Select Workload Identity Federation (Automatic) and click Next</li>
<li>Select Management Group</li>
<li>Select your top-level management group, that matches your Enterprise Policy as Code environment (ie where the definitions will be deployed to)</li>
<li>Type in a name and description and click Save <strong>(make sure this is a name that is easy to understand, and what its function is, we will reuse the name in our pipelines)</strong></li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create Service Principal" src="/assets/images/Create_ADO-SPN-7c51a1d317687cbfca9f09efa4646cce.gif" width="1905" height="964" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Enterprise Policy as Code (EPAC) suggests the least privileged and just enough permissions to deploy the policies, assignment and RBAC <strong>(Role Based Access Control)</strong> where they need to.</p><p>The pipeline itself will look for the following separate Service Connections:</p><ul>
<li>devServiceConnection - This service connection is used for development purposes, allowing the pipeline to connect to the development environment and deploy policies and assignments.</li>
<li>tenantPlanServiceConnection - This service connection is used for managing the policy plan, which includes creating and updating policy definitions, policy sets, and policy initiatives.</li>
<li>tenantDeployServiceConnection - This service connection is used for deploying policy assignments and exemptions to the target environment.</li>
<li>tenantRolesServiceConnection - This service connection is used for managing RBAC (Role-Based Access Control) roles and permissions in the target environment.</li>
</ul><p>So consider whether you have separate scopes and service principals for your environments.</p></div></div>
<p>For the purposes of this article, I am going to use the same service principal to deploy all the EPAC functions, so let&#x27;s edit the pipeline to use it.</p>
<ol>
<li>You can edit the Pipeline, either locally with Visual Studio Code and recommit it, or edit it directly in Azure DevOps, update the following variables with the relevant service connection names:</li>
</ol>
<ul>
<li>devServiceConnection</li>
<li>tenantPlanServiceConnection</li>
<li>tenantDeployServiceConnection</li>
<li>tenantRolesServiceConnection</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Edit ADO Pipeline" src="/assets/images/Edit_ADO-Pipeline_SPN-59f9f6285d55fdebcd41ddf30877575d.gif" width="1905" height="964" class="img_ev3q"></p>
<p>The single-tenant Azure DevOps pipeline has 5 stages:</p>
<table><thead><tr><th>Stage</th><th>Notes</th></tr></thead><tbody><tr><td>devStage</td><td>This stage is used for planning, deploying, and assigning roles in the development environment. It uses the devServiceConnection to connect to Azure. The stage is only executed if the build reason is &#x27;Manual&#x27;, &#x27;IndividualCI&#x27;, or &#x27;BatchedCI&#x27; and the source branch is not &#x27;main&#x27;.</td></tr><tr><td>tenantPlanFeatureStage</td><td>This stage is used for planning feature branches in the tenant environment. It uses the tenantPlanServiceConnection to connect to Azure. This stage depends on the devStage and is only executed if the devStage has not failed or been canceled, the build reason is &#x27;Manual&#x27;, &#x27;IndividualCI&#x27;, or &#x27;BatchedCI&#x27;, and the source branch is not &#x27;main&#x27;.</td></tr><tr><td>tenantPlanMainStage</td><td>This stage is used for planning the main branch in the tenant environment. It uses the tenantPlanServiceConnection to connect to Azure. This stage depends on the tenantPlanFeatureStage and is only executed if the tenantPlanFeatureStage has not failed or been canceled, the build reason is &#x27;Manual&#x27;, &#x27;IndividualCI&#x27;, or &#x27;BatchedCI&#x27;, and the source branch is &#x27;main&#x27;.</td></tr><tr><td>tenantDeployPolicyStage</td><td>This stage is used for deploying policies in the tenant environment. It uses the tenantDeployServiceConnection to connect to Azure. This stage depends on the tenantPlanMainStage and is only executed if the tenantPlanMainStage has not failed or been canceled, the tenantPlanMainStage has policy changes to deploy, the build reason is &#x27;Manual&#x27;, &#x27;IndividualCI&#x27;, or &#x27;BatchedCI&#x27;, and the source branch is &#x27;main&#x27;.</td></tr><tr><td>tenantRolesStage</td><td>This stage is used for deploying role assignments in the tenant environment. It uses the tenantRolesServiceConnection to connect to Azure. This stage depends on the tenantDeployPolicyStage and is only executed if the tenantDeployPolicyStage has not failed or been canceled, the tenantPlanMainStage has role changes to deploy, the build reason is &#x27;Manual&#x27;, &#x27;IndividualCI&#x27;, or &#x27;BatchedCI&#x27;, and the source branch is &#x27;main&#x27;.</td></tr></tbody></table>
<p>The name &#x27;Tenant&#x27; is used to represent the environment that the policies and assignments are being deployed to. Tenant is the default name of the EPAC environment, so we will need to change this, to reflect our own environments. This is the pacSelector name, in the global-settings.jsonc file, that we created earlier.</p>
<p>I will go back and add a new Service Connection, for Development, and add another development environment to the global-settings.jsonc. You don&#x27;t need to do this, but it does give you the option to test your policies and assignments before deploying them to your main environment.</p>
<p>Now we need to edit the pipeline again, to align to our pacEnvironments.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>You could do a a full Find and Replace, of the Word Tenant on the pipeline and replace it with your Production pacEnvironment name, just be wary that the stage name is used as a depedency for other steps, so you will need to make sure all references have been updated.</p></div></div>
<p>Once you have made the changes, commit the pipeline to your repository.</p>
<p><img decoding="async" loading="lazy" alt="Edit ADO Pipeline - pacEnvironment" src="/assets/images/Edit_ADO-Pipeline_pacEnvironments-07b7d7bbe8d09e9716bb05d15ea2c305.gif" width="1905" height="964" class="img_ev3q"></p>
<p>Before we look at actually running the pipeline and redeploying the policies under Enterprise Policy as Code, we need to be aware of another environment option - and that is desiredState.</p>
<p>desiredState allows you to control, how much control EPAC has over your environment, ie how much of a &#x27;make it so&#x27;.</p>
<p>desiredState options are:</p>
<ul>
<li>full</li>
<li>ownedOnly</li>
</ul>
<p>If the desired state strategy is &#x27;Full&#x27;, then EPAC will manage all the policies and assignments in the environment and will remove any policies and assignments that are not in the EPAC repository.
If the desiredState strategy is &#x27;ownedOnly&#x27;, then EPAC will only manage the policies and assignments that are in the EPAC repository, and will not remove any policies and assignments that are not in the EPAC repository.</p>
<p>Full is the default desiredState, so if you want to use ownedOnly, you will need to add the desiredState to the global-settings.jsonc file for the environment.</p>
<div class="language-jsonc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsonc codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// desiredState is an optional object that specifies the desired state of the environment.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          &quot;desiredState&quot;: { // [optional]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              // strategy specifies the strategy to achieve the desired state. The default is &quot;full&quot;.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              &quot;ownedOnly&quot;: &quot;full&quot; // default full</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Another environment option is related to Defender for Cloud. <a href="https://learn.microsoft.com/azure/defender-for-cloud/policy-reference?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Defender for Cloud</a> uses Azure Policy Assignments to enable and configure the various capabilities.
Enterprise Policy as Code could remove the Defender for Cloud assignments if they are not in the EPAC repository, so you can add the following to the global-settings.jsonc file to prevent this from happening.</p>
<div class="language-jsonc codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsonc codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> &quot;desiredState&quot;: { // [optional]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              // strategy specifies the strategy to achieve the desired state. The default is &quot;full&quot;.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              &quot;strategy&quot;: &quot;full&quot; ,// default full</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              &quot;keepDfcSecurityAssignments&quot;: true // default false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If set to true or strategy is ownedOnly, EPAC will not remove Security Policy assignments created by Defender for Cloud.
If omitted or set to false and strategy is full, EPAC will remove Security Policy Set Assignments created by Defender for Cloud.</p>
<p>Even though these settings are managed by the default behaviour of Enterprise Policy as Code, I prefer to make sure they are added in the configuration for awareness. Security Policies should be managed by EPAC at the Management Group level; this is the recommended approach for managing Security Policies instead of relying on the auto-assignments, but as usual, it comes down to business requirements.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-run-the-pipeline">Step 3: Run the Pipeline<a href="#step-3-run-the-pipeline" class="hash-link" aria-label="Direct link to Step 3: Run the Pipeline" title="Direct link to Step 3: Run the Pipeline">​</a></h3>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>Make sure you test your deployment in a development environment before deploying to your main environment, especially if you are using the &#x27;full&#x27; desiredState strategy.</p></div></div>
<p>Now it&#x27;s time to import the pipeline.</p>
<ol>
<li>Login to Azure DevOps</li>
<li>Navigate to your EPAC project</li>
<li>Navigate to Pipelines</li>
<li>Click on Create Pipeline</li>
<li>Click on Azure Repos Git</li>
<li>Select your repository</li>
<li>Select Existing Azure pipelines YAML file</li>
<li>Under path, select single-tenant-pipeline.yml</li>
<li>Click Save</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Import ADO Pipeline" src="/assets/images/Import_ADO-Pipeline-c0c611311aca5b5fff308746e277797d.gif" width="1905" height="964" class="img_ev3q"></p>
<p>Now that it&#x27;s imported, we can run the pipeline. The first pipeline deployment is aimed at making the state of Azure match the EPAC environment and also giving access to the pipelines to the Service Connections.</p>
<p><img decoding="async" loading="lazy" alt="Run ADO Pipeline" src="/assets/images/Run_ADO-Pipeline-72afa5d25f14d97a32c20e47e2a72943.gif" width="1905" height="964" class="img_ev3q"></p>
<p>If this is the first time the pipeline has been run, there may be delays, as you need to approve the pipeline to be able to use the Service Connections.</p>
<p>Congratulations! You have deployed your Azure Policy as Code!</p>
<p>If you login to the Azure Portal and navigate to your <a href="https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Assignments" target="_blank" rel="noopener noreferrer">Policies and assignments</a>, they should match.</p>
<p><img decoding="async" loading="lazy" alt="Azure Policy Assignments" src="/assets/images/AzurePortal_PolicyAssignments-d9665ddff7687b4d9ee52c07d99066ca.png" width="1860" height="630" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="policy-configuration">Policy configuration<a href="#policy-configuration" class="hash-link" aria-label="Direct link to Policy configuration" title="Direct link to Policy configuration">​</a></h2>
<p>Now that the policies and assignments are deployed, you can start to configure your policies and assignments to match your environment.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="change-assignment-scope">Change assignment scope<a href="#change-assignment-scope" class="hash-link" aria-label="Direct link to Change assignment scope" title="Direct link to Change assignment scope">​</a></h3>
<p>In my scenario, my Sandbox policies are assigned to my Lukegeeknz Management Group, and I want them to be assigned to my Sandbox Management Group, so I will need to update the policy assignments to reflect this.</p>
<p>I will test this by deploying it into a New Branch, which will trigger the dev Plan.</p>
<p><img decoding="async" loading="lazy" alt="Change assignment scope" src="/assets/images/Change_EPAC-AssignmentScopeSandbox-b20af13b32d9f00de96df5bbc45c6289.gif" width="1905" height="964" class="img_ev3q"></p>
<p>And we can see in the plan that the assignment will change successfully.</p>
<p><img decoding="async" loading="lazy" alt="Azure DevOps epac-dev plan" src="/assets/images/Run_ADO-Pipeline_Dev_Plan-592f4f43bc055370866dba7cec16af03.png" width="1110" height="747" class="img_ev3q"></p>
<p>Now, let&#x27;s merge or change into Production by opening up a Pull Request; once approved and merged, the Sandbox assignment will be updated in Production.</p>
<p><img decoding="async" loading="lazy" alt="EPAC Pull Request" src="/assets/images/Change_EPAC-AssignmentScopeSandboxPR-603ce031e8264642485384496e822f89.gif" width="1905" height="964" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Azure Policy Assignment" src="/assets/images/AzurePortal_PolicyAssignments.pngAfterChange-07735dd82cf91181554af7de91fca2c3.png" width="1630" height="634" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2>
<p>You can view my EPAC code for reference directly on GitHub: <a href="https://github.com/lukemurraynz/EPAC_ADO" target="_blank" rel="noopener noreferrer">lukemurraynz/EPAC_ADO</a>.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/azure/tag-azure-resources-owner-azure-automation-runbook/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Tag Azure Resources with Owner using Azure Automation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/accessing-keyvault-azure-devops/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Accessing KeyVault from Azure DevOps</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-enterprise-azure-policy-as-code" class="table-of-contents__link toc-highlight">What is Enterprise Azure Policy as Code?</a></li><li><a href="#why-would-you-use-enterprise-azure-policy-as-code" class="table-of-contents__link toc-highlight">Why would you use Enterprise Azure Policy as Code?</a></li><li><a href="#how-do-you-use-enterprise-azure-policy-as-code" class="table-of-contents__link toc-highlight">How do you use Enterprise Azure Policy as Code?</a><ul><li><a href="#step-1-import-existing-policies" class="table-of-contents__link toc-highlight">Step 1: Import existing policies</a></li><li><a href="#step-2-configure-azure-devops" class="table-of-contents__link toc-highlight">Step 2: Configure Azure DevOps</a></li><li><a href="#step-3-run-the-pipeline" class="table-of-contents__link toc-highlight">Step 3: Run the Pipeline</a></li></ul></li><li><a href="#policy-configuration" class="table-of-contents__link toc-highlight">Policy configuration</a><ul><li><a href="#change-assignment-scope" class="table-of-contents__link toc-highlight">Change assignment scope</a></li></ul></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
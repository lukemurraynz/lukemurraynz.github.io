<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Expose Akahu APIs via Azure API Management MCP Server | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="author" content="Luke Murray"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/azure/akahu-mcp-apim"><meta data-rh="true" name="twitter:title" content="Expose Akahu APIs via Azure API Management MCP Server"><meta data-rh="true" name="twitter:description" content="Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code."><meta data-rh="true" property="og:title" content="Expose Akahu APIs via Azure API Management MCP Server | luke.geek.nz"><meta data-rh="true" name="description" content="Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code."><meta data-rh="true" property="og:description" content="Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code."><meta data-rh="true" name="keywords" content="Azure API Management,MCP Server,Akahu,Open Banking New Zealand,API Security"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-08-10T07:59:51.617Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="Azure"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/akahu-mcp-apim/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/azure/akahu-mcp-apim/" hreflang="x-default"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/azure/akahu-mcp-apim"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Expose Akahu APIs via Azure API Management MCP Server","description":"Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code.","url":"https://luke.geek.nz/azure/akahu-mcp-apim","datePublished":"2025-08-10T07:59:51.617Z","dateModified":"2025-08-10T07:59:51.617Z","author":{"@type":"Person","name":"Luke Murray","url":"https://luke.geek.nz/about"},"publisher":{"@type":"Organization","name":"luke.geek.nz","logo":{"@type":"ImageObject","url":"https://luke.geek.nz/img/logo.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://luke.geek.nz/azure/akahu-mcp-apim"},"keywords":"Azure API Management, MCP Server, Akahu, Open Banking New Zealand, API Security, Azure, Azure, Microsoft, Cloud Computing, Technical Blog","articleSection":"Technology","inLanguage":"en-US"}</script><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://luke.geek.nz/azure/akahu-mcp-apim","mainEntityOfPage":"https://luke.geek.nz/azure/akahu-mcp-apim","url":"https://luke.geek.nz/azure/akahu-mcp-apim","headline":"Expose Akahu APIs via Azure API Management MCP Server","name":"Expose Akahu APIs via Azure API Management MCP Server","description":"Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code.","datePublished":"2025-08-10T07:59:51.617Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":["Azure API Management","MCP Server","Akahu","Open Banking New Zealand","API Security"],"isPartOf":{"@type":"Blog","@id":"https://luke.geek.nz/","name":"Luke's Tech Blog - Unleashing the power of the cloud and other technologies!"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script>






<meta property="og:type" content="website">
<meta property="og:site_name" content="luke.geek.nz">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@lukemurraynz">
<meta name="twitter:creator" content="@lukemurraynz">
<meta name="author" content="Luke Murray">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","name":"luke.geek.nz","description":"Microsoft MVP - Microsoft Azure ‚òÅ, Technical Consultant, Azure Solutions Architect Expert, Technologist and a drinker of coffee.","url":"https://luke.geek.nz","author":{"@type":"Person","name":"Luke Murray","url":"https://luke.geek.nz/about","sameAs":["https://twitter.com/lukemurraynz","https://www.linkedin.com/in/ljmurray/","https://aus.social/@lukemurray","https://bsky.app/profile/lukemurraynz.bsky.social"]},"publisher":{"@type":"Person","name":"Luke Murray"},"potentialAction":{"@type":"SearchAction","target":"https://luke.geek.nz/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script><link rel="stylesheet" href="/assets/css/styles.dd27eb3d.css">
<script src="/assets/js/runtime~main.bc290ca1.js" defer="defer"></script>
<script src="/assets/js/main.bfbdb645.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/tags/">Tags</a><a class="navbar__item navbar__link" href="/archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/learn-mcp-server-semantic-kernel/">Integrating Microsoft Learn MCP Server with Semantic Kernel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/umispn/">User-Assigned Managed Identity vs Service Principal (WIF)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/communication-services-mcp-email-server/">MCP Server with Azure Functions &amp; Communication Services</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/function-app-host-runtime/">Azure Function App Host Runtime Error</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/sire/">Secure Isolated Recovery Environment in Azure</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Expose Akahu APIs via Azure API Management MCP Server</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-08-10T07:59:51.617Z">August 10, 2025</time> ¬∑ <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>A recent release to Azure API Management is - MCP server support, the ability to expose a <a href="https://learn.microsoft.com/en-us/azure/api-management/export-rest-mcp-server?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">REST API in API Management as an MCP server</a>.</p>
<!-- -->
<p>Today we are going to look at how to expose an REST API as an MCP server through your API Management instance, with <a href="https://www.akahu.nz/" target="_blank" rel="noopener noreferrer">Akahu</a> APIs as my example.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-overview">üöÄ Overview<a href="#-overview" class="hash-link" aria-label="Direct link to üöÄ Overview" title="Direct link to üöÄ Overview">‚Äã</a></h2>
<p>This guide walks through publishing Akahu‚Äôs open banking-style REST endpoints through Azure API Management (APIM) and exposing them as an MCP server consumable by compatible developer tools (e.g., VS Code extensions). You‚Äôll configure headers via policies, secure tokens with named values, and register the MCP server locally.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-prerequisites">üß∞ Prerequisites<a href="#-prerequisites" class="hash-link" aria-label="Direct link to üß∞ Prerequisites" title="Direct link to üß∞ Prerequisites">‚Äã</a></h2>
<p>Before starting, ensure you have:</p>
<table><thead><tr><th>Item</th><th>Requirement</th></tr></thead><tbody><tr><td>Azure Subscription</td><td>Contributor (or equivalent) rights to create API Management</td></tr><tr><td>Azure API Management</td><td>Standard tier (Preview features enabled for MCP)</td></tr><tr><td>Akahu Account</td><td>Developer portal access + Demo or real bank connection</td></tr><tr><td>Akahu Credentials</td><td>App Token, User Token, Base URL</td></tr><tr><td>VS Code</td><td>Latest version + MCP-capable extension (e.g., GitHub Copilot supporting MCP)</td></tr><tr><td>Network Access</td><td>Outbound HTTPS to api.akahu.io and your APIM gateway</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-quick-steps">üó∫Ô∏è Quick Steps<a href="#Ô∏è-quick-steps" class="hash-link" aria-label="Direct link to üó∫Ô∏è Quick Steps" title="Direct link to üó∫Ô∏è Quick Steps">‚Äã</a></h2>
<table><thead><tr><th>Step</th><th>Action</th><th>Outcome</th></tr></thead><tbody><tr><td>1</td><td>Create Akahu demo connection</td><td>Obtain App &amp; User tokens</td></tr><tr><td>2</td><td>Provision APIM instance</td><td>API gateway ready</td></tr><tr><td>3</td><td>Add HTTP API (Akahu)</td><td>Base operations onboarded</td></tr><tr><td>4</td><td>Define operations (accounts, me)</td><td>REST surface defined</td></tr><tr><td>5</td><td>Test with raw headers</td><td>Validate connectivity</td></tr><tr><td>6</td><td>Create Named Values</td><td>Centralize secrets</td></tr><tr><td>7</td><td>Add inbound policy for headers</td><td>Automate header injection</td></tr><tr><td>8</td><td>Enable MCP Servers (Preview)</td><td>Feature available in portal</td></tr><tr><td>9</td><td>Expose API as MCP server</td><td>Tools generated for operations</td></tr><tr><td>10</td><td>Add MCP-specific policy</td><td>Headers applied to MCP calls</td></tr><tr><td>11</td><td>Configure local mcp.json</td><td>Client can reach MCP endpoint</td></tr><tr><td>12</td><td>Invoke tools in editor</td><td>Accounts/me data accessible</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-why-akahu--mcp">üîé Why Akahu + MCP?<a href="#-why-akahu--mcp" class="hash-link" aria-label="Direct link to üîé Why Akahu + MCP?" title="Direct link to üîé Why Akahu + MCP?">‚Äã</a></h2>
<p>I&#x27;ve been reading up a lot on <a href="https://www.consumer.org.nz/articles/what-is-open-banking" target="_blank" rel="noopener noreferrer">open banking</a>, which is a system that enables financial apps and technologies to connect securely and directly with customers‚Äô bank accounts with the customer‚Äôs consent, and seems to be ahead in Australian banking, but New Zealand banking is catching up, and with an API driven intermediary such as <a href="https://www.akahu.nz/" target="_blank" rel="noopener noreferrer">Akahu</a>, allows me to connect to my bank accounts across various banks, and aggregate my financial data in one place.</p>
<p>So naturally, I wondered how I could expose the Akahu APIs and make them available through an MCP server in Azure API Management.</p>
<p><img decoding="async" loading="lazy" alt="Akahu list accounts" src="/assets/images/Akahu_MCP_ListAccountsOverview-4942662c7be5f1816c1f9e80472aad9b.jpg" width="964" height="634" class="img_ev3q">
<em>Figure: Accounts view returned through the Akahu API (demo data).</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-get-akahu-credentials">üîê Get Akahu Credentials<a href="#-get-akahu-credentials" class="hash-link" aria-label="Direct link to üîê Get Akahu Credentials" title="Direct link to üîê Get Akahu Credentials">‚Äã</a></h2>
<p>To get started, we will need credentials from Akahu to connect.</p>
<ol>
<li>Navigate to the <a href="https://www.akahu.nz/" target="_blank" rel="noopener noreferrer">Akahu</a>.</li>
<li>Log in and create an account if you don&#x27;t have one.</li>
<li>Once logged in, navigate to the <a href="https://developer.akahu.nz/" target="_blank" rel="noopener noreferrer">Akahu Developer Portal</a>.</li>
<li>Go to Developers and create a new connection, for the purposes of this tutorial, I will be creating a Connection to the Demo bank, but you can have more than one connection to multiple New Zealand-based banks, ANZ, Westpac, including Sharesies and the Inland Revenue Department.</li>
</ol>
<p><img decoding="async" loading="lazy" alt="Create API" src="/assets/images/Akahu_CreateAPIConnection-c2d6a36a1fbc68dde24109fc97eb9682.gif" width="466" height="938" class="img_ev3q">
<em>Figure: Creating a demo bank connection in the Akahu developer portal.</em></p>
<ol start="5">
<li>Once the connection has been stood up, make note of the  base URL, App Token, and the User Token as we will need these later.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-create-azure-api-management-instance">üèóÔ∏è Create Azure API Management Instance<a href="#Ô∏è-create-azure-api-management-instance" class="hash-link" aria-label="Direct link to üèóÔ∏è Create Azure API Management Instance" title="Direct link to üèóÔ∏è Create Azure API Management Instance">‚Äã</a></h2>
<p>Once we have these details, it&#x27;s time for API Management, so create an <a href="https://learn.microsoft.com/azure/api-management/api-management-key-concepts?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure API Management</a> instance, in my demo I am using a Standard Tier API Management instance in the New Zealand North Azure region.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-add-the-akahu-http-api">üåê Add the Akahu HTTP API<a href="#-add-the-akahu-http-api" class="hash-link" aria-label="Direct link to üåê Add the Akahu HTTP API" title="Direct link to üåê Add the Akahu HTTP API">‚Äã</a></h2>
<p>Now we need to add the Akahu APIs into Azure API Management, so add in an HTTP API:</p>
<p>Display name: akahu.nz <em>(this could be what you want it to be)</em>
URL: <a href="https://api.akahu.io/v1/" target="_blank" rel="noopener noreferrer">https://api.akahu.io/v1/</a>
Suffix: mcp  <em>(this could be what you want it to be)</em></p>
<p><img decoding="async" loading="lazy" alt="Akahu add API" src="/assets/images/Akahu_APIM_AddAPI-711dc1b085b3afc83987fc643c325dbb.jpg" width="1416" height="972" class="img_ev3q">
<em>Figure: Adding the Akahu HTTP API in Azure API Management.</em></p>
<p>Then you can add your Operations, because I am using the Akahu Demo bank, I will be adding the following operations:</p>
<ul>
<li>accounts</li>
<li>me</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Akahu Add Accounts" src="/assets/images/Akahu_APIM_AddAPI_Accounts-7b06d320b752b117bf78711d282add62.jpg" width="1285" height="408" class="img_ev3q">
<em>Figure: Defining the accounts operation.</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-document-operations">üßæ Document Operations<a href="#-document-operations" class="hash-link" aria-label="Direct link to üßæ Document Operations" title="Direct link to üßæ Document Operations">‚Äã</a></h2>
<p>Make sure you fill out a description, as this will be parsed through as the description of the MCP Tool.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-test-the-api-manual">üß™ Test the API (Manual)<a href="#-test-the-api-manual" class="hash-link" aria-label="Direct link to üß™ Test the API (Manual)" title="Direct link to üß™ Test the API (Manual)">‚Äã</a></h2>
<p>Make sure you test the API using the Test functionality directly in API Management, you should get a response back with your accounts, and the details of the account, you will need to specify the X-Akahu-Id and Authorization headers.</p>
<p>The X-Akahu-Id is your app_token
The Authorization is your user token.</p>
<p>Make sure you add Bearer to the front of your user token, so it looks like this: <code>Bearer &lt;user_token&gt;</code></p>
<p><img decoding="async" loading="lazy" alt="Test Akahu" src="/assets/images/Test_APIM_AddAPI_Accounts-48040ed5f630276aa6208d7ad83a49c9.jpg" width="1637" height="1124" class="img_ev3q">
<em>Figure: Testing the accounts operation with required headers.</em></p>
<p>Now that we have tested that the API is working and we can call the Accounts through the rest API via API Management, the next thing we need to do is add the authorization and user tokens as Named Values, so they can be referenced in the MCP calls.</p>
<p>In Azure API Management, select Named values, and add in 2 new values:</p>
<ul>
<li>Authorization, which will have the value of the user token.</li>
<li>X-Akahu-Id, which will have the value of the app token.</li>
</ul>
<p><em>(In a scenario for Production, ideally these values will be stored and referenced in an Azure Key Vault, but for the purposes of this demo, we will be storing them in Named Values.)</em></p>
<p><img decoding="async" loading="lazy" alt="API Named Values" src="/assets/images/Test_APIM_AddAPI_NamedValues-d62c49d64312cc2ccc0d3a3968132e26.jpg" width="1235" height="752" class="img_ev3q">
<em>Figure: Named values configured for secure header injection.</em></p>
<p>You could add these values as input into the Header for the MCP Server calls, but in my case, I am using them directly in API Management.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-add-inbound-headers-via-policy">üõ†Ô∏è Add Inbound Headers via Policy<a href="#Ô∏è-add-inbound-headers-via-policy" class="hash-link" aria-label="Direct link to üõ†Ô∏è Add Inbound Headers via Policy" title="Direct link to üõ†Ô∏è Add Inbound Headers via Policy">‚Äã</a></h2>
<p>Now that we have added the values, we need to create a new API Management policy so that it will pick up the named values and add them to the header of any future requests.</p>
<p>In API Management, navigate back to your API and select All operations, and select Edit on the Base policy.</p>
<p>Add in the following to the Inbound portion of the policy:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">inbound</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">set-header</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">X-Akahu-Id</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">exists-action</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">override</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">value</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">{{X-Akahu-Id}}</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">value</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">set-header</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">set-header</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">Authorization</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">exists-action</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">override</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">value</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Bearer {{Authorization}}</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">value</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">set-header</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">inbound</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="Add header values" src="/assets/images/Test_APIM_AddAPI_AddHeaderValues-9ea5ba9de5a350263ab048d82fbc0ad9.jpg" width="1730" height="801" class="img_ev3q">
<em>Figure: Policy editor showing inbound header injection.</em></p>
<p>This will ensure that the headers are added to the request when it is made to the Akahu API.</p>
<p>Now you can retest, without needing to add in the Id and Authorization headers, and you should get the same response back as before - 200.</p>
<p><img decoding="async" loading="lazy" alt="API Named Values policy test" src="/assets/images/Test_APIM_AddAPI_NamedValuesPolicyTest-251af413207236a930a0520d7ef2fef2.jpg" width="1298" height="950" class="img_ev3q">
<em>Figure: Successful 200 response after policy application.</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-enable-mcp-server-support-preview">‚öôÔ∏è Enable MCP Server Support (Preview)<a href="#Ô∏è-enable-mcp-server-support-preview" class="hash-link" aria-label="Direct link to ‚öôÔ∏è Enable MCP Server Support (Preview)" title="Direct link to ‚öôÔ∏è Enable MCP Server Support (Preview)">‚Äã</a></h2>
<p>Next up is enabling the MCP server support, so navigate to the API Management instance, and MCP Servers (Preview).</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If you do not see the &quot;MCP Servers (Preview)&quot; option, your Azure API Management instance may be running an older version that does not yet support MCP server features.</p><p><strong>How to enable AI Gateway capabilities:</strong></p><ol>
<li>In the Azure portal, navigate to your API Management instance.</li>
<li>Go to <strong>Service Updates (preview)</strong> in the left-hand menu.</li>
<li>Select <strong>Update Group</strong>.</li>
<li>Choose <strong>AI Gateway Early</strong> to opt into the early update group that enables MCP server support.</li>
</ol><p><img decoding="async" loading="lazy" alt="AI Gateway" src="/assets/images/APIM_AIGateway-b70fa27aec16504d363f2c5684c3344d.jpg" width="1984" height="717" class="img_ev3q">
<em>Figure: Enabling AI Gateway early update group.</em></p><blockquote>
<p><strong>Note:</strong> The AI Gateway Early update group is typically available for API Management instances running on the Consumption or Developer tier, and may not be available for all regions or SKUs. If you are unsure, check the <a href="https://learn.microsoft.com/en-us/azure/api-management/API-management-features?WT.mc_id=AZ-MVP-5004796" target="_blank" rel="noopener noreferrer">Azure API Management release notes</a> for the latest supported features and version information.</p>
</blockquote><p>Also, be aware of the maintenance window; you may need to wait for the maintenance window for the update to take effect. Even though MCP Servers may display and allow you to add, you may encounter errors until the update is fully rolled out. If you experience issues, try again after your maintenance window has passed.</p></div></div>
<p>Now click Create MCP server, and select Expose an API as an MCP server, and select the API you created earlier, and give it a name, I will call it akahu-nz-mcp, select the API operations that you want to expose into the MCP Server, these will become the Tools that can be called from from a MCP client.</p>
<p><img decoding="async" loading="lazy" alt="Create MCP Server" src="/assets/images/Akahu_AddAkahuMCP-37db1fb07800fa22beeba5c5adc38a8c.gif" width="1991" height="938" class="img_ev3q">
<em>Figure: Wizard to expose API as an MCP server.</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-add-mcp-endpoint-policy">üß© Add MCP Endpoint Policy<a href="#-add-mcp-endpoint-policy" class="hash-link" aria-label="Direct link to üß© Add MCP Endpoint Policy" title="Direct link to üß© Add MCP Endpoint Policy">‚Äã</a></h2>
<p>Now navigate to Policies, as you can see, you can have separate policies for MCP endpoints than the API endpoints, so add in the headers again.</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    - Policies are applied in the order they appear.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    - Position &lt;base/&gt; inside a section to inherit policies from the outer scope.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">    - Comments within policies are not preserved.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!-- Add policies as children to the &lt;inbound&gt;, &lt;outbound&gt;, &lt;backend&gt;, and &lt;on-error&gt; elements --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">policies</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!-- Throttle, authorize, validate, cache, or transform the requests --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">inbound</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">base</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">set-header</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">X-Akahu-Id</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">exists-action</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">override</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">value</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">{{X-Akahu-Id}}</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">value</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">set-header</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">set-header</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">Authorization</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">exists-action</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">override</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">			</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">value</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain">Bearer {{Authorization}}</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">value</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">set-header</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">inbound</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!-- Control if and how the requests are forwarded to services  --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">backend</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">base</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">backend</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!-- Customize the responses --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">outbound</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">base</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">outbound</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!-- Handle exceptions and customize error responses  --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">on-error</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">base</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">on-error</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">policies</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre></div></div>
<p>Once that has been completed and save, the endpoint should be available for use.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-configure-local-mcp-client">üñ•Ô∏è Configure Local MCP Client<a href="#Ô∏è-configure-local-mcp-client" class="hash-link" aria-label="Direct link to üñ•Ô∏è Configure Local MCP Client" title="Direct link to üñ•Ô∏è Configure Local MCP Client">‚Äã</a></h2>
<p>So let us test, to do this we will use Visual Studio Code, so launch GitHub Copilot chat, and select Add MCP Server to open the mcp.json file, and add the following MCP server configuration:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;servers&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;akahu&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;http&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;url&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://&lt;your-apim-instance-name&gt;.azure-api.net/akahu-nz-mcp/mcp&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;headers&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;Ocp-Apim-Subscription-Key&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&lt;your-subscription-key&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">30000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;inputs&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>Although we no longer need to add the X-Akahu-Id and Authorization headers, we still need to add the Ocp-Apim-Subscription-Key header, which is the subscription key for your API Management instance, so obtain this from the Azure Portal, navigate to your API Management instance, and select Subscription keys, and copy a key that has access to the API.</p>
<p><img decoding="async" loading="lazy" alt="Akahu MCP mcp.json" src="/assets/images/Akahu_MCP_mcpjson-c95cd368e1e630f0313b9306f2416314.jpg" width="772" height="333" class="img_ev3q">
<em>Figure: Example mcp.json configuration with subscription key.</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-run-and-verify">‚ñ∂Ô∏è Run and Verify<a href="#Ô∏è-run-and-verify" class="hash-link" aria-label="Direct link to ‚ñ∂Ô∏è Run and Verify" title="Direct link to ‚ñ∂Ô∏è Run and Verify">‚Äã</a></h2>
<p>Finally, run the MCP server, and you should be able to see the Akahu accounts exposed as tools you can invoke, allowing you to call the Akahu APIs through the MCP interface.</p>
<p><img decoding="async" loading="lazy" alt="MCP Server Running" src="/assets/images/Akahu_TestAkahuMCP-0c3a8dc5a5919f3de12046b5cd0ef14d.gif" width="846" height="716" class="img_ev3q">
<em>Figure: MCP client showing available Akahu tools.</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-security--governance-considerations">üîí Security &amp; Governance Considerations<a href="#-security--governance-considerations" class="hash-link" aria-label="Direct link to üîí Security &amp; Governance Considerations" title="Direct link to üîí Security &amp; Governance Considerations">‚Äã</a></h2>
<ul>
<li>Prefer Azure Key Vault integration with APIM Named Values (secret type) instead of storing tokens directly.</li>
<li>Rotate Akahu tokens periodically; update Named Values without redeploying APIs.</li>
<li>Apply rate limiting (e.g., <code>&lt;rate-limit-by-key&gt;</code>) to protect upstream Akahu services.</li>
<li>Use separate APIM Products and subscription keys per environment (dev/test/prod) to isolate usage.</li>
<li>Log requests (omit sensitive headers) via Application Insights for auditing.</li>
<li>Avoid over-broad scopes when future Akahu endpoints require granular permissions.</li>
<li>For production, add validation policies (JSON schema, response caching as appropriate) and observability (tracing, metrics).</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-troubleshooting">üßØ Troubleshooting<a href="#-troubleshooting" class="hash-link" aria-label="Direct link to üßØ Troubleshooting" title="Direct link to üßØ Troubleshooting">‚Äã</a></h2>
<table><thead><tr><th>Symptom</th><th>Cause</th><th>Fix</th></tr></thead><tbody><tr><td>401 from Akahu</td><td>Missing or malformed Authorization header</td><td>Confirm policy injected <code>Bearer &lt;token&gt;</code> and token not expired</td></tr><tr><td>401 after adding policy</td><td>Policy saved at operation not API scope</td><td>Ensure change applied at All operations level or MCP policy layer</td></tr><tr><td>MCP Servers option missing</td><td>Preview feature not enabled</td><td>Enable AI Gateway Early group and wait for maintenance window</td></tr><tr><td>Tool not appearing in client</td><td>Operation not selected when creating MCP server</td><td>Edit MCP server and add operation</td></tr><tr><td>429 responses</td><td>Exceeded rate limits (Akahu or APIM)</td><td>Add/adjust rate-limit / retry-after policies</td></tr><tr><td>Unexpected empty results</td><td>Demo bank seeded data differences</td><td>Confirm with direct Akahu call outside APIM</td></tr><tr><td>Subscription key rejected</td><td>Wrong product or key rotated</td><td>Re-copy active key from APIM Subscriptions blade</td></tr></tbody></table>
<p>Hopefully this walkthrough shows the Akahu MCP setup in action and how you can route Akahu API calls via Azure API Management. Combining your financial data (with appropriate consent) and an LLM can assist with generating summaries or draft insights (e.g., spending categories, high-level comparisons across accounts) without manually crafting each REST call. Always validate model outputs against authoritative data before making financial decisions, and avoid exposing sensitive information beyond what is required for the task.</p>
<blockquote>
<p>Note: Large Language Models can produce inaccuracies or outdated interpretations. Treat generated insights as assistive, not authoritative, and apply appropriate governance and compliance controls for any production scenario.</p>
</blockquote></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/azure/">Azure</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/azure/sire/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Secure Isolated Recovery Environment in Azure</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/azure/container-apps-vnc-dosbox/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Azure Container Apps with VNC and DOSBox</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#-overview" class="table-of-contents__link toc-highlight">üöÄ Overview</a></li><li><a href="#-prerequisites" class="table-of-contents__link toc-highlight">üß∞ Prerequisites</a></li><li><a href="#Ô∏è-quick-steps" class="table-of-contents__link toc-highlight">üó∫Ô∏è Quick Steps</a></li><li><a href="#-why-akahu--mcp" class="table-of-contents__link toc-highlight">üîé Why Akahu + MCP?</a></li><li><a href="#-get-akahu-credentials" class="table-of-contents__link toc-highlight">üîê Get Akahu Credentials</a></li><li><a href="#Ô∏è-create-azure-api-management-instance" class="table-of-contents__link toc-highlight">üèóÔ∏è Create Azure API Management Instance</a></li><li><a href="#-add-the-akahu-http-api" class="table-of-contents__link toc-highlight">üåê Add the Akahu HTTP API</a></li><li><a href="#-document-operations" class="table-of-contents__link toc-highlight">üßæ Document Operations</a></li><li><a href="#-test-the-api-manual" class="table-of-contents__link toc-highlight">üß™ Test the API (Manual)</a></li><li><a href="#Ô∏è-add-inbound-headers-via-policy" class="table-of-contents__link toc-highlight">üõ†Ô∏è Add Inbound Headers via Policy</a></li><li><a href="#Ô∏è-enable-mcp-server-support-preview" class="table-of-contents__link toc-highlight">‚öôÔ∏è Enable MCP Server Support (Preview)</a></li><li><a href="#-add-mcp-endpoint-policy" class="table-of-contents__link toc-highlight">üß© Add MCP Endpoint Policy</a></li><li><a href="#Ô∏è-configure-local-mcp-client" class="table-of-contents__link toc-highlight">üñ•Ô∏è Configure Local MCP Client</a></li><li><a href="#Ô∏è-run-and-verify" class="table-of-contents__link toc-highlight">‚ñ∂Ô∏è Run and Verify</a></li><li><a href="#-security--governance-considerations" class="table-of-contents__link toc-highlight">üîí Security &amp; Governance Considerations</a></li><li><a href="#-troubleshooting" class="table-of-contents__link toc-highlight">üßØ Troubleshooting</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
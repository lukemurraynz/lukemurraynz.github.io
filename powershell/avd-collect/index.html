<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">AVD-Collect - Azure Virtual Desktop Diagnostics and Logging | luke.geek.nz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://luke.geek.nz/img/social-card.png"><meta data-rh="true" property="og:url" content="https://luke.geek.nz/powershell/avd-collect/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="AVD-Collect - Azure Virtual Desktop Diagnostics and Logging | luke.geek.nz"><meta data-rh="true" name="description" content="AVD-Collect is a handy PowerShell script created by Microsoft Customer Support Services to assist with troubleshooting and resolving issues with Azure Virtual Desktop (and Windows 365), by capturing Logs for analysis (which could then be passed to Microsoft or allow you to delve deeper) and running basic Diagnostics against some common known issues."><meta data-rh="true" property="og:description" content="AVD-Collect is a handy PowerShell script created by Microsoft Customer Support Services to assist with troubleshooting and resolving issues with Azure Virtual Desktop (and Windows 365), by capturing Logs for analysis (which could then be passed to Microsoft or allow you to delve deeper) and running basic Diagnostics against some common known issues."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-08-08T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://luke.geek.nz"><meta data-rh="true" property="article:tag" content="PowerShell"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://luke.geek.nz/powershell/avd-collect/"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/powershell/avd-collect/" hreflang="en"><link data-rh="true" rel="alternate" href="https://luke.geek.nz/powershell/avd-collect/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://ZBH2T1WJQD-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://luke.geek.nz/powershell/avd-collect","mainEntityOfPage":"https://luke.geek.nz/powershell/avd-collect","url":"https://luke.geek.nz/powershell/avd-collect","headline":"AVD-Collect - Azure Virtual Desktop Diagnostics and Logging","name":"AVD-Collect - Azure Virtual Desktop Diagnostics and Logging","description":"AVD-Collect is a handy PowerShell script created by Microsoft Customer Support Services to assist with troubleshooting and resolving issues with Azure Virtual Desktop (and Windows 365), by capturing Logs for analysis (which could then be passed to Microsoft or allow you to delve deeper) and running basic Diagnostics against some common known issues.","datePublished":"2021-08-08T00:00:00.000Z","author":{"@type":"Person","name":"Luke Murray","description":"Author","url":"https://luke.geek.nz","image":"https://luke.geek.nz/img/logo.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://luke.geek.nz/","name":"Lukes Tech Blog - Unleashing the power of the cloud and other technologies!"}}</script><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="luke.geek.nz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="luke.geek.nz Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="luke.geek.nz JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0QDLBY7NNN"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0QDLBY7NNN",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.dd27eb3d.css">
<script src="/assets/js/runtime~main.d574728b.js" defer="defer"></script>
<script src="/assets/js/main.fe97b4e9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#D3D3D3" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you haven't already, sign up for my Weekly Azure updates Newsletter, straight to your inbox! <a target="_blank" rel="noopener noreferrer" href="https://newsletter.azurefeeds.com/join">Subscribe now!</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="luke.geek.nz" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">luke.geek.nz</b></a><a class="navbar__item navbar__link" href="/Tags/">Tags</a><a class="navbar__item navbar__link" href="/Archive/">Blog</a><a class="navbar__item navbar__link" href="/about/">About</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCUG3TKDTAZz4UXshGrjBBoQ" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="YouTube">
              <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M23.498,6.186c-0.273-1.186-1.143-2.144-2.332-2.417C18.389,3.153,12,3.153,12,3.153s-6.389,0-9.166,0.616
                  c-1.19,0.273-2.06,1.23-2.332,2.417C0,8.07,0,12,0,12s0,3.93,0.502,5.814c0.272,1.187,1.142,2.062,2.332,2.335
                  C5.611,20.847,12,20.847,12,20.847s6.389,0,9.166-0.698c1.189-0.273,2.059-1.148,2.332-2.335C24,15.93,24,12,24,12
                  S24,8.07,23.498,6.186z M9.545,15.568V8.432l6.545,3.568L9.545,15.568z"/>
              </svg>
            </a><a href="https://aus.social/@lukemurray" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Mastodon">
              <svg height="20" width="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" xml:space="preserve">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                <g id="SVGRepo_iconCarrier">
                  <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.510 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"></path>
                </g>
              </svg>
            </a><a href="https://bsky.app/profile/lukemurraynz.bsky.social" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="Bluesky">
              <svg class="octicon" xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 16 16" height="20" width="20" fill="currentColor">
                <title>Bluesky</title>
                <path d="M8 7.2c-.72-1.4-2.7-4.04-4.53-5.33C1.7.63 1.04.84.6 1.04.1 1.27 0 2.05 0 2.51c0 .46.25 3.77.42 4.32.54 1.82 2.47 2.45 4.25 2.25-2.6.38-4.92 1.33-1.88 4.71 3.33 3.46 4.57-.74 5.21-2.87.64 2.13 1.37 6.18 5.16 2.87 2.84-2.87.78-4.33-1.83-4.71 1.78.2 3.71-.43 4.25-2.25.17-.55.42-3.86.42-4.32 0-.46-.09-1.24-.6-1.47-.44-.2-1.11-.42-2.87.83A17.87 17.87 0 0 0 8 7.2Z"></path>
              </svg>
            </a><a href="https://twitter.com/lukemurraynz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="X"><svg height="20" width="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414L10 8.586z" clip-rule="evenodd"/>
          </svg></a><a href="https://www.linkedin.com/in/ljmurray/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-icon" aria-label="LinkedIn"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"></path></svg></a><a href="https://luke.geek.nz/rss" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-rss-link" aria-label="RSS"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/service-groups-terraform-azapi/">Deploying Azure Service Groups with Terraform AzAPI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/mcp-vscode-microsoft-learn/">Model Context Protocol (MCP) in VS Code with Microsoft Learn</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/drasi-bastion-rbac-automation/">Automate Azure Bastion with Drasi Realtime RBAC Monitoring</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/zone-redundancy-cli/">Validate Azure Zone Redundancy with az zones CLI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/azure/container-apps-planned-maintenance/">Azure Container Apps Configure Planned Maintenance Windows</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">AVD-Collect - Azure Virtual Desktop Diagnostics and Logging</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-08-08T00:00:00.000Z">August 8, 2021</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://luke.geek.nz/img/logo.png" alt="Luke Murray"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://luke.geek.nz" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Luke Murray</span></a></div><small class="authorTitle_nd0D" title="Author">Author</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>AVD-Collect is a handy PowerShell script created by Microsoft Customer Support Services to assist with troubleshooting and resolving issues with Azure Virtual Desktop (and Windows 365), by capturing Logs for analysis <em>(which could then be passed to Microsoft or allow you to delve deeper)</em> and running basic Diagnostics against some common known issues.</p>
<p>You can download this script from: <a href="https://aka.ms/avd-collect" target="_blank" rel="noopener noreferrer" title="https://aka.ms/avd-collect?WT.mc_id=AZ-MVP-5004796">https://aka.ms/avd-collect</a></p>
<blockquote>
<p>There is no publically avaliable github repository for it currently, Microsoft will retain the latest version of the script at this link.</p>
<p>This script was NOT created by me and comes &#x27;As/Is&#x27;, this article is merely intended to share the script to assit others in their AVD troubleshooting.</p>
<p>This script is intended to help support Microsoft Customer Support with assisting customers, but was made publically accessible to assist with MS Support cases and Azure Virtual Desktop diagnostics. No data is automatically uploaded to Microsoft.</p>
<p>Please be aware that the script may change and include new functionality not part of this article, please review the Changelog and Readme of the script directly.</p>
</blockquote>
<p>A lot of the information below is contained in the script readme <em>(including a list of the extensive diagnostics and log locations)</em> and changelog; however, I am supplying this article for reference and to help share this nifty tool.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="script-pre-requisites">Script pre-requisites<a href="#script-pre-requisites" class="hash-link" aria-label="Direct link to Script pre-requisites" title="Direct link to Script pre-requisites">​</a></h3>
<ol>
<li>
<p>The script must be run with elevated permissions to collect all required data.</p>
</li>
<li>
<p>All collected data will be archived into a .zip file located in the same folder as the script itself.</p>
</li>
<li>
<p>As needed, run the script on AVD host VMs and/or Windows-based devices from where you connect to the AVD hosts.</p>
</li>
<li>
<p>When launched, the script will present the Microsoft Diagnostic Tools End User License Agreement (EULA). You need to accept the EULA before you can continue using the script.</p>
</li>
<li>
<p>If the script does not start, complaining about execution restrictions, then in an elevated PowerShell console run:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">	Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Force -Scope Process</span><br></span></code></pre></div></div>
</li>
</ol>
<p><em>Acceptance of the EULA will be stored in the registry under HKCU\Software\Microsoft\CESDiagnosticTools, and you will not be prompted again to accept it as long as the registry key is in place.</em> <em>You can also use the &quot;-AcceptEula&quot; command line parameter to accept the EULA silently.</em> <em>This is a per-user setting, so each user running the script will accept the EULA once.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="script-scenarios">Script scenarios<a href="#script-scenarios" class="hash-link" aria-label="Direct link to Script scenarios" title="Direct link to Script scenarios">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="core---suitable-for-troubleshooting-issues-that-do-not-involve-profiles-or-teams-or-msix-app-attach">Core - suitable for troubleshooting issues that do not involve Profiles or Teams or MSIX App Attach<a href="#core---suitable-for-troubleshooting-issues-that-do-not-involve-profiles-or-teams-or-msix-app-attach" class="hash-link" aria-label="Direct link to Core - suitable for troubleshooting issues that do not involve Profiles or Teams or MSIX App Attach" title="Direct link to Core - suitable for troubleshooting issues that do not involve Profiles or Teams or MSIX App Attach">​</a></h4>
<ul>
<li>Collects core troubleshooting data without including Profiles/FSLogix/OneDrive or Teams or MSIXAA related data</li>
<li>Runs Diagnostics.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="core--profiles---suitable-for-troubleshooting-profiles-issues">Core + Profiles - suitable for troubleshooting Profiles issues<a href="#core--profiles---suitable-for-troubleshooting-profiles-issues" class="hash-link" aria-label="Direct link to Core + Profiles - suitable for troubleshooting Profiles issues" title="Direct link to Core + Profiles - suitable for troubleshooting Profiles issues">​</a></h4>
<ul>
<li>Collects all Core data</li>
<li>Collects Profiles/FSLogix/OneDrive related information, as available</li>
<li>Runs Diagnostics.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="core--teams---suitable-for-troubleshooting-teams-issues">Core + Teams - suitable for troubleshooting Teams issues<a href="#core--teams---suitable-for-troubleshooting-teams-issues" class="hash-link" aria-label="Direct link to Core + Teams - suitable for troubleshooting Teams issues" title="Direct link to Core + Teams - suitable for troubleshooting Teams issues">​</a></h4>
<ul>
<li>Collects all Core data</li>
<li>Collects Teams related information, as available</li>
<li>Runs Diagnostics.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="core--msix-app-attach---suitable-for-troubleshooting-msix-app-attach-issues">Core + MSIX App Attach - suitable for troubleshooting MSIX App Attach issues<a href="#core--msix-app-attach---suitable-for-troubleshooting-msix-app-attach-issues" class="hash-link" aria-label="Direct link to Core + MSIX App Attach - suitable for troubleshooting MSIX App Attach issues" title="Direct link to Core + MSIX App Attach - suitable for troubleshooting MSIX App Attach issues">​</a></h4>
<ul>
<li>Collects all Core data</li>
<li>Collects MSIX App Attach related information, as available</li>
<li>Runs Diagnostics.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="core--msra---suitable-for-troubleshooting-remote-assistance-issues">Core + MSRA - suitable for troubleshooting Remote Assistance issues<a href="#core--msra---suitable-for-troubleshooting-remote-assistance-issues" class="hash-link" aria-label="Direct link to Core + MSRA - suitable for troubleshooting Remote Assistance issues" title="Direct link to Core + MSRA - suitable for troubleshooting Remote Assistance issues">​</a></h4>
<ul>
<li>Collects all Core data</li>
<li>Collects Remote Assistance related information, as available</li>
<li>Runs Diagnostics.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="extended-all---suitable-for-troubleshooting-most-issues-including-profilesfslogixonedrive-teams-and-msix-app-attach">Extended (all) - suitable for troubleshooting most issues, including Profiles/FSLogix/OneDrive, Teams and MSIX App Attach<a href="#extended-all---suitable-for-troubleshooting-most-issues-including-profilesfslogixonedrive-teams-and-msix-app-attach" class="hash-link" aria-label="Direct link to Extended (all) - suitable for troubleshooting most issues, including Profiles/FSLogix/OneDrive, Teams and MSIX App Attach" title="Direct link to Extended (all) - suitable for troubleshooting most issues, including Profiles/FSLogix/OneDrive, Teams and MSIX App Attach">​</a></h4>
<ul>
<li>Collects all Core data</li>
<li>Collects Profiles/FSLogix/OneDrive related information, as available</li>
<li>Collects Microsoft Teams related information, as available</li>
<li>Collects MSIX App Attach related information, as available</li>
<li>Runs Diagnostics.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="diagonly">DiagOnly<a href="#diagonly" class="hash-link" aria-label="Direct link to DiagOnly" title="Direct link to DiagOnly">​</a></h4>
<ul>
<li>Skips all Core/Extended data collection and runs Diagnostics only <em>(regardless of any other parameters that have been specified)</em>.</li>
</ul>
<p><strong>The default scenario is &quot;Core&quot;.​​​​​​​</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="available-command-line-parameters-to-preselect-the-desired-scenario">Available command line parameters (to preselect the desired scenario)<a href="#available-command-line-parameters-to-preselect-the-desired-scenario" class="hash-link" aria-label="Direct link to Available command line parameters (to preselect the desired scenario)" title="Direct link to Available command line parameters (to preselect the desired scenario)">​</a></h4>
<ul>
<li>Core - Collects Core data + Runs Diagnostics</li>
<li>Extended - Collects all Core data + Extended <em>(Profiles/FSLogix/OneDrive, Teams, MSIX App Attach)</em> data + Runs Diagnostics</li>
<li>Profiles - Collects all Core data + Profiles/FSLogix/OneDrive data + Runs Diagnostics</li>
<li>Teams - Collects all Core data + Teams data + Runs Diagnostics</li>
<li>MSIXAA - Collects all Core data + MSIX App Attach data + Runs Diagnostics</li>
<li>MSRA - Collects all Core data + Remote Assistance data + Runs Diagnostics</li>
<li>DiagOnly - The script will skip all data collection and will only run the diagnostics part <em>(even if other parameters have been included)</em>.</li>
<li>AcceptEula - Silently accepts the Microsoft Diagnostic Tools End User License Agreement.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage-example-with-parameters">Usage example with parameters<a href="#usage-example-with-parameters" class="hash-link" aria-label="Direct link to Usage example with parameters" title="Direct link to Usage example with parameters">​</a></h3>
<p>To collect only Core data (excluding Profiles/FSLogix/OneDrive, Teams, MSIX App Attach):</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">	.\AVD-Collect.ps1 -Core</span><br></span></code></pre></div></div>
<p>To collect Core + Extended data (incl. Profiles/FSLogix/OneDrive, Teams, MSIX App Attach):</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">	.\AVD-Collect.ps1 -Extended</span><br></span></code></pre></div></div>
<p>To collect Core + Profiles + MSIX App Attach data</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">	.\AVD-Collect.ps1 -Profiles -MSIXAA</span><br></span></code></pre></div></div>
<p>To collect Core + Profiles data</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">	.\AVD-Collect.ps1 -Profiles</span><br></span></code></pre></div></div>
<p>​​​​​​​If you are missing any of the data that the script should normally collect, check the content of the &quot;__AVD-Collect-Log.txt&quot; and &quot;__AVD-Collect-Errors.txt&quot; files for more information. Some data may not be present during data collection and thus not picked up by the script.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="execute-the-script">Execute the script<a href="#execute-the-script" class="hash-link" aria-label="Direct link to Execute the script" title="Direct link to Execute the script">​</a></h3>
<ol>
<li>
<p><strong>Download</strong> the AVD-Collect <strong>script</strong> to the session host you need to collect the logs from, if you haven&#x27;t already.</p>
</li>
<li>
<p><strong>Extract</strong> the <strong>script</strong> to a folder <em>(i.e. C:\Users\%username&amp;\Downloads\AVD-Collect)</em></p>
</li>
<li>
<p>Right-click on: AVD-Collect.ps1, select Properties</p>
</li>
<li>
<p>Because this file has been downloaded from the Internet, it may be in a protected/block status - select <strong>Unblock</strong> and click <strong>Apply</strong></p>
</li>
<li>
<p>Open Windows Powershell as Administrator</p>
</li>
<li>
<p>Now we need to <strong>change</strong> the <strong>directory</strong> for where the script is located; in my example, the command I use is:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd &#x27;C:\Users\Luke\Downloads\AVD-Collect&#x27;</span><br></span></code></pre></div></div>
</li>
<li>
<p>By default, the script will run as &#x27;Core&#x27;, and I want to include everything, profiles, Teams etc., so <strong>run</strong> Extended:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">.\AVD-Collect.ps1 -Extended -AcceptEula</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Read</strong> the notice from the Microsoft Customer Support centre and press &#x27;<strong>Y</strong>&#x27; if you <strong>accept</strong> to move onto the next steps.</p>
</li>
<li>
<p>The <strong>script</strong> will now <strong>run</strong>:</p>
</li>
<li>
<p><img decoding="async" loading="lazy" alt="AVD- Script Running" src="/assets/images/avd-collect_running-b41bcdee269b2479cb7fac5270563bf7.png" title="AVD- Script Running" width="855" height="237" class="img_ev3q"></p>
</li>
<li>
<p>You will start to see new folders get created in the directory that the script is running from with the extracted log files. The script will take a few minutes to complete as it extracts the logs and then zips them.</p>
</li>
<li>
<p>Once the script has ran, there will now be a <strong>ZIP file</strong> of all the Logs collected by the script. In my example, the <strong>logs</strong> consisted of:</p>
</li>
</ol>
<ul>
<li>Certificates</li>
<li>Recent Event Log</li>
<li>FSLogix logs</li>
<li>Networking</li>
<li>Registry Keys</li>
<li>Teams information</li>
<li>System information</li>
<li>Networking and Firewall information</li>
</ul>
<ol start="13">
<li><img decoding="async" loading="lazy" alt="AVD-Collect Logs" src="/assets/images/avd-collect-postrun-58e7188011316714735af65e00f442e0.png" title="AVD-Collect Logs" width="495" height="342" class="img_ev3q"></li>
<li>If needed, you can now <strong>send</strong> or upload the <strong>ZIP</strong> file to Microsoft <strong>support</strong>. If you are troubleshooting yourself, you can navigate to the folders to look at the specific logs you want, all in one place!</li>
<li>To <strong>look</strong> at <strong>Diagnostic</strong> information, open the: <strong>AVD-Diag.html</strong> file.</li>
<li>You can now see a list of common issues, what the script is looking for, and whether the host has passed or failed these scripts <em>(this can be very useful for Azure Virtual Desktop hosts, to make sure all the standard configuration is done or being applied, including making sure that the session host has access to all the external resources it needs</em>):</li>
<li><img decoding="async" loading="lazy" alt="AVD-Collect Diagnostics" src="/assets/images/avd-collect-diagreport-ea0ec39061efa2d1606d30a8271d4a15.png" title="AVD-Collect Diagnostics" width="1487" height="929" class="img_ev3q"></li>
</ol></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/tags/power-shell/">PowerShell</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/2021/08/21/update-admpwdadschema-the-requested-attribute-does-not-exist/"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Update-AdmPwdAdSchema - The requested attribute does not exist</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2021/07/18/implement-webjea-for-self-service-azure-resource-creation-with-powershell/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Implement WebJEA for self-service Start/Stop of Azure Virtual Machines</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#script-pre-requisites" class="table-of-contents__link toc-highlight">Script pre-requisites</a></li><li><a href="#script-scenarios" class="table-of-contents__link toc-highlight">Script scenarios</a><ul><li><a href="#core---suitable-for-troubleshooting-issues-that-do-not-involve-profiles-or-teams-or-msix-app-attach" class="table-of-contents__link toc-highlight">Core - suitable for troubleshooting issues that do not involve Profiles or Teams or MSIX App Attach</a></li><li><a href="#core--profiles---suitable-for-troubleshooting-profiles-issues" class="table-of-contents__link toc-highlight">Core + Profiles - suitable for troubleshooting Profiles issues</a></li><li><a href="#core--teams---suitable-for-troubleshooting-teams-issues" class="table-of-contents__link toc-highlight">Core + Teams - suitable for troubleshooting Teams issues</a></li><li><a href="#core--msix-app-attach---suitable-for-troubleshooting-msix-app-attach-issues" class="table-of-contents__link toc-highlight">Core + MSIX App Attach - suitable for troubleshooting MSIX App Attach issues</a></li><li><a href="#core--msra---suitable-for-troubleshooting-remote-assistance-issues" class="table-of-contents__link toc-highlight">Core + MSRA - suitable for troubleshooting Remote Assistance issues</a></li><li><a href="#extended-all---suitable-for-troubleshooting-most-issues-including-profilesfslogixonedrive-teams-and-msix-app-attach" class="table-of-contents__link toc-highlight">Extended (all) - suitable for troubleshooting most issues, including Profiles/FSLogix/OneDrive, Teams and MSIX App Attach</a></li><li><a href="#diagonly" class="table-of-contents__link toc-highlight">DiagOnly</a></li><li><a href="#available-command-line-parameters-to-preselect-the-desired-scenario" class="table-of-contents__link toc-highlight">Available command line parameters (to preselect the desired scenario)</a></li></ul></li><li><a href="#usage-example-with-parameters" class="table-of-contents__link toc-highlight">Usage example with parameters</a></li><li><a href="#execute-the-script" class="table-of-contents__link toc-highlight">Execute the script</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 luke.geek.nz. Powered by coffee, clouds and hamsters on wheels!</div></div></div></footer></div>
</body>
</html>
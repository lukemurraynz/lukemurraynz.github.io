"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[88694],{31110:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>s,default:()=>l,frontMatter:()=>i,metadata:()=>r,toc:()=>g});var r=t(19477),a=t(74848),o=t(28453);const i={title:"Changing the default Management Group in Azure",authors:["Luke"],tags:["Azure"],toc:!1,header:{teaser:"/images/posts/ChangeDefaultManagementGroup.png"},date:"2023-07-17 00:00:00 +1300",slug:"azure/Changing-default-management-group-for-azure"},s=void 0,u={authorsImageUrls:[void 0]},g=[{value:"Configure using Azure Portal",id:"configure-using-azure-portal",level:3},{value:"Configuring using Bicep",id:"configuring-using-bicep",level:3},{value:"Configure using REST API using PowerShell",id:"configure-using-rest-api-using-powershell",level:3},{value:"Configure using Terraform",id:"configure-using-terraform",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["By default, when a ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/governance/management-groups/overview?WT.mc_id=AZ-MVP-5004796",children:"Management Group"})," gets created, it goes under the Root Management Group, the same is true for ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions?WT.mc_id=AZ-MVP-5004796",children:"Subscriptions"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["This works fine, when you have a simple Microsoft Azure environment, but as soon as you start expanding into areas such as ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/architecture/landing-zones/subscription-vending?WT.mc_id=AZ-MVP-5004796",children:"Subscription vending"})," or limited access to who can see the Root Management Group and start to look into Visual Studio Enterprise subscriptions, you may want to consider moving new subscriptions, under its own Management Group, away from any policies or RBAC controls, essentially into a Management Group that acts as a shopping cart, to then be picked up and moved later."]}),"\n",(0,a.jsxs)(n.p,{children:["If we refer to a ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/cloud-adoption-framework/ready/landing-zone/design-area/resource-org-management-groups?WT.mc_id=AZ-MVP-5004796#management-group-recommendations",children:"recommendation"})," on the Microsoft Cloud Adoption Framework:"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Configure a default, dedicated management group for new subscriptions. This group ensures that no subscriptions are placed under the root management group. This group is especially important if there are users eligible for Microsoft Developer Network (MSDN) or Visual Studio benefits and subscriptions. A good candidate for this type of management group is a ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/cloud-adoption-framework/ready/considerations/sandbox-environments?WT.mc_id=AZ-MVP-5004796",children:"sandbox"})," management group."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"So, how can we change the default Management Group, that new Subscriptions go into?"}),"\n",(0,a.jsx)(n.p,{children:"Lets take a look at the different ways we could use to update the default management group, that new subscriptions go into."}),"\n",(0,a.jsx)(n.h3,{id:"configure-using-azure-portal",children:"Configure using Azure Portal"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Use the search bar to search for and select 'Management groups'."}),"\n",(0,a.jsx)(n.li,{children:"On the root management group, select details next to the name of the management group."}),"\n",(0,a.jsx)(n.li,{children:"Under Settings, select Hierarchy settings."}),"\n",(0,a.jsx)(n.li,{children:"Select the Change default management group button."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"configuring-using-bicep",children:"Configuring using Bicep"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"resource symbolicname 'Microsoft.Management/managementGroups/settings@2021-04-01' = {\nname: 'default'\nparent: resourceSymbolicName\nproperties: {\ndefaultManagementGroup: 'string'\nrequireAuthorizationForGroupCreation: bool\n}\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Reference: ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/templates/microsoft.management/managementgroups/settings?pivots=deployment-language-bicep&WT.mc_id=AZ-MVP-5004796",children:"Microsoft.Management managementGroups/settings"})]}),"\n",(0,a.jsx)(n.h3,{id:"configure-using-rest-api-using-powershell",children:"Configure using REST API using PowerShell"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'$root_management_group_id = "Enter the ID of root management group"\n$default_management_group_id = "Enter the ID of default management group (or use the same ID of the root management group)"\n$body = \'{\n "properties": {\n      "defaultManagementGroup": "/providers/Microsoft.Management/managementGroups/\' + $default_management_group_id + \'",\n      "requireAuthorizationForGroupCreation": true\n }\n}\'\n$token = (Get-AzAccessToken).Token\n$headers = @{"Authorization"= "Bearer $token"; "Content-Type"= "application/json"}\n$uri = "https://management.azure.com/providers/Microsoft.Management/managementGroups/$root_management_group_id/settings/default?api-version=2021-04-01"\nInvoke-RestMethod -Method PUT -Uri $uri -Headers $headers -Body $body\n'})}),"\n",(0,a.jsx)(n.h3,{id:"configure-using-terraform",children:"Configure using Terraform"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'resource "azurerm_management_group_subscription_association" "example" {\nmanagement_group_id = data.azurerm_management_group.example.id\nsubscription_id     = data.azurerm_subscription.example.id\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Note: Not quite the same, as configuring the default setting as above - but you can specify the Managament Group association for subscriptions using Terraform."})]})}function l(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>s});var r=t(96540);const a={},o=r.createContext(a);function i(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:n},e.children)}},19477:e=>{e.exports=JSON.parse('{"permalink":"/azure/Changing-default-management-group-for-azure","source":"@site/blog/2023-07-17-Changing-default-management-group-for-azure.md","title":"Changing the default Management Group in Azure","description":"By default, when a Management Group gets created, it goes under the Root Management Group, the same is true for Subscriptions.","date":"2023-07-17T00:00:00.000Z","tags":[{"inline":true,"label":"Azure","permalink":"/tags/azure"}],"readingTime":1.965,"hasTruncateMarker":false,"authors":[{"name":"Luke Murray","title":"Author","url":"https://luke.geek.nz","imageURL":"https://luke.geek.nz/img/logo.png","key":"Luke","page":null}],"frontMatter":{"title":"Changing the default Management Group in Azure","authors":["Luke"],"tags":["Azure"],"toc":false,"header":{"teaser":"/images/posts/ChangeDefaultManagementGroup.png"},"date":"2023-07-17 00:00:00 +1300","slug":"azure/Changing-default-management-group-for-azure"},"unlisted":false,"prevItem":{"title":"Entra ID login to a CIS Hardened Linux Azure Virtual Machine","permalink":"/azure/Entra-ID-login-to-a-CIS-Hardened-Linux-Azure-Virtual-Machine"},"nextItem":{"title":"Access denied on Azure VM when using aztfexport","permalink":"/azure/Access-denied-aztfexport"}}')}}]);
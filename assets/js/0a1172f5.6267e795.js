"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[77420],{40670:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var i=t(18753),a=t(74848),o=t(28453);const s={title:"Validate Azure Zone Redundancy with az zones CLI",metaDescription:"Use the Azure CLI 'az zones' extension to check and validate zone redundancy for high availability in your Azure workloads.",tags:["Azure"],categories:["Azure"],authors:["Luke"],slug:"azure/zone-redundancy-cli",keywords:["Azure","Cloud Reliability","Zone Redundancy","az zones","Azure CLI","High Availability"],description:"Learn to use the Azure CLI 'az zones' extension to check zone redundancy and ensure high availability for your Azure workloads.",date:new Date("2025-06-07T06:29:11.921Z")},r=void 0,d={authorsImageUrls:[void 0]},l=[{value:"\ud83c\udfe2 What Makes Up an Azure Region?",id:"-what-makes-up-an-azure-region",level:2},{value:"\ud83d\udee1\ufe0f Designing for Reliability with Availability Zones",id:"\ufe0f-designing-for-reliability-with-availability-zones",level:2},{value:"\ud83d\udd0d How Do You Know If Your Workload Is Zone Redundant?",id:"-how-do-you-know-if-your-workload-is-zone-redundant",level:2},{value:"\ud83e\udde9 Understanding Zone Redundancy Status",id:"-understanding-zone-redundancy-status",level:2},{value:"\ud83d\ude80 Getting Started with <code>az zones validate</code>",id:"-getting-started-with-az-zones-validate",level:2},{value:"\ud83d\udcca Output Formats and Exporting Results",id:"-output-formats-and-exporting-results",level:2},{value:"\ud83c\udfaf Scoping Your Validation",id:"-scoping-your-validation",level:2},{value:"\ud83e\uddf9 Additional Options and Filtering",id:"-additional-options-and-filtering",level:2}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/well-architected/reliability/?WT.mc_id=AZ-MVP-5004796",children:"Reliability"})," ",(0,a.jsx)(n.em,{children:"(Resiliency, availability, recovery)"})," is part of one of the main pillars of the ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/well-architected/?WT.mc_id=AZ-MVP-5004796",children:"Azure Well-Architected Framework"}),". It is essential for ensuring that applications and services remain operational and performant, even in the face of failures or unexpected events. Reliability encompasses various aspects, including fault tolerance, disaster recovery, and high availability."]}),"\n",(0,a.jsxs)(n.p,{children:["Reliability is also a shared responsibility between the cloud provider ",(0,a.jsx)(n.em,{children:"(ie, Microsoft)"})," and the customer. While Azure provides a robust infrastructure and services designed for reliability, customers must also implement best practices and strategies to ensure their applications are resilient and can recover from failures."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"ReliabilitySharedResponsibility",src:t(25445).A+"",width:"1500",height:"826"})}),"\n",(0,a.jsxs)(n.p,{children:["But a key question arises: ",(0,a.jsxs)(n.strong,{children:["How do we check the reliability ",(0,a.jsx)(n.em,{children:"(in this example, Zone redundancy of our Workload)"})," ?"]})]}),"\n",(0,a.jsxs)(n.p,{children:["One of the tools we can use for this is the ",(0,a.jsx)(n.code,{children:"az zones"})," command line tool."]}),"\n","\n",(0,a.jsxs)(n.admonition,{type:"info",children:[(0,a.jsx)(n.p,{children:"I just want to say that Resiliency is not just about the infrastructure, but also about the application design and architecture. It is essential to consider how your application will handle failures and recover from them, as there are numerous layers to take into account when implementing technology."}),(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"ImportanceReliability",src:t(60178).A+"",width:"1511",height:"844"})}),(0,a.jsx)(n.p,{children:"However, the resiliency platform capabilities, although sometimes not directly visible, are essential for the reliability of your application. They provide the foundation upon which your workload sits."})]}),"\n",(0,a.jsx)(n.h2,{id:"-what-makes-up-an-azure-region",children:"\ud83c\udfe2 What Makes Up an Azure Region?"}),"\n",(0,a.jsxs)(n.p,{children:["Before we go into the details of the ",(0,a.jsx)(n.code,{children:"az zones"})," command line tool, I want to touch on what the tool will be highlighting for us."]}),"\n",(0,a.jsxs)(n.p,{children:["If we go into what a region consists of, we can see that it is made up of multiple availability zones. An availability zone is a physically separate zone within an Azure region, designed to be isolated from failures in other zones. Each availability zone ",(0,a.jsx)(n.em,{children:"(one or more datacenters)"})," has its own power, cooling, and networking infrastructure, ensuring that if one zone experiences an outage, the others remain operational."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Azure Availability Zones",src:t(19238).A+"",width:"1280",height:"720"})}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-designing-for-reliability-with-availability-zones",children:"\ud83d\udee1\ufe0f Designing for Reliability with Availability Zones"}),"\n",(0,a.jsx)(n.p,{children:"When designing your workloads for reliability within Azure, it is crucial to consider the availability zones. By deploying resources across multiple availability zones, you can achieve higher levels of fault tolerance and availability. This means that even if one zone goes down, your application can continue to function using resources in other zones."}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["If you are interested in more about Workload criticality, refer to a previous blog post I did: ",(0,a.jsx)(n.a,{href:"https://luke.geek.nz/azure/business-critical-workloads/",children:"Understanding Workload Criticality in the Cloud\n"}),". This goes a bit deeper into SLA, SLO, and composite SLAs"]})}),"\n",(0,a.jsx)(n.h2,{id:"-how-do-you-know-if-your-workload-is-zone-redundant",children:"\ud83d\udd0d How Do You Know If Your Workload Is Zone Redundant?"}),"\n",(0,a.jsxs)(n.p,{children:["So, how do you know that your workload is redundant? This is where the ",(0,a.jsx)(n.code,{children:"az zones"})," command line tool comes in handy."]}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsxs)(n.p,{children:["This extension is in active development. While an effort has been made to include the most common resource types and their zone redundancy configuration, there are still plenty of resource types missing. More will be added in future releases. In the meantime, if you need specific resources added or have found errors, please raise a ",(0,a.jsx)(n.a,{href:"https://github.com/Azure/azure-cli-extensions/issues",children:"Github issue"}),". The extension still has missing resource types. These are shown as Unknown in the results. It is essential that you validate zone redundancy of these resources yourself, since your whole application is only zone redundant if all resources are zone redundant."]})}),"\n",(0,a.jsx)(n.h2,{id:"-understanding-zone-redundancy-status",children:"\ud83e\udde9 Understanding Zone Redundancy Status"}),"\n",(0,a.jsx)(n.p,{children:"This CLI Extension helps validate the zone redundancy status of resources within a specific scope. For each resource, one of the following statuses will be returned:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Status"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Unknown"}),(0,a.jsx)(n.td,{children:"Unable to verify status. You'll need to check the resource manually."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsx)(n.td,{children:"Resource is configured for zone redundancy"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Always"}),(0,a.jsx)(n.td,{children:"Resource is always zone redundant, no configuration needed"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"Resource is not configured for zone redundancy, but could be in another configuration"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Never"}),(0,a.jsx)(n.td,{children:"Resource cannot be configured for zone redundancy"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Dependent"}),(0,a.jsx)(n.td,{children:"Resource is zone redundant if parent or related resource is zone redundant"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"NoZonesInRegion"}),(0,a.jsx)(n.td,{children:"The region the resource is deployed in does not have Availability Zones"})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"By running this against a specific resource group that contains your production resources, you can be sure that you have not overlooked any resources in your quest for zone redundancy. If the results show 'No' on one of your resources, that means that you need to change the configuration to enable ZR. If it shows 'Never', that probably means you need to deploy multiple of those resources to the different zones manually."}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"Zonal services are considered to be Zone Redundant if they are deployed to at least 2 zones."}),"\n"]}),"\n",(0,a.jsxs)(n.h2,{id:"-getting-started-with-az-zones-validate",children:["\ud83d\ude80 Getting Started with ",(0,a.jsx)(n.code,{children:"az zones validate"})]}),"\n",(0,a.jsxs)(n.p,{children:["So let's get going - with the ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest&WT.mc_id=AZ-MVP-5004796",children:"Azure CLI"})," installed, it's time to run a validate command - this will prompt the Azure CLI to install the extension."]}),"\n",(0,a.jsxs)(n.p,{children:["Make sure you log in with: ",(0,a.jsx)(n.code,{children:"az login"}),"\nThen type: ",(0,a.jsx)(n.code,{children:"az zones validate"})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Az Zones validate",src:t(51755).A+"",width:"1202",height:"496"})}),"\n",(0,a.jsx)(n.p,{children:"This will prompt the zones extension to be installed and run the validate command."}),"\n",(0,a.jsx)(n.h2,{id:"-output-formats-and-exporting-results",children:"\ud83d\udcca Output Formats and Exporting Results"}),"\n",(0,a.jsx)(n.p,{children:"Next, let us rerun it - this time in a Table format:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"az zones validate -o table"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Az Zones validate - Output Tables",src:t(38391).A+"",width:"1201",height:"496"})}),"\n",(0,a.jsxs)(n.p,{children:["The Table format makes it easier to read, in my opinion, and then we could export and then open it up in Excel, for example, to view outside of the terminal ",(0,a.jsx)(n.code,{children:" az zones validate -o table > ZonesOutput.csv"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"As we can see, I have a range of resource types in my Azure environment:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Az Zones validate - open in Excel",src:t(54731).A+"",width:"1691",height:"647"})}),"\n",(0,a.jsxs)(n.p,{children:["I can see that I have User Assigned Managed Identitties with the class of: Always - meaning it is ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/storage/common/storage-redundancy?WT.mc_id=AZ-MVP-5004796#zone-redundant-storage",children:"zone-redundant"})," and no other changes are needed.\nI can see that I have Disks, which are not zone redundant. THis means that they are not Zone-Redundant _(remember zone redundant is deployed to 2 or more zones) - in this case I would have to change the configuration from an ",(0,a.jsxs)(n.a,{href:"https://learn.microsoft.com/azure/storage/common/storage-redundancy?WT.mc_id=AZ-MVP-5004796#locally-redundant-storage",children:["LRS ",(0,a.jsx)(n.em,{children:"(Locally Redundant storage)"})]})," to ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/azure/storage/common/storage-redundancy?WT.mc_id=AZ-MVP-5004796#zone-redundant-storage",children:"ZRS _(Zone reundant storage)_"})," SKU or adjust the system using the disk - to be redundant, ie failover cluster.\nI can see I have an Expressroute circuit with the status of Unknown, This means that the zones CLI extension isn't able to verify this resource type. So you would need to check manually - make sure your ",(0,a.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/vpn-gateway/about-zone-redundant-vnet-gateways?WT.mc_id=AZ-MVP-5004796",children:"virtual network gateways are zone-redundant"}),". It's worth noting that Virtual Networks are zone-redundant by default."]}),"\n",(0,a.jsx)(n.h2,{id:"-scoping-your-validation",children:"\ud83c\udfaf Scoping Your Validation"}),"\n",(0,a.jsxs)(n.p,{children:["Now it's worth noting that when we ran ",(0,a.jsx)(n.code,{children:"az zones validate"})," it ran across all resources across subscriptions in the tenant we have access to, if we wanted to limit the scope of the scan, we can."]}),"\n",(0,a.jsx)(n.p,{children:"We can limit it by Resources with a specific tag only:"}),"\n",(0,a.jsx)(n.p,{children:"`az zones validate --tags Environment=dev'"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Azure Zones Validate",src:t(36378).A+"",width:"1200",height:"496"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"(It's worth noting the Tag value pair is case sensitive.)"})}),"\n",(0,a.jsx)(n.p,{children:"And we can also limit it by Resource Group or Subscription:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"az zones validate --resource-groups defaultresourcegroup-eau"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"az zones validate --subscription lukemurray-mvp-visualstudioenterprise-sub-dev"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Azure Zones Validate - Scope",src:t(93139).A+"",width:"1200",height:"496"})}),"\n",(0,a.jsx)(n.h2,{id:"-additional-options-and-filtering",children:"\ud83e\uddf9 Additional Options and Filtering"}),"\n",(0,a.jsxs)(n.p,{children:["You can also use the ",(0,a.jsx)(n.code,{children:"--omit-dependent"})," to remove resource dependencies from the scan and output."]}),"\n",(0,a.jsxs)(n.p,{children:["You can also use a JMESPath custom query ie, if I wanted to only view the resiliency of my disks: ",(0,a.jsx)(n.code,{children:"az zones validate --output table --query \"[?resourceType=='microsoft.compute/disks'].{Resource:name, Location:location, ZoneRedundant:zoneRedundant}\""})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Azure Zones Validate ",src:t(61450).A+"",width:"1200",height:"496"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},19238:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/AvailabilityZones-1ae3c9e34a273371fdbfaa9665171978.jpg"},51755:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/AzZonesValidate-2fcdc4164e6727e2d045550ff4f6e24d.gif"},38391:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/AzZonesValidate_OutputTable-34594e7e5dc8f4359ed2f1e1ec6e61b6.gif"},93139:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/AzZonesValidate_ScopeRGSub-a4f7009bfaed5a86cde79e5231f95aa5.gif"},61450:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/AzZonesValidate_ScopeResourceType-092c66b6286e014ce767906187ed1335.gif"},36378:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/AzZonesValidate_TagScope-050fade1e61afc73f43a59c6cbafbddc.gif"},54731:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/AzZones_ExcelExportView-f775739c29a20550176249560f7cd6f5.png"},60178:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/ImportanceReliability-84010f457c76af363dd7111889e21081.png"},25445:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/ReliabilitySharedResponsibility-f11723a008cf0c2993a7e12ee2c252ed.png"},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var i=t(96540);const a={},o=i.createContext(a);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:n},e.children)}},18753:e=>{e.exports=JSON.parse('{"permalink":"/azure/zone-redundancy-cli","source":"@site/blog/2025-06-07-azzonescli/index.mdx","title":"Validate Azure Zone Redundancy with az zones CLI","description":"Learn to use the Azure CLI \'az zones\' extension to check zone redundancy and ensure high availability for your Azure workloads.","date":"2025-06-07T06:29:11.921Z","tags":[{"inline":true,"label":"Azure","permalink":"/tags/azure"}],"readingTime":6.55,"hasTruncateMarker":true,"authors":[{"name":"Luke Murray","title":"Author","url":"https://luke.geek.nz","imageURL":"https://luke.geek.nz/img/logo.png","key":"Luke","page":null}],"frontMatter":{"title":"Validate Azure Zone Redundancy with az zones CLI","metaDescription":"Use the Azure CLI \'az zones\' extension to check and validate zone redundancy for high availability in your Azure workloads.","tags":["Azure"],"categories":["Azure"],"authors":["Luke"],"slug":"azure/zone-redundancy-cli","keywords":["Azure","Cloud Reliability","Zone Redundancy","az zones","Azure CLI","High Availability"],"description":"Learn to use the Azure CLI \'az zones\' extension to check zone redundancy and ensure high availability for your Azure workloads.","date":"2025-06-07T06:29:11.921Z"},"unlisted":false,"nextItem":{"title":"Azure Container Apps Configure Planned Maintenance Windows","permalink":"/azure/container-apps-planned-maintenance"}}')}}]);
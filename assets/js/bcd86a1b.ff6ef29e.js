"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[63260],{47170:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var r=n(22674),s=n(74848),i=n(28453);const a={title:"Using PowerShell to start the DFS Namespace service",description:"Distributed File System DFS has some service dependencies - so if those don't start the DFS Namespace service will also not start.",tags:["PowerShell"],date:"2018-06-11 00:00:00 +1300",header:{teaser:"images/powershell-blog-feature-banner.png"}},o=void 0,c={authorsImageUrls:[]},l=[];function h(e){const t={code:"code",em:"em",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Distributed File System (DFS) has some service dependencies - so if those don't start the DFS Namespace service will also not start."}),"\n",(0,s.jsx)(t.img,{className:"alignnone",src:"https://i1.wp.com/luke.geek.nz/wp-content/uploads/2016/12/121316_0835_DFSNamespac1.png?resize=584%2C112",alt:"DFS Namespace",width:"584",height:"112","data-recalc-dims":"1"}),"\n",(0,s.jsx)(t.p,{children:"The dependencies are:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Remote Registry"}),"\n",(0,s.jsx)(t.li,{children:"Security Accounts Manager"}),"\n",(0,s.jsx)(t.li,{children:"Server"}),"\n",(0,s.jsx)(t.li,{children:"Workstation"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"I have seen the Remote Registry service become the culprit of the DFS-N service not starting."}),"\n",(0,s.jsx)(t.p,{children:"In my experience, this had been caused by antivirus software changing the Remote Registry service to Disabled start-up type so when the DFS-N server restarts, one of the dependency services:"}),"\n",(0,s.jsx)(t.p,{children:"Remote Registry does not start so if you have issues with the DFS-N service not starting \u2013 check the Remote Registry Start-up type is configured to Automatic and click Start to confirm there are no errors and try starting the DFS-N service again."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:"Note: RemoteRegistry \u2013 although it is Automatic, will only Start when it is being used so don't be alarmed if it is in a 'Stopped' state."})}),"\n",(0,s.jsx)(t.img,{className:"alignnone",src:"https://i2.wp.com/luke.geek.nz/wp-content/uploads/2016/12/121316_0835_DFSNamespac2.png?resize=377%2C267",alt:"Remote Registry",width:"377",height:"267","data-recalc-dims":"1"}),"\n",(0,s.jsx)(t.p,{children:"I have also created a PowerShell script to do some general checking for the DFS namespace service \u2013 which sets the Remote Registry service to Automatic startup then gets the other DFS dependency services and changes the startup type to Automatic and starts them and finally tries to start the DFS Namespace service."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-powershell",metastring:'title="Start-DFS.ps1"',children:"\n#requires -Version 2.0\n\n<#\n.SYNOPSIS\n  Starts the DFS service\n\n.DESCRIPTION\n  Changes the Remote Registry service to Automatic start-up and Start the DFS NameSpace service dependencies, then start the DFS namespace service. \n  If the service does not start, it will retrieve the last 10 event log items from the DFS log.\n\n.NOTES\n  Version:        1.0\n  Author:         Luke Murray (Luke.Geek.NZ)\n  Creation Date:  20/03/17\n  Purpose/Change: \n  20/03/17 - Initial script development\n  11/06/18 - Updated script formatting\n\n.EXAMPLE\n  ./Start-DFS-Service.ps1\n  \n#>\n\n#---------------------------------------------------------[Script Parameters]------------------------------------------------------\n\n$ServiceName = 'DFS'\n$ErrorActionPreference = 'Stop'\n\n#-----------------------------------------------------------[Execution]------------------------------------------------------------\n\nTry \n{\n  Get-Service -Name RemoteRegistry | Set-Service -StartupType Automatic\n}\nCatch \n{\n  Write-Verbose -Message 'There is an issue changing the Remote Registry Service to Automatic Startup Type' -Verbose\n}\nTry\n{\n  $ServiceDependency = Get-Service -Name $ServiceName -DependentServices\n  $ServiceDependency | Set-Service -StartupType Automatic | Start-Service\n  Write-Verbose -Message \"$ServiceName dependencies have started. Will now try starting the $ServiceName service..\" -Verbose\n}\ncatch [Microsoft.PowerShell.Commands.ServiceCommandException]\n{\n  [Management.Automation.ErrorRecord]$e = $_\n\n  $info = New-Object -TypeName PSObject -Property @{\n    Exception = $e.Exception.Message\n    Reason    = $e.CategoryInfo.Reason\n    Target    = $e.CategoryInfo.TargetName\n    Line      = $e.InvocationInfo.ScriptLineNumber\n    Column    = $e.InvocationInfo.OffsetInLine\n  }\n  Write-Verbose -Message 'Opps! There was an error:' -Verbose\n  $info\n}\nCatch \n{\n  Write-Verbose -Message \"There was an issue starting $ServiceName dependencies\" -Verbose\n}\n\ntry\n{\n  Try\n  {\n    Start-Service -Name $ServiceName\n    Write-Verbose -Message \"The $ServiceName service has started.\" -Verbose\n  }\n  Catch \n  {\n    Get-WinEvent -LogName Microsoft-Windows-DFSN-Server/Operational | Select-Object -Last 10\n  }\n}\n\ncatch\n{\n  [Management.Automation.ErrorRecord]$e = $_\n\n  $info = New-Object -TypeName PSObject -Property @{\n    Exception = $e.Exception.Message\n    Reason    = $e.CategoryInfo.Reason\n    Target    = $e.CategoryInfo.TargetName\n    Line      = $e.InvocationInfo.ScriptLineNumber\n    Column    = $e.InvocationInfo.OffsetInLine\n  }\n  Write-Verbose -Message 'Opps! There was an error:' -Verbose\n  $info\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:"Note: Script is also hosted on my Github repository. Feel free to\nclone/recommend improvements or fork."})})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var r=n(96540);const s={},i=r.createContext(s);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:t},e.children)}},22674:e=>{e.exports=JSON.parse('{"permalink":"/2018/06/11/dfs-namespace-service-not-starting-reboot","source":"@site/blog/2018-06-11-dfs-namespace-service-not-starting-reboot.md","title":"Using PowerShell to start the DFS Namespace service","description":"Distributed File System DFS has some service dependencies - so if those don\'t start the DFS Namespace service will also not start.","date":"2018-06-11T00:00:00.000Z","tags":[{"inline":true,"label":"PowerShell","permalink":"/tags/power-shell"}],"readingTime":2.62,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Using PowerShell to start the DFS Namespace service","description":"Distributed File System DFS has some service dependencies - so if those don\'t start the DFS Namespace service will also not start.","tags":["PowerShell"],"date":"2018-06-11 00:00:00 +1300","header":{"teaser":"images/powershell-blog-feature-banner.png"}},"unlisted":false,"prevItem":{"title":"How to manage cost in Microsoft Azure","permalink":"/2018/12/19/How to manage cost in Microsoft Azure"},"nextItem":{"title":"Using PowerShell to connect to Microsoft Azure","permalink":"/2018/06/10/Using PowerShell to connect to Azure"}}')}}]);
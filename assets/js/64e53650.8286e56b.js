"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[26559],{23325:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});var t=n(88443),r=n(74848),o=n(28453);const i={title:"Microsoft Azure - ZonalAllocationFailed",authors:["Luke"],tags:["Azure"],date:"2022-07-27 00:00:00 +1300",toc:!0,header:{teaser:"/uploads/zonalallocationfailed.png"},slug:"azure/microsoft-azure-zonalallocationfailed"},s=void 0,l={authorsImageUrls:[void 0]},c=[{value:"<strong>Waiting for more Compute to be added to the Azure server clusters may not be an option, so what can you do?</strong>",id:"waiting-for-more-compute-to-be-added-to-the-azure-server-clusters-may-not-be-an-option-so-what-can-you-do",level:4},{value:"Raise a Support Case",id:"raise-a-support-case",level:5},{value:"Purchase On-demand Capacity Reservation",id:"purchase-on-demand-capacity-reservation",level:5},{value:"Redeploy to another Availability Zone",id:"redeploy-to-another-availability-zone",level:5},{value:"Change the Virtual Machine version",id:"change-the-virtual-machine-version",level:5},{value:"Increase regional vCPU quotas",id:"increase-regional-vcpu-quotas",level:5}];function d(e){const a={a:"a",blockquote:"blockquote",em:"em",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a.blockquote,{children:["\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"Error code"}),": AllocationFailed or ZonalAllocationFailed"]}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"Error message"}),': "Allocation failed. We do not have sufficient capacity for the requested VM size in this region. Read more about improving likelihood of allocation success at ',(0,r.jsx)(a.a,{href:"https://aka.ms/allocation-guidance?WT.mc_id=AZ-MVP-5004796",title:"https://aka.ms/allocation-guidance",children:"https://aka.ms/allocation-guidance"}),'"']}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:["When you create a virtual machine ",(0,r.jsx)(a.em,{children:"(VM)"}),", start stopped ",(0,r.jsx)(a.em,{children:"(deallocated)"})," VMs, or resize a VM, Microsoft Azure allocates compute resources to your subscription."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.img,{alt:"ZonalAllocationFailed",src:n(343).A+"",title:"ZonalAllocationFailed",width:"831",height:"122"})}),"\n",(0,r.jsx)(a.p,{children:"Microsoft is continually investing in additional infrastructure and features to ensure that they always have all VM types available to support customer demand. However, you may occasionally experience resource allocation failures because of unprecedented growth in demand for Azure services in specific regions."}),"\n",(0,r.jsx)(a.p,{children:"These tips, also apply to the 'Following SKUs have failed for Capacity Restrictions' error."}),"\n",(0,r.jsx)(a.p,{children:"This error could also be caused by a parameter issue with your Infrastructure as Code deployments, if you are to restrictive and it attempts to create a resource that isn't supported - an example is a SKU that doesn't support Accelerated Networking, or an attempt to deploy an Ultra SSD disk for a SKU that doesn't deploy it."}),"\n",(0,r.jsx)(a.h4,{id:"waiting-for-more-compute-to-be-added-to-the-azure-server-clusters-may-not-be-an-option-so-what-can-you-do",children:(0,r.jsx)(a.strong,{children:"Waiting for more Compute to be added to the Azure server clusters may not be an option, so what can you do?"})}),"\n",(0,r.jsx)(a.h5,{id:"raise-a-support-case",children:"Raise a Support Case"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"Take a screenshot of the error"}),"\n",(0,r.jsx)(a.li,{children:"Copy the Activity/Deployment ID"}),"\n",(0,r.jsx)(a.li,{children:"Take note of the Region"}),"\n",(0,r.jsx)(a.li,{children:"Take note of the Availability Zone."}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:["Let ",(0,r.jsx)(a.a,{href:"https://azure.microsoft.com/en-us/support/?WT.mc_id=AZ-MVP-5004796",title:" Azure Support",children:"Azure Support"})," know; that Microsoft may already be aware, but raising a support request helps identify potentially impacted customers. If you know of other SKUs you need to deploy, you can let them know."]}),"\n",(0,r.jsx)(a.h5,{id:"purchase-on-demand-capacity-reservation",children:"Purchase On-demand Capacity Reservation"}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/capacity-reservation-overview?WT.mc_id=AZ-MVP-5004796",title:"On-demand Capacity Reservation",children:"On-demand Capacity Reservation"})," enables you to reserve Compute capacity in an Azure region or an Availability Zone for any duration of time."]}),"\n",(0,r.jsxs)(a.p,{children:["Unlike ",(0,r.jsx)(a.a,{href:"https://azure.microsoft.com/en-us/pricing/reserved-vm-instances/?WT.mc_id=AZ-MVP-5004796",title:"Reserved Instances",children:"Reserved Instances"}),", you do not have to sign up for a 1-year or a 3-year term commitment."]}),"\n",(0,r.jsx)(a.p,{children:"Once the Capacity Reservation is created, the capacity is available immediately and is exclusively reserved for your use until the reservation is deleted."}),"\n",(0,r.jsx)(a.p,{children:"Capacity Reservations are priced at the same rate as the underlying VM size."}),"\n",(0,r.jsx)(a.p,{children:"For example, if you create a reservation for the D2s_v3 VMs, you will start getting billed for the D2s_v3 VMs, even if the reservation is not being used."}),"\n",(0,r.jsx)(a.p,{children:"So why would you purchase On-demand Capacity reservations?"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"You are operating Azure workloads that scale out and run off a fresh image, like a Citrix farm and want to ensure the capacity is available for the minimum workloads you need."}),"\n",(0,r.jsx)(a.li,{children:"You have a project coming up where you need the capacity to be available."}),"\n"]}),"\n",(0,r.jsx)(a.h5,{id:"redeploy-to-another-availability-zone",children:"Redeploy to another Availability Zone"}),"\n",(0,r.jsxs)(a.p,{children:["The server cluster that ARM (Azure Resource Manager) attempted to deploy your workload may not have the necessary capacity, but another Availability Zone ",(0,r.jsx)(a.em,{children:"(datacenter)"})," might."]}),"\n",(0,r.jsx)(a.p,{children:"Make sure your Virtual Machine is not in a Proximtry or Avalibility Group and do the following."}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Take note of the Availability Zone that your deployment failed"})," ",(0,r.jsx)(a.em,{children:"(i.e. Availability Zone 1)"})]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Remove any resources"})," that may have been created as part of the original failed deployment."]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Redeploy"})," your workload and ",(0,r.jsx)(a.strong,{children:"select"})," another Availability ",(0,r.jsx)(a.strong,{children:"Zone"}),", such as ",(0,r.jsx)(a.em,{children:"(2 - if your failed deployment was in Zone 1)"})]}),"\n"]}),"\n",(0,r.jsx)(a.h5,{id:"change-the-virtual-machine-version",children:"Change the Virtual Machine version"}),"\n",(0,r.jsxs)(a.p,{children:["By version, I don't mean ",(0,r.jsx)(a.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/generation-2?WT.mc_id=AZ-MVP-5004796#features-and-capabilities",title:"Generation 1 vs. generation 2 features",children:"Generation 1 and Generation 2"})," Virtual Machines; I mean the version of underlying Compute; when you look at a VM SKU size, you will see:"]}),"\n",(0,r.jsxs)(a.blockquote,{children:["\n",(0,r.jsxs)(a.p,{children:["Standard_DC24s_",(0,r.jsx)(a.strong,{children:"v3"})]}),"\n",(0,r.jsxs)(a.p,{children:["[Family] + ",(0,r.jsx)(a.em,{children:"[Sub-family]"}),"* + [# of vCPUs] + ",(0,r.jsx)(a.em,{children:"[Constrained vCPUs]"}),"* + [Additive Features] + ",(0,r.jsx)(a.em,{children:"[Accelerator Type]"}),"* + ",(0,r.jsx)(a.strong,{children:"[Version]"})]}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:['You can read more about Virtual Machine Naming conversions "',(0,r.jsx)(a.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/vm-naming-conventions?WT.mc_id=AZ-MVP-5004796",title:"Azure virtual machine sizes naming conventions",children:"here"}),'".']}),"\n",(0,r.jsx)(a.p,{children:"The version of the VM series links to the underlying hardware associated with the Virtual Machine series; with most new hardware releases, the version changes; an example is: from v3 to v4."}),"\n",(0,r.jsxs)(a.blockquote,{children:["\n",(0,r.jsx)(a.p,{children:'#Tip: Microsoft may run a promotion on the pricing for early adopters from time to time, to move to the new version; they can be seen from the Azure Portal with "Promo" in the name.'}),"\n"]}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsxs)(a.li,{children:["You can ",(0,r.jsx)(a.strong,{children:"change the version of the SKU"})," by looking in the Azure Portal, ",(0,r.jsx)(a.strong,{children:"Sizing"}),", and you should be ",(0,r.jsx)(a.strong,{children:"select"})," different ",(0,r.jsx)(a.strong,{children:"versions"})," of the same SKU; ",(0,r.jsx)(a.em,{children:"if you are at v5, try resizing to v4 - or the other way around"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:["Remember that changing the VM SKU will force the Virtual Machine to deallocate ",(0,r.jsx)(a.em,{children:"(stop)"}),", as it triggers ARM to stand up the Virtual Machine on different server clusters/hardware."]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsx)(a.em,{children:"I have found that there are no noticeable decreases in performance for most workloads, but keep in mind you may be returning on older hardware - but it should get you going, and then you can update the SKU to the latest version later."})}),"\n",(0,r.jsx)(a.h5,{id:"increase-regional-vcpu-quotas",children:"Increase regional vCPU quotas"}),"\n",(0,r.jsx)(a.p,{children:"Azure Resource Manager enforces two types of vCPU quotas for virtual machines:"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"standard vCPU quotas"}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"spot vCPU quotas\nStandard vCPU quotas apply to pay-as-you-go VMs and reserved VM instances. They are enforced at two tiers, for each subscription, in each region:"}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"The first tier is the total regional vCPU quota."}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"The second tier is the VM-family vCPU quota such as D-series vCPUs."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(a.p,{children:["Check your subscription quotas and if necessary, raise a request to increase them by following the guide here: [Increase regional vCPU quotas]{",(0,r.jsx)(a.a,{href:"https://learn.microsoft.com/azure/quotas/regional-quota-requests?WT.mc_id=AZ-MVP-5004796%7D",children:"https://learn.microsoft.com/azure/quotas/regional-quota-requests?WT.mc_id=AZ-MVP-5004796}"})]})]})}function h(e={}){const{wrapper:a}={...(0,o.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},343:(e,a,n)=>{n.d(a,{A:()=>t});const t=n.p+"assets/images/zonalallocationfailed-d3444d5a5ebfba3d83efb1663e5ca216.png"},28453:(e,a,n)=>{n.d(a,{R:()=>i,x:()=>s});var t=n(96540);const r={},o=t.createContext(r);function i(e){const a=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function s(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:a},e.children)}},88443:e=>{e.exports=JSON.parse('{"permalink":"/azure/microsoft-azure-zonalallocationfailed","source":"@site/blog/2022-07-27-microsoft-azure-zonalallocationfailed.md","title":"Microsoft Azure - ZonalAllocationFailed","description":"Error code: AllocationFailed or ZonalAllocationFailed","date":"2022-07-27T00:00:00.000Z","tags":[{"inline":true,"label":"Azure","permalink":"/tags/azure"}],"readingTime":4.465,"hasTruncateMarker":false,"authors":[{"name":"Luke Murray","title":"Author","url":"https://luke.geek.nz","imageURL":"https://luke.geek.nz/img/logo.png","key":"Luke","page":null}],"frontMatter":{"title":"Microsoft Azure - ZonalAllocationFailed","authors":["Luke"],"tags":["Azure"],"date":"2022-07-27 00:00:00 +1300","toc":true,"header":{"teaser":"/uploads/zonalallocationfailed.png"},"slug":"azure/microsoft-azure-zonalallocationfailed"},"unlisted":false,"prevItem":{"title":"Create a Public Holidays API using Microsoft Azure","permalink":"/2022/08/09/create-a-public-holidays-api-using-microsoft-azure"},"nextItem":{"title":"Azure Virtual Machine and a custom MAC address","permalink":"/azure/azure-virtual-machine-and-mac-address-software-licensing"}}')}}]);
"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[7258],{52133:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var t=n(74848),i=n(28453);const r={date:"2022-01-06 00:00:00 +1300",title:"Controlled Chaos in Azure using Chaos Studio",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"images/chaosengineering-banner.png"},slug:"azure/controlled-chaos-in-azure-using-chaos-studio"},o=void 0,a={permalink:"/azure/controlled-chaos-in-azure-using-chaos-studio",source:"@site/blog/2022-01-06-controlled-chaos-in-azure-using-chaos-studio.md",title:"Controlled Chaos in Azure using Chaos Studio",description:"Chaos engineering has been around for a while; Netflix runs their own famous Chaos Monkey, supposedly running 24/7, taking down their resources and pushing them to the limit continuously; it almost sounds counter-intuitive \u2013 but it's not.",date:"2022-01-06T00:00:00.000Z",tags:[{label:"Azure",permalink:"/tags/azure"}],readingTime:12.645,hasTruncateMarker:!1,authors:[{name:"Luke Murray",title:"Author",url:"https://luke.geek.nz",imageURL:"https://luke.geek.nz/img/logo.png",key:"Luke"}],frontMatter:{date:"2022-01-06 00:00:00 +1300",title:"Controlled Chaos in Azure using Chaos Studio",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"images/chaosengineering-banner.png"},slug:"azure/controlled-chaos-in-azure-using-chaos-studio"},unlisted:!1,prevItem:{title:"Azure Public DNS as Code",permalink:"/azure/azure-public-dns-as-code"},nextItem:{title:"Microsoft Entra ID Application Proxy Implementation",permalink:"/azure/azure-active-directory-application-proxy-implementation"}},l={authorsImageUrls:[void 0]},c=[{value:"Setup Azure Chaos Studio",id:"setup-azure-chaos-studio",level:3},{value:"Create Managed Identity",id:"create-managed-identity",level:4},{value:"Create Application Insights",id:"create-application-insights",level:4},{value:"Setup Chaos Studio Targets",id:"setup-chaos-studio-targets",level:4},{value:"Configure and run Azure Chaos Studio",id:"configure-and-run-azure-chaos-studio",level:3},{value:"Action exclusions",id:"action-exclusions",level:4},{value:"Configure Experiments",id:"configure-experiments",level:4},{value:"Assign permissions for the Experiments",id:"assign-permissions-for-the-experiments",level:4},{value:"Run Experiments",id:"run-experiments",level:4},{value:"Monitor and Auditing of Azure Chaos Studio",id:"monitor-and-auditing-of-azure-chaos-studio",level:3},{value:"Azure Activity Log",id:"azure-activity-log",level:4},{value:"Azure Alerts",id:"azure-alerts",level:4}];function h(e){const s={a:"a",blockquote:"blockquote",em:"em",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:["Chaos engineering has been around for a while; Netflix runs their own famous ",(0,t.jsx)(s.a,{href:"https://netflix.github.io/chaosmonkey/",children:"Chaos Monkey"}),", supposedly running 24/7, taking down their resources and pushing them to the limit continuously; it almost sounds counter-intuitive \u2013 but it's not."]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["Chaos engineering is defined as \u201cthe discipline of experimenting on a system in order to build confidence in the system\u2019s capability to withstand turbulent conditions in production\u201d (Principles of Chaos Engineering, ",(0,t.jsx)(s.a,{href:"http://principlesofchaos.org/",title:"http://principlesofchaos.org/",children:"http://principlesofchaos.org/"}),"). In other words, it\u2019s a software testing method focusing on finding evidence of problems before they are experienced by users."]}),"\n",(0,t.jsx)(s.p,{children:"Chaos engineering is a methodology that helps developers attain consistent reliability by hardening services against failures in production. Another way to think about chaos engineering is that it's about embracing the inherent chaos in complex systems and, through experimentation, growing confidence in your solution's ability to handle it."}),"\n",(0,t.jsx)(s.p,{children:"A common way to introduce chaos is to deliberately inject faults that cause system components to fail. The goal is to observe, monitor, respond to, and improve your system's reliability under adverse circumstances. For example, taking dependencies offline (stopping API apps, shutting down VMs, etc.), restricting access (enabling firewall rules, changing connection strings, etc.), or forcing failover (database level, Front Door, etc.), is a good way to validate that the application is able to handle faults gracefully."}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Introducing controlled Chaos tools such as Chaos Monkey and now \u2013 ",(0,t.jsx)(s.a,{href:"https://azure.microsoft.com/en-us/services/chaos-studio/?WT.mc_id=AZ-MVP-5004796",children:"Azure Chaos Studio"})," allows you to put pressure and, in some cases, take down your services to teach you how your services will react under strain and identity areas of improvement as resiliency and scalability to improve your systems."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Chaos",src:n(20436).A+"",title:"Chaos",width:"2400",height:"700"})}),"\n",(0,t.jsxs)(s.p,{children:["Azure Chaos Studio ",(0,t.jsx)(s.em,{children:"(currently in Preview and only supported in several"})," ",(0,t.jsx)(s.a,{href:"https://azure.microsoft.com/en-us/global-infrastructure/services/?products=chaos-studio&WT.mc_id=AZ-MVP-5004796",children:(0,t.jsx)(s.em,{children:"regions"})}),(0,t.jsx)(s.em,{children:"now)"})," is an enabler for 'controlled Chaos' in the Microsoft Azure ecosystem. Using that same tool that Microsoft uses to test and improve their services \u2013 you can as well!"]}),"\n",(0,t.jsxs)(s.p,{children:["Chaos Studio works by creating Experiments ",(0,t.jsx)(s.em,{children:"(i.e., Faults/Capabilities)"})," that run against Targets ",(0,t.jsx)(s.em,{children:"(your resources, whether they are agent or service-based)"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"There are two types of methods you can use to target your resources:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Service-direct"}),"\n",(0,t.jsx)(s.li,{children:"Agent-based"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Service-direct is tied into the Azure fabric and puts pressure on your resources from outside them ",(0,t.jsx)(s.em,{children:"(i.e., supported on most resources that don't need agent-based, PaaS resources, such as Network Security Groups)."})," For example, a service-direct capability may be to add or remove a security rule from your network security group for faulty findings."]}),"\n",(0,t.jsx)(s.p,{children:"Agent-based relies on an agent installed; these are targeted at resources such as Virtual Machine and Virtual Machine scale sets; agent-based targets use a user-assigned managed identity to manage an agent on your virtual machines and wreak havoc by running capabilities such as stopping services and putting memory and disk pressure on your workloads."}),"\n",(0,t.jsxs)(s.p,{children:["Just a word of warning, before you proceed to allow Chaos to reign in your environment, make sure it is done out of hours or, better yet \u2013 against development or test resources, also make sure that any resources that support autoscaling are disabled \u2013 or you might suddenly find ten more instances of that resource you were running ",(0,t.jsx)(s.em,{children:"(unless of course you're testing that autoscaling is working)"}),"! \ud83d\ude0a"]}),"\n",(0,t.jsx)(s.p,{children:"In my test setup, I have the following already pre-created that I will be running my experiments against:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Virtual Machine Scale set ",(0,t.jsx)(s.em,{children:"(running Windows with two instances)"})]}),"\n",(0,t.jsxs)(s.li,{children:["Single Virtual Machine ",(0,t.jsx)(s.em,{children:"(running Windows)"})," to test shutdown against"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["The currently supported resource types of Azure Chaos Studio can be found '",(0,t.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/azure/chaos-studio/chaos-studio-fault-providers?WT.mc_id=AZ-MVP-5004796",children:"here"}),"'."]}),"\n",(0,t.jsx)(s.h3,{id:"setup-azure-chaos-studio",children:"Setup Azure Chaos Studio"}),"\n",(0,t.jsx)(s.h4,{id:"create-managed-identity",children:"Create Managed Identity"}),"\n",(0,t.jsx)(s.p,{children:"Because we will use Agent-based capabilities to generate our Faults, I needed to create a Managed Identity to give Chaos Studio the ability to wreak havoc on my resources!"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["In the ",(0,t.jsx)(s.strong,{children:"Azure Portal,"})," search for ",(0,t.jsx)(s.a,{href:"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.ManagedIdentity%2FuserAssignedIdentities",children:(0,t.jsx)(s.strong,{children:"Managed Identities"})})]}),"\n",(0,t.jsxs)(s.li,{children:["Click on ",(0,t.jsx)(s.strong,{children:"Create"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," the ",(0,t.jsx)(s.strong,{children:"subscrSubscription"}),"ng the resources that you want to test against"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," your ",(0,t.jsx)(s.strong,{children:"Resource Group"})," to place the managed identity in (",(0,t.jsx)(s.em,{children:"I suggest creating a new Resource Group, as your Chaos experiments may have a different lifecycle than your resources, but it's just a preference, I will be placing mine in the Chaos Studio resource group so I can quickly delete it later)"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," the ",(0,t.jsx)(s.strong,{children:"RegionRegion"}),"ur resources"]}),"\n",(0,t.jsxs)(s.li,{children:["Type in a ",(0,t.jsx)(s.strong,{children:"name"})," (",(0,t.jsx)(s.em,{children:"this will be the identity that you will see in logs running these experiments, so make sure its something you can identify with)"})]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Portal - Create User Management Identity",src:n(25988).A+"",title:"Azure Portal - Create User Management Identity",width:"602",height:"347"})}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Next: Tags"})]}),"\n",(0,t.jsxs)(s.li,{children:["Make sure you enter appropriate tags to make sure that the resource can be identified and tracked, and click ",(0,t.jsx)(s.strong,{children:"Review + Create"})]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Portal Tags",src:n(49671).A+"",title:"Azure Portal Tags",width:"602",height:"238"})}),"\n",(0,t.jsxs)(s.li,{children:["Verify that everything looks good and click ",(0,t.jsx)(s.strong,{children:"Create"})," to create your User Assigned Managed identity."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"create-application-insights",children:"Create Application Insights"}),"\n",(0,t.jsx)(s.p,{children:"Now, it's time to create an Application Insights resource. Applications Insights is for the logs of the experiments to go into, so you can see the faults and their behaviours."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["In the ",(0,t.jsx)(s.strong,{children:"Azure Portal"}),", search for ",(0,t.jsx)(s.a,{href:"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.insights%2Fcomponents",children:(0,t.jsx)(s.strong,{children:"Application Insights"})})]}),"\n",(0,t.jsxs)(s.li,{children:["Click on ",(0,t.jsx)(s.strong,{children:"Create"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," the ",(0,t.jsx)(s.strong,{children:"Subscription"})," the resources that you want to test against"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," your ",(0,t.jsx)(s.strong,{children:"Resource Group"})," to place the Application Insights resource into (",(0,t.jsx)(s.em,{children:"I suggest creating a new Resource Group, as your Chaos experiments may have a different lifecycle than your resources, but it's just a preference, I will be placing mine in the Chaos Studio resource group so I can easily delete it later)"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," the ",(0,t.jsx)(s.strong,{children:"Region"})," the resources are in"]}),"\n",(0,t.jsxs)(s.li,{children:["Type in a ",(0,t.jsx)(s.strong,{children:"name"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," your ",(0,t.jsx)(s.strong,{children:"Log Analytics workspace"})," you want to link Application Insights to ",(0,t.jsx)(s.em,{children:"(if you don't have a Log Analytics workspace, you can create one '"}),(0,t.jsx)(s.a,{href:"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.OperationalInsights%2Fworkspaces",children:(0,t.jsx)(s.em,{children:"here"})}),(0,t.jsx)(s.em,{children:"')"}),"."]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Portal - Application Insights",src:n(99485).A+"",title:"Azure Portal - Application Insightsv",width:"602",height:"520"})}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Tags"})]}),"\n",(0,t.jsxs)(s.li,{children:["Make sure you ",(0,t.jsx)(s.strong,{children:"enter appropriate tags"})," to make sure that the resource can be identified and tracked, and click ",(0,t.jsx)(s.strong,{children:"Review + Create"})]}),"\n",(0,t.jsxs)(s.li,{children:["Verify that everything looks good and click ",(0,t.jsx)(s.strong,{children:"Create"})," to create your Application Insights."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"setup-chaos-studio-targets",children:"Setup Chaos Studio Targets"}),"\n",(0,t.jsx)(s.p,{children:"It is now time to add the resources targets to Chaos Studio"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["In the ",(0,t.jsx)(s.strong,{children:"Azure Portal"}),", search for ",(0,t.jsx)(s.a,{href:"https://portal.azure.com/#blade/Microsoft_Azure_Chaos/ChaosStudioMenuBlade/overview",children:(0,t.jsx)(s.strong,{children:"Chaos Studio"})})]}),"\n",(0,t.jsxs)(s.li,{children:["On the left band side Blade, select ",(0,t.jsx)(s.strong,{children:"Targets"})]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos Studio",src:n(21793).A+"",title:"Azure Chaos Studio",width:"602",height:"125"})}),"\n",(0,t.jsx)(s.li,{children:"As you can see, I have a Virtual Machine Scale Set and a front-end Network Security Group."}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," the ",(0,t.jsx)(s.strong,{children:"checkbox"})," next to Name to ",(0,t.jsx)(s.strong,{children:"select all"})," the Resources"]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Enable Targets"})]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos Studio",src:n(31348).A+"",title:"Azure Chaos Studio",width:"602",height:"106"})}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Enable service-direct targets (All resources)"})]}),"\n",(0,t.jsx)(s.li,{children:"Enabling the service-direct targets will then add the capabilities supported by Service-direct targets into Chaos Studio for you to use."}),"\n",(0,t.jsxs)(s.li,{children:["Once completed, I will ",(0,t.jsx)(s.strong,{children:"select"})," the scale set and click ",(0,t.jsx)(s.strong,{children:"Enable Target"})]}),"\n",(0,t.jsxs)(s.li,{children:["Then finally, ",(0,t.jsx)(s.strong,{children:"Enable agent-based targets (VM, VMSS)"})]}),"\n",(0,t.jsx)(s.li,{children:"This is where you link the user-managed identity, and Application Insights created earlier"}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," your ",(0,t.jsx)(s.strong,{children:"Subscription"})]}),"\n",(0,t.jsxs)(s.li,{children:["Select your ",(0,t.jsx)(s.strong,{children:"managed identity"})]}),"\n",(0,t.jsx)(s.li,{children:"Select Enabled for Application Insights and select your Application Insights account. The instrumentation key should be selected manually."}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos Studio - Enable targets",src:n(52162).A+"",title:"Azure Chaos Studio - Enable targets",width:"602",height:"584"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.em,{children:"If your instrumentation key isn't filled in, you can find it on the Overview pane of the Application Insights resource."})}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Review + Enable"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Review"})," the ",(0,t.jsx)(s.strong,{children:"resources"})," you want to enable Chaos Studio to target and select ",(0,t.jsx)(s.strong,{children:"Enable"})]}),"\n",(0,t.jsxs)(s.li,{children:["Finally, you should now be back at the Targets pane make sure you select Manage actions and make sure that all actions are ticked and click ",(0,t.jsx)(s.strong,{children:"Save"})]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos Studio Capabilities",src:n(160).A+"",title:"Azure Chaos Studio Capabilities",width:"829",height:"679"})}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"configure-and-run-azure-chaos-studio",children:"Configure and run Azure Chaos Studio"}),"\n",(0,t.jsx)(s.h4,{id:"action-exclusions",children:"Action exclusions"}),"\n",(0,t.jsx)(s.p,{children:"There may be actions that you don't want to be run against specific resources; an example might be you don't want anyone to kill any processes on a Virtual Machine."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["In the Target pane of Chaos Studio, select ",(0,t.jsx)(s.strong,{children:"Actions"})," next to the resource"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Unselect"})," the ",(0,t.jsx)(s.strong,{children:"capability"})," you don't want to run on that resource"]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Save"})]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos Studio Actions",src:n(88197).A+"",title:"Azure Chaos Studio - Enable targets",width:"602",height:"641"})}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"configure-experiments",children:"Configure Experiments"}),"\n",(0,t.jsx)(s.p,{children:"An experiment is a collection of capabilities to create faults, put pressure on your resources, and cause Chaos that will run against your target resources. These experiments are saved so you can run them multiple times and edit them later, although currently, you cannot reassign the same experiments to other resources."}),"\n",(0,t.jsx)(s.p,{children:"Note: If you name an Experiment the same as another experiment, it will replace the older Experiment with your new one and retain the previous history."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["In the ",(0,t.jsx)(s.strong,{children:"Azure Portal,"})," search for ",(0,t.jsx)(s.a,{href:"https://portal.azure.com/#blade/Microsoft_Azure_Chaos/ChaosStudioMenuBlade/overview",children:(0,t.jsx)(s.strong,{children:"Chaos Studio"})}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["On the left band side Blade, select ",(0,t.jsx)(s.strong,{children:"Experiments"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"+ Create"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," your ",(0,t.jsx)(s.strong,{children:"Subscription"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," your ",(0,t.jsx)(s.strong,{children:"Resource Group"})," to save the Experiment into"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Type"})," in a ",(0,t.jsx)(s.strong,{children:"name"})," for your ",(0,t.jsx)(s.strong,{children:"Experiment"})," that makes sense; in this case, we will put some Memory pressure on the VM scale set."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," your ",(0,t.jsx)(s.strong,{children:"Region"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Next: Experiment Designer"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Using"})," Experiment ",(0,t.jsx)(s.strong,{children:"Designer"}),", you can ",(0,t.jsx)(s.strong,{children:"design"})," your ",(0,t.jsx)(s.strong,{children:"Faults"}),"; you can have multiple capabilities hit a resource with expected delays, ",(0,t.jsx)(s.em,{children:"i.e., you can have Memory pressure on a VM for 10 minutes, then CPU pressure, then shutdown."})]}),"\n",(0,t.jsxs)(s.li,{children:["We are going to select ",(0,t.jsx)(s.strong,{children:"Add Action"})]}),"\n",(0,t.jsxs)(s.li,{children:["Then ",(0,t.jsx)(s.strong,{children:"Add Fault"})]}),"\n",(0,t.jsxs)(s.li,{children:["I am going to select ",(0,t.jsx)(s.strong,{children:"Physical Memory"})," pressure"]}),"\n",(0,t.jsxs)(s.li,{children:["Leave the duration to ",(0,t.jsx)(s.strong,{children:"10 minutes"})]}),"\n",(0,t.jsxs)(s.li,{children:["Because this will go against my VM scale set, I will add in the instances I want to target ",(0,t.jsx)(s.em,{children:"(if you aren't targeting a VM Scale set, you can leave this blank, you can find the instance ID by going to your VM Scale set click on Instances, click on the VM instance you want to target and you should see the Instance ID in the Overview pane)"})]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos Studio - Add fault",src:n(44537).A+"",title:"Azure Chaos Studio - Add fault",width:"602",height:"441"})}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Next: Target resources"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," your ",(0,t.jsx)(s.strong,{children:"resources"})," ",(0,t.jsx)(s.em,{children:"(you will notice as this is an Agent-based capability, only agent supported resources are listed)"})]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Add"})]}),"\n",(0,t.jsxs)(s.li,{children:["I am then going to ",(0,t.jsx)(s.strong,{children:"Add delay for 5 Minutes"})]}),"\n",(0,t.jsxs)(s.li,{children:["Then add an ",(0,t.jsx)(s.strong,{children:"abrupt VM shutdown"})," for 10 minutes ",(0,t.jsx)(s.em,{children:"(Chaos Studio will automatically restart the VM after the 10-minute duration)"}),"."]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos Studio create experiment",src:n(50223).A+"",title:"Azure Chaos Studio create experiment",width:"602",height:"266"})}),"\n",(0,t.jsxs)(s.li,{children:["As you can see with the Branches ",(0,t.jsx)(s.em,{children:"(items that will run in parallel)"})," and actions, you can have multiple faults running at once in parallel by using branches or one after the other sequentially."]}),"\n",(0,t.jsxs)(s.li,{children:["Now that we are ready with our faulty, we are going to click ",(0,t.jsx)(s.strong,{children:"Review + Create"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Create"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.em,{children:"Note: I had an API error; after some investigation, I found it was having problems with the '?' in my experiment name, so I removed it and continued to create the Experiment."})}),"\n",(0,t.jsx)(s.h4,{id:"assign-permissions-for-the-experiments",children:"Assign permissions for the Experiments"}),"\n",(0,t.jsxs)(s.p,{children:["Now that the Experiment has been created, we need to give rights to the Managed User account created earlier ",(0,t.jsx)(s.em,{children:"(and/or the System managed identity that was created when the Experiment was created for service-direct experiments)"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["I will assign permissions to the Resource Group that the VM Scale set exists in, but you might be better off applying the rights to the individual resource for more granular control. You can see suggested roles to give resources: ",(0,t.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/azure/chaos-studio/chaos-studio-fault-providers?WT.mc_id=AZ-MVP-5004796",children:"Supported resource types and role assignments for the Chaos Studio"})," Microsoft page."]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["In the ",(0,t.jsx)(s.strong,{children:"Azure Portal"}),", click on the ",(0,t.jsx)(s.strong,{children:"Resource Group"})," containing the resources you want to run the Experiment against"]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Access control (IAM)"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"+ Add"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Add Role Assignment"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Reader"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Next"})]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Assign access to Managed identity"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click on ",(0,t.jsx)(s.strong,{children:"+ Select Members"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Select"})," the ",(0,t.jsx)(s.strong,{children:"User"})," assigned ",(0,t.jsx)(s.strong,{children:"management identity"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Review"})," and ",(0,t.jsx)(s.strong,{children:"assign"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["Because the shutdown is a service-direct, ",(0,t.jsx)(s.strong,{children:"go back and give the experiment system managed identity Virtual Machine Contributor rights"}),", so it has access to shutdown the VM."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"run-experiments",children:"Run Experiments"}),"\n",(0,t.jsx)(s.p,{children:"Now that the Experiment has been created, it should appear as a resource in the resource group you selected earlier; if you open it, you can see the Experiment's History, Start, and Edit buttons."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Start"})]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos studio - Run experiment",src:n(67228).A+"",title:"Azure Chaos studio - Run experiment",width:"602",height:"145"})}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Ok"})," to ",(0,t.jsx)(s.strong,{children:"start"})," the ",(0,t.jsx)(s.strong,{children:"Experiment"})," ",(0,t.jsx)(s.em,{children:"(and place it into the queue)"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Click"})," on ",(0,t.jsx)(s.strong,{children:"Details"})," to see the ",(0,t.jsx)(s.strong,{children:"experiment progress"})," ",(0,t.jsx)(s.em,{children:"(and any errors)"}),", and if it fails one part, it may move to the next step depending on the fault."]}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.img,{alt:"Azure Chaos studio - Run experiment",src:n(47365).A+"",title:"Azure Chaos studio - Run experiment",width:"602",height:"346"})}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Azure Chaos studio should now run rampant and do best \u2013 cause Chaos"}),"!"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["This service is still currently in Preview. If you have any issues, take a look at the: ",(0,t.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/azure/chaos-studio/troubleshooting",children:"Troubleshoot issues with Azure Chaos Studio"}),"."]}),"\n",(0,t.jsx)(s.h3,{id:"monitor-and-auditing-of-azure-chaos-studio",children:"Monitor and Auditing of Azure Chaos Studio"}),"\n",(0,t.jsx)(s.p,{children:"Now that Azure Chaos Studio is in use by your organization, you may want to know what auditing is available, along with reporting to Application Insights."}),"\n",(0,t.jsx)(s.h4,{id:"azure-activity-log",children:"Azure Activity Log"}),"\n",(0,t.jsx)(s.p,{children:"When an Azure Chaos Studio experiment has touched a resource, there will be an audit trail in the Azure activity log of that resource; here, you can see that 'WhatMemory', which is the Name of my Chaos Experiment, has successfully powered off and on my VM."}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Azure Activity Log - Azure Chaos Studio",src:n(68864).A+"",title:"Azure Activity Log - Azure Chaos Studio",width:"602",height:"56"})}),"\n",(0,t.jsx)(s.h4,{id:"azure-alerts",children:"Azure Alerts"}),"\n",(0,t.jsx)(s.p,{children:"It is easy to set up alerts when a Chaos experiment kicks off; to create an Azure, do the following."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["In the ",(0,t.jsx)(s.strong,{children:"Azure Portal"}),", click on ",(0,t.jsx)(s.strong,{children:"Azure Monito"}),"r"]}),"\n",(0,t.jsxs)(s.li,{children:["Click on ",(0,t.jsx)(s.strong,{children:"Alerts"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"+ Create"})]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Alert Rule"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Create resource"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Filter"})," your resource ",(0,t.jsx)(s.strong,{children:"type"})," to ",(0,t.jsx)(s.strong,{children:"Chaos Experiments"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Filter"})," your ",(0,t.jsx)(s.strong,{children:"alert"})," to ",(0,t.jsx)(s.strong,{children:"Subscription"})," and click ",(0,t.jsx)(s.strong,{children:"Done"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Add Condition"})]}),"\n",(0,t.jsxs)(s.li,{children:["Select: ",(0,t.jsx)(s.strong,{children:"Starts a Chaos Experiment"})]}),"\n",(0,t.jsxs)(s.li,{children:["Make sure that: *",(0,t.jsx)(s.em,{children:"Event initiated by is set to (All services and users)"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Done"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Add Action Group"})]}),"\n",(0,t.jsxs)(s.li,{children:["If you have one, ",(0,t.jsx)(s.strong,{children:"assign"})," an ",(0,t.jsx)(s.strong,{children:"action group"})," ",(0,t.jsx)(s.em,{children:"(these are who and how the alerts will get to you)"}),". If you don't have one, click: ",(0,t.jsx)(s.strong,{children:"+ Create an action group"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Specify"})," a resource ",(0,t.jsx)(s.strong,{children:"group"})," to hold your action groups ",(0,t.jsx)(s.em,{children:"(usually a monitor or management resource group)"})]}),"\n",(0,t.jsxs)(s.li,{children:["Type the ",(0,t.jsx)(s.strong,{children:"Action Group name"})]}),"\n",(0,t.jsxs)(s.li,{children:["Type the ",(0,t.jsx)(s.strong,{children:"Action group Display name"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Next: Notifications"})]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Notification Type"})]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"email"})]}),"\n",(0,t.jsxs)(s.li,{children:["Select ",(0,t.jsx)(s.strong,{children:"Email"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Type"})," in your ",(0,t.jsx)(s.strong,{children:"email"})," address to be notified"]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"ok"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Type"})," in the ",(0,t.jsx)(s.strong,{children:"Name"})," of the ",(0,t.jsx)(s.strong,{children:"mail"})," to be a reference in the future ",(0,t.jsx)(s.em,{children:"(i.e. Help Desk)"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Review + Create"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Create"})," to create your Action group"]}),"\n",(0,t.jsxs)(s.li,{children:["Type in your ",(0,t.jsx)(s.strong,{children:"rule name"})," ",(0,t.jsx)(s.em,{children:"(i.e. Alert \u2013 Chaos Experiment \u2013 Started)"})]}),"\n",(0,t.jsxs)(s.li,{children:["Type in a ",(0,t.jsx)(s.strong,{children:"description"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Specify"})," the ",(0,t.jsx)(s.strong,{children:"resource group"})," to place the alert in ",(0,t.jsx)(s.em,{children:"(again, usually a monitor or management resource group)"})]}),"\n",(0,t.jsxs)(s.li,{children:["Check ",(0,t.jsx)(s.strong,{children:"Enable alert rule on creation"})]}),"\n",(0,t.jsxs)(s.li,{children:["Click ",(0,t.jsx)(s.strong,{children:"Create alert rule"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.em,{children:"Note: Activity Log alerts are hidden types; they are not shown in the resource group by default, but if you check the: Show hidden types box, they will appear."})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Azure Activity Log - Azure Chaos Studio",src:n(2745).A+"",title:"Azure Activity Log - Azure Chaos Studio",width:"602",height:"48"})})]})}function d(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},20436:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/chaosengineering-banner-0929ef3aa12bf5e4832160ff75a00b4b.png"},99485:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_applicationinsights-c4676bae524a9a2cafbeaa8ed778cc01.png"},68864:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_activitylog-27476f7626f821f811db0174c941c034.png"},2745:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_alert-9d90704feb648ce05039987b32de9c97.png"},44537:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_createexperimentaddfault-f6ff8fd1cfc8dab21fb1bcb99813e20d.png"},50223:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_createexperimentaddfault2-ab12282d4c3801eb941de223ee7bc627.png"},52162:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_enableagenttargets-620b1ddfd69c44193fff354eaca7ceb8.png"},88197:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_manageactions-5786b1de8eca578ccac4c06c5e680398.png"},21793:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_targets-989d1638d9ab55b2a648197eb570d72f.png"},31348:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_targets2-52ce0a064e8a54465447a2997047630b.png"},67228:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_whatmemory-09151c403439e67c1de46401589b3418.png"},47365:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_chaosstudio_whatmemoryrun-1bac1d245af3399c523a6792dea66041.png"},25988:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azure_userassignedmanageidentity-8f2cdc8b86ee1f35091c9270a3061f5a.png"},160:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azurechaosactions-1af7db09581d9982ae10818aa1075db4.png"},49671:(e,s,n)=>{n.d(s,{A:()=>t});const t=n.p+"assets/images/azuretags_chaos-3882e50f463cdfc7bb84fb50a0845993.png"},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>a});var t=n(96540);const i={},r=t.createContext(i);function o(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);
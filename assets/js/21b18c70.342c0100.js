"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[81461],{36644:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});var i=n(90910),r=n(74848),t=n(28453);const o={date:"2021-06-29 00:00:00 +1200",title:"How to setup FSLogix profiles for Azure Virtual Desktop",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"images/iazure-marketplace-banner.png"},slug:"azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop"},l=void 0,c={authorsImageUrls:[void 0]},a=[{value:"Setup Storage Account",id:"setup-storage-account",level:3},{value:"Configure Storage Account",id:"configure-storage-account",level:3},{value:"Configure File Share",id:"configure-file-share",level:3},{value:"Configure FSLogix policies",id:"configure-fslogix-policies",level:3}];function d(e){const s={a:"a",br:"br",code:"code",em:"em",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:["If you have a few Azure Virtual Desktop machines, you need some way to keep user persistence's and application customisations, which would usually be stored in the user profile locally across multiple machines ",(0,r.jsx)(s.em,{children:"(or even the same machine if using Ephemeral OS)"}),", this is where FSLogix Profile Containers can assist."]}),"\n",(0,r.jsx)(s.p,{children:"We are going to implement FSLogix using an Azure File Share, to store the profiles."}),"\n",(0,r.jsxs)(s.p,{children:["I am going to assume you already have an Azure Virtual Desktop farm ",(0,r.jsx)(s.em,{children:"(and Azure ADDS)"}),", if not you can check out my guide ",(0,r.jsx)(s.a,{href:"https://luke.geek.nz/azure/create-a-azure-virtual-desktop-farm/",title:"How to create a Azure Virtual Desktop farm ",children:"here"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"This article will be based on the Azure Virtual Desktop farm created in a previous article, however, you can just still along and replace the resource names and groups with your own."}),"\n",(0,r.jsx)(s.h3,{id:"setup-storage-account",children:"Setup Storage Account"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["Log in to the ",(0,r.jsx)(s.strong,{children:"Azure Portal"})]}),"\n",(0,r.jsxs)(s.li,{children:["Click on ",(0,r.jsx)(s.strong,{children:"Create a resource"})]}),"\n",(0,r.jsxs)(s.li,{children:["Type in ",(0,r.jsx)(s.strong,{children:"Storage Account"})," and press Enter to search"]}),"\n",(0,r.jsx)(s.li,{children:"Select Storage account"}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Azure Storage Account",src:n(12094).A+"",title:"FSLogix - Azure Storage Account",width:"998",height:"360"})}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsx)(s.strong,{children:"Create"})]}),"\n",(0,r.jsxs)(s.li,{children:["If you already have a Resource Group, then ",(0,r.jsx)(s.strong,{children:"select"})," it, if not you can create a new ",(0,r.jsx)(s.strong,{children:"resource group"}),". I am going to put my resources user profiles in the same resource group as my utility server: aad_infra ",(0,r.jsx)(s.em,{children:"(this is just personal preference, keeping the session hosts in their own resource groups)"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Type in"})," a Storage ",(0,r.jsx)(s.strong,{children:"Account Name"})," ",(0,r.jsx)(s.em,{children:"(the name needs to be globally unique across all of Azure, the field can contain only lowercase letters and numbers. Name must be between 3 and 24 characters.)"}),", in my case I have gone with: fslogixprofileslgnz."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Select"})," your ",(0,r.jsx)(s.strong,{children:"Region"})," ",(0,r.jsx)(s.em,{children:"(the same region you have your Azure Virtual Desktop session hosts and Virtual Network)"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Select"})," Standard ",(0,r.jsx)(s.strong,{children:"performance"})," ",(0,r.jsx)(s.em,{children:"(Microsoft have recommendations, based on users on what Tier to select -"})," ",(0,r.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-desktop/store-fslogix-profile?WT.mc_id=AZ-MVP-5004796",title:"https://learn.microsoft.com/en-us/azure/virtual-desktop/store-fslogix-profile?WT.mc_id=AZ-MVP-5004796",children:(0,r.jsx)(s.em,{children:"https://learn.microsoft.com/en-us/azure/virtual-desktop/store-fslogix-profile"})}),(0,r.jsx)(s.em,{children:")"})]}),"\n",(0,r.jsxs)(s.li,{children:["For Redundancy, I am going to ",(0,r.jsx)(s.strong,{children:"select LRS"})," storage ",(0,r.jsx)(s.em,{children:"(I haven't built have any redundancy in my Azure Virtual Desktop farm)"}),"."]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.em,{children:"Note: Just a heads up, don't select Geo-Redundant if you are looking to create File Shares on this Storage account over 100TiB, it is only supported in LRS. If you do need this kind of large file size, I recommend using a completely different storage account from the one you are using for user profiles. My screenshot below has GRS, just ignore it!"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Azure Storage Account",src:n(54324).A+"",title:"FSLogix - Azure Storage Account",width:"769",height:"552"})}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsx)(s.strong,{children:"Next: Advanced"})]}),"\n",(0,r.jsxs)(s.li,{children:["Leave everything as default and ",(0,r.jsx)(s.strong,{children:"select Next: Networking"})]}),"\n",(0,r.jsx)(s.li,{children:"Now we need to configure a Private Endpoint for the Azure storage account to add onto the Virtual Network directly."}),"\n",(0,r.jsxs)(s.li,{children:["Select ",(0,r.jsx)(s.strong,{children:"Private endpoint"})," and click ",(0,r.jsx)(s.strong,{children:"+ Add Private endpoint"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Verify"})," that your ",(0,r.jsx)(s.strong,{children:"Location"})," is ",(0,r.jsx)(s.strong,{children:"correct"})," and ",(0,r.jsx)(s.strong,{children:"type"})," in a ",(0,r.jsx)(s.strong,{children:"Name for"})," your ",(0,r.jsx)(s.strong,{children:"Private Endpoint"})," service, in my case: fslogixprofileslgnzPE"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Select"})," the drop-down for ",(0,r.jsx)(s.strong,{children:"Storage sub-resource"})," and select ",(0,r.jsx)(s.strong,{children:"file"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Select"})," your ",(0,r.jsx)(s.strong,{children:"Virtual Network"})," and ",(0,r.jsx)(s.strong,{children:"subnet"})," ",(0,r.jsx)(s.em,{children:"(I will be selecting my main resource subnet of aadds-subnet, where the Azure Virtual Desktop hosts are)"})]}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsx)(s.strong,{children:"Ok"})]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Azure Storage Account",src:n(24961).A+"",title:"FSLogix - Azure Storage Account",width:"1671",height:"717"})}),"\n",(0,r.jsxs)(s.li,{children:["Select ",(0,r.jsx)(s.strong,{children:"Next: Data Protection"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Untick"})," the ",(0,r.jsx)(s.strong,{children:"Enable soft delete for Blogs and Container's"})," ",(0,r.jsx)(s.em,{children:"(we will only be using Azure Files in this storage account)"})]}),"\n",(0,r.jsx)(s.li,{children:"Soft delete allows you to quickly recover a deleted file-share, even though we can backup the Azure Fileshare, my recommendation would be to leave this on for additional protection and '7' days is enough for me."}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Azure Storage Account",src:n(23850).A+"",title:"FSLogix - Azure Storage Account",width:"753",height:"689"})}),"\n",(0,r.jsxs)(s.li,{children:["Select ",(0,r.jsx)(s.strong,{children:"Review + Create"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Validate"})," your ",(0,r.jsx)(s.strong,{children:"configuration"})," and select ",(0,r.jsx)(s.strong,{children:"Create"})]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"configure-storage-account",children:"Configure Storage Account"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Once your storage account has been created, go to it."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Navigate down the left-hand side Blade and select: ",(0,r.jsx)(s.strong,{children:"Networking"})]}),"\n",(0,r.jsx)(s.p,{children:"Make sure: Selected networks are selected and the Private Endpoint connection is displaying."}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Azure Storage Account",src:n(96656).A+"",title:"FSLogix - Azure Storage Account",width:"653",height:"310"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Azure Storage Account",src:n(31091).A+"",title:"FSLogix - Azure Storage Account",width:"974",height:"191"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Now its time to join the Storage account to Microsoft Entra ID Domain Services, on the left-hand side Blade, click on ",(0,r.jsx)(s.strong,{children:"Configuration"})," ",(0,r.jsx)(s.em,{children:"(under Settings)"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Navigate to: ",(0,r.jsx)(s.strong,{children:"Identity-based access for file shares"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Select ",(0,r.jsx)(s.strong,{children:"Enabled"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Click ",(0,r.jsx)(s.strong,{children:"Save"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Azure Storage Account",src:n(29898).A+"",title:"FSLogix - Azure Storage Account",width:"632",height:"612"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Now its time to create the File Share, On the left-hand side Blade, navigate to ",(0,r.jsx)(s.strong,{children:"File Shares"})," (under Data Storage)"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Select ",(0,r.jsx)(s.strong,{children:"+ File Share"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Give this ",(0,r.jsx)(s.strong,{children:"File share"})," a ",(0,r.jsx)(s.strong,{children:"name"}),": fslogixprofiles"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Even though you don't need to have a Quota ",(0,r.jsx)(s.em,{children:"(the Fileshare will grow)"}),", I will add one in stop any surprises and make sure that I have an ongoing task to review and optimize the profiles"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Because user profiles are generally a lot of read/write activity, select ",(0,r.jsx)(s.strong,{children:"Transaction Optimized"})," ",(0,r.jsx)(s.em,{children:"(take a look at the"})," ",(0,r.jsx)(s.a,{href:"https://azure.microsoft.com/en-us/pricing/details/storage/files/?WT.mc_id=AZ-MVP-5004796",title:"https://azure.microsoft.com/en-us/pricing/details/storage/files/?WT.mc_id=AZ-MVP-5004796",children:(0,r.jsx)(s.em,{children:"https://azure.microsoft.com/en-us/pricing/details/storage/files/"})})," ",(0,r.jsx)(s.em,{children:")"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Click ",(0,r.jsx)(s.strong,{children:"Create"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - File Share",src:n(73626).A+"",title:"FSLogix - File Share",width:"295",height:"373"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["One last thing we can do on the Storage Account is ",(0,r.jsx)(s.strong,{children:"enable backups"})," for your ",(0,r.jsx)(s.strong,{children:"Azure File Share"})," - ",(0,r.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/azure/backup/backup-afs?WT.mc_id=AZ-MVP-5004796",title:"https://learn.microsoft.com/en-us/azure/backup/backup-afs?WT.mc_id=AZ-MVP-5004796",children:"https://learn.microsoft.com/en-us/azure/backup/backup-afs?WT.mc_id=AZ-MVP-5004796"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"configure-file-share",children:"Configure File Share"}),"\n",(0,r.jsx)(s.p,{children:"Now that the Microsoft Entra ID rights have been assigned and the File Share has been created, we now need to set up the NTFS permissions on the FSLogix share."}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Navigate to ",(0,r.jsx)(s.strong,{children:"File Shares"})," ",(0,r.jsx)(s.em,{children:"(under Data Storage)"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Click"})," on ",(0,r.jsx)(s.strong,{children:"your"})," file-",(0,r.jsx)(s.strong,{children:"share"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Click on ",(0,r.jsx)(s.strong,{children:"Properties"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Copy"})," the ",(0,r.jsx)(s.strong,{children:"URL"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - File Share",src:n(72199).A+"",title:"FSLogix - File Share",width:"761",height:"578"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Remove http"})," and replace the forward slashes with backslashes so it looks like this: \\\\fslogixprofileslgnz.file.core.windows.net\\fslogixprofiles"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Using"})," a ",(0,r.jsx)(s.strong,{children:"user"})," that is a ",(0,r.jsx)(s.strong,{children:"member of"})," the '",(0,r.jsx)(s.strong,{children:"AVD Admins'"})," group and can ",(0,r.jsx)(s.strong,{children:"log into"})," the ",(0,r.jsx)(s.strong,{children:"Azure Virtual Desktop"})," farm ",(0,r.jsx)(s.em,{children:"(it\u2019s a good chance to test connectivity to the Storage account through the private endpoint from your Azure Virtual Desktop session host)"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Open ",(0,r.jsx)(s.strong,{children:"Computer"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Select the Computer Tab and select ",(0,r.jsx)(s.strong,{children:"Map network drive"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Mapped Drive",src:n(96782).A+"",title:"FSLogix - Mapped Drive",width:"420",height:"184"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Select a drive letter"})," that isn't in use and paste in the ",(0,r.jsx)(s.strong,{children:"UNC path"})," created earlier ",(0,r.jsx)(s.em,{children:"(step 6)"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Mapped Drive",src:n(35495).A+"",title:"FSLogix - Mapped Drive",width:"522",height:"264"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Hopefully, you should ",(0,r.jsx)(s.strong,{children:"successfully"})," have ",(0,r.jsx)(s.strong,{children:"mapped"})," a ",(0,r.jsx)(s.strong,{children:"drive"}),"!"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Once the drive is mapped, ",(0,r.jsx)(s.strong,{children:"open"})," up a ",(0,r.jsx)(s.strong,{children:"Command Prompt"})]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:"Note: Don't run the Command Prompt as Administrator, as this runs in a separate context and doesn't have permissions to the mapped drive."})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Run"})," the ",(0,r.jsx)(s.strong,{children:"following command"})," to ",(0,r.jsx)(s.strong,{children:"set"})," the necessary ",(0,r.jsx)(s.strong,{children:"NTFS permissions"})," ",(0,r.jsx)(s.em,{children:"(change the Drive mapping and AVD Users group to your own group)"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:'icacls z: /grant "AVD Users":(M)\n\nicacls z: /grant "Creator Owner":(OI)(CI)(IO)(M)\n\nicacls z: /remove "Authenticated Users"\n\nicacls z: /remove "Builtin\\Users"\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Security Permissions",src:n(16398).A+"",title:"FSLogix - Security Permissions",width:"932",height:"473"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"The permissions should look similar to:"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Security Permissions",src:n(17534).A+"",title:"FSLogix - Security Permissions",width:"729",height:"218"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"configure-fslogix-policies",children:"Configure FSLogix policies"}),"\n",(0,r.jsx)(s.p,{children:"Now that you have successfully created a Storage Account and granted it the proper permissions, we now need to configure Group Policy for FSLogix."}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Connect to"})," your Microsoft Entra ID ",(0,r.jsx)(s.strong,{children:"Utility server"}),", that has ",(0,r.jsx)(s.strong,{children:"Group Policy management"})," installed using an account in the: AAD DC Administrators group"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Download"})," the latest ",(0,r.jsx)(s.strong,{children:"FSLogix Agent"})," - ",(0,r.jsx)(s.a,{href:"https://aka.ms/fslogix_download",title:"https://aka.ms/fslogix_download?WT.mc_id=AZ-MVP-5004796",children:"https://aka.ms/fslogix_download"})," onto the Utility server"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Extract"})," the FSLogix agent ",(0,r.jsx)(s.strong,{children:"zip"})," file to a folder"]}),"\n",(0,r.jsxs)(s.li,{children:["Now we will ",(0,r.jsx)(s.strong,{children:"create"})," a ",(0,r.jsx)(s.strong,{children:"Central Store"})," to manage the Group Policy consistently"]}),"\n",(0,r.jsxs)(s.li,{children:["On your Utility server, browse to ",(0,r.jsx)(s.strong,{children:"C:\\Windows"})," ",(0,r.jsx)(s.em,{children:"(If you are primarily using Azure Virtual Desktop, it may be best to copy the PolicyDefinitions folder from an Azure Virtual Desktop session host to make sure you can edit all the latest Windows 10 policies)"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Copy"})," the ",(0,r.jsx)(s.strong,{children:"PolicyDefinitions"})," folder"]}),"\n",(0,r.jsxs)(s.li,{children:["Copy ",(0,r.jsx)(s.strong,{children:"the PolicyDefinitions"})," folder to your ",(0,r.jsx)(s.strong,{children:"Policies"})," folder on your ",(0,r.jsx)(s.strong,{children:"domain"}),": \\luke.geek.nz\\SYSVOL\\luke.geek.nz\\Policies",(0,r.jsx)(s.br,{}),"\n",(0,r.jsx)(s.em,{children:"(replace luke.geek.nz, with your ADDS DNS name)"})]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Group Policy",src:n(8530).A+"",title:"FSLogix - Group Policy",width:"554",height:"230"})}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Go to"})," your ",(0,r.jsx)(s.strong,{children:"extracted"})," FSLogix ",(0,r.jsx)(s.strong,{children:"folder"})," and ",(0,r.jsx)(s.strong,{children:"copy"}),":\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"fslogix.admx to: \\luke.geek.nz\\SYSVOL\\luke.geek.nz\\Policies\\PolicyDefinitions\\"}),"\n",(0,r.jsx)(s.li,{children:"fslogix.adml to: \\luke.geek.nz\\SYSVOL\\luke.geek.nz\\Policies\\PolicyDefinitions\\en-US\\"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["This will allow us to use Group Policy to manage FSLogix using Group Policy, ",(0,r.jsx)(s.strong,{children:"Open Group Policy Management"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Navigate"})," to your ",(0,r.jsx)(s.strong,{children:"Hosts OU"})]}),"\n",(0,r.jsxs)(s.li,{children:["Right-click the OU and select: ",(0,r.jsx)(s.strong,{children:"Create a GPO in this domain, and Link it here\u2026"})]}),"\n",(0,r.jsx)(s.li,{children:"Name it according to your naming standards (this is a Computer-based policy) - in my example, I am using: AVD_ComputerPolicy"}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsx)(s.strong,{children:"Ok"})]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Group Policy",src:n(11595).A+"",title:"FSLogix - Group Policy",width:"580",height:"355"})}),"\n",(0,r.jsxs)(s.li,{children:["Right-click the GPO you have just created and select ",(0,r.jsx)(s.strong,{children:"Edit\u2026"})]}),"\n",(0,r.jsxs)(s.li,{children:["Because this is a Computer-based policy, to speed up processing, ",(0,r.jsx)(s.strong,{children:"right-click"})," the ",(0,r.jsx)(s.strong,{children:"Policy heading"})," and select ",(0,r.jsx)(s.strong,{children:"Properties"})]}),"\n",(0,r.jsxs)(s.li,{children:["Tick: ",(0,r.jsx)(s.strong,{children:"Disable User Configuration Settings"})]}),"\n",(0,r.jsxs)(s.li,{children:["Confirm that you want to do it and select ",(0,r.jsx)(s.strong,{children:"Yes"})]}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsx)(s.strong,{children:"Apply"})]}),"\n",(0,r.jsxs)(s.li,{children:["While you have the screen open, ",(0,r.jsx)(s.strong,{children:"click on"})," ",(0,r.jsx)(s.strong,{children:"Comment"}),", and ",(0,r.jsx)(s.strong,{children:"add"})," in some ",(0,r.jsx)(s.strong,{children:"details"})," about the GPO for future reference then click ",(0,r.jsx)(s.strong,{children:"Apply"})," and ",(0,r.jsx)(s.strong,{children:"Ok"})]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Group Policy",src:n(14062).A+"",title:"FSLogix - Group Policy",width:"799",height:"563"})}),"\n",(0,r.jsx)(s.li,{children:"Now it's time to actually configure the FSLogix Group Policy settings."}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Navigate"})," to: Computer Configuration\\Policies\\Administrative Templates\\FSLogix\\",(0,r.jsx)(s.strong,{children:"Profile Containers"})]}),"\n",(0,r.jsxs)(s.li,{children:["Open up ",(0,r.jsx)(s.strong,{children:"Enabled"})," and select: ",(0,r.jsx)(s.strong,{children:"Enabled"})," and ",(0,r.jsx)(s.strong,{children:"Apply"})]}),"\n",(0,r.jsxs)(s.li,{children:["Open: ",(0,r.jsx)(s.strong,{children:"VHD Location"})," and ",(0,r.jsx)(s.strong,{children:"copy"})," in your Profiles ",(0,r.jsx)(s.strong,{children:"UNC share"})," ",(0,r.jsx)(s.em,{children:"(for example, mine is:"})," [",(0,r.jsx)(s.em,{children:"\\\\fslogixprofileslgnz.file.core.windows.net\\fslogixprofiles)"})," click ",(0,r.jsx)(s.strong,{children:"Ok"})]}),"\n",(0,r.jsxs)(s.li,{children:["Select: ",(0,r.jsx)(s.strong,{children:"Delete local profile when FSLofix profile should apply"}),", click ",(0,r.jsx)(s.strong,{children:"Enabled"})," and check to ",(0,r.jsx)(s.strong,{children:"Delete local profile when FSLogix Profile should apply"})," ",(0,r.jsx)(s.em,{children:"(don't blindly follow this, I am making the assumption this is a new farm, with no user-based profile stored on it. You may need to create a separate GPO to test this setting on, or you could lose valuable data)"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Open: ",(0,r.jsx)(s.strong,{children:"Set Outlook cached mode on successful container attach"})," to ",(0,r.jsx)(s.strong,{children:"Enabled"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Now in Group Policy Management console, click on ",(0,r.jsx)(s.strong,{children:"Container and Directory Naming"})," and select ",(0,r.jsx)(s.strong,{children:"Virtual Disk type"})]}),"\n",(0,r.jsxs)(s.li,{children:["Click ",(0,r.jsx)(s.strong,{children:"Enabled"})," and change the Option to ",(0,r.jsx)(s.strong,{children:"VHDX"}),", click ",(0,r.jsx)(s.strong,{children:"Ok"})]}),"\n",(0,r.jsxs)(s.li,{children:["Click on: ",(0,r.jsx)(s.strong,{children:"Swap directory name components setting"})," and click ",(0,r.jsx)(s.strong,{children:"Enabled"}),", ",(0,r.jsx)(s.strong,{children:"check"})," the s",(0,r.jsx)(s.strong,{children:"wap directory name components"})," and click ",(0,r.jsx)(s.strong,{children:"Apply"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Restart"})," the Azure Virtual Desktop ",(0,r.jsx)(s.strong,{children:"session hosts"})," to pick up the new policies."]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.strong,{children:"You have now set up FSLogix profiles! If you map the drive you should see your user profile folders!"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.img,{alt:"FSLogix - Mapped Profiles",src:n(33799).A+"",title:"FSLogix - Mapped Profiles",width:"753",height:"346"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},96782:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/computermappeddrive-b6d4b059bbc60cae71cf413c53ed4a8b.png"},35495:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/computermappingdrive-643b7416f45e128e07e11d1d71ea851d.png"},33799:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/computermappingdrivelast-295af306bce86bb195f492335abb6f73.png"},14062:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/gpo_avd_computerpolicy-013e44a036919779c77128f2dd3be4be.png"},11595:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/gpo_management_createpolicy-7658db17732ed0748448c741dcba3244.png"},16398:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/setfslogixpermissions-68547b485f7bc90692b642b71edbde17.png"},17534:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/setfslogixpermissions2-f5d2a6470c03a6dc2c1fc2b73bd03eef.png"},12094:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount-2801dccd641138f94c83c89ae389a5c5.png"},29898:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount_adds_identity-fe967979aade968af246f28cd5978a5d.png"},96656:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount_firewalls-dd944f693e41a8503e0566839495faad.png"},72199:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount_fslogixprofiles-6e8f1169f72bacd246c5a3edf61c6729.png"},73626:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount_newfileshare-95f161154ef1674774aa4a9c41b98da5.png"},31091:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount_peapproved-6debcc29f48cc0a69fc6c792153764e8.png"},24961:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount_privateendpoint-57650fe4060dc07aa1150353bed7248f.png"},54324:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount_projectdetails-839ccecc467cdf1704c728f298727e9a.png"},23850:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/storageaccount_softdelete-f99ec396a4d126592b3bdd9cce89eedb.png"},8530:(e,s,n)=>{n.d(s,{A:()=>i});const i=n.p+"assets/images/sysvolpolicies-f5f02ecdb5e5547339c11eb39f2021b8.png"},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var i=n(96540);const r={},t=i.createContext(r);function o(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:s},e.children)}},90910:e=>{e.exports=JSON.parse('{"permalink":"/azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop","source":"@site/blog/2021-06-29-how-to-setup-fslogix-profiles-for-azure-virtual-desktop.md","title":"How to setup FSLogix profiles for Azure Virtual Desktop","description":"If you have a few Azure Virtual Desktop machines, you need some way to keep user persistence\'s and application customisations, which would usually be stored in the user profile locally across multiple machines (or even the same machine if using Ephemeral OS), this is where FSLogix Profile Containers can assist.","date":"2021-06-29T00:00:00.000Z","tags":[{"inline":true,"label":"Azure","permalink":"/tags/azure"}],"readingTime":8.4,"hasTruncateMarker":false,"authors":[{"name":"Luke Murray","title":"Author","url":"https://luke.geek.nz","imageURL":"https://luke.geek.nz/img/logo.png","key":"Luke","page":null}],"frontMatter":{"date":"2021-06-29 00:00:00 +1200","title":"How to setup FSLogix profiles for Azure Virtual Desktop","authors":["Luke"],"tags":["Azure"],"toc":true,"header":{"teaser":"images/iazure-marketplace-banner.png"},"slug":"azure/how-to-setup-fslogix-profiles-for-azure-virtual-desktop"},"unlisted":false,"prevItem":{"title":"Azure Virtual Desktop Optimisations","permalink":"/azure/Azure-Virtual-Desktop-Optimisations"},"nextItem":{"title":"No Available Resources Error when attempting to connect to Azure Virtual Desktop","permalink":"/azure/no-available-resources-error-when-connecting-to-azure-virtual-desktop"}}')}}]);
"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[70761],{10387:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var s=n(94732),r=n(74848),i=n(28453);const a={title:"Scan Your Kubernetes Cluster with KubeBuddy",metaDescription:"Scan your AKS cluster with KubeBuddy to detect hidden issues and generate actionable reports for better operations.",tags:["Azure","Misc"],categories:["Misc"],authors:["Luke"],slug:"azure/kubebuddy-scanning-clusters",keywords:["Azure","Kubernetes","AKS","KubeBuddy","Cluster Scanning","Kubernetes Diagnostics","Cluster Health","PowerShell"],description:"Scan your AKS cluster with KubeBuddy to detect issues and generate actionable reports for better operations.",date:new Date("2025-05-07T21:47:58.518Z")},o=void 0,u={authorsImageUrls:[void 0]},d=[{value:"Overview",id:"overview",level:2},{value:"\u2699\ufe0f Connect &amp; Scan",id:"\ufe0f-connect--scan",level:2},{value:"\ud83d\udcc8 Deliver Insights",id:"-deliver-insights",level:2},{value:"\ud83d\udd0e Analyze Issues",id:"-analyze-issues",level:2}];function l(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["Today, we will look at ",(0,r.jsx)(t.a,{href:"https://kubebuddy.kubedeck.io/",children:"KubeBuddy"}),"."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"KubeBuddy Logo",src:n(91543).A+"",width:"3600",height:"804"})}),"\n",(0,r.jsx)(t.p,{children:"The tag line of KubeBuddy is:"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"Kubernetes says your cluster is healthy. It\u2019s probably not."}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(t.p,{children:["Developed by Microsoft Azure MVP, ",(0,r.jsx)(t.a,{href:"https://www.linkedin.com/in/%E2%98%81-richard-hooper/",children:"Richard Hooper"})," - let us take a look at KubeBuddy against an ",(0,r.jsxs)(t.a,{href:"https://learn.microsoft.com/azure/aks/what-is-aks?WT.mc_id=AZ-MVP-5004796",children:["Azure Kubernetes Cluster ",(0,r.jsx)(t.em,{children:"(AKS)"})]}),"."]}),"\n","\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://kubebuddy.kubedeck.io/",children:"KubeBuddy"}),", powered by ",(0,r.jsx)(t.a,{href:"https://github.com/kubedeckio",children:"Kubedeck"}),", is a comprehensive diagnostic tool designed to address the hidden issues within Kubernetes clusters. It aims to solve problems related to node failures, pod crashes, security risks, and networking issues. By running externally via your terminal or Docker, KubeBuddy ensures no cluster intrusion, providing clean execution without agents or Helm charts. It generates actionable reports in HTML, JSON, or CLI formats, offering quick insights and sharing capabilities. KubeBuddy's stateless design means scans don't persist anything, ensuring no runtime footprint or security baggage. It can be used locally, in CI/CD, or on a jump host, making it versatile for various work environments."]})}),"\n",(0,r.jsxs)(t.p,{children:["Today, we are going to run it locally, against an ",(0,r.jsxs)(t.a,{href:"https://learn.microsoft.com/azure/aks/what-is-aks?WT.mc_id=AZ-MVP-5004796",children:["Azure Kubernetes Cluster ",(0,r.jsx)(t.em,{children:"(AKS)"})]})," - using ",(0,r.jsx)(t.a,{href:"https://learn.microsoft.com/powershell/scripting/overview?view=powershell-7.5&WT.mc_id=AZ-MVP-5004796",children:"PowerShell"}),". If you are so inclined, you can go down the ",(0,r.jsx)(t.a,{href:"https://kubebuddy.kubedeck.io/usage/docker-usage/",children:"docker"})," route."]}),"\n",(0,r.jsx)(t.h2,{id:"\ufe0f-connect--scan",children:"\u2699\ufe0f Connect & Scan"}),"\n",(0,r.jsx)(t.p,{children:"KubeBuddy uses your existing Kubeconfig to scan your cluster externally; no agents are required. So, let's get started."}),"\n",(0,r.jsx)(t.p,{children:"I have an AKS cluster. This cluster is deployed in the Australia East region. Its System Node Pool size is Standard_DS2_v2, and its User Node Pool size is Standard_D4as_v5. I will run this on a GitHub Codespace, running Ubuntu 20.04.6 LTS and PowerShell 7.5.1 with kubectl and Azure CLI installed, but from the PowerShell terminal."}),"\n",(0,r.jsx)(t.p,{children:"First, let's install the KubeBuddy module."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:"Install-Module -Name KubeBuddy -Scope CurrentUser -Force -AllowClobber\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Install - KubeBuddy PowerShell Module",src:n(44493).A+"",width:"1151",height:"300"})}),"\n",(0,r.jsx)(t.p,{children:"Once installed, we need to log in to Azure using the Azure CLI and then connect to the AKS cluster."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:'# =========================\n# Variables\n# =========================\n$resourceGroup      = "akscluster-rg"\n$clusterName        = "lukesakscluster"\n$subscriptionId     = "7a30b0c4-5b48-419e-8e57-439b127b69d2"\n# =========================\n# Helper Functions\n# =========================\nfunction Write-Log {\n    param([string]$message)\n    Write-Host "$(Get-Date -Format o): $message"\n}\n# =========================\n# Main Logic\n# =========================\nWrite-Log "Setting Azure subscription context..."\naz account set --subscription $subscriptionId\nWrite-Log "Getting AKS credentials for cluster \'$clusterName\' in resource group \'$resourceGroup\'..."\naz aks get-credentials --resource-group $resourceGroup --name $clusterName\nWrite-Log "AKS credentials setup."\n'})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Get AKS Credentials",src:n(44085).A+"",width:"1151",height:"300"})}),"\n",(0,r.jsx)(t.p,{children:"Once we have the AKS credentials and set the kuberconfig, we can run KubeBuddy."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:'# =========================\n# Variables\n# =========================\n$resourceGroup      = "akscluster-rg"\n$clusterName        = "lukesakscluster"\n$subscriptionId     = "7a30b0c4-5b48-419e-8e57-439b127b69d2"\n\n# =========================\n# Helper Functions\n# =========================\nfunction Write-Log {\n    param([string]$message)\n    Write-Host "$(Get-Date -Format o): $message"\n}\n# =========================\n# Main Logic\n# =========================\nWrite-Log "Invoking KubeBuddy for AKS cluster management..."\nInvoke-KubeBuddy -Aks -SubscriptionId $subscriptionId -ResourceGroup $resourceGroup -ClusterName $clusterName\nWrite-Log "KubeBuddy invocation complete."\n'})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Invoke KubeBuddy",src:n(27154).A+"",width:"1151",height:"300"})}),"\n",(0,r.jsx)(t.h2,{id:"-deliver-insights",children:"\ud83d\udcc8 Deliver Insights"}),"\n",(0,r.jsx)(t.p,{children:"Generates clear, actionable reports in HTML, JSON, or CLI format for immediate action."}),"\n",(0,r.jsxs)(t.p,{children:["Now that we can run KubeBuddy, we can look at the results. KubeBuddy will run a series of tests against the AKS cluster and return the results. Instead of the interactive mode shown earlier, we are going to have it generate a HTML report with the AKS check results ",(0,r.jsx)(t.em,{children:"(assuming we have the kubeconfig connected as part of earlier steps)"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:"Invoke-KubeBuddy -HtmlReport\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Invoke KubeBuddy HTML Report",src:n(4092).A+"",width:"1151",height:"300"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"KubeBuddy HTML Report",src:n(93132).A+"",width:"1880",height:"901"})}),"\n",(0,r.jsx)(t.p,{children:"We can see that my Kubernetes cluster is not healthy. The AKS cluster has issues, and the HTML report includes recommended actions."}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsx)(t.p,{children:"So far, the alerts and reports are only Kubernetes-based for the HTML reports. If we are using Docker, we will have to authenticate using a Service Principal for the Aks health checks, but with the PowerShell method, we are already authenticated, so we can simply add the Aks switch."})}),"\n",(0,r.jsx)(t.p,{children:"And rerun the KubeBuddy report command, with the AKS switch:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:"Invoke-KubeBuddy -AKS -SubscriptionId $subscriptionId -ResourceGroup $resourceGroup -ClusterName $clusterName -HtmlReport\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"KubeBuddy HTML Checks",src:n(57717).A+"",width:"1910",height:"1272"})}),"\n",(0,r.jsx)(t.h2,{id:"-analyze-issues",children:"\ud83d\udd0e Analyze Issues"}),"\n",(0,r.jsx)(t.p,{children:"Detects hidden problems like misconfigurations, security risks, and resource failures in seconds."}),"\n",(0,r.jsx)(t.p,{children:"Now that we have scanned our cluster and retrieved the reports, it's time to review and analyse the issues we have encountered."}),"\n",(0,r.jsxs)(t.admonition,{type:"tip",children:[(0,r.jsx)(t.p,{children:"You can do a comparison of 2 different reports to see if you are going up and down:"}),(0,r.jsx)(t.p,{children:"For example, if you run the following command to do the output as a text file:"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:"Invoke-KubeBuddy -txtReport -Aks -SubscriptionId $SubscriptionId -ResourceGroup $ResourceGroup -ClusterName $ClusterName\n"})}),(0,r.jsx)(t.p,{children:"Then run a script similar to the one below to create a comparison file:"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-powershell",children:'# =========================\n\n# Variables (snake_case)\n\n# =========================\n\n$report_path_1 = "./kubebuddy-report-20250508-082143.txt"\n$report_path_2 = "./kubebuddy-report-20250507-181629.txt"\n$output_diff_path = "./kubebuddy-report-diff.txt"\n\n# =========================\n\n# Parameters (camelCase)\n\n# =========================\n\nparam(\n[string]$reportFile1 = $report_path_1,\n    [string]$reportFile2 = $report_path_2,\n    [string]$outputFile = $output_diff_path\n)\n\n# =========================\n\n# Helper Functions\n\n# =========================\n\nfunction Validate-FileExists {\nparam(\n[string]$filePath,\n        [string]$paramName\n)\nif (-not (Test-Path $filePath)) {\n        throw "File \'$filePath\' specified by \'$paramName\' does not exist."\n}\n}\n\n# =========================\n\n# Main Logic\n\n# =========================\n\ntry { # Validate input files\nValidate-FileExists -filePath $reportFile1 -paramName "reportFile1"\nValidate-FileExists -filePath $reportFile2 -paramName "reportFile2"\n\n    # Compare files (ignoring whitespace differences)\n    $diff = Compare-Object `\n        -ReferenceObject (Get-Content $reportFile1) `\n        -DifferenceObject (Get-Content $reportFile2) `\n        -IncludeEqual:$false\n\n    if ($diff) {\n        $diff | Out-File -FilePath $outputFile\n        Write-Host "Differences found. See $outputFile for details."\n    } else {\n        Write-Host "No differences found between the reports."\n    }\n\n}\ncatch {\nWrite-Error $_.Exception.Message\nexit 1\n}\n'})}),(0,r.jsx)(t.p,{children:"This will generate a diff file, which you can then pass into something like Copilot or another script to do something like this:"}),(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"KubeBuddy",src:n(17824).A+"",width:"998",height:"652"})})]}),"\n",(0,r.jsxs)(t.p,{children:["You can follow the recommendations, ie, ",(0,r.jsx)(t.a,{href:"https://learn.microsoft.com/azure/aks/use-managed-identity?WT.mc_id=AZ-MVP-5004796",children:"Use a managed identity in Azure Kubernetes Service (AKS)"})," that the reports give you. Be aware that some of the issues can only be resolved during the cluster creation. So, ideally, you would run this report as early in the lifecycle as possible, during the proof of technology phase, and take the recommendations into account as part of provisioning any UAT or Production workloads."]}),"\n",(0,r.jsxs)(t.p,{children:["Give ",(0,r.jsx)(t.a,{href:"https://kubebuddy.kubedeck.io/",children:"KubeBuddy"})," a go today!"]})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},17824:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/CompareKubeBuddyRuns-d5632c7a030f240490eb0db1bc490e21.gif"},44085:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/ConnectAzlKubeBuddyPSModule-6c8838202845ac04667bbd2fc00ba762.gif"},44493:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/InstallKubeBuddyPSModule-2a36aba6bc9a1629eefb688a283f141b.gif"},4092:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/InvokeKubeBuddyHTMLReport-def86b9cbefe4ef72b2bfefdaba9efc2.gif"},27154:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/InvokeKubeBuddyPSModule-242ae5444c232db86f80b541fe45a148.gif"},57717:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/KubeBuddyHTMLAksChecks-53cf9c5fadd0a926787b5ee4b7b42efa.jpg"},93132:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/KubeBuddyHTMLReport-b895f164dfdac41ae9f749f3b92635e2.gif"},91543:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/KubeBuddyLogo-a3c35e036f509cc1eafd17ff55da4010.png"},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(96540);const r={},i=s.createContext(r);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:t},e.children)}},94732:e=>{e.exports=JSON.parse('{"permalink":"/azure/kubebuddy-scanning-clusters","source":"@site/blog/2025-05-08-kubebuddy/index.mdx","title":"Scan Your Kubernetes Cluster with KubeBuddy","description":"Scan your AKS cluster with KubeBuddy to detect issues and generate actionable reports for better operations.","date":"2025-05-07T21:47:58.518Z","tags":[{"inline":true,"label":"Azure","permalink":"/tags/azure"},{"inline":true,"label":"Misc","permalink":"/tags/misc"}],"readingTime":4.905,"hasTruncateMarker":true,"authors":[{"name":"Luke Murray","title":"Author","url":"https://luke.geek.nz","imageURL":"https://luke.geek.nz/img/logo.png","key":"Luke","page":null}],"frontMatter":{"title":"Scan Your Kubernetes Cluster with KubeBuddy","metaDescription":"Scan your AKS cluster with KubeBuddy to detect hidden issues and generate actionable reports for better operations.","tags":["Azure","Misc"],"categories":["Misc"],"authors":["Luke"],"slug":"azure/kubebuddy-scanning-clusters","keywords":["Azure","Kubernetes","AKS","KubeBuddy","Cluster Scanning","Kubernetes Diagnostics","Cluster Health","PowerShell"],"description":"Scan your AKS cluster with KubeBuddy to detect issues and generate actionable reports for better operations.","date":"2025-05-07T21:47:58.518Z"},"unlisted":false,"nextItem":{"title":"GitHub Codespace Secrets","permalink":"/misc/codespace-secrets"}}')}}]);
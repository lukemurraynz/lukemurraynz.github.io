"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[55676],{30197:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var i=r(85893),t=r(11151);const s={date:"2022-11-14 00:00:00 +1300",title:"Deploy Azure-Firewall-mon to a Static Web App",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"/uploads/azfirewallmon.png"}},a=void 0,o={permalink:"/2022/11/14/deploy-azure-firewall-mon-to-a-static-web-app",source:"@site/blog/2022-11-14-deploy-azure-firewall-mon-to-a-static-web-app.md",title:"Deploy Azure-Firewall-mon to a Static Web App",description:"Azure-Firewall-mon is a near real-time Azure Firewall log viewer.",date:"2022-11-14T00:00:00.000Z",formattedDate:"November 14, 2022",tags:[{label:"Azure",permalink:"/tags/azure"}],readingTime:10.015,hasTruncateMarker:!1,authors:[{name:"Luke Murray",title:"Author",url:"https://luke.geek.nz",imageURL:"https://luke.geek.nz/img/logo.png",key:"Luke"}],frontMatter:{date:"2022-11-14 00:00:00 +1300",title:"Deploy Azure-Firewall-mon to a Static Web App",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"/uploads/azfirewallmon.png"}},unlisted:!1,prevItem:{title:"Disable SFTP support on an Azure Storage account on a Schedule",permalink:"/azure/disable-sftp-support-on-an-azure-storage-account-on-a-schedule"},nextItem:{title:"Official Microsoft Community Calls",permalink:"/2022/11/06/official-microsoft-community-calls"}},l={authorsImageUrls:[void 0]},c=[{value:"Overview",id:"overview",level:3},{value:"Deployment",id:"deployment",level:3},{value:"Prerequisites",id:"prerequisites",level:4},{value:"Fork the GitHub repository",id:"fork-the-github-repository",level:4},{value:"Create Static Web App and deploy azure-firewall-mon",id:"create-static-web-app-and-deploy-azure-firewall-mon",level:4},{value:"Create Event Hub namespace and shared access policy",id:"create-event-hub-namespace-and-shared-access-policy",level:4},{value:"Configure Azure Firewall to stream to Event Hub and run Azure Firewall monitor",id:"configure-azure-firewall-to-stream-to-event-hub-and-run-azure-firewall-monitor",level:4},{value:"<strong>References: GitHub Action</strong>",id:"references-github-action",level:4},{value:"<strong>References: Azure Bicep</strong>",id:"references-azure-bicep",level:4},{value:"Azure Static Web App",id:"azure-static-web-app",level:5},{value:"Event Hub",id:"event-hub",level:5}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/nicolgit/azure-firewall-mon",title:"Azure-Firewall-mon",children:"Azure-Firewall-mon"})," is a near real-time ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/firewall/overview?WT.mc_id=AZ-MVP-5004796",title:"What is Azure Firewall?",children:"Azure Firewall"})," log viewer."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Azure-Firewall-mon provides an ",(0,i.jsx)(n.em,{children:"alternative_and_opinable"})," \ud83d\ude0a way to access and inspect Azure Firewall logs. The recommended approach for analysing Azure Firewall logs is to set up a Log Analytics Workspace to collect all the data and use Kusto ",(0,i.jsx)(n.em,{children:"(KQL)"})," queries to check what's happening."]}),"\n",(0,i.jsx)(n.p,{children:"In Azure-Firewall-mon, the idea is to provide an approach much more like Sysinternals Process Monitor or Check Point's SmartView, where there is no queries or dashboards that you need to implement first to get working. Still, all events are available as a log stream. In addition, a full-text search at the top of the page lets you quickly filter the content displayed on the screen, helping you understand what is happening right now (or close to present)."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Azure-Firewall-mon ",(0,i.jsx)(n.em,{children:"(AFM or Azure Firewall Monitor)"})," is a custom solution ",(0,i.jsx)(n.em,{children:"(currently in a functional beta)"})," created by an Italian Microsoft Cloud Solution Architect called: ",(0,i.jsx)(n.a,{href:"https://nicolgit.github.io/",title:"Nicola Delfino",children:"Nicola Delfino"}),", its worth mentioning that although a Microsoft CSA makes AFM, ",(0,i.jsx)(n.strong,{children:"IT IS NOT A SUPPORTED MICROSOFT PRODUCT"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Monitoring Azure Firewall can be a pain - with trawling through logs - using the ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/firewall/firewall-workbook?WT.mc_id=AZ-MVP-5004796",title:"Monitor logs using Azure Firewall Workbook",children:"Azure Firewall Workbook"})," - helps fill in the gap - especially around the application and network rule traffic. Still, you may want something more straightforward and designed for real-time traffic to assist with in-the-moment troubleshooting."]}),"\n",(0,i.jsxs)(n.p,{children:["Azure-Firewall-mon is an open-source, ",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Single-page_application",children:"single Page Application"})," written in ",(0,i.jsx)(n.a,{href:"https://angular.io/",children:"Angular"})," and hosted on an ",(0,i.jsx)(n.a,{href:"https://az-firewall-mon.azurewebsites.net",title:"az-firewall-mon",children:"Azure WebApp"})," - so to use this, you don't need to deploy to your environment.. add in an Event Hub connection string, and away you go ",(0,i.jsx)(n.em,{children:"(there is also a demo mode - so you can see what the experience will be like)"}),"!"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"az-firewall-mon landing page",src:r(36110).Z+"",title:"az-firewall-mon",width:"829",height:"651"}),"\n",(0,i.jsx)(n.img,{alt:"az-firewall-mon landing page",src:r(13346).Z+"",title:"az-firewall-mon",width:"1902",height:"910"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"We can deploy it to an Azure"})," ",(0,i.jsx)(n.a,{href:"https://azure.microsoft.com/en-us/products/app-service/static/?WT.mc_id=AZ-MVP-5004796",title:" Static Web Apps",children:(0,i.jsx)(n.strong,{children:"Static Web App"})})," ",(0,i.jsx)(n.strong,{children:"for those who would instead host it in our environment."})]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:'"Azure Static Web Apps is a service that automatically builds and deploys full-stack web apps to Azure from a code repository. When you create an Azure Static Web Apps resource, Azure interacts directly with GitHub or Azure DevOps to monitor a branch of your choice. Every time you push commits or accept pull requests into the watched branch, a build is automatically run and your app and API is deployed to Azure."'}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Azure Static WebApps - Overview",src:r(63307).Z+"",title:"Azure Static WebApps - Overview",width:"900",height:"376"})}),"\n",(0,i.jsx)(n.h3,{id:"deployment",children:"Deployment"}),"\n",(0,i.jsx)(n.h4,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Today, we are going to deploy Azure-Firewall-mon into an Azure Static Web App - to do this; we will need the following prerequisites:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.a,{href:"https://github.com/",title:"GitHub",children:"GitHub"})," account"]}),"\n",(0,i.jsxs)(n.li,{children:["An ",(0,i.jsx)(n.a,{href:"https://azure.microsoft.com/en-us/?WT.mc_id=AZ-MVP-5004796",title:"Do more with less. On Azure.",children:"Azure"})," subscription_(with permissions to deploy Event Hub, deploy an Azure Static WebApp, and configure Diagnostics on the Azure Firewall)_"]}),"\n",(0,i.jsxs)(n.li,{children:["Azure Firewall ",(0,i.jsx)(n.em,{children:"(provisioned)"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Note: Also, ensure that your Event Hub is in the same region as your Azure Firewall so that you can use Diagnostics settings. Regarding the Azure Static WebApp - it doesn't matter; this is a global service  - and you will be entering the Event Hub listener."})}),"\n",(0,i.jsxs)(n.p,{children:["We will use the Azure Portal and a browser to provision the workflow ",(0,i.jsx)(n.em,{children:"(however, I will have added Azure Bicep to the bottom of the article for reference)"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This article - assumes you have basic knowledge of GitHub and Microsoft Azure."}),"\n",(0,i.jsxs)(n.p,{children:["For this demo, I am using a ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?tabs=cli&WT.mc_id=AZ-MVP-5004796",title:"Hub-spoke network topology in Azure",children:"Hub & Spoke Azure"})," topology."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Azure Firewall Monitor - High Level Architecture",src:r(32876).Z+"",title:"Azure Firewall Monitor - High Level Architecture",width:"462",height:"96"})}),"\n",(0,i.jsx)(n.h4,{id:"fork-the-github-repository",children:"Fork the GitHub repository"}),"\n",(0,i.jsx)(n.p,{children:"The first thing we need to do is clone the Azure-Firewall-mon repository; this repository holds the source control of Azure-Firewall-mon. First, however, we need a clone of it - to use in our Static Web App - this will also allow us to pull down and build the latest changes and updates of the Azure-Firewall-mon tool while having the stability of maintaining your version of the device."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["In your favourite browser of choice, navigate to: ",(0,i.jsx)(n.a,{href:"https://github.com/nicolgit/azure-firewall-mon",title:"https://github.com/nicolgit/azure-firewall-mon",children:"https://github.com/nicolgit/azure-firewall-mon"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Fork"})," ",(0,i.jsx)(n.em,{children:"(top right of the repository)"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"GitHub - Create a new fork",src:r(45660).Z+"",title:"GitHub - Create a new fork",width:"789",height:"531"})}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Create fork"})]}),"\n",(0,i.jsx)(n.li,{children:"You have now created a fork of the 'azure-firewall-mon' repository; when a new update of Azure-Firewall-mon comes out - you can also select 'Sync fork' - to keep your fork up-to-date and trigger a new build."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"create-static-web-app-and-deploy-azure-firewall-mon",children:"Create Static Web App and deploy azure-firewall-mon"}),"\n",(0,i.jsx)(n.p,{children:"Now that you have created a fork, it's time to make your Azure Static WebApp!"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Navigate to the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#home",title:"Azure Portal",children:(0,i.jsx)(n.strong,{children:"Azure Portal"})})]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"+ Create a resource"})]}),"\n",(0,i.jsxs)(n.li,{children:["Type in: ",(0,i.jsx)(n.strong,{children:"Static Web App"})]}),"\n",(0,i.jsxs)(n.li,{children:["Select and click ",(0,i.jsx)(n.strong,{children:"Create"})]}),"\n",(0,i.jsxs)(n.li,{children:["Create or ",(0,i.jsx)(n.strong,{children:"select"})," a ",(0,i.jsx)(n.strong,{children:"Resource Group"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"})," in the ",(0,i.jsx)(n.strong,{children:"name"})," of your Static Web App"]}),"\n",(0,i.jsxs)(n.li,{children:["For the plan type, we will go with ",(0,i.jsx)(n.strong,{children:"Free"})]}),"\n",(0,i.jsxs)(n.li,{children:["Please select your ",(0,i.jsx)(n.strong,{children:"region"})," ",(0,i.jsx)(n.em,{children:"(this is the staging environment used to create your resource so the Azure Static Web App can then be replicated geographically)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Select ",(0,i.jsx)(n.strong,{children:"Source"}),", as ",(0,i.jsx)(n.strong,{children:"GitHub"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Sign in"})," with ",(0,i.jsx)(n.strong,{children:"GitHub"})," ",(0,i.jsx)(n.em,{children:"(and sign in with an account with access to the GitHub Repository fork of azure-firewall-mon created earlier)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Authorise"})," the ",(0,i.jsx)(n.strong,{children:"Azure Static Web Apps"})," to have access to your repositories"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Select"})," your ",(0,i.jsx)(n.strong,{children:"organisation"})," and the azure-firewall-mon ",(0,i.jsx)(n.strong,{children:"repository"})," you forked earlier."]}),"\n",(0,i.jsxs)(n.li,{children:["Select '",(0,i.jsx)(n.strong,{children:"main"}),"' for the branch"]}),"\n",(0,i.jsxs)(n.li,{children:["Under Build Presents, select ",(0,i.jsx)(n.strong,{children:"Angular"})]}),"\n",(0,i.jsxs)(n.li,{children:['For App location, enter "',(0,i.jsx)(n.strong,{children:"/firewall-mon-app/"}),'"']}),"\n",(0,i.jsx)(n.li,{children:"Leave the API location empty"}),"\n",(0,i.jsxs)(n.li,{children:["For the Output location, enter: ",(0,i.jsx)(n.strong,{children:'"dist/firewall-mon-app"'})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure Static WebApps - Angular Build",src:r(71342).Z+"",title:"Azure Static WebApps - Angular Build",width:"798",height:"315"})}),"\n",(0,i.jsx)(n.li,{children:"If you navigate to your own forked GitHub repository, you should see a new folder created under .github/workflows - and a new GitHub Actions workflow file!"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Create Azure Static WebApp - Angular - Azure Portal",src:r(50631).Z+"",title:"Create Azure Static WebApp - Angular - Azure Portal",width:"1300",height:"873"})}),"\n",(0,i.jsxs)(n.li,{children:["If you select ",(0,i.jsx)(n.strong,{children:"Actions"})," in GitHub, you should see a deployment start."]}),"\n",(0,i.jsxs)(n.li,{children:["After roughly 5 minutes, your ",(0,i.jsx)(n.strong,{children:"Azure Static App - will have deployed azure-firewall-mon"}),"!"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Navigate"})," to your newly created ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2FStaticSites",title:"Static Web Apps",children:(0,i.jsx)(n.strong,{children:"Azure Static App"})})," in the Azure Portal"]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Browse"})]}),"\n",(0,i.jsxs)(n.li,{children:["You should now see ",(0,i.jsx)(n.strong,{children:"azure-firewall-mon"}),"!"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"azure-firewall-mon",src:r(59109).Z+"",title:"azure-firewall-mon",width:"1902",height:"998"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Note: In GitHub, under Actions and the Build and Deploy Job, you may see a message about Note.js 12 actions being deprecated; you can set the node version to be higher."})}),"\n",(0,i.jsx)(n.p,{children:"Add the step to set the node version below submodules and above the Build and Deploy step:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'      - uses: actions/setup-node@v1\n        with:\n          node-version: "18.x"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Refer to a copy of my Github Actions file here: ",(0,i.jsx)(n.a,{href:"https://gist.github.com/lukemurraynz/3f300a5eb73b2693d3a9378261a023db",title:"Azure Static Web Apps CI/CD",children:"AzureStaticWebAppsCICD.yml"})," for a comparison of GitHub action - a setup-node step running on the latest version of 18."]}),"\n",(0,i.jsx)(n.h4,{id:"create-event-hub-namespace-and-shared-access-policy",children:"Create Event Hub namespace and shared access policy"}),"\n",(0,i.jsxs)(n.p,{children:["Even if you use the externally hosted version of ",(0,i.jsx)(n.a,{href:"https://az-firewall-mon.azurewebsites.net/",children:"Azure Firewall Monitor"}),", you still need an Event Hub and Namespace to stream the events from our Azure Firewall to the Azure Firewall Monitor."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate to the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#home",title:"Azure Portal",children:(0,i.jsx)(n.strong,{children:"Azure Portal"})})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"+ Create a resource"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Type in: ",(0,i.jsx)(n.strong,{children:"Event Hubs"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select and click ",(0,i.jsx)(n.strong,{children:"Create"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select your subscription and ",(0,i.jsx)(n.strong,{children:"Resource Group"}),";"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Type in the ",(0,i.jsx)(n.strong,{children:"Namespace"})," of the event hub ",(0,i.jsx)(n.em,{children:"(i.e. AzureFirewallMonitor)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select your ",(0,i.jsx)(n.strong,{children:"location"})," ",(0,i.jsx)(n.em,{children:"(make sure this is the same region as your Azure Firewall)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select your ",(0,i.jsx)(n.strong,{children:"Pricing Tier"})," ",(0,i.jsx)(n.em,{children:"(in this example, I am going with Basic)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Review + create"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Once the Namespace has been created, it's time to make our Event Hub; navigate to your newly created AzFirewallMonitor namespace."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Under ",(0,i.jsx)(n.strong,{children:"Entitles"}),", click ",(0,i.jsx)(n.strong,{children:"+ Event Hub"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Under the name, enter the Event Hub name ",(0,i.jsx)(n.em,{children:"(i.e. AzMonitorCapture)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Leave the defaults ",(0,i.jsx)(n.em,{children:"(and Message retention to 1 day)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Review + Create"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Create"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Create Azure Event Hub",src:r(55441).Z+"",title:"Create Azure Event Hub",width:"837",height:"350"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Now that the Event Hub is created, we need to create a Shared access policy; in the Event Hub namespace, click on ",(0,i.jsx)(n.strong,{children:"Shared access policies."})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"+ Add"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Type in a ",(0,i.jsx)(n.strong,{children:"Policy name"}),(0,i.jsx)(n.em,{children:"(i.e. AzMonitorListener)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select ",(0,i.jsx)(n.strong,{children:"Send"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Create"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Azure Event Hub - Create shared access policy",src:r(908).Z+"",title:"Azure Event Hub - Create shared access policy",width:"1633",height:"317"})}),"\n",(0,i.jsx)(n.h4,{id:"configure-azure-firewall-to-stream-to-event-hub-and-run-azure-firewall-monitor",children:"Configure Azure Firewall to stream to Event Hub and run Azure Firewall monitor"}),"\n",(0,i.jsx)(n.p,{children:"Now that we have an Event Hub configured and a Shared access policy set to Listen - it's time to configure the Azure Firewall to direct logs to the Namespace."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate to the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#home",title:"Azure Portal",children:(0,i.jsx)(n.strong,{children:"Azure Portal"})})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate to your ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FazureFirewalls",title:"Firewalls",children:(0,i.jsx)(n.strong,{children:"Azure Firewall"})})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select ",(0,i.jsx)(n.strong,{children:"Diagnostic Settings"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"+ Add diagnostic setting"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Azure Firewall - Diagnostic Settings",src:r(93344).Z+"",title:"Azure Firewall - Diagnostic Settings",width:"1300",height:"676"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Type in a Diagnostic setting name ",(0,i.jsx)(n.em,{children:"(i.e. AzureFirewallMonitor)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select ",(0,i.jsx)(n.strong,{children:"All Logs"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select ",(0,i.jsx)(n.strong,{children:"Stream to an event hub"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Select your subscription, event hub namespace, event hub and policy created earlier."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Azure Firewall - Diagnostic setting",src:r(78109).Z+"",title:"Azure Firewall - Configure Diagnostic setting",width:"1208",height:"724"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Save"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Please navigate back to your ",(0,i.jsx)(n.strong,{children:"Event Hub"})," namespace and select your ",(0,i.jsx)(n.strong,{children:"Event Hub entity"}),"; now, we need to create a Shared access policy to ",(0,i.jsx)(n.strong,{children:"Listen"})," ",(0,i.jsx)(n.em,{children:"(for the entity, not the Namespace)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click Shared access policies, and create a new Shared access policy with ",(0,i.jsx)(n.strong,{children:"Listen."})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Copy the ",(0,i.jsx)(n.strong,{children:"Connection string-primary key"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Navigate"})," to your newly created ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2FStaticSites",title:"Static Web Apps",children:(0,i.jsx)(n.strong,{children:"Azure Static App"})})," in the Azure Portal"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Browse"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["You should now see ",(0,i.jsx)(n.strong,{children:"azure-firewall-mon"}),", and enter in the ",(0,i.jsx)(n.strong,{children:"Connection string-primary key copied"})," earlier!"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Congratulations you have now set up Azure Firewall Monitor on an Azure Static Web App and can troubleshoot your Azure Firewall quickly in real-time!"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Run Azure Firewall Monitor",src:r(47992).Z+"",title:"Run Azure Firewall Monitor",width:"1522",height:"873"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"references-github-action",children:(0,i.jsx)(n.strong,{children:"References: GitHub Action"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'name: Azure Static Web Apps CI/CD\n\non:\n  push:\n    branches:\n      - main\n  pull_request:\n    types: [opened, synchronize, reopened, closed]\n    branches:\n      - main\n\njobs:\n  build_and_deploy_job:\n    if: github.event_name == \'push\' || (github.event_name == \'pull_request\' && github.event.action != \'closed\')\n    runs-on: ubuntu-latest\n    name: Build and Deploy Job\n    steps:\n      - uses: actions/checkout@v2\n        with:\n          submodules: true\n\n      - uses: actions/setup-node@v1\n        with:\n          node-version: "18.x"\n      - name: Build And Deploy\n        id: builddeploy\n        uses: Azure/static-web-apps-deploy@v1\n        with:\n          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_POLITE_CLIFF_06D4C2810 }}\n          repo_token: ${{ secrets.GITHUB_TOKEN }} # Used for Github integrations (i.e. PR comments)\n          action: "upload"\n          ###### Repository/Build Configurations - These values can be configured to match your app requirements. ######\n          # For more information regarding Static Web App workflow configurations, please visit: https://aka.ms/swaworkflowconfig\n          app_location: "/firewall-mon-app/" # App source code path\n          api_location: "" # Api source code path - optional\n          output_location: "dist/firewall-mon-app" # Built app content directory - optional\n\n          ###### End of Repository/Build Configurations ######\n\n  close_pull_request_job:\n    if: github.event_name == \'pull_request\' && github.event.action == \'closed\'\n    runs-on: ubuntu-latest\n    name: Close Pull Request Job\n    steps:\n      - name: Close Pull Request\n        id: closepullrequest\n        uses: Azure/static-web-apps-deploy@v1\n        with:\n          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_POLITE_CLIFF_06D4C2810 }}\n          action: "close"\n'})}),"\n",(0,i.jsx)(n.h4,{id:"references-azure-bicep",children:(0,i.jsx)(n.strong,{children:"References: Azure Bicep"})}),"\n",(0,i.jsx)(n.p,{children:"Below are some Azure Bicep references:"}),"\n",(0,i.jsx)(n.h5,{id:"azure-static-web-app",children:"Azure Static Web App"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"param staticSites_AzFw_Mon_name string = 'AzFw-Mon'\n\nresource staticSites_AzFw_Mon_name_resource 'Microsoft.Web/staticSites@2022-03-01' = {\n  name: staticSites_AzFw_Mon_name\n  location: 'Central US'\n  sku: {\n    name: 'Free'\n    tier: 'Free'\n  }\n  properties: {\n    repositoryUrl: 'https://github.com/lukemurraynz/azure-firewall-mon'\n    branch: 'main'\n    stagingEnvironmentPolicy: 'Enabled'\n    allowConfigFileUpdates: true\n    provider: 'GitHub'\n    enterpriseGradeCdnStatus: 'Disabled'\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h5,{id:"event-hub",children:"Event Hub"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"param namespaces_AzFirewallMonitor_name string = 'AzFirewallMonitor'\nparam location string = resourceGroup().location\n\n\nresource namespaces_AzFirewallMonitor_name_resource 'Microsoft.EventHub/namespaces@2022-01-01-preview' = {\n  name: namespaces_AzFirewallMonitor_name\n  location: 'Australia East'\n  sku: {\n    name: 'Basic'\n    tier: 'Basic'\n    capacity: 1\n  }\n  properties: {\n    minimumTlsVersion: '1.2'\n    publicNetworkAccess: 'Enabled'\n    disableLocalAuth: false\n    zoneRedundant: true\n    isAutoInflateEnabled: false\n    maximumThroughputUnits: 0\n    kafkaEnabled: false\n  }\n}\n\nresource namespaces_AzFirewallMonitor_name_AzMonitorListner 'Microsoft.EventHub/namespaces/authorizationrules@2022-01-01-preview' = {\n  parent: namespaces_AzFirewallMonitor_name_resource\n  name: 'AzMonitorListner'\n  location: location\n  properties: {\n    rights: [\n      'Listen'\n      'Send'\n    ]\n  }\n}\n\n\nresource namespaces_AzFirewallMonitor_name_azmonitorcapture 'Microsoft.EventHub/namespaces/eventhubs@2022-01-01-preview' = {\n  parent: namespaces_AzFirewallMonitor_name_resource\n  name: 'azmonitorcapture'\n  location: location\n  properties: {\n    messageRetentionInDays: 1\n    partitionCount: 2\n    status: 'Active'\n  }\n}\n\nresource namespaces_AzFirewallMonitor_name_default 'Microsoft.EventHub/namespaces/networkRuleSets@2022-01-01-preview' = {\n  parent: namespaces_AzFirewallMonitor_name_resource\n  name: 'default'\n  location: location\n  properties: {\n    publicNetworkAccess: 'Enabled'\n    defaultAction: 'Allow'\n    virtualNetworkRules: []\n    ipRules: []\n  }\n}\n\nresource namespaces_AzFirewallMonitor_name_azmonitorcapture_AzMonitor 'Microsoft.EventHub/namespaces/eventhubs/authorizationrules@2022-01-01-preview' = {\n  parent: namespaces_AzFirewallMonitor_name_azmonitorcapture\n  name: 'AzMonitor'\n  location: location\n  properties: {\n    rights: [\n      'Listen'\n    ]\n  }\n  dependsOn: [\n\n    namespaces_AzFirewallMonitor_name_resource\n  ]\n}\n\nresource namespaces_AzFirewallMonitor_name_azmonitorcapture_Default 'Microsoft.EventHub/namespaces/eventhubs/consumergroups@2022-01-01-preview' = {\n  parent: namespaces_AzFirewallMonitor_name_azmonitorcapture\n  name: '$Default'\n  location: location\n  properties: {\n  }\n  dependsOn: [\n\n    namespaces_AzFirewallMonitor_name_resource\n  ]\n}\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},32876:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/AzMonArchitecture-2a808a28e6a53d30a3d54b9efc5bfee0.png"},36110:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/az-firewall-mon-5ee91a5e050fe29ab5cb0ab490d9f68a.png"},13346:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/azfirewallmon-60df2768099b9ac2627a844cd78480bb.png"},63307:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/azure-static-web-apps-overview-db72be97bdda7bc3b20f59753dd62022.png"},78109:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/azure_azfirewall_configure_diagsettings-750b70e33b8cb744ffe625adc16a1793.png"},93344:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/azure_azfirewall_create_diagsettings-392fac216bbd70568dc3e5616013a2f4.png"},55441:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/azure_azfirewall_mon_createeventhub-5a668a3e7de5b9a898c12c041d87ac23.png"},59109:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/azure_azfirewall_mon_deployed-30347db0fe83fdfb7a9c45f5b210e0ca.png"},908:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/azure_azfirewall_mon_sharedaccesspolicy-f2f1f482b00b1f0b407b66e4ede00daa.png"},50631:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/create_azstaticwebapp_portal_azfw-mon-1f247c2b24ef6bdf6f4f84a02190df76.gif"},71342:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/github_azfirewall_mon_createbuildangular-a12ee728543a0ee418ac652c833a6d1d.png"},45660:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/github_azfirewall_mon_createfork-a564e58393e28ac3483ef8936c00af4c.png"},47992:(e,n,r)=>{r.d(n,{Z:()=>i});const i=r.p+"assets/images/run_azstaticwebapp_portal_azfw-mon-4fc7782c49343576059701ddcc7ee8e4.gif"},11151:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>a});var i=r(67294);const t={},s=i.createContext(t);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);
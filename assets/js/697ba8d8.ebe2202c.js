"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[30272],{80244:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=s(74848),t=s(28453);const i={date:"2021-07-10 00:00:00 +1200",title:"Configure Azure Virtual Desktop Monitoring Insights",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"/uploads/azportal_azurevirtualdesktopinsights.png"}},o=void 0,l={permalink:"/2021/07/10/configure-azure-virtual-desktop-monitoring-insights",source:"@site/blog/2021-07-10-configure-azure-virtual-desktop-monitoring-insights.md",title:"Configure Azure Virtual Desktop Monitoring Insights",description:"Microsoft has now added a built-in Monitoring workbook for Azure Virtual Desktop performance monitoring; this monitoring includes dashboards related (but not limited to):",date:"2021-07-10T00:00:00.000Z",tags:[{inline:!0,label:"Azure",permalink:"/tags/azure"}],readingTime:4.06,hasTruncateMarker:!1,authors:[{name:"Luke Murray",title:"Author",url:"https://luke.geek.nz",imageURL:"https://luke.geek.nz/img/logo.png",key:"Luke",page:null}],frontMatter:{date:"2021-07-10 00:00:00 +1200",title:"Configure Azure Virtual Desktop Monitoring Insights",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"/uploads/azportal_azurevirtualdesktopinsights.png"}},unlisted:!1,prevItem:{title:"Well-Architected Framework Azure infrastructure review with PSRule for Azure",permalink:"/2021/07/13/validate-that-your-azure-resources-are-deployed-per-the-well-architected-framework"},nextItem:{title:"How to create a Free Azure Log Analytics Workspace using PowerShell",permalink:"/2021/07/10/how-to-create-a-free-log-analytics-workspace"}},a={authorsImageUrls:[void 0]},c=[{value:"Create a Log Analytics workspace",id:"create-a-log-analytics-workspace",level:3},{value:"Configure Azure Virtual Desktop Insights",id:"configure-azure-virtual-desktop-insights",level:3}];function h(e){const n={a:"a",em:"em",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Microsoft has now added a built-in Monitoring workbook for Azure Virtual Desktop performance monitoring; this monitoring includes dashboards related ",(0,r.jsx)(n.em,{children:"(but not limited to)"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Session host diagnostics"}),"\n",(0,r.jsx)(n.li,{children:"Connection performance"}),"\n",(0,r.jsx)(n.li,{children:"Host performance"}),"\n",(0,r.jsx)(n.li,{children:"User login events"}),"\n",(0,r.jsx)(n.li,{children:"Remote Desktop client versions"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To configure, we first need to create a Log Analytics workspace that both the Host Pool and Workspace will connect to."}),"\n",(0,r.jsx)(n.h3,{id:"create-a-log-analytics-workspace",children:"Create a Log Analytics workspace"}),"\n",(0,r.jsx)(n.p,{children:"You can use a Log Analytics workspace if it already exists; if not, we will have to create one."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Log in to the ",(0,r.jsx)(n.strong,{children:"Azure Portal"})]}),"\n",(0,r.jsxs)(n.li,{children:["Click on + ",(0,r.jsx)(n.strong,{children:"Create a Resource"})]}),"\n",(0,r.jsxs)(n.li,{children:["Search for: ",(0,r.jsx)(n.strong,{children:"Log Analytics workspace"})]}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:"Create"})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.img,{alt:"Azure Portal - Log Analytics Marketplace",src:s(28769).A+"",title:"Azure Portal - Log Analytics Marketplace",width:"991",height:"500"})}),"\n",(0,r.jsxs)(n.li,{children:["Here we can ",(0,r.jsx)(n.strong,{children:"select"})," the ",(0,r.jsx)(n.strong,{children:"Resource Group"}),", ",(0,r.jsx)(n.strong,{children:"Name"})," and ",(0,r.jsx)(n.strong,{children:"Location"})," of the Log Analytics workspace we will create."]}),"\n",(0,r.jsxs)(n.li,{children:["I am going to ",(0,r.jsx)(n.strong,{children:"create"})," a new ",(0,r.jsx)(n.strong,{children:"Resource Group"})," called: aad_mgmt"]}),"\n",(0,r.jsxs)(n.li,{children:["I click Create New and ",(0,r.jsx)(n.strong,{children:"enter"})," in the ",(0,r.jsx)(n.strong,{children:"name"})," of the ",(0,r.jsx)(n.strong,{children:"Resource Group"})]}),"\n",(0,r.jsx)(n.li,{children:"Under Instance Details, make sure you select a name that adheres to your naming governance."}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.em,{children:"Note: the name of your Log Analytics workspace is now scoped to the Resource Group, so you can have Log Analytics workspaces with the same name, as long as they are indifferent resource groups."})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.img,{alt:"Azure Portal - Create Log Analytics",src:s(87537).A+"",title:"Azure Portal - Create Log Analytics",width:"725",height:"663"})}),"\n",(0,r.jsxs)(n.li,{children:["Click on: ",(0,r.jsx)(n.strong,{children:"Next: Pricing Tier"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Select"})," the applicable ",(0,r.jsx)(n.strong,{children:"pricing tier"}),", I only have Pay-as-you-go (Per GB 2018), so I will select that."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.em,{children:"Note: You can view the Pricing for Log Analytics on the"})," ",(0,r.jsx)(n.a,{href:"https://azure.microsoft.com/en-us/pricing/details/monitor/?WT.mc_id=AZ-MVP-5004796,",title:"Azure Pricing Calculator - Azure Monitor",children:(0,r.jsx)(n.em,{children:"Pricing Calculator"})}),(0,r.jsx)(n.em,{children:":  look at the Pay-As-You rates."})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.img,{alt:"Azure Portal - Create Log Analytics",src:s(83867).A+"",title:"Azure Portal - Create Log Analytics",width:"743",height:"349"})}),"\n",(0,r.jsxs)(n.li,{children:["Click ",(0,r.jsx)(n.strong,{children:"Next: Tags"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Enter"})," in any ",(0,r.jsx)(n.strong,{children:"applicable tags"}),", such as Creator, Who it may get billed to, Project ID etc. that\u2019s relevant and select ",(0,r.jsx)(n.strong,{children:"Review + Create"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Review"})," the ",(0,r.jsx)(n.strong,{children:"configuration"})," and click ",(0,r.jsx)(n.strong,{children:"Create"})," to create your Log Analytics workspace! ",(0,r.jsx)(n.em,{children:"(It should take less than a minute."}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configure-azure-virtual-desktop-insights",children:"Configure Azure Virtual Desktop Insights"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Log in to the ",(0,r.jsx)(n.strong,{children:"Azure Portal"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Search"})," for: ",(0,r.jsx)(n.strong,{children:"Azure Virtual Desktop"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click on ",(0,r.jsx)(n.a,{href:"https://portal.azure.com/#blade/Microsoft_Azure_WVD/WvdManagerMenuBlade/insights",title:"Azure Virtual Desktop - Insights",children:(0,r.jsx)(n.strong,{children:"Insights"})})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"A Workbook blade should now greet you"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["This is where we will ",(0,r.jsx)(n.strong,{children:"configure"})," the Azure Virtual Desktop ",(0,r.jsx)(n.strong,{children:"Insights"}),". You can see on the lower right-hand side that we will be deploying Azure Monitor for 'Windows Virtual Desktop v1.0.4' ",(0,r.jsx)(n.em,{children:"(however, this will be managed by Microsoft, but it is handy to know the version in case of support later on)."})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop - Insights",src:s(53064).A+"",title:"Azure Virtual Desktop - Insights",width:"1700",height:"672"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click on ",(0,r.jsx)(n.strong,{children:"Open Configuration Workbook"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Here, ",(0,r.jsx)(n.strong,{children:"select"})," the Log Analytics ",(0,r.jsx)(n.strong,{children:"workspace"})," you created earlier ",(0,r.jsx)(n.em,{children:"(or want to use)"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Select ",(0,r.jsx)(n.strong,{children:"Configure host pool"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop - Insights",src:s(27328).A+"",title:"Azure Virtual Desktop - Insights",width:"925",height:"997"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click on ",(0,r.jsx)(n.strong,{children:"Deploy"})," ",(0,r.jsx)(n.em,{children:"(make sure all your Session Hosta are started so that Azure can deploy and configure the Log Analytics agent on the Virtual Machines)"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"You can select View Template and Parameters if you want to confirm the host pool and workspace configured."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop - Insights",src:s(82075).A+"",title:"Azure Virtual Desktop - Insights",width:"408",height:"309"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["While the Diagnostic host pool settings are being configured, click on ",(0,r.jsx)(n.strong,{children:"Configure workspace."})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click on: ",(0,r.jsx)(n.strong,{children:"Deploy"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Once the Workspace and Host Pool deployments are done, click on ",(0,r.jsx)(n.strong,{children:"Refresh."})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop - Insights",src:s(51781).A+"",title:"Azure Virtual Desktop - Insights",width:"621",height:"142"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Confirm"})," that ",(0,r.jsx)(n.strong,{children:"Enabled"})," is: True"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop",src:s(59070).A+"",width:"1260",height:"734"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["The journey is not over yet; now that the Host Pool and Workspace have been configured, we need to ",(0,r.jsx)(n.strong,{children:"add"})," the ",(0,r.jsx)(n.strong,{children:"Session Hosts"})," and configure the ",(0,r.jsx)(n.strong,{children:"performance counters"})," to the same workspace!"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click on: ",(0,r.jsx)(n.strong,{children:"Session host data settings."})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Select"})," your Log Analytics ",(0,r.jsx)(n.strong,{children:"workspace"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Select ",(0,r.jsx)(n.strong,{children:"Add hosts to workspace"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop",src:s(69121).A+"",width:"955",height:"578"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Confirm the Deployment and click ",(0,r.jsx)(n.strong,{children:"Deploy"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Wait until"})," the ",(0,r.jsx)(n.strong,{children:"deployment"})," has ",(0,r.jsx)(n.strong,{children:"succeeded,"})," or you may get API errors, then select:"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Navigate down and click ",(0,r.jsx)(n.strong,{children:"Configure performance counters"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop",src:s(34622).A+"",width:"1141",height:"597"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click on ",(0,r.jsx)(n.strong,{children:"Apply"})," config."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Wait until"})," the ",(0,r.jsx)(n.strong,{children:"deployment"})," has ",(0,r.jsx)(n.strong,{children:"succeeded,"})," or you may get API errors, then select:"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Navigate down and click on ",(0,r.jsx)(n.strong,{children:"Configure events"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop",src:s(12618).A+"",width:"1347",height:"631"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click on ",(0,r.jsx)(n.strong,{children:"Deploy"})]}),"\n",(0,r.jsxs)(n.p,{children:["Now click on: ",(0,r.jsx)(n.strong,{children:"Refresh"}),", and you should see 'No missing performance counters', 'No missing events found'."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop",src:s(52413).A+"",width:"1506",height:"875"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"You have now configured Azure Virtual Desktop Insights!"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"It may take a few minutes to an hour to populate and collect the data for some of the events and counters."})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop",src:s(89601).A+"",width:"1576",height:"792"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"On the plus side, all the data is also in Log Analytics so that it can be queried, and you can set up Alert rules against it and get more visibility into your Azure Virtual Desktop environment and use."})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Azure Virtual Desktop",src:s(49763).A+"",width:"1694",height:"990"})}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},53064:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_azurevirtualdesktop_insights-dfb15951312d5bd19cec3a739675b4e9.png"},59070:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_azurevirtualdesktopcheckconfig-f6b7bf16a6e99d7367517c0ee4496bb0.png"},51781:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_azurevirtualdesktopcheckconfigrefresh-8a31df74f32458c5c1adfe8218f3426b.png"},27328:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_azurevirtualdesktopcheckconfiguration-f0789585b303fa6f001d9178b019d839.png"},82075:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_azurevirtualdesktophostpooldeploy-12850b5994f383071022cfd6189a7543.png"},89601:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_azurevirtualdesktopinsights-16a5d47b37970b66136cbd3e5f590764.png"},49763:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_azurevirtualdesktoploganalytiicsquery-49377adee1c7434d0b3a37d4735c5d42.png"},87537:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_createloganalyticsworkspace-de7ccc210cfbffca60f38cbf97d55e97.png"},83867:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_createloganalyticsworkspacepricing-82e82e4f329bb29622867177b614e4f7.png"},12618:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_eventlogssettings-673f0134884b13d12f45ee37eac9e2a2.png"},28769:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_loganalyticsworkspace-1731c847286b3b7f27cfe4cd5b15db61.png"},52413:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_performancecountersreview-ae75b48856a1e45f3e90086cfbab7187.png"},34622:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_performancecounterssettings-6cf5bc872a2bc3942fb88a172ea99dcd.png"},69121:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/azportal_sessionhostdatasettings-a761143019816a6cc5e3d73bec9d1b1c.png"},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(96540);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[12158],{92127:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>s,toc:()=>h});var s=n(51008),a=n(74848),t=n(28453);const o={title:"Azure Resource - Change Analysis",metaDescription:"A comprehensive guide on using Change Analysis in Azure Monitor to track changes on your Azure resources.",date:new Date("2024-10-30T09:01:07.852Z"),tags:["Azure"],categories:["Azure"],authors:["Luke"],slug:"azure/change-analysis",keywords:["Change Analysis","Azure Monitor","Azure resources","resource tracking","change tracking","cloud management","Azure tools","IT operations"],description:"A comprehensive guide on using Change Analysis in Azure Monitor to track changes on your Azure resources."},i=void 0,c={authorsImageUrls:[void 0]},h=[{value:"Overview",id:"overview",level:2},{value:"Can we see the changes that have occurred on our Azure resources?",id:"can-we-see-the-changes-that-have-occurred-on-our-azure-resources",level:2},{value:"Can we see the changes on our Azure resources over time?",id:"can-we-see-the-changes-on-our-azure-resources-over-time",level:2},{value:"Can we tell who made the change?",id:"can-we-tell-who-made-the-change",level:2},{value:"Can we determine what made the change?",id:"can-we-determine-what-made-the-change",level:2},{value:"References",id:"references",level:2}];function u(e){const r={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.p,{children:"Who created my resource? What created my Azure resource? We often ask ourselves these questions when troubleshooting or trying to understand the state of our Azure resources."}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.a,{href:"https://learn.microsoft.com/azure/azure-monitor/change/change-analysis?WT.mc_id=AZ-MVP-5004796",children:"Change Analysis"})," is a feature in Azure Monitor that helps you answer these questions. Change Analysis helps to provide a view of the changes that have occurred on your Azure resources over time, using the ",(0,a.jsx)(r.a,{href:"https://learn.microsoft.com/azure/governance/resource-graph/overview?WT.mc_id=AZ-MVP-5004796",children:"Azure Resource Graph"}),"."]}),"\n","\n",(0,a.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(r.p,{children:"Today, we will look at Change Analysis to see:"}),"\n",(0,a.jsx)(r.p,{children:"A. Can we see the changes that have occurred on our Azure resources?\nB. Can we see the changes that have occurred on our Azure resources over time?\nC. Can we tell who made the change?\nD. Can we determine what made the change?"}),"\n",(0,a.jsxs)(r.admonition,{type:"info",children:[(0,a.jsx)(r.p,{children:"Change Analysis in the portal"}),(0,a.jsx)(r.p,{children:"Change Analysis experiences across the Azure portal are powered using the Azure Resource Graph Microsoft.ResourceGraph/resources API. You can query this API for changes made to many of the Azure resources you interact with, including App Services (Microsoft.Web/sites) or Virtual Machines (Microsoft.Compute/virtualMachines)."}),(0,a.jsx)(r.p,{children:"The Azure Resource Graph Change Analysis portal experience provides the following:"}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"An onboarding-free experience, giving all subscriptions and resources access to change history."}),"\n",(0,a.jsx)(r.li,{children:"Tenant-wide querying rather than select subscriptions."}),"\n",(0,a.jsx)(r.li,{children:"Change history summaries aggregated into cards at the top of the new Resource Graph Change Analysis."}),"\n",(0,a.jsx)(r.li,{children:"More extensive filtering capabilities."}),"\n",(0,a.jsx)(r.li,{children:"Improved accuracy and relevance of changed by information, using Change Actor functionality."}),"\n"]}),(0,a.jsxs)(r.p,{children:["Learn how to ",(0,a.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/governance/resource-graph/changes/view-resource-changes?WT.mc_id=AZ-MVP-5004796",children:"view the new Change Analysis experience in the portal"}),"."]})]}),"\n",(0,a.jsx)(r.h2,{id:"can-we-see-the-changes-that-have-occurred-on-our-azure-resources",children:"Can we see the changes that have occurred on our Azure resources?"}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsx)(r.p,{children:"Yes, we can see the changes that have occurred on our Azure resources. Change Analysis provides a view of the changes on your Azure resources over time. You can see the changes that have occurred on your Azure resources in the last 14 days."}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:["If we navigate to the ",(0,a.jsx)(r.a,{href:"https://portal.azure.com/#view/Microsoft_Azure_OneInventory/ResourceChangesOverview.ReactView",children:"Change Analysis (Preview)"})," blade in the Azure portal, we can see the changes that have occurred on our Azure resources."]}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{alt:"Change Analysis",src:n(45974).A+"",width:"1896",height:"917"})}),"\n",(0,a.jsx)(r.admonition,{type:"note",children:(0,a.jsxs)(r.p,{children:["The blur is intentional, as part of the ",(0,a.jsx)(r.a,{href:"https://luke.geek.nz/azure/cloudcloak/",children:"Cloudclock"})," extension to protect sensitive information."]})}),"\n",(0,a.jsx)(r.p,{children:"We can see the changes (Create, Update, and Delete) that have occurred on our Azure resources. We can even group them by resource or by who made the change."}),"\n",(0,a.jsx)(r.h2,{id:"can-we-see-the-changes-on-our-azure-resources-over-time",children:"Can we see the changes on our Azure resources over time?"}),"\n",(0,a.jsx)(r.p,{children:"By default, we can see the changes over the last 14 days from the Azure Portal."}),"\n",(0,a.jsx)(r.admonition,{type:"info",children:(0,a.jsxs)(r.p,{children:["Changes are queryable for 14 days. For longer retention, you can ",(0,a.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/governance/resource-graph/tutorials/logic-app-calling-arg?WT.mc_id=AZ-MVP-5004796",children:"integrate your Resource Graph query with Azure Logic Apps"})," and manually export query results to any of the Azure data stores like ",(0,a.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/azure-monitor/logs/log-analytics-overview?WT.mc_id=AZ-MVP-5004796",children:"Log Analytics"})," for your desired retention."]})}),"\n",(0,a.jsx)(r.p,{children:"A KQL query to see the changes over the last 14 days would look like:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-kql",children:'resourcechanges\n| where type == "microsoft.resources/changes"\n| project id, resourceid = properties.targetResourceId, changeType = properties.changeType, clientType = properties.changeAttributes.clientType, changedBy = properties.changeAttributes.changedBy\n'})}),"\n",(0,a.jsx)(r.p,{children:"If you want to target a specific resource, you can use a query like:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-kql",children:'resourcechanges\n| where type == "microsoft.resources/changes"\n| where properties.targetResourceId contains  "ResourceName"\n| project id, resourceId = properties.targetResourceId, resourceType = properties.targetResourceType, changeType = properties.changeType, clientType = properties.changeAttributes.clientType, changedBy = properties.changeAttributes.changedBy\n'})}),"\n",(0,a.jsxs)(r.p,{children:["Replace the ",(0,a.jsx)(r.code,{children:"ResourceName"})," with the name of the resource you are looking for. These queries can also be integrated into the Logic App for export."]}),"\n",(0,a.jsxs)(r.p,{children:["You can also run these queries directly from the Azure Portal by navigating to the ",(0,a.jsx)(r.a,{href:"https://portal.azure.com/#view/HubsExtension/ArgQueryBlade/query/resourcechanges",children:"Azure Resource Graph Explorer"})," blade."]}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{alt:"Azure Resource Graph Explorer",src:n(28469).A+"",width:"1828",height:"859"})}),"\n",(0,a.jsxs)(r.admonition,{type:"warning",children:[(0,a.jsx)(r.p,{children:"Currently, Azure Resource Graph doesn't:"}),(0,a.jsx)(r.p,{children:"Observe changes made to a resource's data plane API, such as writing data to a table in a storage account.\nSupport file and configuration changes over App Service."})]}),"\n",(0,a.jsx)(r.h2,{id:"can-we-tell-who-made-the-change",children:"Can we tell who made the change?"}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsxs)(r.p,{children:["Yes, we can tell who made the change. Change Analysis provides the ",(0,a.jsx)(r.code,{children:"changedBy"})," field, which tells us who made the change."]}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:["In my examples, we can see the ",(0,a.jsx)(r.code,{children:"changedBy"})," field in the query results. This field tells us who made the change."]}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{alt:"Azure Resource Graph Explorer",src:n(28469).A+"",width:"1828",height:"859"})}),"\n",(0,a.jsx)(r.p,{children:"It could be the user or the service principal that made the change. In this example, I can see:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["A Network interface resource was created by ",(0,a.jsx)(r.code,{children:"2cf9eb86-36b5-49dc-86ae-9a63135dfa8c"}),", which is the Application ID of a Microsoft-owned Registration for Azure Traffic Manager and DNS."]}),"\n",(0,a.jsxs)(r.li,{children:["A Deletion of the network interface was done by ",(0,a.jsx)(r.code,{children:"Luke@geek,"})," which is my user account."]}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:["SOME Azure resources ",(0,a.jsx)(r.em,{children:"(with the latest API)"})," such as this Data Collection Rule, contains the information in the resource metadata."]}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{alt:"JSON - ChangedBy",src:n(10423).A+"",width:"1539",height:"1027"})}),"\n",(0,a.jsx)(r.h2,{id:"can-we-determine-what-made-the-change",children:"Can we determine what made the change?"}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsxs)(r.p,{children:["Yes, we can determine what caused the change. Change Analysis provides the ",(0,a.jsx)(r.code,{children:"clientType"})," field, which tells us what caused the change. However, as we can see in the previous screenshots, this is not always as accurate as we may want it to be. However, it's good enough that you can infer what may have issued the changes."]}),"\n"]}),"\n",(0,a.jsx)(r.p,{children:"Some of the clientType values you may see are:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"Azure Portal"})," - Changes made from the Azure Portal."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"Unknown"})," - A change happened to a client that is unrecognized."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"CLI"})," - Changes made from Azure CLI."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"Unspecified"})," - Unspecified is displayed when the resource is missing changedByType values and could be missing for either Creates or Updates. It could also mean changes are performed in the background by Azure services and not user initiatied."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"ARM Template"})," - Changes made from an ARM Template, whether deployed automatically or via a 'Deploy to Azure' button. This also includes changes made by Bicep."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"System"})," - System is displayed as a changedBy value when a background change occurred that wasn't correlated with any direct user action."]}),"\n"]}),"\n",(0,a.jsx)(r.h2,{id:"references",children:"References"}),"\n",(0,a.jsx)(r.p,{children:"To learn more about Change Analysis, check out the following resources:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://learn.microsoft.com/azure/governance/resource-graph/changes/resource-graph-changes?WT.mc_id=AZ-MVP-5004796#change-analysis-in-azure-resource-graph-vs-azure-monitor",children:"Change Analysis in Azure Resource Graph vs. Azure Monitor"})}),"\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://techcommunity.microsoft.com/t5/azure-governance-and-management/announcing-the-general-availability-of-change-actor/ba-p/4171801?WT.mc_id=AZ-MVP-5004796",children:"Announcing the General Availability of Change Actor"})}),"\n"]})]})}function l(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},28469:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/AzurePortal_AzureResourceGraph_Query-b6de8f6fd5bf1617e1226cab516e6c00.png"},45974:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/AzurePortal_ChangeAnalysis-1dcdda4ef769b7a1f7a4812bb06e202a.gif"},10423:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/AzurePortal_DCR_JSON-8425d2fb17e95a8e9ffc9fcc93da1169.png"},28453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>i});var s=n(96540);const a={},t=s.createContext(a);function o(e){const r=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(t.Provider,{value:r},e.children)}},51008:e=>{e.exports=JSON.parse('{"permalink":"/azure/change-analysis","source":"@site/blog/2024-10-30-azure-resource-changeanalysis/index.mdx","title":"Azure Resource - Change Analysis","description":"A comprehensive guide on using Change Analysis in Azure Monitor to track changes on your Azure resources.","date":"2024-10-30T09:01:07.852Z","tags":[{"inline":true,"label":"Azure","permalink":"/tags/azure"}],"readingTime":5.37,"hasTruncateMarker":true,"authors":[{"name":"Luke Murray","title":"Author","url":"https://luke.geek.nz","imageURL":"https://luke.geek.nz/img/logo.png","key":"Luke","page":null}],"frontMatter":{"title":"Azure Resource - Change Analysis","metaDescription":"A comprehensive guide on using Change Analysis in Azure Monitor to track changes on your Azure resources.","date":"2024-10-30T09:01:07.852Z","tags":["Azure"],"categories":["Azure"],"authors":["Luke"],"slug":"azure/change-analysis","keywords":["Change Analysis","Azure Monitor","Azure resources","resource tracking","change tracking","cloud management","Azure tools","IT operations"],"description":"A comprehensive guide on using Change Analysis in Azure Monitor to track changes on your Azure resources."},"unlisted":false,"prevItem":{"title":"Enhancing GitHub Copilot with Custom Instructions","permalink":"/azure/enhancing-github-copilot-with-custom-instructions"},"nextItem":{"title":"Book Review - Kubernetes \u2013 An Enterprise Guide","permalink":"/misc/kubernetes-enterprise-guide-book-review"}}')}}]);
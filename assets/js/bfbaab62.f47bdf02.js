"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[69318],{70476:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var n=r(85893),a=r(11151);const o={date:new Date("2019-09-08T00:00:00.000Z"),title:"Update your Azure Local Network Gateway IP with PowerShell",authors:["Luke"],tags:["Azure","PowerShell"],header:{teaser:"images/iazure-marketplace-banner.png"}},i=void 0,s={permalink:"/2019/09/08/Update your Azure Local Network Gateway IP with PowerShell",source:"@site/blog/2019-09-08-Update your Azure Local Network Gateway IP with PowerShell.md",title:"Update your Azure Local Network Gateway IP with PowerShell",description:"One of the issues you face with setting up an Azure Site to Site VPN is making sure that your Azure Local Network Gateway always has your Public/On-premises IP.",date:"2019-09-08T00:00:00.000Z",formattedDate:"September 8, 2019",tags:[{label:"Azure",permalink:"/tags/azure"},{label:"PowerShell",permalink:"/tags/power-shell"}],readingTime:1.18,hasTruncateMarker:!1,authors:[{name:"Luke Murray",title:"Author",url:"https://luke.geek.nz",imageURL:"https://luke.geek.nz/img/logo.png",key:"Luke"}],frontMatter:{date:"2019-09-08T00:00:00.000Z",title:"Update your Azure Local Network Gateway IP with PowerShell",authors:["Luke"],tags:["Azure","PowerShell"],header:{teaser:"images/iazure-marketplace-banner.png"}},unlisted:!1,prevItem:{title:"First look at Universal Automation Desktop",permalink:"/2020/02/29/First look at Universal Automation Desktop"},nextItem:{title:"How to manage cost in Microsoft Azure",permalink:"/2018/12/19/How to manage cost in Microsoft Azure"}},l={authorsImageUrls:[void 0]},u=[];function c(e){const t={a:"a",em:"em",li:"li",p:"p",ul:"ul",...(0,a.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["One of the issues you face with setting up an Azure ",(0,n.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/azure/vpn-gateway/tutorial-site-to-site-portal?WT.mc_id=AZ-MVP-5004796",children:"Site to Site VPN"})," is making sure that your Azure Local Network Gateway always has your Public/On-premises IP."]}),"\n",(0,n.jsx)(t.p,{children:"This setup is fine when used in environments that have Static IPs (and yes if setting this up for a Business or Production, it is highly recommended to have a static IP!)."}),"\n",(0,n.jsx)(t.p,{children:"However, when used in environments like my home network or lab environments - which has a Dynamic IP that could change at any time it will cause connectivity issues if your IP changes and the Local Network Gateway is not updated."}),"\n",(0,n.jsx)(t.p,{children:"The script below \u2013 intended to be run on as a Daily scheduled task, will find\nyour Public IP and connect to Azure and if needed \u2013 will update the IP of your\nLocal Network Gateway."}),"\n",(0,n.jsx)(t.p,{children:"Prerequisites:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-7.5.0&WT.mc_id=AZ-MVP-5004796",children:"Az PowerShell Module"})}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal?WT.mc_id=AZ-MVP-5004796",children:"Azure Service Principal"})," (with Contributor rights to the Azure Local Network Gateway)"]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Once you have the Azure Service Principal and Az Module installed, you need to\nedit the following variables to suit your environment:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"$ResourceGroup = 'RESOURCE GROUP OF LOCAL NETWORK GATEWAY'"}),"\n",(0,n.jsx)(t.li,{children:"$LocalNetworkGateway = \u2018NAME OF AZURE LOCAL NETWORK GATEWAY\u2019"}),"\n",(0,n.jsx)(t.li,{children:"$azureAplicationId =\u2019AZURE AD APPLICATION ID\u2019"}),"\n",(0,n.jsx)(t.li,{children:"$azureTenantId= \u2018AZURE AD TENANCY/DIRECTORY ID\u2019"}),"\n",(0,n.jsx)(t.li,{children:"$azureAPI = \u2018AZURE AD APPLICATION API/CLIENT SECRET\u2019"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"{% gist 1b73335e1d0eadcfe4064f8221077ca1 %}"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Note: Script is also hosted on my Github repository. Feel free to clone/recommend improvements or fork."})})]})}function h(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},11151:(e,t,r)=>{r.d(t,{Z:()=>s,a:()=>i});var n=r(67294);const a={},o=n.createContext(a);function i(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);
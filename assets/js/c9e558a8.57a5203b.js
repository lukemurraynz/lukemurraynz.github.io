"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[17420],{36199:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var o=n(85893),r=n(11151);const a={date:"2021-06-13 00:00:00 +1200",title:"Add Log Analytics to Monitoring Agent with PowerShell",authors:["Luke"],Tags:["PowerShell"],toc:!1,header:{teaser:"images/powershell-blog-feature-banner.png"}},s=void 0,i={permalink:"/2021/06/13/add-log-analytics-workspace-to-microsoft-monitoring-agent-via-powershell",source:"@site/blog/2021-06-13-add-log-analytics-workspace-to-microsoft-monitoring-agent-via-powershell.md",title:"Add Log Analytics to Monitoring Agent with PowerShell",description:"Have you ever wanted to add a Log Analytics workspace to multiple Microsoft Monitoring Agent (MMA)'s before?",date:"2021-06-13T00:00:00.000Z",formattedDate:"June 13, 2021",tags:[],readingTime:1.04,hasTruncateMarker:!1,authors:[{name:"Luke Murray",title:"Author",url:"https://luke.geek.nz",imageURL:"https://luke.geek.nz/img/logo.png",key:"Luke"}],frontMatter:{date:"2021-06-13 00:00:00 +1200",title:"Add Log Analytics to Monitoring Agent with PowerShell",authors:["Luke"],Tags:["PowerShell"],toc:!1,header:{teaser:"images/powershell-blog-feature-banner.png"}},unlisted:!1,prevItem:{title:"Remove old PowerShell modules versions using PowerShell",permalink:"/2021/06/18/remove-old-powershell-modules-versions-using-powershell"},nextItem:{title:"Update your Azure WebApp to be Always On",permalink:"/azure/update-your-azure-webapp-to-be-always-on"}},l={authorsImageUrls:[void 0]},c=[];function u(e){const t={code:"code",em:"em",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"Have you ever wanted to add a Log Analytics workspace to multiple Microsoft Monitoring Agent (MMA)'s before?"}),"\n",(0,o.jsx)(t.p,{children:"Maybe you are setting up Windows Defender or wanting to redirect to collect event or performance logs."}),"\n",(0,o.jsx)(t.p,{children:"This little quick script will help get you started on automating adding a Log Analytics workspace to the MMA agent, even through a proxy."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"Note:  It is recommended to have the latest MMA Agent installed, this is not compatible with SCOM 2012 R2 agents, but the latest agent is supported by SCOM."})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-powershell",metastring:'title="Add_LogAnalyticsWorkspace.ps1"',children:'\n<#\n\n    Author: Luke Murray (Luke.Geek.NZ)\n    Version: 0.1\n    Version History:\n\n    Purpose: Add an MMA agent to a Log Analytics workspace using a proxy with no user authentication.\n    Notes:\n    Find more options about the MMA Agent Object:\n    #$healthServiceSettings = New-Object -ComObject \'AgentConfigManager.MgmtSvcCfg\'\n    #$proxyMethod = $healthServiceSettings | Get-Member -Name \'SetProxyInfo\'\n\n    If script is being published by Configuration as a package, create a Command Line installer:\n    "%Windir%\\sysnative\\WindowsPowerShell\\v1.0\\powershell.exe" -ExecutionPolicy Bypass -Command  .\\Add_LogAnalyticsWorkspace.ps1\n\n    If the proxy requires authentication, then the following null entries need to be replaced with user,password: $mma.SetProxyInfo("$proxy","$null","$null"). If you aren\'t using a proxy then you can remove the entire mma.SetProxyInfo line.\n\n    Location: https://github.com/lukemurraynz/PowerOfTheShell/blob/master/OperationsMgr/Add_LogAnalyticsWorkspace.ps1\n#>\n\n$workspaceId = "INSERTLOGANALYTICSWORKSPACEIDHERE"\n$workspaceKey = "INSERTLOGANALYTICSWORKSPACEKEY"\n$proxy = \'ProxyIP:PORT\'\n$mma = New-Object -ComObject \'AgentConfigManager.MgmtSvcCfg\'\n$mma.AddCloudWorkspace($workspaceId, $workspaceKey)\n$mma.SetProxyInfo("$proxy","$null","$null")\n$mma.ReloadConfiguration()\n\n'})})]})}function p(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},11151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>s});var o=n(67294);const r={},a=o.createContext(r);function s(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);
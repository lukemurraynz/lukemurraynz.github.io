"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[29616],{26143:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>i,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var n=o(85893),t=o(11151);const s={title:"Microsoft Azure Management with PowerShell - Introduction",authors:["Luke"],tags:["Azure","PowerShell"],toc:!0,header:{teaser:"/images/posts/BlogHeading-BlogHeading-Microsoft-Azure-Management-with-PowerShell.gif"},date:"2023-10-30 00:00:00 +1300",keywords:["azure","powershell","landing zones"],description:"Delve into the common ways to work with Microsoft Azure, using PowerShell.",slug:"azure/powershell/azure-management-powershell"},a="Introduction to PowerShell in Azure",l={permalink:"/azure/powershell/azure-management-powershell",source:"@site/blog/2023-10-30-Microsoft-Azure-Management-with-PowerShell-Introduction.md",title:"Microsoft Azure Management with PowerShell - Introduction",description:"Delve into the common ways to work with Microsoft Azure, using PowerShell.",date:"2023-10-30T00:00:00.000Z",formattedDate:"October 30, 2023",tags:[{label:"Azure",permalink:"/tags/azure"},{label:"PowerShell",permalink:"/tags/power-shell"}],readingTime:7.095,hasTruncateMarker:!1,authors:[{name:"Luke Murray",title:"Author",url:"https://luke.geek.nz",imageURL:"https://luke.geek.nz/img/logo.png",key:"Luke"}],frontMatter:{title:"Microsoft Azure Management with PowerShell - Introduction",authors:["Luke"],tags:["Azure","PowerShell"],toc:!0,header:{teaser:"/images/posts/BlogHeading-BlogHeading-Microsoft-Azure-Management-with-PowerShell.gif"},date:"2023-10-30 00:00:00 +1300",keywords:["azure","powershell","landing zones"],description:"Delve into the common ways to work with Microsoft Azure, using PowerShell.",slug:"azure/powershell/azure-management-powershell"},unlisted:!1,prevItem:{title:"Azure Bicep - Principal does not exist in directory",permalink:"/azure/PrincpalNotFound-bicep-roleassignment"},nextItem:{title:"Monitor your Azure Landing Zone with Baseline Alerts",permalink:"/azure/Monitor-Azure-LandingZones-with-AMBA"}},i={authorsImageUrls:[void 0]},c=[{value:"PowerShell",id:"powershell",level:2},{value:"PowerShell and Microsoft Azure",id:"powershell-and-microsoft-azure",level:2},{value:"Setting up your Azure environment for PowerShell",id:"setting-up-your-azure-environment-for-powershell",level:3},{value:"Getting started with Azure PowerShell module",id:"getting-started-with-azure-powershell-module",level:3},{value:"Resource Creation",id:"resource-creation",level:3}];function u(e){const r={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:["To see a video of these commands in action, take a look at the following YouTube-hosted video: ",(0,n.jsx)(r.a,{href:"https://youtu.be/a4gehHwlwBQ",children:"Microsoft Azure Management with PowerShell - Introduction"})]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"powershell",children:"PowerShell"}),"\n",(0,n.jsx)(r.p,{children:"PowerShell is a powerful scripting and automation framework developed by Microsoft. It is designed for task automation and configuration management and is particularly useful for managing and automating Microsoft Windows environments. PowerShell uses a command-line interface with a scriptable approach, and it's built on the .NET Framework."}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://learn.microsoft.com/powershell/scripting/overview?WT.mc_id=AZ-MVP-5004796",children:"What is PowerShell?"})}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"powershell-and-microsoft-azure",children:"PowerShell and Microsoft Azure"}),"\n",(0,n.jsx)(r.p,{children:'When it comes to Microsoft Azure, PowerShell provides a robust set of cmdlets (pronounced "command-lets") that enable you to interact with and manage Azure resources, making it a valuable tool for working with Azure services.'}),"\n",(0,n.jsx)(r.p,{children:"When you run a PowerShell cmdlet to, for example, create a virtual machine or retrieve information about an Azure resource, the cmdlet translates your request into an HTTP request to the relevant Azure REST API endpoint."}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://learn.microsoft.com/powershell/azure/?view=azps-10.4.1&WT.mc_id=AZ-MVP-5004796",children:"Azure PowerShell Documentation"})}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"There is an assumption, that you have access to an Azure environment, and the ability to create resources, within that environment."}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"Microsoft Azure Management with PowerShell",src:o(65918).Z+"",width:"1198",height:"628"})}),"\n",(0,n.jsx)(r.p,{children:"First up, let's verify the version of PowerShell we have, open a Powershell terminal and run:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"$PSVersionTable\n"})}),"\n",(0,n.jsx)(r.p,{children:"A supported version of PowerShell version 7 or higher is the recommended version of PowerShell for use with the Az PowerShell module on all platforms including Windows, Linux, and macOS."}),"\n",(0,n.jsxs)(r.p,{children:["The Az PowerShell module is preinstalled in ",(0,n.jsx)(r.a,{href:"https://learn.microsoft.com/azure/cloud-shell/overview?WT.mc_id=AZ-MVP-5004796",children:"Azure Cloud Shell"})," and in ",(0,n.jsx)(r.a,{href:"https://learn.microsoft.com/powershell/azure/azureps-in-docker?view=azps-10.4.1&tabs=amd64&WT.mc_id=AZ-MVP-5004796",children:"Docker"})," images."]}),"\n",(0,n.jsx)(r.h3,{id:"setting-up-your-azure-environment-for-powershell",children:"Setting up your Azure environment for PowerShell"}),"\n",(0,n.jsxs)(r.p,{children:["First thigs first, lets installed the Azure (",(0,n.jsx)(r.a,{href:"https://learn.microsoft.com/powershell/azure/new-azureps-module-az?view=azps-10.4.1&WT.mc_id=AZ-MVP-5004796",children:"Azure Az PowerShell module"}),")modules."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Install Azure Modules\n# The Set-PSRepository cmdlet is used to set values for a registered repository. \n# The Install-Module cmdlet is used to download one or more modules from an online gallery and installs them on the local computer. In this case, the command is installing the Az module, which provides cmdlets for managing Azure resources.\nSet-PSRepository -Name 'PSGallery' -InstallationPolicy Trusted\nInstall-Module Az \n"})}),"\n",(0,n.jsx)(r.p,{children:"If you don't have local administrator rights, you can install it into your user profile like below:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Install Azure Module as Current User (as opposed to System)\n# '-Scope CurrentUser` specifies that the module should be installed only for the current user. If you don't specify a scope, the default is `AllUsers`, which requires administrator permissions.\n\nInstall-Module -Name Az -Repository PSGallery -Scope CurrentUser\n"})}),"\n",(0,n.jsx)(r.p,{children:"You can install a specific version of the Az module by specifying RequiredVersion, like below:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Install specific version of Azure Modules\n\nInstall-Module -Name Az -RequiredVersion 7.1.0\n"})}),"\n",(0,n.jsx)(r.p,{children:"You will find that the Azure powershell cmdlets will constantly get updated, to resolve bugs, offer new functionality, to update the modules to the ltest you can use:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Update Azure Module\n# The command Get-InstalledModule -Name Az* | Update-Module is used to update all installed PowerShell modules that start with \"Az\".\nSet-PSRepository -Name 'PSGallery' -InstallationPolicy Trusted\nGet-InstalledModule -Name Az* | Update-Module\n"})}),"\n",(0,n.jsx)(r.p,{children:"Az is a collection of different cmdlets, across multiple Azure resource types, to view a list of avaliable commands you use 'Get-Command', like below:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Gets Az Commands\n# Note: Will take a while for all the cmdlets to list.\nGet-Command -Noun Az*\n"})}),"\n",(0,n.jsx)(r.h3,{id:"getting-started-with-azure-powershell-module",children:"Getting started with Azure PowerShell module"}),"\n",(0,n.jsx)(r.p,{children:"Lets connect to Microsoft Azure"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Connect to Azure - Interactive will prompt for credentials\nConnect-AzAccount\n"})}),"\n",(0,n.jsx)(r.p,{children:"If your wanting to connect to Azure, from a device that doesn't supoport the credential prompt, like Azure Cloudshell you can connect using another device, using a device code:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Connect to Azure\nConnect-AzAccount -UseDeviceAuthentication\n"})}),"\n",(0,n.jsx)(r.p,{children:"If you have a Service principal, you can use this to authenticate, commonly used for automation scripts, Azure DevOps agents and GitHub runners."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Connect to Azure using Service Principal authentication\n$SecurePassword = ConvertTo-SecureString -String \"Password123!\" -AsPlainText -Force\n$TenantId = 'yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyy'\n$ApplicationId = 'zzzzzzzz-zzzz-zzzz-zzzz-zzzzzzzz'\n$Credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $ApplicationId, $SecurePassword\nConnect-AzAccount -ServicePrincipal -TenantId $TenantId -Credential $Credential\n"})}),"\n",(0,n.jsx)(r.p,{children:"Once, connected - its time to check what Azure subscriptions you can use."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Get Azure Subscriptions\nGet-AzSubscription\n"})}),"\n",(0,n.jsx)(r.p,{children:"Once you have selected the right Azure subscription to connect to, you can set your Subscription context (modify/delete resources). Add your subscription ID, from the earlier step in between ''."}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Select Azure Subscription\n$subid = ''\nSet-AzContext -SubscriptionId $subid\n"})}),"\n",(0,n.jsx)(r.p,{children:"Now you have connected to your, Azure subscription, it is time to get your Azure resources and Resource Groups"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Get Azure resource groups and resources\nGet-AzResourceGroup | Format-Table\nGet-AzResource | Format-Table\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Get Azure resource\nGet-AzResource\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Get Azure resource by ResourceType\nGet-AzResource | Where-Object {$_.ResourceType -eq 'Microsoft.Network/virtualNetworks'} \n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Sort Azure resource by Name and Resource Group\nGet-AzResource | Where-Object {$_.ResourceType -eq 'Microsoft.Storage/storageAccounts'} | Sort-Object Name\nGet-AzResource | Sort-Object ResourceGroupName \n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Working with Variables\n\n# Working with variables and data types in PowerShell\n$resourceType = 'Microsoft.Network/virtualNetworks'\nGet-AzResource | Where-Object {$_.ResourceType -eq $resourceType}\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'# Using PowerShell operators for comparisons and calculations\n\n$resources = Get-AzResource\n$count = $resources.Count\nWrite-Host "You have $count resources in your Azure subscription."\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'# Scripting constructs: loops and conditional statements\n$resources = Get-AzResource\n\nforeach ($resource in $resources) {\n    if ($resource.ResourceType -eq \'Microsoft.Network/virtualNetworks\') {\n        Write-Host "Found a virtual network: $($resource.Name)"\n        Write-Host "This virtual network is in $($resource.ResourceGroupName)" -ForegroundColor Green\n    }\n}\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'# Scripting constructs: loops and conditional statements\n$subscriptions = Get-AzSubscription\n\nforeach ($subscription in $subscriptions) {\n$resource = Get-AzResource | Where-Object {$_.ResourceType -eq \'Microsoft.Network/virtualNetworks\'} \n\n    if ($resource.ResourceType -eq \'Microsoft.Network/virtualNetworks\') {\n        Write-Host "Found a virtual network: $($resource.Name)" -BackgroundColor Black -ForegroundColor White\n        Write-Host "This virtual network is in $($resource.ResourceGroupName)" -ForegroundColor Green\n        Write-Host "This Virtual Network is in $($subscription.Name)" -ForegroundColor Green\n    }\n}\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'# Error handling in PowerShell\ntry {\n    Get-AzResource -ResourceGroupName "NonexistentResourceGroup" -ErrorAction Stop\n} catch {\n    Write-Host "An error occurred: $_. Make sure you have selected the right Resource Group" -ForegroundColor Red\n}\n'})}),"\n",(0,n.jsx)(r.h3,{id:"resource-creation",children:"Resource Creation"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Import Module\nImport-Module Az -Verbose\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'#Create Azure Resource Group\nNew-AzResourceGroup -Name "MyResourceGroup" -Location "West US"\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Get Regions\nGet-AzLocation | Select-Object -First 1\nGet-AzLocation | Select-Object DisplayName, Location, PhysicalLocation, GeographyGroup | Format-Table\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"ate Azure Resource Group\n$region = 'AustraliaEast'\nNew-AzResourceGroup -Name \"MyResourceGroup$region\" -Location $region\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'# Create a storage account\n$uniqueId = [guid]::NewGuid().ToString().Substring(0,4)\n$region = \'AustraliaEast\'\n$ResourceGroupName = "MyResourceGroup$region"\nNew-AzStorageAccount -ResourceGroupName $ResourceGroupName -Name "mystgacc$uniqueId" -Location $region -SkuName Standard_LRS -AllowBlobPublicAccess $false -verbose\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'#Remove Azure Storage account\n$region = \'AustraliaEast\'\n$ResourceGroupName = $ResourceGroupName\nRemove-AzStorageAccount -ResourceGroupName $ResourceGroupName -Name "mystgacc$uniqueId" -Force -verbose\nGet-AzStorageAccount -ResourceGroupName $ResourceGroupName -Name "mystgacc$uniqueId" -verbose\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Create an Azure Virtual Network\n$region = 'AustraliaEast'\n$ResourceGroupName = 'network-prod-rg'\n$VNetname = 'vnet-prod'\n$subnetname = 'infraservers'\n$subnetAddressPrefix = '10.0.0.0/24'\n\n# Create a resource group\n$ResourceGroup = Get-AzResourceGroup -Name $ResourceGroupName -ErrorAction SilentlyContinue\n\nif ($null -eq $ResourceGroup)\n{\n    Write-Host \"Creating Resource Group $ResourceGroupName in $region\" -ForegroundColor Yellow\n    $ResourceGroup = New-AzResourceGroup -Name $ResourceGroupName -Location $region -Force\n}\nelse\n{\n    Write-Host \"Resource Group $ResourceGroupName already exists in $region\" -ForegroundColor Green\n}\n\n# Create a virtual network\n$AzVNET = New-AzVirtualNetwork -ResourceGroupName $ResourceGroupName -Name $VNetname -AddressPrefix '10.0.0.0/16' -Location $region\n\n# Create a subnet\n$subnetConfig = Add-AzVirtualNetworkSubnetConfig -Name $subnetname -AddressPrefix $subnetAddressPrefix -VirtualNetwork $AzVNET\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Get full object output\n# Alias (This is a pipeline to the Format-List cmdlet (fl is an alias for Format-List). It formats the output as a list of properties for each object. This can make it easier to read the details of the virtual network.)\n\nGet-AzVirtualNetwork -ResourceGroupName $ResourceGroupName -Name $VNetname # | fl\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Alias\n\nGet-Alias  | Select-Object -First 2\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'#splat\n\n$configData = @{\n    ResourceGroupName = "MyResourceGroup"\n    Location = "West US"\n    StorageAccountName = "stgacctest100"\n}\n\ntry {\n    New-AzStorageAccount -ResourceGroupName $configData.ResourceGroupName -Name $configData.StorageAccountName -Location $configData.Location -SkuName Standard_LRS\n} catch {\n    Write-Error "Failed to create storage account: $_"\n}\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:'#splat as parameters\n\n$configData = @{\n    "ResourceGroupName" = "MyResourceGroup"\n    "Location" = "West US"\n    "StorageAccountName" = "stgacctest100"\n    "SkuName" = "Standard_LRS"\n\n}\n\ntry {\n    New-AzStorageAccount @configData\n} catch {\n    Write-Error "Failed to create storage account: $_"\n}\n'})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Tags\n$ResourceGroupName = 'TagTestRG'\nNew-AzResourceGroup -Name $ResourceGroupName -Location 'AustraliaEast'\nSet-AzResourceGroup -Name $ResourceGroupName -Tag @{ Department = \"Finance\"; Project = \"Q1\" }\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"# Get Tag Resource Group\n$ResourceGroupName = 'TagTestRG'\n(Get-AzResourceGroup -Name $ResourceGroupName).Tags\n"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-powershell",children:"$ResourceGroupName = 'TagTestRG'\n$tags = (Get-AzResourceGroup -Name $ResourceGroupName).Tags\n$tags.Remove(\"Project\")\nSet-AzResourceGroup -Name $ResourceGroupName -Tag $tags\n"})})]})}function d(e={}){const{wrapper:r}={...(0,t.a)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},65918:(e,r,o)=>{o.d(r,{Z:()=>n});const n=o.p+"assets/images/BlogHeading-BlogHeading-Microsoft-Azure-Management-with-PowerShell-788b8586e4737f49ce3303670020bee9.gif"},11151:(e,r,o)=>{o.d(r,{Z:()=>l,a:()=>a});var n=o(67294);const t={},s=n.createContext(t);function a(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);
"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[13339],{48172:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>a,frontMatter:()=>t,metadata:()=>l,toc:()=>o});var l=i(94690),r=i(74848),s=i(28453);const t={date:"2021-03-26 00:00:00 +1300",title:"Allow Azure DevOps Microsoft Hosted Agent to communicate with Azure KeyVault",authors:["Luke"],tags:["Azure"],toc:!1},c=void 0,d={authorsImageUrls:[void 0]},o=[];function h(e){const n={a:"a",em:"em",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"It is best practice to lock down Azure resources to be accessible by location and services that is only to what's required and, the Azure Key vault is no exception."}),"\n",(0,r.jsx)(n.p,{children:"When using Microsoft Hosted Agents in Azure DevOps, you need to make sure that the AzureCloud IPs for the Azure DevOps regions are opened on the Firewall."}),"\n",(0,r.jsx)(n.p,{children:"In my case, I was in the: AustraliaEast region and needed to identify and add the following 'AzureCloud' Address Ranges to the KeyVault firewall:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:['"name": "',(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.em,{children:"AzureCloud.australiaeast"})}),'",']}),"\n",(0,r.jsx)(n.li,{children:'"id": "AzureCloud.australiaeast",'}),"\n",(0,r.jsx)(n.li,{children:'"properties": {'}),"\n",(0,r.jsx)(n.li,{children:'"changeNumber": 13,'}),"\n",(0,r.jsx)(n.li,{children:'"region": "australiaeast",'}),"\n",(0,r.jsx)(n.li,{children:'"regionId": 3,'}),"\n",(0,r.jsx)(n.li,{children:'"platform": "Azure",'}),"\n",(0,r.jsx)(n.li,{children:'"systemService": "",'}),"\n",(0,r.jsx)(n.li,{children:'"addressPrefixes": ['}),"\n",(0,r.jsx)(n.li,{children:'"13.70.64.0/18",'}),"\n",(0,r.jsx)(n.li,{children:'"13.72.224.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"13.73.192.0/20",'}),"\n",(0,r.jsx)(n.li,{children:'"13.75.128.0/17",'}),"\n",(0,r.jsx)(n.li,{children:'"13.104.211.128/26",'}),"\n",(0,r.jsx)(n.li,{children:'"13.105.16.192/26",'}),"\n",(0,r.jsx)(n.li,{children:'"13.105.20.128/26",'}),"\n",(0,r.jsx)(n.li,{children:'"13.105.52.192/26",'}),"\n",(0,r.jsx)(n.li,{children:'"13.105.53.128/26",'}),"\n",(0,r.jsx)(n.li,{children:'"20.37.192.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"20.38.112.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"20.40.64.0/20",'}),"\n",(0,r.jsx)(n.li,{children:'"20.40.80.0/21",'}),"\n",(0,r.jsx)(n.li,{children:'"20.40.120.0/21",'}),"\n",(0,r.jsx)(n.li,{children:'"20.40.176.0/20",'}),"\n",(0,r.jsx)(n.li,{children:'"20.42.192.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"20.43.96.0/20",'}),"\n",(0,r.jsx)(n.li,{children:'"20.47.37.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"20.47.122.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"20.53.32.0/28",'}),"\n",(0,r.jsx)(n.li,{children:'"20.53.40.0/21",'}),"\n",(0,r.jsx)(n.li,{children:'"20.53.64.0/18",'}),"\n",(0,r.jsx)(n.li,{children:'"20.53.128.0/17",'}),"\n",(0,r.jsx)(n.li,{children:'"20.58.128.0/18",'}),"\n",(0,r.jsx)(n.li,{children:'"20.60.72.0/22",'}),"\n",(0,r.jsx)(n.li,{children:'"20.60.182.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"20.70.128.0/17",'}),"\n",(0,r.jsx)(n.li,{children:'"20.135.120.0/21",'}),"\n",(0,r.jsx)(n.li,{children:'"20.150.66.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"20.150.92.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"20.150.117.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"20.157.44.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"20.188.128.0/17",'}),"\n",(0,r.jsx)(n.li,{children:'"20.190.142.0/25",'}),"\n",(0,r.jsx)(n.li,{children:'"20.190.167.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"20.191.192.0/18",'}),"\n",(0,r.jsx)(n.li,{children:'"20.193.0.0/18",'}),"\n",(0,r.jsx)(n.li,{children:'"20.193.64.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"23.101.208.0/20",'}),"\n",(0,r.jsx)(n.li,{children:'"40.79.160.0/20",'}),"\n",(0,r.jsx)(n.li,{children:'"40.79.211.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"40.82.32.0/22",'}),"\n",(0,r.jsx)(n.li,{children:'"40.82.192.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"40.87.208.0/22",'}),"\n",(0,r.jsx)(n.li,{children:'"40.90.18.0/28",'}),"\n",(0,r.jsx)(n.li,{children:'"40.90.30.0/25",'}),"\n",(0,r.jsx)(n.li,{children:'"40.90.130.80/28",'}),"\n",(0,r.jsx)(n.li,{children:'"40.90.130.208/28",'}),"\n",(0,r.jsx)(n.li,{children:'"40.90.140.32/27",'}),"\n",(0,r.jsx)(n.li,{children:'"40.90.142.160/27",'}),"\n",(0,r.jsx)(n.li,{children:'"40.90.147.64/27",'}),"\n",(0,r.jsx)(n.li,{children:'"40.90.150.0/27",'}),"\n",(0,r.jsx)(n.li,{children:'"40.112.37.128/26",'}),"\n",(0,r.jsx)(n.li,{children:'"40.126.14.0/25",'}),"\n",(0,r.jsx)(n.li,{children:'"40.126.39.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"40.126.224.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"52.108.40.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"52.108.83.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"52.109.112.0/22",'}),"\n",(0,r.jsx)(n.li,{children:'"52.111.224.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"52.113.88.0/22",'}),"\n",(0,r.jsx)(n.li,{children:'"52.113.103.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"52.114.16.0/22",'}),"\n",(0,r.jsx)(n.li,{children:'"52.114.58.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"52.114.192.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"52.115.98.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"52.120.158.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"52.121.108.0/22",'}),"\n",(0,r.jsx)(n.li,{children:'"52.143.199.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"52.143.200.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"52.147.0.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"52.156.160.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"52.187.192.0/18",'}),"\n",(0,r.jsx)(n.li,{children:'"52.232.136.0/21",'}),"\n",(0,r.jsx)(n.li,{children:'"52.232.154.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"52.237.192.0/18",'}),"\n",(0,r.jsx)(n.li,{children:'"52.239.130.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"52.239.226.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"52.245.16.0/22",'}),"\n",(0,r.jsx)(n.li,{children:'"104.44.90.64/26",'}),"\n",(0,r.jsx)(n.li,{children:'"104.44.93.96/27",'}),"\n",(0,r.jsx)(n.li,{children:'"104.44.95.48/28",'}),"\n",(0,r.jsx)(n.li,{children:'"104.46.29.0/24",'}),"\n",(0,r.jsx)(n.li,{children:'"104.46.30.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"104.209.80.0/20",'}),"\n",(0,r.jsx)(n.li,{children:'"104.210.64.0/18",'}),"\n",(0,r.jsx)(n.li,{children:'"191.238.66.0/23",'}),"\n",(0,r.jsx)(n.li,{children:'"191.239.64.0/19",'}),"\n",(0,r.jsx)(n.li,{children:'"2603:1010::/46",'}),"\n",(0,r.jsx)(n.li,{children:'"2603:1010:5::/48",'}),"\n",(0,r.jsx)(n.li,{children:'"2603:1010:6::/48",'}),"\n",(0,r.jsx)(n.li,{children:'"2603:1016:1400:60::/59",'}),"\n",(0,r.jsx)(n.li,{children:'"2603:1016:2402::/48",'}),"\n",(0,r.jsx)(n.li,{children:'"2603:1016:2500:c::/64",'}),"\n",(0,r.jsx)(n.li,{children:'"2603:1017:0:60::/59"'}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You only need to add the IP ranges of the Region that your Azure DevOps instance sits in."}),"\n",(0,r.jsx)(n.p,{children:"You can find the region that your Azure DevOps instance sits in by following the article below:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops&tabs=yaml&WT.mc_id=AZ-MVP-5004796#networking",children:"Microsoft-hosted agents for Azure Pipelines - Azure Pipelines"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You can retrieve the list of Azure IP Ranges and Service Tags from the following Microsoft JSON file:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.microsoft.com/en-us/download/details.aspx?id=56519",children:"Download Azure IP Ranges and Service Tags \u2013 Public Cloud from Official Microsoft Download Center"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Note: These IP ranges can change and update, depending on Microsoft removing and adding new datacenter capability, it is always worth rechecking the list if you find you start having problems with intermittent connectivity to check whether new ranges have been added that haven't been whitelisted."})})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var l=i(96540);const r={},s=l.createContext(r);function t(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(s.Provider,{value:n},e.children)}},94690:e=>{e.exports=JSON.parse('{"permalink":"/2021/03/26/allow-azure-devops-microsoft-hosted-agent-to-communicate-with-azure-keyvault","source":"@site/blog/2021-03-26-allow-azure-devops-microsoft-hosted-agent-to-communicate-with-azure-keyvault.md","title":"Allow Azure DevOps Microsoft Hosted Agent to communicate with Azure KeyVault","description":"It is best practice to lock down Azure resources to be accessible by location and services that is only to what\'s required and, the Azure Key vault is no exception.","date":"2021-03-26T00:00:00.000Z","tags":[{"inline":true,"label":"Azure","permalink":"/tags/azure"}],"readingTime":2.25,"hasTruncateMarker":false,"authors":[{"name":"Luke Murray","title":"Author","url":"https://luke.geek.nz","imageURL":"https://luke.geek.nz/img/logo.png","key":"Luke","page":null}],"frontMatter":{"date":"2021-03-26 00:00:00 +1300","title":"Allow Azure DevOps Microsoft Hosted Agent to communicate with Azure KeyVault","authors":["Luke"],"tags":["Azure"],"toc":false},"unlisted":false,"prevItem":{"title":"Azure WebApp 500 Errors reporting from AspNetCoreModule","permalink":"/azure/azure-webapp-500-errors-reporting-from-aspnetcoremodule"},"nextItem":{"title":"Failed to delete the private endpoint. Error: Call to Microsoft.Storage/storageAccounts failed","permalink":"/2021/03/26/failed-to-delete-the-private-endpoint.error-call-to-microsoft.storage-storageaccounts-failed"}}')}}]);
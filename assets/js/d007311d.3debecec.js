"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[31067],{77204:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var o=n(74848),r=n(28453);const s={date:"2022-08-17 00:00:00 +1200",title:"Connect to Azure SQL Database in a Jupyter Notebook using Python",authors:["Luke"],tags:["Azure"],toc:!1,header:{teaser:"/uploads/juptyer_notebook.png"}},i=void 0,a={permalink:"/2022/08/17/connect-to-azure-sql-database-in-a-jupyter-notebook-using-python",source:"@site/blog/2022-08-17-connect-to-azure-sql-database-in-a-jupyter-notebook-using-python.md",title:"Connect to Azure SQL Database in a Jupyter Notebook using Python",description:"Jupyter Notebooks, commonly used by Data Scientists and Students, allow you to run code, such as Python and PowerShell, inside a Notebook format and display the output inside the notebook; this is useful for teaching a subject or displaying up-to-date information.",date:"2022-08-17T00:00:00.000Z",tags:[{label:"Azure",permalink:"/tags/azure"}],readingTime:2.405,hasTruncateMarker:!1,authors:[{name:"Luke Murray",title:"Author",url:"https://luke.geek.nz",imageURL:"https://luke.geek.nz/img/logo.png",key:"Luke"}],frontMatter:{date:"2022-08-17 00:00:00 +1200",title:"Connect to Azure SQL Database in a Jupyter Notebook using Python",authors:["Luke"],tags:["Azure"],toc:!1,header:{teaser:"/uploads/juptyer_notebook.png"}},unlisted:!1,prevItem:{title:"Microsoft Azure - Operational Cost Optimization Tasks",permalink:"/2022/08/18/microsoft-azure-cost-optimization-tasks"},nextItem:{title:"Create a Public Holidays API using Microsoft Azure",permalink:"/2022/08/09/create-a-public-holidays-api-using-microsoft-azure"}},c={authorsImageUrls:[void 0]},d=[];function l(e){const t={a:"a",code:"code",em:"em",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://jupyter.org/",title:"Jupyter",children:"Jupyter"})," Notebooks, commonly used by Data Scientists and Students, allow you to run code, such as Python and PowerShell, inside a Notebook format and display the output inside the notebook; this is useful for teaching a subject or displaying up-to-date information."]}),"\n",(0,o.jsx)(t.p,{children:"I am not a python or Jupyter expert, so this article will be brief on how I was able to connect to an Azure SQL Database using Microsoft Entra ID authentication and run a query."}),"\n",(0,o.jsxs)(t.p,{children:["To run a Jupyter Notebook, you can install ",(0,o.jsx)(t.a,{href:"https://www.anaconda.com/products/distribution",title:"Anaconda",children:"Anaconda"})," and then use that to download Juypter to run the notebooks from a locally ",(0,o.jsx)(t.em,{children:"(or server)"})," hosted web-based interface."]}),"\n",(0,o.jsxs)(t.p,{children:["However, today I will be using Visual Studio Code with the ",(0,o.jsx)(t.a,{href:"https://code.visualstudio.com/docs/datascience/jupyter-notebooks",title:" Jupyter Notebooks in VS Code ",children:"Jupyter extension"})," on a windows endpoint."]}),"\n",(0,o.jsx)(t.p,{children:"Make sure you install:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://www.python.org/downloads/",title:"Python",children:"Python"})}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://pypi.org/project/pyodbc/",title:"pyodbc ",children:"pyodbc"})," library"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/sql/connect/odbc/microsoft-odbc-driver-for-sql-server",title:"Microsoft ODBC Driver for SQL Server",children:"Microsoft ODBC Driver for SQL Server"})," ",(0,o.jsx)(t.em,{children:"(has to be v17 or newer to support Microsoft Entra ID authentication)"}),"."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://code.visualstudio.com/",title:"Visual Studio Code",children:"Visual Studio Code"})," + ",(0,o.jsx)(t.a,{href:"https://code.visualstudio.com/docs/datascience/jupyter-notebooks",title:" Jupyter Notebooks in VS Code",children:"Jupyter extension"})]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"Note: Jupyter notebook extensions end in '*.ipynb'."})}),"\n",(0,o.jsx)(t.p,{children:"Once all the prerequisites are installed, it's time to create the Notebook."}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Open ",(0,o.jsx)(t.strong,{children:"Visual Studio Code"})]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Click ",(0,o.jsx)(t.strong,{children:"File"}),", ",(0,o.jsx)(t.strong,{children:"New File"})]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Select ",(0,o.jsx)(t.strong,{children:"Jupyter Notebook"})]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Press ",(0,o.jsx)(t.strong,{children:"+ Code"})," ",(0,o.jsx)(t.em,{children:"(to add a Code snippet)"})]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"First, we need to import the pyodbc library:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"#Libraries\nimport pyodbc\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Then we need to ",(0,o.jsx)(t.strong,{children:"add the snippet to connect to the SQL database"})," ",(0,o.jsxs)(t.em,{children:["(this can be in a separate Codeblock or the same code block, as long as the import is run before the SQL connection is made - ",(0,o.jsx)(t.strong,{children:"make sure you update the server and database variables,"})," to match your environment!)"]}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"#Connection to SQL database\n\n\nserver = 'tcp:SQLSERVER.database.windows.net' \ndatabase = 'DBNAME' \nusername = 'user@contoso.com' \npassword = 'password' \n\n\nconnection = pyodbc.connect('Driver={ODBC Driver 18 for SQL Server};Server='+server+',1433;Database='+database+';Uid='+username+';Pwd='+password+';Encrypt=yes;TrustServerCertificate=no;Connection Timeout=180;Authentication=ActiveDirectoryInteractive')\ncursor = connection.cursor()\n"})}),"\n",(0,o.jsx)(t.p,{children:"The 'Authentication=ActiveDirectoryInteractive' parameter as part of the Connection string will prompt an interactive Microsoft Entra ID prompt to display and ask for credentials to be logged in; this includes MFA support. Using this method, the username and password variables are simply placeholders."}),"\n",(0,o.jsxs)(t.p,{children:["If you want to hardcode credentials into the Notebook ",(0,o.jsx)(t.em,{children:"(not recommended)"}),", you can remove the '",(0,o.jsx)(t.em,{children:"Authentication=ActiveDirectoryInteractive"}),"' section and enter the credentials into the username and password field."]}),"\n",(0,o.jsxs)(t.p,{children:["Now that we have connected to the database, let us ",(0,o.jsx)(t.strong,{children:"run a test query to obtain the SQL version"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'#Sample select query\ncursor.execute("SELECT @@version;")\nrow = cursor.fetchone()\nwhile row:\nprint(row[0])\nrow = cursor.fetchone()\n'})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Jupyter python SQL connection",src:n(21096).A+"",width:"1326",height:"545"})}),"\n",(0,o.jsx)(t.p,{children:"Congratulations, you have successfully connected to an Azure SQL database and ran a query against the database."}),"\n",(0,o.jsx)(t.p,{children:"If the connection to SQL appears to be stalling, check to make sure the Azure authentication window, isn't hidden behind another window."}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.em,{children:"A"})," ",(0,o.jsx)(t.a,{href:"https://gist.github.com/lukemurraynz/6636632309bc2bf2b1b37676ee0881ce",title:"python.sqldb.text",children:(0,o.jsx)(t.em,{children:"GIST"})})," ",(0,o.jsx)(t.em,{children:"has been created, with the code as well, in case issues are copied from the website."})]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},21096:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/juptyer_notebook_query-2725747992751ea8ac1afcb105f1c3b1.png"},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var o=n(96540);const r={},s=o.createContext(r);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);
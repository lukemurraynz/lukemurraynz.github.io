"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[87910],{56785:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var a=t(36826),i=t(74848),s=t(28453);const r={title:"Expose Akahu APIs via Azure API Management MCP Server",metaDescription:"Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code.",tags:["Azure","API Management","MCP","Open Banking","Akahu"],categories:["Azure"],authors:["Luke"],slug:"azure/akahu-mcp-apim",keywords:["Azure API Management","MCP Server","Akahu","Open Banking New Zealand","API Security"],description:"Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code.",date:new Date("2025-08-10T07:59:51.617Z")},o=void 0,d={authorsImageUrls:[void 0]},l=[{value:"\ud83d\ude80 Overview",id:"-overview",level:2},{value:"\ud83e\uddf0 Prerequisites",id:"-prerequisites",level:2},{value:"\ud83d\uddfa\ufe0f Quick Steps",id:"\ufe0f-quick-steps",level:2},{value:"\ud83d\udd0e Why Akahu + MCP?",id:"-why-akahu--mcp",level:2},{value:"\ud83d\udd10 Get Akahu Credentials",id:"-get-akahu-credentials",level:2},{value:"\ud83c\udfd7\ufe0f Create Azure API Management Instance",id:"\ufe0f-create-azure-api-management-instance",level:2},{value:"\ud83c\udf10 Add the Akahu HTTP API",id:"-add-the-akahu-http-api",level:2},{value:"\ud83e\uddfe Document Operations",id:"-document-operations",level:2},{value:"\ud83e\uddea Test the API (Manual)",id:"-test-the-api-manual",level:2},{value:"\ud83d\udee0\ufe0f Add Inbound Headers via Policy",id:"\ufe0f-add-inbound-headers-via-policy",level:2},{value:"\u2699\ufe0f Enable MCP Server Support (Preview)",id:"\ufe0f-enable-mcp-server-support-preview",level:2},{value:"\ud83e\udde9 Add MCP Endpoint Policy",id:"-add-mcp-endpoint-policy",level:2},{value:"\ud83d\udda5\ufe0f Configure Local MCP Client",id:"\ufe0f-configure-local-mcp-client",level:2},{value:"\u25b6\ufe0f Run and Verify",id:"\ufe0f-run-and-verify",level:2},{value:"\ud83d\udd12 Security &amp; Governance Considerations",id:"-security--governance-considerations",level:2},{value:"\ud83e\uddef Troubleshooting",id:"-troubleshooting",level:2}];function h(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["A recent release to Azure API Management is - MCP server support, the ability to expose a ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/api-management/export-rest-mcp-server?WT.mc_id=AZ-MVP-5004796",children:"REST API in API Management as an MCP server"}),"."]}),"\n","\n",(0,i.jsxs)(n.p,{children:["Today we are going to look at how to expose an REST API as an MCP server through your API Management instance, with ",(0,i.jsx)(n.a,{href:"https://www.akahu.nz/",children:"Akahu"})," APIs as my example."]}),"\n",(0,i.jsx)(n.h2,{id:"-overview",children:"\ud83d\ude80 Overview"}),"\n",(0,i.jsx)(n.p,{children:"This guide walks through publishing Akahu\u2019s open banking-style REST endpoints through Azure API Management (APIM) and exposing them as an MCP server consumable by compatible developer tools (e.g., VS Code extensions). You\u2019ll configure headers via policies, secure tokens with named values, and register the MCP server locally."}),"\n",(0,i.jsx)(n.h2,{id:"-prerequisites",children:"\ud83e\uddf0 Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before starting, ensure you have:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Item"}),(0,i.jsx)(n.th,{children:"Requirement"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Azure Subscription"}),(0,i.jsx)(n.td,{children:"Contributor (or equivalent) rights to create API Management"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Azure API Management"}),(0,i.jsx)(n.td,{children:"Standard tier (Preview features enabled for MCP)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Akahu Account"}),(0,i.jsx)(n.td,{children:"Developer portal access + Demo or real bank connection"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Akahu Credentials"}),(0,i.jsx)(n.td,{children:"App Token, User Token, Base URL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"VS Code"}),(0,i.jsx)(n.td,{children:"Latest version + MCP-capable extension (e.g., GitHub Copilot supporting MCP)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Network Access"}),(0,i.jsx)(n.td,{children:"Outbound HTTPS to api.akahu.io and your APIM gateway"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-quick-steps",children:"\ud83d\uddfa\ufe0f Quick Steps"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Step"}),(0,i.jsx)(n.th,{children:"Action"}),(0,i.jsx)(n.th,{children:"Outcome"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"1"}),(0,i.jsx)(n.td,{children:"Create Akahu demo connection"}),(0,i.jsx)(n.td,{children:"Obtain App & User tokens"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2"}),(0,i.jsx)(n.td,{children:"Provision APIM instance"}),(0,i.jsx)(n.td,{children:"API gateway ready"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3"}),(0,i.jsx)(n.td,{children:"Add HTTP API (Akahu)"}),(0,i.jsx)(n.td,{children:"Base operations onboarded"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4"}),(0,i.jsx)(n.td,{children:"Define operations (accounts, me)"}),(0,i.jsx)(n.td,{children:"REST surface defined"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"5"}),(0,i.jsx)(n.td,{children:"Test with raw headers"}),(0,i.jsx)(n.td,{children:"Validate connectivity"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"6"}),(0,i.jsx)(n.td,{children:"Create Named Values"}),(0,i.jsx)(n.td,{children:"Centralize secrets"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"7"}),(0,i.jsx)(n.td,{children:"Add inbound policy for headers"}),(0,i.jsx)(n.td,{children:"Automate header injection"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"8"}),(0,i.jsx)(n.td,{children:"Enable MCP Servers (Preview)"}),(0,i.jsx)(n.td,{children:"Feature available in portal"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"9"}),(0,i.jsx)(n.td,{children:"Expose API as MCP server"}),(0,i.jsx)(n.td,{children:"Tools generated for operations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"Add MCP-specific policy"}),(0,i.jsx)(n.td,{children:"Headers applied to MCP calls"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"11"}),(0,i.jsx)(n.td,{children:"Configure local mcp.json"}),(0,i.jsx)(n.td,{children:"Client can reach MCP endpoint"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"12"}),(0,i.jsx)(n.td,{children:"Invoke tools in editor"}),(0,i.jsx)(n.td,{children:"Accounts/me data accessible"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"-why-akahu--mcp",children:"\ud83d\udd0e Why Akahu + MCP?"}),"\n",(0,i.jsxs)(n.p,{children:["I've been reading up a lot on ",(0,i.jsx)(n.a,{href:"https://www.consumer.org.nz/articles/what-is-open-banking",children:"open banking"}),", which is a system that enables financial apps and technologies to connect securely and directly with customers\u2019 bank accounts with the customer\u2019s consent, and seems to be ahead in Australian banking, but New Zealand banking is catching up, and with an API driven intermediary such as ",(0,i.jsx)(n.a,{href:"https://www.akahu.nz/",children:"Akahu"}),", allows me to connect to my bank accounts across various banks, and aggregate my financial data in one place."]}),"\n",(0,i.jsx)(n.p,{children:"So naturally, I wondered how I could expose the Akahu APIs and make them available through an MCP server in Azure API Management."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Akahu list accounts",src:t(63664).A+"",width:"964",height:"634"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Accounts view returned through the Akahu API (demo data)."})]}),"\n",(0,i.jsx)(n.h2,{id:"-get-akahu-credentials",children:"\ud83d\udd10 Get Akahu Credentials"}),"\n",(0,i.jsx)(n.p,{children:"To get started, we will need credentials from Akahu to connect."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Navigate to the ",(0,i.jsx)(n.a,{href:"https://www.akahu.nz/",children:"Akahu"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Log in and create an account if you don't have one."}),"\n",(0,i.jsxs)(n.li,{children:["Once logged in, navigate to the ",(0,i.jsx)(n.a,{href:"https://developer.akahu.nz/",children:"Akahu Developer Portal"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Go to Developers and create a new connection, for the purposes of this tutorial, I will be creating a Connection to the Demo bank, but you can have more than one connection to multiple New Zealand-based banks, ANZ, Westpac, including Sharesies and the Inland Revenue Department."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Create API",src:t(25499).A+"",width:"466",height:"938"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Creating a demo bank connection in the Akahu developer portal."})]}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Once the connection has been stood up, make note of the  base URL, App Token, and the User Token as we will need these later."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-create-azure-api-management-instance",children:"\ud83c\udfd7\ufe0f Create Azure API Management Instance"}),"\n",(0,i.jsxs)(n.p,{children:["Once we have these details, it's time for API Management, so create an ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/azure/api-management/api-management-key-concepts?WT.mc_id=AZ-MVP-5004796",children:"Azure API Management"})," instance, in my demo I am using a Standard Tier API Management instance in the New Zealand North Azure region."]}),"\n",(0,i.jsx)(n.h2,{id:"-add-the-akahu-http-api",children:"\ud83c\udf10 Add the Akahu HTTP API"}),"\n",(0,i.jsx)(n.p,{children:"Now we need to add the Akahu APIs into Azure API Management, so add in an HTTP API:"}),"\n",(0,i.jsxs)(n.p,{children:["Display name: akahu.nz ",(0,i.jsx)(n.em,{children:"(this could be what you want it to be)"}),"\nURL: ",(0,i.jsx)(n.a,{href:"https://api.akahu.io/v1/",children:"https://api.akahu.io/v1/"}),"\nSuffix: mcp  ",(0,i.jsx)(n.em,{children:"(this could be what you want it to be)"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Akahu add API",src:t(73715).A+"",width:"1416",height:"972"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Adding the Akahu HTTP API in Azure API Management."})]}),"\n",(0,i.jsx)(n.p,{children:"Then you can add your Operations, because I am using the Akahu Demo bank, I will be adding the following operations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"accounts"}),"\n",(0,i.jsx)(n.li,{children:"me"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Akahu Add Accounts",src:t(59368).A+"",width:"1285",height:"408"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Defining the accounts operation."})]}),"\n",(0,i.jsx)(n.h2,{id:"-document-operations",children:"\ud83e\uddfe Document Operations"}),"\n",(0,i.jsx)(n.p,{children:"Make sure you fill out a description, as this will be parsed through as the description of the MCP Tool."}),"\n",(0,i.jsx)(n.h2,{id:"-test-the-api-manual",children:"\ud83e\uddea Test the API (Manual)"}),"\n",(0,i.jsx)(n.p,{children:"Make sure you test the API using the Test functionality directly in API Management, you should get a response back with your accounts, and the details of the account, you will need to specify the X-Akahu-Id and Authorization headers."}),"\n",(0,i.jsx)(n.p,{children:"The X-Akahu-Id is your app_token\nThe Authorization is your user token."}),"\n",(0,i.jsxs)(n.p,{children:["Make sure you add Bearer to the front of your user token, so it looks like this: ",(0,i.jsx)(n.code,{children:"Bearer <user_token>"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Test Akahu",src:t(5548).A+"",width:"1637",height:"1124"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Testing the accounts operation with required headers."})]}),"\n",(0,i.jsx)(n.p,{children:"Now that we have tested that the API is working and we can call the Accounts through the rest API via API Management, the next thing we need to do is add the authorization and user tokens as Named Values, so they can be referenced in the MCP calls."}),"\n",(0,i.jsx)(n.p,{children:"In Azure API Management, select Named values, and add in 2 new values:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Authorization, which will have the value of the user token."}),"\n",(0,i.jsx)(n.li,{children:"X-Akahu-Id, which will have the value of the app token."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"(In a scenario for Production, ideally these values will be stored and referenced in an Azure Key Vault, but for the purposes of this demo, we will be storing them in Named Values.)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"API Named Values",src:t(39715).A+"",width:"1235",height:"752"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Named values configured for secure header injection."})]}),"\n",(0,i.jsx)(n.p,{children:"You could add these values as input into the Header for the MCP Server calls, but in my case, I am using them directly in API Management."}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-add-inbound-headers-via-policy",children:"\ud83d\udee0\ufe0f Add Inbound Headers via Policy"}),"\n",(0,i.jsx)(n.p,{children:"Now that we have added the values, we need to create a new API Management policy so that it will pick up the named values and add them to the header of any future requests."}),"\n",(0,i.jsx)(n.p,{children:"In API Management, navigate back to your API and select All operations, and select Edit on the Base policy."}),"\n",(0,i.jsx)(n.p,{children:"Add in the following to the Inbound portion of the policy:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:' <inbound>\n        <set-header name="X-Akahu-Id" exists-action="override">\n            <value>{{X-Akahu-Id}}</value>\n        </set-header>\n        <set-header name="Authorization" exists-action="override">\n            <value>Bearer {{Authorization}}</value>\n        </set-header>\n    </inbound>\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Add header values",src:t(95262).A+"",width:"1730",height:"801"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Policy editor showing inbound header injection."})]}),"\n",(0,i.jsx)(n.p,{children:"This will ensure that the headers are added to the request when it is made to the Akahu API."}),"\n",(0,i.jsx)(n.p,{children:"Now you can retest, without needing to add in the Id and Authorization headers, and you should get the same response back as before - 200."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"API Named Values policy test",src:t(15813).A+"",width:"1298",height:"950"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Successful 200 response after policy application."})]}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-enable-mcp-server-support-preview",children:"\u2699\ufe0f Enable MCP Server Support (Preview)"}),"\n",(0,i.jsx)(n.p,{children:"Next up is enabling the MCP server support, so navigate to the API Management instance, and MCP Servers (Preview)."}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:'If you do not see the "MCP Servers (Preview)" option, your Azure API Management instance may be running an older version that does not yet support MCP server features.'}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"How to enable AI Gateway capabilities:"})}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"In the Azure portal, navigate to your API Management instance."}),"\n",(0,i.jsxs)(n.li,{children:["Go to ",(0,i.jsx)(n.strong,{children:"Service Updates (preview)"})," in the left-hand menu."]}),"\n",(0,i.jsxs)(n.li,{children:["Select ",(0,i.jsx)(n.strong,{children:"Update Group"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Choose ",(0,i.jsx)(n.strong,{children:"AI Gateway Early"})," to opt into the early update group that enables MCP server support."]}),"\n"]}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"AI Gateway",src:t(65577).A+"",width:"1984",height:"717"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Enabling AI Gateway early update group."})]}),(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," The AI Gateway Early update group is typically available for API Management instances running on the Consumption or Developer tier, and may not be available for all regions or SKUs. If you are unsure, check the ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/api-management/release-notes/",children:"Azure API Management release notes"})," for the latest supported features and version information."]}),"\n"]}),(0,i.jsx)(n.p,{children:"Also, be aware of the maintenance window; you may need to wait for the maintenance window for the update to take effect. Even though MCP Servers may display and allow you to add, you may encounter errors until the update is fully rolled out. If you experience issues, try again after your maintenance window has passed."})]}),"\n",(0,i.jsx)(n.p,{children:"Now click Create MCP server, and select Expose an API as an MCP server, and select the API you created earlier, and give it a name, I will call it akahu-nz-mcp, select the API operations that you want to expose into the MCP Server, these will become the Tools that can be called from from a MCP client."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Create MCP Server",src:t(49166).A+"",width:"1991",height:"938"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Wizard to expose API as an MCP server."})]}),"\n",(0,i.jsx)(n.h2,{id:"-add-mcp-endpoint-policy",children:"\ud83e\udde9 Add MCP Endpoint Policy"}),"\n",(0,i.jsx)(n.p,{children:"Now navigate to Policies, as you can see, you can have separate policies for MCP endpoints than the API endpoints, so add in the headers again."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'\x3c!--\n    - Policies are applied in the order they appear.\n    - Position <base/> inside a section to inherit policies from the outer scope.\n    - Comments within policies are not preserved.\n--\x3e\n\x3c!-- Add policies as children to the <inbound>, <outbound>, <backend>, and <on-error> elements --\x3e\n<policies>\n\t\x3c!-- Throttle, authorize, validate, cache, or transform the requests --\x3e\n\t<inbound>\n\t\t<base />\n\t\t<set-header name="X-Akahu-Id" exists-action="override">\n\t\t\t<value>{{X-Akahu-Id}}</value>\n\t\t</set-header>\n\t\t<set-header name="Authorization" exists-action="override">\n\t\t\t<value>Bearer {{Authorization}}</value>\n\t\t</set-header>\n\t</inbound>\n\t\x3c!-- Control if and how the requests are forwarded to services  --\x3e\n\t<backend>\n\t\t<base />\n\t</backend>\n\t\x3c!-- Customize the responses --\x3e\n\t<outbound>\n\t\t<base />\n\t</outbound>\n\t\x3c!-- Handle exceptions and customize error responses  --\x3e\n\t<on-error>\n\t\t<base />\n\t</on-error>\n</policies>\n'})}),"\n",(0,i.jsx)(n.p,{children:"Once that has been completed and save, the endpoint should be available for use."}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-configure-local-mcp-client",children:"\ud83d\udda5\ufe0f Configure Local MCP Client"}),"\n",(0,i.jsx)(n.p,{children:"So let us test, to do this we will use Visual Studio Code, so launch GitHub Copilot chat, and select Add MCP Server to open the mcp.json file, and add the following MCP server configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "servers": {\n    "akahu": {\n      "type": "http",\n      "url": "https://<your-apim-instance-name>.azure-api.net/akahu-nz-mcp/mcp",\n      "headers": {\n        "Ocp-Apim-Subscription-Key": "<your-subscription-key>"\n      },\n      "timeout": 30000\n    }\n  },\n  "inputs": []\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Although we no longer need to add the X-Akahu-Id and Authorization headers, we still need to add the Ocp-Apim-Subscription-Key header, which is the subscription key for your API Management instance, so obtain this from the Azure Portal, navigate to your API Management instance, and select Subscription keys, and copy a key that has access to the API."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"Akahu MCP mcp.json",src:t(37715).A+"",width:"772",height:"333"}),"\n",(0,i.jsx)(n.em,{children:"Figure: Example mcp.json configuration with subscription key."})]}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-run-and-verify",children:"\u25b6\ufe0f Run and Verify"}),"\n",(0,i.jsx)(n.p,{children:"Finally, run the MCP server, and you should be able to see the Akahu accounts exposed as tools you can invoke, allowing you to call the Akahu APIs through the MCP interface."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"MCP Server Running",src:t(59385).A+"",width:"846",height:"716"}),"\n",(0,i.jsx)(n.em,{children:"Figure: MCP client showing available Akahu tools."})]}),"\n",(0,i.jsx)(n.h2,{id:"-security--governance-considerations",children:"\ud83d\udd12 Security & Governance Considerations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Prefer Azure Key Vault integration with APIM Named Values (secret type) instead of storing tokens directly."}),"\n",(0,i.jsx)(n.li,{children:"Rotate Akahu tokens periodically; update Named Values without redeploying APIs."}),"\n",(0,i.jsxs)(n.li,{children:["Apply rate limiting (e.g., ",(0,i.jsx)(n.code,{children:"<rate-limit-by-key>"}),") to protect upstream Akahu services."]}),"\n",(0,i.jsx)(n.li,{children:"Use separate APIM Products and subscription keys per environment (dev/test/prod) to isolate usage."}),"\n",(0,i.jsx)(n.li,{children:"Log requests (omit sensitive headers) via Application Insights for auditing."}),"\n",(0,i.jsx)(n.li,{children:"Avoid over-broad scopes when future Akahu endpoints require granular permissions."}),"\n",(0,i.jsx)(n.li,{children:"For production, add validation policies (JSON schema, response caching as appropriate) and observability (tracing, metrics)."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-troubleshooting",children:"\ud83e\uddef Troubleshooting"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Symptom"}),(0,i.jsx)(n.th,{children:"Cause"}),(0,i.jsx)(n.th,{children:"Fix"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"401 from Akahu"}),(0,i.jsx)(n.td,{children:"Missing or malformed Authorization header"}),(0,i.jsxs)(n.td,{children:["Confirm policy injected ",(0,i.jsx)(n.code,{children:"Bearer <token>"})," and token not expired"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"401 after adding policy"}),(0,i.jsx)(n.td,{children:"Policy saved at operation not API scope"}),(0,i.jsx)(n.td,{children:"Ensure change applied at All operations level or MCP policy layer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"MCP Servers option missing"}),(0,i.jsx)(n.td,{children:"Preview feature not enabled"}),(0,i.jsx)(n.td,{children:"Enable AI Gateway Early group and wait for maintenance window"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Tool not appearing in client"}),(0,i.jsx)(n.td,{children:"Operation not selected when creating MCP server"}),(0,i.jsx)(n.td,{children:"Edit MCP server and add operation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"429 responses"}),(0,i.jsx)(n.td,{children:"Exceeded rate limits (Akahu or APIM)"}),(0,i.jsx)(n.td,{children:"Add/adjust rate-limit / retry-after policies"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Unexpected empty results"}),(0,i.jsx)(n.td,{children:"Demo bank seeded data differences"}),(0,i.jsx)(n.td,{children:"Confirm with direct Akahu call outside APIM"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Subscription key rejected"}),(0,i.jsx)(n.td,{children:"Wrong product or key rotated"}),(0,i.jsx)(n.td,{children:"Re-copy active key from APIM Subscriptions blade"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Hopefully this walkthrough shows the Akahu MCP setup in action and how you can route Akahu API calls via Azure API Management. Combining your financial data (with appropriate consent) and an LLM can assist with generating summaries or draft insights (e.g., spending categories, high-level comparisons across accounts) without manually crafting each REST call. Always validate model outputs against authoritative data before making financial decisions, and avoid exposing sensitive information beyond what is required for the task."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note: Large Language Models can produce inaccuracies or outdated interpretations. Treat generated insights as assistive, not authoritative, and apply appropriate governance and compliance controls for any production scenario."}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},65577:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/APIM_AIGateway-b70fa27aec16504d363f2c5684c3344d.jpg"},73715:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Akahu_APIM_AddAPI-711dc1b085b3afc83987fc643c325dbb.jpg"},59368:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Akahu_APIM_AddAPI_Accounts-7b06d320b752b117bf78711d282add62.jpg"},49166:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Akahu_AddAkahuMCP-37db1fb07800fa22beeba5c5adc38a8c.gif"},25499:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Akahu_CreateAPIConnection-c2d6a36a1fbc68dde24109fc97eb9682.gif"},63664:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Akahu_MCP_ListAccountsOverview-4942662c7be5f1816c1f9e80472aad9b.jpg"},37715:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Akahu_MCP_mcpjson-c95cd368e1e630f0313b9306f2416314.jpg"},59385:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Akahu_TestAkahuMCP-0c3a8dc5a5919f3de12046b5cd0ef14d.gif"},5548:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Test_APIM_AddAPI_Accounts-48040ed5f630276aa6208d7ad83a49c9.jpg"},95262:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Test_APIM_AddAPI_AddHeaderValues-9ea5ba9de5a350263ab048d82fbc0ad9.jpg"},39715:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Test_APIM_AddAPI_NamedValues-d62c49d64312cc2ccc0d3a3968132e26.jpg"},15813:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Test_APIM_AddAPI_NamedValuesPolicyTest-251af413207236a930a0520d7ef2fef2.jpg"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var a=t(96540);const i={},s=a.createContext(i);function r(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}},36826:e=>{e.exports=JSON.parse('{"permalink":"/azure/akahu-mcp-apim","source":"@site/blog/2025-08-10-akahumcpapim/index.mdx","title":"Expose Akahu APIs via Azure API Management MCP Server","description":"Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code.","date":"2025-08-10T07:59:51.617Z","tags":[{"inline":true,"label":"Azure","permalink":"/tags/azure"},{"inline":true,"label":"API Management","permalink":"/tags/api-management"},{"inline":true,"label":"MCP","permalink":"/tags/mcp"},{"inline":true,"label":"Open Banking","permalink":"/tags/open-banking"},{"inline":true,"label":"Akahu","permalink":"/tags/akahu"}],"readingTime":10.58,"hasTruncateMarker":true,"authors":[{"name":"Luke Murray","title":"Author","url":"https://luke.geek.nz","imageURL":"https://luke.geek.nz/img/logo.png","key":"Luke","page":null}],"frontMatter":{"title":"Expose Akahu APIs via Azure API Management MCP Server","metaDescription":"Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code.","tags":["Azure","API Management","MCP","Open Banking","Akahu"],"categories":["Azure"],"authors":["Luke"],"slug":"azure/akahu-mcp-apim","keywords":["Azure API Management","MCP Server","Akahu","Open Banking New Zealand","API Security"],"description":"Expose Akahu open banking APIs through Azure API Management as an MCP server and call them from VS Code.","date":"2025-08-10T07:59:51.617Z"},"unlisted":false,"nextItem":{"title":"Azure Container Apps with VNC and DOSBox","permalink":"/azure/container-apps-vnc-dosbox"}}')}}]);
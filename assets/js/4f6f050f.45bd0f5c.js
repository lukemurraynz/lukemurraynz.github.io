"use strict";(self.webpackChunklukemurraynz=self.webpackChunklukemurraynz||[]).push([[87496],{52642:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var i=t(85893),r=t(11151);const s={date:"2022-01-12 00:00:00 +1300",title:"Create Azure Point to Site VPN using Microsoft Entra ID authentication",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"uploads/hl_azurep2s.png"},slug:"azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication"},o=void 0,a={permalink:"/azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication",source:"@site/blog/2022-01-11-create-azure-point-to-site-vpn-using-azure-active-directory-authentication.md",title:"Create Azure Point to Site VPN using Microsoft Entra ID authentication",description:"You may be working remotely or only have a few devices needing access to your resources in Azure; a solution that can be deployed is a point to site connection straight into your Microsoft Azure network.",date:"2022-01-12T00:00:00.000Z",formattedDate:"January 12, 2022",tags:[{label:"Azure",permalink:"/tags/azure"}],readingTime:8.23,hasTruncateMarker:!1,authors:[{name:"Luke Murray",title:"Author",url:"https://luke.geek.nz",imageURL:"https://luke.geek.nz/img/logo.png",key:"Luke"}],frontMatter:{date:"2022-01-12 00:00:00 +1300",title:"Create Azure Point to Site VPN using Microsoft Entra ID authentication",authors:["Luke"],tags:["Azure"],toc:!0,header:{teaser:"uploads/hl_azurep2s.png"},slug:"azure/create-azure-point-to-site-vpn-using-azure-active-directory-authentication"},unlisted:!1,prevItem:{title:"AWESOME-Azure-Architecture List",permalink:"/2022/01/16/awesome-azure-architecture-list"},nextItem:{title:"My Website Setup",permalink:"/2022/01/08/my-website"}},c={authorsImageUrls:[void 0]},l=[{value:"Create Azure Point to Site VPN using Microsoft Entra ID authentication",id:"create-azure-point-to-site-vpn-using-microsoft-entra-id-authentication",level:3},{value:"Prerequisites",id:"prerequisites",level:4},{value:"Create Virtual Network",id:"create-virtual-network",level:4},{value:"Create Virtual Network Gateway",id:"create-virtual-network-gateway",level:4},{value:"Setup Microsoft Entra ID authentication on the Virtual Network Gateway",id:"setup-microsoft-entra-id-authentication-on-the-virtual-network-gateway",level:4},{value:"Collect Microsoft Entra ID Tenant ID",id:"collect-microsoft-entra-id-tenant-id",level:5},{value:"Grant Azure VPN Client permisisons",id:"grant-azure-vpn-client-permisisons",level:5},{value:"Configure Point to Site Connection",id:"configure-point-to-site-connection",level:5},{value:"Install and connect using the Azure VPN client",id:"install-and-connect-using-the-azure-vpn-client",level:5}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"You may be working remotely or only have a few devices needing access to your resources in Azure; a solution that can be deployed is a point to site connection straight into your Microsoft Azure network."}),"\n",(0,i.jsxs)(n.p,{children:["This functionality allows your computer to connect privately to resources over a secure tunnel using your internet connection, using an Azure Virtual Network gateway, you can seamlessly connect to resources without the need of opening up your resources to the internet or having to whitelist your ",(0,i.jsx)(n.em,{children:"(or third party vendor)"})," IP address, which may change daily."]}),"\n",(0,i.jsx)(n.p,{children:"You know only your specified users access your Azure resources using Microsoft Entra ID."}),"\n",(0,i.jsx)(n.p,{children:"You can have a site to site and point to site VPN running on the same Gateway today. We will set up a Point to Site VPN using Windows 11."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Azure Point to Site",src:t(7513).Z+"",width:"620",height:"293"})}),"\n",(0,i.jsxs)(n.p,{children:["Depending on the SKU of your Virtual Network Gateway, depends on the number of concurrent connections and throughput you are allowed; because we are using Microsoft Entra ID and the OpenVPN protocol, I will be selecting Generation 1, VpnGw1, supporting a max of 250 connections ",(0,i.jsx)(n.em,{children:"(you can double the number of throughput and connections if you are running in Active/Active and have a second gateway, or select a higher SKU)"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Azure AD authentication is supported for OpenVPN\xae protocol connections only and requires the Azure VPN client."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["A note about Gateway SKUs ",(0,i.jsx)(n.em,{children:"(apart from Basic)"})," you can resize in the same generation ",(0,i.jsx)(n.em,{children:"(i.e. Generation 1 VpnGw1 to VpnGw3, but you can't go from Generation 1 VpnGw1 to Generation 2 VpnGw5, in order to upgrade, you have to delete and recreate the Gateway, just keep this in mind when deciding on the SKU of your resources"}),")."]}),"\n",(0,i.jsxs)(n.p,{children:["You can read more about the Virtual Network Gateways and VPN SKUs at the official Microsoft documentation ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways?WT.mc_id=AZ-MVP-5004796",children:"here"}),"; your Gateway SKU may differ depending on your requirements."]}),"\n",(0,i.jsx)(n.h3,{id:"create-azure-point-to-site-vpn-using-microsoft-entra-id-authentication",children:"Create Azure Point to Site VPN using Microsoft Entra ID authentication"}),"\n",(0,i.jsx)(n.h4,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["An Azure subscription ",(0,i.jsx)(n.em,{children:"(that you have at least contributor rights to and the ability to create Users and Groups)"})]}),"\n",(0,i.jsxs)(n.li,{children:["An endpoint device running Windows 10 or 11 that you can install the ",(0,i.jsx)(n.a,{href:"https://www.microsoft.com/en-us/p/azure-vpn-client-preview/9np355qt2sqb?rtc=2&activetab=pivot:overviewtab",title:" Azure VPN Client",children:"Azure VPN client"})," onto"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"create-virtual-network",children:"Create Virtual Network"}),"\n",(0,i.jsx)(n.p,{children:"First things first, let's create a Virtual Network."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Log in to the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#home",title:"Azure Portal",children:(0,i.jsx)(n.strong,{children:"Azure Portal"})})]}),"\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.strong,{children:"+ Create a resource"})]}),"\n",(0,i.jsxs)(n.li,{children:["Search for: ",(0,i.jsx)(n.strong,{children:"Virtual Network"})," and click on it"]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Create"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Select"})," or create your ",(0,i.jsx)(n.strong,{children:"Resource Group"})," that you want your network resource to sit in ",(0,i.jsx)(n.em,{children:"(I recommend Virtual Network and the gateway resources sit in its own Resource Group away from other resources so that they can be protected by resource locks, RBAC and they are usually classified as a shared resource)"}),"."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure Virtual Network",src:t(68976).Z+"",title:"Azure Virtual Network",width:"782",height:"481"})}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Next: IP Addresses"})]}),"\n",(0,i.jsxs)(n.li,{children:["Now we need to ",(0,i.jsx)(n.strong,{children:"define"})," the ",(0,i.jsx)(n.strong,{children:"Address space"})," and subnets; I will leave the Address space as 10.0.0.0/16 but remove the Default subnet ",(0,i.jsx)(n.em,{children:"(select the checkbox next to the Subnet and select Delete)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click +",(0,i.jsx)(n.strong,{children:"Add Subnet"}),", and add a new subnet with the name of GatewaySubnet with an IP range of: 10.0.1.0/27 ",(0,i.jsx)(n.em,{children:"(this Subnet will be used by our Virtual Network Gateway, and the name needs to be exactly GatewaySubnet)"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Now I will add a subnet named: app servers, for the Virtual Machines I will need to connect to will be placed."}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure Virtual Network",src:t(60794).Z+"",title:"Azure Virtual Network",width:"782",height:"493"})}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Next: Security"})]}),"\n",(0,i.jsxs)(n.li,{children:["Leave everything ",(0,i.jsx)(n.em,{children:"(BastionHost, DDoS Protection Standard, Firewall)"})," as Disabled."]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Next: Tags"})]}),"\n",(0,i.jsxs)(n.li,{children:["Enter in any tags and click ",(0,i.jsx)(n.strong,{children:"Review + Create"})]}),"\n",(0,i.jsxs)(n.li,{children:["Review your configuration and click ",(0,i.jsx)(n.strong,{children:"Create"})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"create-virtual-network-gateway",children:"Create Virtual Network Gateway"}),"\n",(0,i.jsx)(n.p,{children:"Now that we have the foundation of our setup - an Azure Virtual Network, it is time to provision the Gateway itself; just a note before we continue, the Gateway can take 30-60 minutes to provision."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Log in to the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#home",title:"Azure Portal",children:"Azure Portal"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.strong,{children:"+ Create a resource"})]}),"\n",(0,i.jsxs)(n.li,{children:["Type in and search for: ",(0,i.jsx)(n.strong,{children:"Virtual Network Gateway"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Create"})]}),"\n",(0,i.jsxs)(n.li,{children:["Type in the ",(0,i.jsx)(n.strong,{children:"name"})," of your Azure Virtual Network ",(0,i.jsx)(n.strong,{children:"Gateway"})]}),"\n",(0,i.jsxs)(n.li,{children:["Select the ",(0,i.jsx)(n.strong,{children:"region"})," ",(0,i.jsx)(n.em,{children:"(it must be the same region as your virtual network)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Select the Gateway Type: ",(0,i.jsx)(n.strong,{children:"VPN"})]}),"\n",(0,i.jsxs)(n.li,{children:["The VPN type is: ",(0,i.jsx)(n.strong,{children:"Route-based"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Select"})," the ",(0,i.jsx)(n.strong,{children:"SKU"}),", in this example - I will be going with VpnGw1"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Select"})," the ",(0,i.jsx)(n.strong,{children:"Generation"})," of the Virtual Network Gateway; I am going with: Generation 1"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Select"})," the ",(0,i.jsx)(n.strong,{children:"Virtual Network"})," that you created earlier, and it will automatically find and assign the Gateway to the Subnet named: GatewaySubnet"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Select"})," Standard ",(0,i.jsx)(n.strong,{children:"public IP"})," address ",(0,i.jsx)(n.strong,{children:"SKU"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Select Public IP"})," address and select: ",(0,i.jsx)(n.strong,{children:"Create new"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type"})," in your public IP ",(0,i.jsx)(n.strong,{children:"name"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Leave"})," 'Enable active-active mode' and 'Configure BGP' as ",(0,i.jsx)(n.strong,{children:"Disabled"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Review + Create"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure Virtual Network Gateway",src:t(92543).Z+"",title:"Azure Virtual Network Gateway",width:"809",height:"1004"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verify configuration"})," is correct and clicks ",(0,i.jsx)(n.strong,{children:"Create"})]}),"\n",(0,i.jsx)(n.li,{children:"It can take up to 30-60 minutes for the Virtual Network Gateway to be created."}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"setup-microsoft-entra-id-authentication-on-the-virtual-network-gateway",children:"Setup Microsoft Entra ID authentication on the Virtual Network Gateway"}),"\n",(0,i.jsx)(n.p,{children:"Now that the Virtual Network has been created, we can now set up Microsoft Entra ID authentication."}),"\n",(0,i.jsx)(n.h5,{id:"collect-microsoft-entra-id-tenant-id",children:"Collect Microsoft Entra ID Tenant ID"}),"\n",(0,i.jsx)(n.p,{children:"First, we need to collect the Azure AD Tenancy ID"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Log in to the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#home",title:"Azure Portal",children:(0,i.jsx)(n.strong,{children:"Azure Portal"})})]}),"\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.strong,{children:"Microsoft Entra ID"})]}),"\n",(0,i.jsxs)(n.li,{children:["In the Overview pane, ",(0,i.jsx)(n.strong,{children:"copy"})," the ",(0,i.jsx)(n.strong,{children:"Tenant ID"})," and save this for the next step."]}),"\n"]}),"\n",(0,i.jsx)(n.h5,{id:"grant-azure-vpn-client-permisisons",children:"Grant Azure VPN Client permisisons"}),"\n",(0,i.jsx)(n.p,{children:"Now we need to grant the Azure VPN application permissions."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Log in to the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#home",title:"Azure Portal",children:(0,i.jsx)(n.strong,{children:"Azure Portal"})})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Open a new window and type in and press Enter:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://login.microsoftonline.com/common/oauth2/authorize?client_id=41b23e61-6c1e-4545-b367-cd054e0ed4b4&response_type=code&redirect_uri=https://portal.azure.com&nonce=1234&prompt=admin_consent\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If you get an error about external identity, then replace /",(0,i.jsx)(n.strong,{children:"common"}),"/ with your tenant ID."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Azure VPN Permissions",src:t(53437).Z+"",title:"Azure VPN Permissions",width:"458",height:"588"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Accept"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate back to ",(0,i.jsx)(n.strong,{children:"Microsoft Entra ID"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select ",(0,i.jsx)(n.strong,{children:"Enterprise Applications"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Select ",(0,i.jsx)(n.strong,{children:"Azure VPN"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Copy"})," the ",(0,i.jsx)(n.strong,{children:"Application ID"})," of the Azure VPN enterprise application ",(0,i.jsx)(n.em,{children:"(you will need both Application ID and tenant ID for the next steps)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Azure VPN",src:t(25842).Z+"",title:"Azure VPN",width:"652",height:"338"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h5,{id:"configure-point-to-site-connection",children:"Configure Point to Site Connection"}),"\n",(0,i.jsx)(n.p,{children:"Now its time to configure the Virtual Network Gateway"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Log in to the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com/#home",title:"Azure Portal",children:(0,i.jsx)(n.strong,{children:"Azure Portal"})})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Navigate"})," to the Virtual Network ",(0,i.jsx)(n.strong,{children:"Gateway"})," you created earlier"]}),"\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.strong,{children:"Point-to-site configuration"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Configure now"})]}),"\n",(0,i.jsxs)(n.li,{children:["Enter in your ",(0,i.jsx)(n.strong,{children:"address pool"})," ",(0,i.jsx)(n.em,{children:"(this is the address pool of the VPN clients, make sure this doesn't overlap with any other IP range you use, I will go with: 172.0.0.0/16)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Make sure the Tunnel type is: ",(0,i.jsx)(n.strong,{children:"OpenVPN (SSL)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Select ",(0,i.jsx)(n.strong,{children:"Microsoft Entra ID"})," for the ",(0,i.jsx)(n.strong,{children:"Authentication"})," type"]}),"\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.strong,{children:"Tenant, ID enter"})," in: ",(0,i.jsx)(n.a,{href:"https://login.microsoftonline.com/**TENANTID**/",children:"https://login.microsoftonline.com/**TENANTID**/"})," and enter in your own Tenant ID."]}),"\n",(0,i.jsx)(n.li,{children:"For the Audience (this is the users and groups that are assigned to the Enterprise Azure VPN application), put in the Application ID of the Azure VPN."}),"\n",(0,i.jsxs)(n.li,{children:["For the Issuer, enter in: ",(0,i.jsx)(n.a,{href:"https://sts.windows.net/**TENANTID**/",children:"https://sts.windows.net/**TENANTID**/"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure Virtual Network Gateway",src:t(11202).Z+"",title:"Azure Virtual Network Gateway",width:"893",height:"912"})}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Save"})]}),"\n",(0,i.jsx)(n.li,{children:"It may take 1-5 minutes to save the configuration"}),"\n"]}),"\n",(0,i.jsx)(n.h5,{id:"install-and-connect-using-the-azure-vpn-client",children:"Install and connect using the Azure VPN client"}),"\n",(0,i.jsx)(n.p,{children:"Now that the Point to Site VPN has been configured it's time to connect!"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Click on ",(0,i.jsx)(n.strong,{children:"Download VPN client"})," ",(0,i.jsx)(n.em,{children:"(if it is greyed out, then navigate to the Overview pane, then back to the Point-to-site configuration)"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Extract the zip file, you will need these files"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Download"})," the ",(0,i.jsx)(n.a,{href:"https://go.microsoft.com/fwlink/?linkid=2117554",children:"Azure VPN Client"})," to your computer."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure VPN Client",src:t(30262).Z+"",title:"Azure VPN Client",width:"1200",height:"929"})}),"\n",(0,i.jsxs)(n.li,{children:["Once, downloaded click ",(0,i.jsx)(n.strong,{children:"Open."})]}),"\n",(0,i.jsxs)(n.li,{children:["Click the ",(0,i.jsx)(n.strong,{children:"+"})," sign (lower left)"]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Import"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Navigate"})," to the: ",(0,i.jsx)(n.strong,{children:"azurevpnconfig.xml"})," file that you downloaded earlier and click ",(0,i.jsx)(n.strong,{children:"Open"})]}),"\n",(0,i.jsxs)(n.li,{children:["You can change the Connection Name to something more user friendly ",(0,i.jsx)(n.em,{children:"(you can also edit the file directly for when you look at pushing out this to multiple users, but make sure you have a backup of the file)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Save"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure VPN Connection",src:t(78466).Z+"",title:"Azure VPN Connection",width:"1160",height:"850"})}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"Connect"})]}),"\n",(0,i.jsxs)(n.li,{children:["Enter in your Microsoft Entra ID credentials ",(0,i.jsx)(n.em,{children:"(you may be prompted for MFA, depending on the rules - you can use Azure VPN application under conditional access)"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure VPN Connection",src:t(6585).Z+"",title:"Azure VPN Connection",width:"1160",height:"850"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"You should now be connected to the Azure network through a point to site VPN!"})}),"\n",(0,i.jsx)(n.li,{children:"If I run 'ipconfig /all' on my device, I can see a PPP adapter that is connected and on the VPN address range created earlier: 172.0.0.2"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure Point to Site Connections",src:t(83340).Z+"",title:"Azure Point to Site Connections",width:"564",height:"227"})}),"\n",(0,i.jsx)(n.li,{children:"If I navigate back to the Point-to-site connection in the Azure Portal, I can see, my connection has been allocated:"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure Point to Site Connections",src:t(66558).Z+"",title:"Azure Point to Site Connections",width:"871",height:"552"})}),"\n",(0,i.jsx)(n.li,{children:"I can now use Remote Desktop to connect to a Virtual Machine, running in my AppServers Subnet, which I am running without the need of a Public IP or bastion/jump host:"}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.img,{alt:"Azure Point to Site VPN",src:t(67882).Z+"",title:"Azure Point to Site VPN",width:"1380",height:"692"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Note: I don't have a DNS service running in Azure, but the Azure VPN agent will take DNS from the Virtual Network if you have this configured to point towards a DNS server (Active Directory, or other DNS forwarder (pointing towards Azure DNS IP: 168.63.129.16) such as Azure Firewall DNS proxy; you can set Custom DNS servers by modifying your DNS configuration, or add entries into the host file of the computers."}),"\n",(0,i.jsxs)(n.p,{children:["You can set your Custom DNS settings (remember to add the DNS suffix if needed) and configure the VPN to automatically connect by following the details on the ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/vpn-gateway/openvpn-azure-ad-client#faq",title:"Microsoft Entra ID authentication: Configure a VPN client for P2S OpenVPN protocol connections",children:"OpenVPN Azure AD"})," Client page."]}),"\n",(0,i.jsx)(n.p,{children:"Using Intune, you can also push this configuration to your Windows 10 and 11 clients"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/vpn-gateway/vpn-profile-intune?WT.mc_id=AZ-MVP-5004796",children:"Create custom Intune profiles to deploy VPN client profiles"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},11202:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azure-point-to-site-configuration-14d899979995fe8bec94fe6971233b8e.png"},68976:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azureportal-createvirtualnetwork-a1fbd5e45e24eb1276224ba7ce936150.png"},60794:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azureportal-createvirtualnetworksubnets-646829ca5d787c48027b5d59962ab0c0.png"},92543:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azureportal-createvnetfgw-5d497c12b28d82b47ebe4cfe171943d6.png"},53437:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azureportal_azurevpnpermissions-4859ac00017f2a1a732286341841759f.png"},83340:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azurevpn-ipconfig-2c8c0b092f836ec502ad15d41cc3cc31.png"},66558:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azurevpn-p2sconnections-a5656eeefdd5297cec6ce9c2fef165d7.png"},67882:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azurevpn-rdp-1e634ab96e9fa3a4173047be002a127a.png"},25842:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azurevpn_enterpriseappvpn-48f8cda9eb6f9303035c244b742d5c11.png"},6585:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azurevpnclient-afterconnection-17f6b2c4077a7fa39392fc321fddb00c.png"},78466:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/azurevpnclient-beforeconnection-9c72c647ae6b840531511a45307f43b5.png"},7513:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/hl_azurep2s-b91230db64b1534a63ed0a1112fb73ed.png"},30262:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/windowsstore-azurevpn-e3c19700463ac2ec4b149f6c5dffffd5.png"},11151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>o});var i=t(67294);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);